angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,o){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(n,l,i,r){function a(e,t){return t&&"function"==typeof t?function(){e.apply(this,arguments),t.apply(this,arguments)}:e}function s(e){var t=e.data("ui-sortable");return t&&"object"==typeof t&&"ui-sortable"===t.widgetFullName?t:null}function u(e,t){var o=e.sortable("option","helper");return"clone"===o||"function"==typeof o&&t.item.sortable.isCustomHelperUsed()}function c(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}function d(e,t){for(var o=null,n=0;n<e.length;n++){var l=e[n];if(l.element[0]===t[0]){o=l.scope;break}}return o}function m(e,t){t.item.sortable._destroy()}var p,b={},f={"ui-floating":void 0},v={receive:null,remove:null,start:null,stop:null,update:null},g={helper:null};return angular.extend(b,f,e,n.uiSortable),angular.element.fn&&angular.element.fn.jquery?(r?(n.$watch("ngModel.length",function(){t(function(){s(l)&&l.sortable("refresh")},0,!1)}),v.start=function(e,t){if("auto"===b["ui-floating"]){var o=t.item.siblings(),n=s(angular.element(e.target));n.floating=c(o)}t.item.sortable={model:r.$modelValue[t.item.index()],index:t.item.index(),source:t.item.parent(),sourceModel:r.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(e,o){t.item.sortable[o]=void 0})}}},v.activate=function(e,t){p=l.contents();var o=l.sortable("option","placeholder");if(o&&o.element&&"function"==typeof o.element){var i=o.element();i=angular.element(i);var r=l.find('[class="'+i.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');p=p.not(r)}var a=t.item.sortable._connectedSortables||[];a.push({element:l,scope:n}),t.item.sortable._connectedSortables=a},v.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();var o=t.item.parent();t.item.sortable.droptarget=o;var i=d(t.item.sortable._connectedSortables,o);t.item.sortable.droptargetModel=i.ngModel,l.sortable("cancel")}u(l,t)&&!t.item.sortable.received&&"parent"===l.sortable("option","appendTo")&&(p=p.not(p.last())),p.appendTo(l),t.item.sortable.received&&(p=null),t.item.sortable.received&&!t.item.sortable.isCanceled()&&n.$apply(function(){r.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},v.stop=function(e,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?n.$apply(function(){r.$modelValue.splice(t.item.sortable.dropindex,0,r.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||u(l,t)||p.appendTo(l),p=null},v.receive=function(e,t){t.item.sortable.received=!0},v.remove=function(e,t){"dropindex"in t.item.sortable||(l.sortable("cancel"),t.item.sortable.cancel()),t.item.sortable.isCanceled()||n.$apply(function(){t.item.sortable.moved=r.$modelValue.splice(t.item.sortable.index,1)[0]})},g.helper=function(e){return e&&"function"==typeof e?function(t,o){var n=e.apply(this,arguments);return o.sortable._isCustomHelperUsed=o!==n,n}:e},n.$watch("uiSortable",function(e){var t=s(l);t&&angular.forEach(e,function(e,o){return o in f?("ui-floating"!==o||e!==!1&&e!==!0||(t.floating=e),void(b[o]=e)):(v[o]?("stop"===o&&(e=a(e,function(){n.$apply()}),e=a(e,m)),e=a(v[o],e)):g[o]&&(e=g[o](e)),b[o]=e,void l.sortable("option",o,e))})},!0),angular.forEach(v,function(e,t){b[t]=a(e,b[t]),"stop"===t&&(b[t]=a(b[t],m))})):o.info("ui.sortable: ngModel not provided!",l),void l.sortable(b)):void o.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);