<menu-container open-menu-name="openMenuName">
    <menu-item>
        <menu-header>{{ 'تنظیمات کلی' | translate }}</menu-header>
        <menu-body>
            <div>
                <input type="hidden" ng-model="ngModel.map.info.canExportXlsx" value="true" />

                <general-settings ng-model="ngModel.map.info"></general-settings>

                <map-selector prop="ngModel.map.info.map"></map-selector>

                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'رنگ مرزها' | translate }}</label>
                    <span class="form-divider" flex></span>
                    <div class="col-sm-8">
                        <div md-color-picker ng-model="ngModel.map.info.borderColor" md-color-default-tab="'genericPalette'" on-change="refreshChart('refresh')"></div>

                    </div>
                </div>

                <div class="form-row" layout="row" layout-align="start center">
                        <div class="checkbox">
                            <label class="">
                                <input type="checkbox" ng-model="ngModel.map.info.showName" ng-change="refreshChart('refresh')" /> {{ 'نمایش اسامی شهرها' | translate }}
                            </label>
                        </div>
                        <span class="form-divider" ng-show="ngModel.map.info.showName"flex></span>
                        <text-editor prop="ngModel.map.info.nameEditor" ng-show="ngModel.map.info.showName"></text-editor>
                </div>

                <div class="form-row" layout="row" layout-align="start center" >
                    <div class="col-sm-offset-4 col-sm-8">
                        <div class="checkbox">
                            <label class="">
                                <input type="checkbox" ng-model="ngModel.map.info.showLegend" ng-change="refreshChart('refresh')" /> {{ 'نمایش طیف رنگ' | translate }}
                            </label>
                        </div>
                    </div>
                </div>


                <div class="form-row" layout="row" layout-align="start center">
                    <div class="col-sm-offset-4 col-sm-8">
                        <div class="checkbox">
                            <label class="">
                                <input type="checkbox" ng-model="ngModel.map.info.showChart" ng-change="refreshChart('refresh')" /> {{ 'show chart' | translate }}
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-row" layout="row" layout-align="start center" ng-show="ngModel.map.info.showChart">
                    <label class="col-sm-4">{{ 'نوع نمودار' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <select ng-model="ngModel.map.info.chartType" ng-change="refreshChart('refresh')">
                            <option value="pie" selected="selected">{{ 'pie' | translate }}</option>
                            <option value="bar">{{ 'bar' | translate }}</option>
                        </select>
                    </div>
                </div>


                <div class="form-row" layout="row" layout-align="start center" ng-show="ngModel.map.info.showChart">
                    <div class="checkbox">
                        <label class="">
                            <input type="checkbox" ng-model="ngModel.map.info.showChartLegend" ng-change="refreshChart('refresh')" /> {{ 'show chart legend' | translate }}
                        </label>
                    </div>
                    <span class="form-divider" ng-show="ngModel.map.info.showChartLegend" flex></span>
                    <text-editor prop="ngModel.map.info.legendFont" ng-show="ngModel.map.info.showChartLegend"></text-editor>
                </div>




                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'مکان نمایش راهنما' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <style>
                            .position-circles {
                                width: 33px;
                                height: 33px;
                                position: relative;
                                font-size: 11px;
                            }

                                .position-circles .icon.active {
                                    color: #424242;
                                }

                                .position-circles .icon {
                                    position: absolute;
                                    padding: 0;
                                    margin: 0;
                                    line-height: 11px;
                                    color: darkgray;
                                    cursor: pointer;
                                    width: 11px;
                                    height: 11px;
                                }
                        </style>
                        <div class="position-circles">
                            <i ng-click="ngModel.map.info.legendPosition='top left';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='top left'}" class="icon circle" style="top:0;left:0"></i>
                            <i ng-click="ngModel.map.info.legendPosition='top right';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='top right'}" class="icon circle" style="top:0;right:0"></i>
                            <i ng-click="ngModel.map.info.legendPosition='top center';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='top center'}" class="icon circle" style="top:0;left:11px"></i>
                            <i ng-click="ngModel.map.info.legendPosition='bottom left';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='bottom left'}" class="icon circle" style="bottom:0;left:0"></i>
                            <i ng-click="ngModel.map.info.legendPosition='bottom right';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='bottom right'}" class="icon circle" style="bottom:0;right:0"></i>
                            <i ng-click="ngModel.map.info.legendPosition='bottom center';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='bottom center'}" class="icon circle" style="bottom:0;left:11px"></i>
                            <i ng-click="ngModel.map.info.legendPosition='center right';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='center right'}" class="icon circle" style="top:11px;right:0"></i>
                            <i ng-click="ngModel.map.info.legendPosition='center left';refreshChart('refresh')" ng-class="{active: ngModel.map.info.legendPosition=='center left'}" class="icon circle" style="top:11px;left:0"></i>

                        </div>

                    </div>
                </div>


                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'رنگ شروع' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <div md-color-picker ng-model="ngModel.map.info.colorEnd" md-color-default-tab="'genericPalette'" on-change="refreshChart('refresh')"></div>
                    </div>
                </div>
                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'رنگ پایان' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <div md-color-picker ng-model="ngModel.map.info.colorStart" md-color-default-tab="'genericPalette'" on-change="refreshChart('refresh')"></div>
                    </div>
                </div>


                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'حالت نمایش راهنما' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <select class="selectpicker-x form-control" ng-model="ngModel.map.info.tooltip" ng-change="refreshChart('refresh')">
                            <option value="1" selected="selected">{{ 'مجزا' | translate }}</option>
                            <option value="2">{{ 'تمام شاخص‌های پیدا' | translate }}</option>
                            <option value="3">{{ 'تمام شاخص‌ها' | translate }}</option>
                        </select>
                    </div>
                </div>


                <div class="form-row" layout="column" layout-align="start top">
                    <label class="control-label">{{ 'قالب تیتر راهنما' | translate }}</label>
                    <textarea flex class="form-control"
                              ng-change="refreshChart('refresh')"
                              ng-model-options="{ updateOn: 'blur' }"
                              ng-model="ngModel.map.info.tooltipHeader"
                              style="direction:ltr; text-align:left; font-family:monospace; resize:vertical"></textarea>
                    <p class="help-block">
                        متغیرهای قابل استفاده:
                        <code class="inline">
                            set.key
                        </code> ,<code class="inline">
                            set.sum
                        </code> ,<code class="inline">
                            set.avg
                        </code>,<code class="inline">
                            set.points
                        </code>
                    </p>
                </div>
                <div class="form-row" layout="column">
                    <label class="control-label">{{ 'قالب نمایش راهنما' | translate }}</label>
                    <textarea class="form-control"
                              flex
                              ng-change="refreshChart('refresh')" ng-model-options="{ updateOn: 'blur' }"
                              ng-model="ngModel.map.info.tooltipFormat" style="direction:ltr; text-align:left; font-family:monospace;resize:vertical"></textarea>
                    <p class="help-block">
                        متغیرهای قابل استفاده:
                        <code class="inline">
                            point.data
                        </code> ,<code class="inline">
                            point.label
                        </code> ,<code class="inline">
                            point.color
                        </code>
                        <div>
                            تگ‌های مجاز:
                        </div>
                        <div class="ltr text-left">

                            <code>&lt;b&gt;</code>, <code>&lt;strong&gt;</code>, <code>&lt;i&gt;</code>, <code>&lt;em&gt;</code>, <code>&lt;br/&gt;</code>, <code>&lt;span&gt;</code>
                        </div>
                    </p>
                </div>

            </div>
        </menu-body>
    </menu-item>

    <menu-item ng-show="ngModel.series && ngModel.series.length>0" name="series">
        <menu-header>{{ 'مشخصات شاخص‌ها' | translate }}</menu-header>
        <menu-body>
            <div>
                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'شاخص' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <select id="series-selector" class="selectpicker-x form-control" ng-model="ngModel.selectedSeries">
                            <option ng-repeat="i in ngModel.series" value="{{i}}">{{i}} </option>
                        </select>
                    </div>
                </div>

                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'نام شاخص' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <input type="text" class="form-control" placeholder="{{ 'نام شاخص' | translate }}"
                               ng-change="refreshChart('refresh')"
                               ng-model-options="{ updateOn: 'blur' }"
                               ng-model="ngModel.map.series[ngModel.selectedSeries].name" />
                    </div>
                </div>

                <div class="form-row" layout="row" layout-align="start center">
                    <div class="col-sm-offset-4 col-sm-8">
                        <div class="checkbox">
                            <label class="">
                                <input type="checkbox" ng-change="refreshChart('refresh')" ng-model="ngModel.map.series[ngModel.selectedSeries].hidden" /> {{ 'مخفی کردن' | translate }}
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-row" layout="row" layout-align="start center" ng-show="ngModel.map.info.showChart">
                    <label class="col-sm-4">{{ 'رنگ' | translate }}</label>
                    <span class="form-divider" flex></span>
                    <div class="col-sm-8">
                        <div md-color-picker ng-model="ngModel.map.series[ngModel.selectedSeries].color" md-color-default-tab="'genericPalette'" on-change="refreshChart('refresh')"></div>
                    </div>
                </div>


                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'قالب نمایش' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <select class="selectpicker-x form-control" ng-change="refreshChart('refresh')" ng-model="ngModel.map.series[ngModel.selectedSeries].formatString">
                            <option value="A">{{ 'عادی' | translate }}</option>
                            <option value="%">{{ 'درصد' | translate }}</option>
                            <option value=",.0f">#,#</option>
                            <option value=",.1f">#,#.0</option>
                            <option value=",.2f" selected="selected">#,#.00</option>
                        </select>
                    </div>
                </div>

                <top-measure ng-model="ngModel.map.series[ngModel.selectedSeries].top" ng-change="refreshChart('refreshWithData');"></top-measure>

            </div>

        </menu-body>
    </menu-item>

    <table-indicator dimensions="dimensions" measures="measures" prop="ngModel" config="{name:'map', show:[1]}"></table-indicator>

    <global-variable dimensions="dimensions" measures="measures" prop="ngModel"></global-variable>

    <dim-meas-where model="openMenuName" ng-if="!isOlap" dimensions="dimensions" measures="measures" where="where" datasource="datasource"></dim-meas-where>
    <filter-except related-datasource-list="relatedDatasourceList" filter-exception="filterException" datasource="datasource"></filter-except>
    <calculate-fields calculated-fields="calculatedFields"></calculate-fields>
</menu-container>
