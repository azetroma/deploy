<menu-item class="">
    <menu-header style="position:relative" class="pointer">
        <div data-toggle="" href="#alerts">{{ 'هشدارها' | translate }}</div>
    </menu-header>
    <menu-body id="alerts" class="prop-section   form-horizontal">
        <div layout="row" layout-align="start center">
            <p ng-hide="model[config.name].alerts && model[config.name].alerts.length>0" style="font-size: 0.8em;">{{ 'هنوز هشداری تعریف نشده است' | translate }}</p>
            <span flex></span>

            <div class="ui mini icon button" ng-click="newAlert()" title="{{'add' | translate}}">
                <i class="ui icon add"></i> هشدار جدید
            </div>
        </div>

        <div class="ui segment" ng-repeat="alert in model[config.name].alerts">
            <div class="pointer" style="float:left" ng-click="model[config.name].alerts.splice($index, 1)">
                <i class="ui icon close"></i>
            </div>

            <div class="alert-form-group">
                <div class="form-row" layout="row" layout-align="start center">
                    <label class="col-sm-4">{{ 'نوع هشدار' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <select class="form-control" ng-change="" ng-model="alert.type" ng-options="color.name as  color.value for color in [
                                    {name:'sms', value: 'پیام کوتاه'  },
                                    {name:'email', value: 'پست الکترونیک'  },
                                    ]"></select>
                    </div>
                </div>
                <!--<div class="form-row" layout="row" layout-align="start center" ng-show="alert.type=='sms' || alert.type=='email' ">
                    <label class="col-sm-4">{{ 'عنوان پیام ارسالی' | translate }}</label>
                    <span class="form-divider" flex></span><div class="col-sm-8">
                        <input type="text" class="form-control" data-trans-key='عنوان' data-trans-attr='placeholder' ng-model="alert.title" />
                    </div>
                </div>
                <div class="form-row" layout="row" layout-align="start center">
                    <div class="col-sm-12">
                        <label class="left-margin">
                            <input type="checkbox" ng-model="alert.showDatasourceTime" /> {{ 'نمایش زمان به‌روز رسانی منبع داده' | translate }}
                        </label>
                    </div>
                </div>-->
            </div>


            <div ng-repeat="item in alert.rules" ng-init="alert.rules = alert.rules || [{}]">
                <div class="ui tiny secondary pointing menu">
                    <div class="active item">{{ 'شرط‌' | translate }}</div>
                    <div class="right menu">
                    </div>
                </div>
                <sadaf-indicator ng-model="item" series="model.series" hide-then="true"></sadaf-indicator>
            </div>


            <div class="" style="margin:16px 0;">
                <b class="ui tiny header">{{ 'نقش‌ها' | translate }}</b>
                <select-roles ng-model="alert.roles" class="ui tiny form"></select-roles>
                <small class="grey">در صورت انتخاب نقش، به تمام کاربران آن نقش هشدار فرستاده می‌شود</small>
            </div>


            <div class="form-row" layout="row" layout-align="start center" ng-show="alert.type=='command'">
                <label class="col-sm-4 control-label">دستور: </label>
                <span class="form-divider" flex></span><div class="col-sm-8">
                    <input type="text" class="form-control" data-trans-key='دستور' data-trans-attr='placeholder' ng-model="alert.command">
                </div>
            </div>

            <div class="form-row" layout="row" layout-align="start center" ng-show="alert.type=='webservice'">
                <label class="col-sm-4 control-label">آدرس: </label>
                <span class="form-divider" flex></span><div class="col-sm-8">
                    <input type="text" class="form-control" data-trans-key='آدرس' data-trans-attr='placeholder' ng-model="alert.webservice">
                </div>
            </div>

            <datasource-schedule style="margin-top:10px;display:block;" ng-model="alert.schedule"> </datasource-schedule>

            <div class="form-row" layout="row" layout-align="start center" ng-show="alert.type=='sms' || alert.type=='email' ">
                <div class="alert-section" style="margin-top:10px">{{ 'فرمت نمایش' | translate }}</div>
                <span class="form-divider" flex></span>
                <div class="col-sm-12 ltr code">
                    <input type="text" class="form-control" data-trans-key='فرمت نمایش' data-trans-attr='placeholder' ng-model="alert.format" />
                </div>
            </div>

            <div style="text-align:left">
                <span> <code class="inline ltr">@{k}</code>: برچسب</span>
                <span> <code class="inline ltr">@{m}</code>: شاخص</span>
                <span> <code class="inline ltr">@{n}</code>: مقدار</span>
            </div>

            <div class="form-row" layout="row" layout-align="start center">
                <div layout-wrap>
                    <span>{{ 'انتخاب شاخص‌ها' | translate }}</span>
                    <label ng-repeat="s in model.series" class="left-margin">
                        <input type="checkbox"
                               ng-click="toggleSelectedSeries(alert, s)"
                               ng-checked="alert.selectedSeries.indexOf(s)!=-1" /> {{s}}
                    </label>
                </div>
            </div>

            <div ng-show="alert.type=='sms' || alert.type=='email' ">
                <label>{{ 'پیام ارسالی' | translate }}</label>
                <div>
                    <textarea style="width:100%; line-height: 1.85em;" rows="5" ng-model="alert.body"></textarea>
                </div>
            </div>
            <div style="font-size:10px; color:gray;">
                <div> <b class="inline ltr">@{name}</b> نام نمودار </div>
                <div> <b class="inline ltr">@{update-time}</b> زمان به روز رسانی منبع داده </div>
                <div> <b class="inline ltr">@{filters}</b> فیلترهای نمودار </div>
                <div> <b class="inline ltr">@{content}</b> مقادیر شاخص‌ها</div>
            </div>


            <div>
                <br />
                <div class="ui mini icon button" ng-click="preview(alert)" title="{{'add' | translate}}">
                    <i class="ui icon eye"></i> پیش نمایش
                </div>
                <br />

                <div class="ui segment" ng-show="alert.preview!=null">
                    <div><b>نتیجه:</b> {{alert.preview.result}}</div>
                    <div><b>متن پیام:</b><pre style="white-space: pre-wrap;">{{alert.preview.message}}</pre></div>
                </div>
            </div>

        </div>
    </menu-body>
</menu-item>
