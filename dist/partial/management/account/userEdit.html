
<div layout="column" flex>
    <md-content flex class="content " layout="row" >

        <div flex="20" hide-sm hide-xs></div>
        <div flex="60" flex-xs="100" flex-sm="100" class="content-scroll">

            <md-card>
                <md-card-title>
                    <md-card-title-text>
                        <span class="md-headline" ng-hide="isEdit">{{'new_user' | translate}}</span>
                        <span class="md-headline" ng-show="isEdit">{{'edit_user' | translate}}</span>

                    </md-card-title-text>
                </md-card-title>

                <md-content layout-padding>
                    <div>

                        <form name="userForm">

                            <div layout-gt-sm="row" flex>

                                <md-input-container flex>
                                    <label>{{'username' | translate}}</label>
                                    <input required name="name" ng-model="model.Username" xng-disabled="isEdit">
                                    <div ng-messages="userForm.name.$error">
                                        <div ng-message="required">{{'form_username_required' | translate}}</div>
                                    </div>
                                </md-input-container>

                                <md-input-container flex>
                                    <label>{{'name' | translate}}</label>
                                    <input name="name" ng-model="model.FirstName">
                                    <div ng-messages="userForm.name.$error">
                                        <div ng-message="required">{{'form_name_required' | translate}}</div>
                                    </div>
                                </md-input-container>

                                <md-input-container flex>
                                    <label>{{'last_name' | translate}}</label>
                                    <input name="name" ng-model="model.LastName">
                                    <div ng-messages="userForm.name.$error">
                                        <div ng-message="required">{{'form_last_name_required' | translate}}</div>
                                    </div>
                                </md-input-container>

                            </div>

                            <div layout-gt-sm="row" flex>

                                <md-input-container flex="50">
                                    <label>{{'profile_password_new' | translate}}</label>
                                    <input name="password" type="password" ng-model="model.Password">
                                    <div ng-messages="userForm.name.$error">
                                        <div ng-message="required">{{'form_username_required' | translate}}</div>
                                    </div>
                                </md-input-container>
                                <md-input-container flex="50">
                                    <label>{{'profile_password_repeat' | translate}}</label>
                                    <input name="password_repeat" type="password" ng-model="model.PasswordRepeat">
                                    <div ng-messages="userForm.name.$error">
                                        <div ng-message="required">{{'form_name_required' | translate}}</div>
                                    </div>
                                </md-input-container>
                            </div>

                            <div layout-gt-sm="row">

                                <md-input-container flex="50">
                                    <label>{{'profile_phone' | translate}}</label>
                                    <input type="tel" ng-model="model.Mobile">
                                </md-input-container>

                                <md-input-container flex="50">
                                    <label>{{'profile_email' | translate}}</label>
                                    <input type="email" ng-model="model.Email" name="email" ng-pattern="/^.+@.+\..+$/">
                                    <div ng-messages="userForm.email.$error">
                                        <div ng-message="pattern">{{'email_pattern_error' | translate}}</div>
                                    </div>
                                </md-input-container>

                            </div>

                            <md-switch ng-model="model.PasswordPolicy">
                                {{'complicate password' | translate}}
                            </md-switch>

                            <md-switch ng-model="model.ForceChangePass">
                                {{'force change password' | translate}}
                            </md-switch>



                            <h3 class="sadaf-header">
                                {{'profile_settings' | translate}}
                            </h3>

                            <div layout-gt-sm="row" flex>

                                <md-input-container class="md-block" flex>
                                    <label>{{'profile_slide_timeout' | translate}}</label>
                                    <input type="number" ng-model="model.PageSwiching">
                                    <div class="hint">{{'user_slide_desc' | translate}}</div>
                                </md-input-container>

                                <md-input-container class="md-block" flex>
                                    <label>{{'profile_language' | translate}}</label>
                                    <md-select ng-model="model.Lang">
                                        <md-option value="0">فارسی</md-option>
                                        <md-option value="1">English</md-option>
                                    </md-select>
                                </md-input-container>

                                <md-input-container flex>
                                    <label>{{'expire_time' | translate}}</label>
                                    <input type="text" id="user-expire-time" ng-model="model.Expire">

                                </md-input-container>

                            </div>

                            <fieldset class="sadaf-header">
                                <legend layout="row" layout-align="start center">
                                    <span>
                                        {{'متغیرها' | translate}}
                                    </span>
                                    <md-button class="md-icon-button" ng-click="props.push({Value:[]})">
                                        <span class="material-icons">add</span>
                                        <md-tooltip>{{'add' | translate}}</md-tooltip>
                                    </md-button>
                                </legend>

                                <div ng-repeat="p in props" layout="row">
                                    <!--<md-input-container flex="20">
                                        <input type="text" ng-model="p.Key" placeholder="Key" />
                                    </md-input-container>-->

                                    <md-autocomplete flex required md-no-cache="true"
                                                     md-input-name="autocompleteField"
                                                     md-floating-label="{{'نام متغیر' | translate}}"
                                                     md-search-text="p.Key"
                                                     md-items="item in auto. keys | filter:p.Key"
                                                     md-item-text="item"
                                                     md-min-length="0"
                                                     placeholder="{{'نام متغیر' | translate}}">
                                        <md-item-template>
                                            <span md-highlight-text="p.Key" md-highlight-flags="^i">{{item}}</span>
                                        </md-item-template>
                                        <div ng-messages="syncForm.autocompleteField.$error" ng-if="syncForm.autocompleteField.$touched">
                                            <div ng-message="required">{{'form_name_required' | translate}}</div>
                                        </div>

                                    </md-autocomplete>


                                    <md-chips flex ng-model="p.Value" md-autocomplete-snap
                                              placeholder="{{'insert_user_prop_value' | translate}}"
                                              delete-button-label="{{'delete_user_prop_value' | translate}}"
                                              delete-hint="{{'press_delete_user_prop_value' | translate}}"
                                              secondary-placeholder="{{'add_user_prop_value' | translate}}">

                                        <md-autocomplete md-no-cache="true"
                                                         md-search-text="val"
                                                         md-items="item in auto.flatValues | filter:val"
                                                         md-item-text="item"
                                                         md-min-length="0"
                                                         placeholder="{{'add_user_prop_value' | translate}}">
                                            <span md-highlight-text="val">{{item}}</span>
                                        </md-autocomplete>

                                    </md-chips>
                                    <md-button class="md-icon-button" ng-click="props.splice($index, 1)">
                                        <span class="material-icons">delete</span>
                                        <md-tooltip>{{'remove' | translate}}</md-tooltip>
                                    </md-button>

                                </div>
                            </fieldset>

                            <collapse>
                                <collapse-header>{{'roles'| translate}}</collapse-header>
                                <collapse-body>
                                    <div xstyle="margin:0 20px">

                                        <!--<div ng-repeat="r in roles" layout="row" layout-align="start center">
        <md-checkbox style="margin:5px 0;"ng-model="r.check" ng-show="r.isAdmin">{{r.name}}</md-checkbox>
        <a ng-show="r.isAdmin" href="{{app.hashUrlPrefix + '#/roles/edit/' + r.id}}" style="margin:0 14px;" class="material-icons small small-size pointer">open_in_new</a>
    </div>-->


                                        <div class="sadaf-tree" style="margin: 0 40px;">
                                            <div class="tree-element ul" style="list-style:none">
                                                <div ng-repeat="data in root.nodes track by $index" class="tree-element li" ng-include="'xtree.html'"></div>
                                            </div>

                                        </div>
                                        <script type="text/ng-template" id="xtree.html">
                                            <collapse class="block" ng-model="data" hide-icon="{{(!data.nodes || !data.nodes.length ) &&  ( !data.contents || !data.contents.length) }}">
                                                <collapse-header class="block hide-item-parent">
                                                    <span style="margin:0" >
                                                        <md-checkbox style="margin:5px 0;" ng-model="data.check" ng-click="$event.stopPropagation()">{{data.name}}</md-checkbox>
                                                    </span>
                                                </collapse-header>
                                                <collapse-body class="block">
                                                    <div class="tree-element ul" style="list-style:none">
                                                        <div ng-repeat="data in data.nodes track by $index" class="tree-element li" ng-include="'xtree.html'"></div>
                                                    </div>
                                                </collapse-body>
                                            </collapse>
                                        </script>


                                    </div>
                                </collapse-body>
                            </collapse>

                        </form>


                    </div>



                </md-content>




                <md-card-actions layout="row">
                    <span flex></span>

                    <md-button ng-click="save()" ng-disabled="saveProgress">
                        {{saveProgress == false ? ('ذخیره' | translate) : ('در حال ذخیره‌سازی' | translate)}}

                    </md-button>

                </md-card-actions>


            </md-card>

            <md-card ng-show="testResult" flex>
                <md-content style="max-height:200px;" id="card-resize" layout="column" flex>
                    <div ng-bind-html="testResult" flex></div>
                </md-content>
            </md-card>

            <md-card ng-show="error" layout="row" flex>
                <md-content style="background-color:#f2dede" layout="column" flex layout-padding>
                    <div ng-bind-html="error" flex></div>
                </md-content>
            </md-card>

        </div>
        <div flex="20" hide-sm hide-xs></div>

    </md-content>
</div>
