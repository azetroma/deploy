// داشبورد مدیریتی صدف info@sadafdashboard.ir 

function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS)$/.test(a)}var app=app||{};app.contentSegment=$("#content_segment"),app.contentSegmentModal=$("#content_segmentModal"),$.ajaxSetup({beforeSend:function(a,b){if(!csrfSafeMethod(b.type)&&!this.crossDomain){var c=$("input[name=__RequestVerificationToken]").val();a.setRequestHeader("__RequestVerificationToken",c)}}}),console||(console={},console.log=function(){}),app.chartLoadDelay=120,app.absoluteUrl="/",app.setAboluteUrl=function(a){app.absoluteUrl=a},app.loadContent=function(a){app.showLoadingProgress(),$("#content_segment").load(app.urlPrefix+a,function(){app.hideLoadingProgress(),app.lang.setLang()})},app.setContent=function(a){$("#content_segment").html(a),app.hideLoadingProgress(),app.lang.setLang()},app.setLocation=function(a){app.router.navigate(a,{trigger:!0})},app.urlPrefix="/",app.setUrlPrefix=function(a){app.urlPrefix=a.replace(/Moderation.*/g,"")},app.showInfo=function(a){$("#app-info-text").html(a),$("#app-info-text").fadeIn(),$("#app-loading-text").hide(),app.showInfoHolder.show(),setTimeout(function(){app.showInfoHolder.hide(),$("#app-info-text").fadeOut(400,function(){$("#app-loading-text").show()})},4e3)},app.showLoadingProgress=function(){app.showInfoHolder.show()},app.hideLoadingProgress=function(){app.showInfoHolder.hide()},app.showInfoHolder={holderCount:0,timeout:{},hide:function(){if(app.showInfoHolder.holderCount>0&&--app.showInfoHolder.holderCount,0==app.showInfoHolder.holderCount){var a=(new Date).getTime()-app.showInfoHolder.ticks;clearTimeout(app.showInfoHolder.timeout),setTimeout(function(){$("#app-loading").parent("div").animate({top:"0",opacity:0},400)},a<1e3?1e3:0)}},show:function(){var a=$("#app-loading").parent("div");a.css("left",$(window).width()/2-a.outerWidth()/2),++app.showInfoHolder.holderCount,app.showInfoHolder.ticks=(new Date).getTime(),app.showInfoHolder.timeout=setTimeout(function(){$("#app-loading").parent("div").animate({top:"50",opacity:1},400)},1e3)}},app.encodeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},app.convertOldPropObject=function(a,b){if(a){if(a.chartProp&&a.chartProp.info)return a;var c={};if(c.chartProp={},+b==chartTypes.TABLE){c.chartProp.info={chartSize:a.chartProp.chartSize,pivotTable:a.chartProp.pivotTable},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:a.seriesProp[""+d].table.headerName,numberFactor:"1",textAlign:a.seriesProp[""+d].table.textAlign,formatString:a.seriesProp[""+d].table.formatString,fontSize:a.seriesProp[""+d].table.fontSize,textBold:!1,textItalic:!1,color:a.seriesProp[""+d].table.fontColor}),c.chartProp.series["default"]={name:"",numberFactor:"1",textAlign:"right",formatString:"A",fontSize:"1m",textBold:!1,textItalic:!1,color:"#000000"}}if(+b==chartTypes.BAR){c.chartProp.info={chartSize:a.chartProp.chartSize,horizontalLines:a.chartProp.horizontalLine,formatString:a.chartProp.formatString},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:"",numberFactor:a.seriesProp[""+d].barlineChartProp.numberFactor,seriesType:a.seriesProp[""+d].barlineChartProp.barlineChartType,seriesColor:a.seriesProp[""+d].barlineChartProp.barlineChartColor,lineType:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartStyle,lineStyle:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineStyle,lineWeight:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineWeight,lineFace:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineDashes});c.chartProp.series["default"]={name:"",numberFactor:"1",seriesType:"bar",seriesColor:"#1f77b4",lineType:"line-dot-area",lineStyle:"linear",lineWeight:"2",lineFace:"5,0"}}return+b==chartTypes.PIE&&(c.chartProp.info={horizontalLines:a.chartProp.horizontalLine,chartSize:a.chartProp.chartSize,formatString:a.chartProp.formatString,pieStyle:a.chartProp.pieStyle,hole:"65"},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1"}),+b==chartTypes.GAUGE&&(c.chartProp.info={chartSize:a.chartProp.chartSize,style:a.chartProp.gaugeStyle,height:"medium",color:"#333333",fontSize:"3em",formatString:",.2f",status:"",target:"",textBold:!0,textItalic:!1,trend:"",value:"",segmentType:"singleSegment",min:"",yellow:"",green:"",max:""},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1",type:"value",typeMs:"value"}),c.dataUrl=a.chartProp.DataUrl,c.editMode=a.chartProp.editMode,c}},app.autoPlayTimer=app.autoPlayTimer||{counter:0},app.autoPlay=function(a,b){if(a&&"start"==a){var c=function(a){b=b||10,$(".sadaf-circular-preogress").progressbar(10,1e3*+b),app.autoPlayTimer.timer=setTimeout(function(){document.location.href=app.urlPrefix+"#/app/"+a.appId+"/dashboard/"+a.id,$(".sadaf-circular-preogress").progressbar("stop"),app.autoPlay("start",b)},1e3*+b)};app.autoPlayTimer.links?c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length]):$.get(app.urlPrefix+"api/menus/get").done(function(a){app.autoPlayTimer.links=a,c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length])})}a&&"stop"==a&&($(".sadaf-circular-preogress").progressbar("stop"),clearTimeout(app.autoPlayTimer.timer))};var resizeTimer;app.lestenWindowResize=function(a){function b(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){a()},400)}var c=$(window).width();$(window).resize(function(){$(window).width();$(window).width()!=c&&(c=$(this).width(),b())})};var designMenuTimer,printMenuTimer;app.onMenusClick=function(a,b){return"showPrintMenu"==a||"hidePrintMenu"==a?(clearTimeout(printMenuTimer),void(printMenuTimer=setTimeout(function(){"showPrintMenu"==a?$(".navbar .print-toggle").fadeIn():"hidePrintMenu"==a&&$(".navbar .print-toggle").fadeOut()},800))):(clearTimeout(designMenuTimer),designMenuTimer=setTimeout(function(){"showDesignMenu"==a?$(".navbar .design-toggle").fadeIn():"hideDesignMenu"==a&&$(".navbar .design-toggle").fadeOut(),b&&"showfullScreenMenu"==b?$(".navbar .fullscreen-toggle").parents(".pull-right").fadeIn():$(".navbar .fullscreen-toggle").parents(".pull-right").fadeOut()},800),void $("html,body").animate({scrollTop:0},"slow",function(){$(".side-menu").hasClass("open")&&$("#side-menu-toggle").click()}))},app.print={printSingle:function(a,b){var c=this.getWidgetHtml(a);app.print.print(c,b,null,null,a)},getWidgetHtml:function(a){var b=($(a).height(),$(a).width(),$(a).clone());b.find(".ui.dimmer .dimmer-info").html();b.find(".ui.dimmer ").remove(),b.find(".gs-resize-handle").remove(),b.find(" #sort_checkbox").remove(),b.find(" .comment").remove(),b.find(" .menu-bar").remove();var c=$("<div>").append(b).html();return c},printPage:function(){var a="",b=$("<div/>");b.append(a);$(".dashboard-page.active > a").text()},print:function(a,b,c,d,e){var f=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(f=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var g='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+f+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",h=window.open();h.window.onafterprint=function(){h.window.close()},h.document.write('<html><head><meta charset="utf-8"><title>'+b+"</title>"+g),h.document.write("</head><body>"),h.document.write(a),h.document.write("</body></html>"),h.document.close(),h.focus();try{var i=$(e).find("canvas")[0],j=h.document.getElementsByTagName("canvas")[0];j.width=i.width,j.height=i.height;var k=j.getContext("2d");k.drawImage(i,0,0)}catch(l){}setTimeout(function(){h.print(),h.window.onfocus=function(){}},400)},printHeaderFooter:function(a,b,c,d,e,f,g){function h(){return'<html>                                                                                                                        <head>                                                                         <meta http-equiv=Content-Type content="text/html; charset=unicode">    <title>'+b+"</title> "+j+"       <style>                                                                        body, html {                                                                   margin: 0;                                                                 direction: rtl;                                                            width: 21cm;                                                               font-family: IRMitra !important;                                           font-size: 21px;                                                           text-align: justify;                                                       color: black;                                                   }                                                                                                                                                            table.report-container {                                                       page-break-after: always;                                                  font-size:inherit;                                                         text-align: inherit;                                                   }                                                                                                                                                     thead.report-header {                                                          display: table-header-group;                                               background-color: #00000000;                                           }                                                                                                                                                     tfoot.report-footer {                                                          display: table-footer-group;                                               background-color: #00000000;                                           }                                                                                                                                                     .back {                                                                        position: fixed;                                                           top: 0;                                                                    z-index: -1;                                                           }                                                                                                                                                     u {                                                                            text-decoration: unset;                                                    border-bottom: 1px solid black;                                            line-height: 1;                                                            display: inline-block;                                                 }                                                                          .content {                                                                     width: 21cm;                                                               padding: 0 2cm;                                                        }                                                                                                                                                         .content p {                                                                   margin: 0;                                                                 line-height:1.9;                                                           margin-bottom: 10px;                                                   }                                                                                                                                                 @page {                                                                        margin: 0cm;                                                           }                                                                                                                                                                                                                                .center {                                                                      text-align: center;                                                    }                                                                                                                                                     .flex {                                                                        display: flex;                                                             -ms-flex-direction: row;                                                   -webkit-flex-direction: row;                                               flex-direction: row;                                                   }                                                                      </style>                                                               </head>                                                                                                                                               <body>                                                                         "+(e?'<img class="back" src="/api/upload/getPic/'+e+'" />':"")+'                                                                 <table class="report-container">                                                                <thead class="report-header">                                                                   <tr>                                                                                            <th>                                                                                            <div style="height:'+(f||3)+'cm">                                                                                       </div>                                                                                  </th>                                                                                   </tr>                                                                                   </thead>                                                                                    <tfoot class="report-footer">                                                                   <tr>                                                                                            <td>                                                                                            <div style="height:'+(g||3)+'cm">                                                                                       </div>                                                                                  </td>                                                                                   </tr>                                                                                   </tfoot>                                                                                    <tbody class="report-content">                                                                  <tr>                                                                                            <td>                                                                                            <div class="content"> '+a+"</div>                                                                                  </td>                                                                                   </tr>                                                                                   </tbody>                                                                                </table>                                                                                </body>                                                                                     </html>"}var i=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(i=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var j='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+i+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",k=window.open();k.window.onafterprint=function(){k.window.close()},k.document.write(h()),k.document.close(),k.focus(),setTimeout(function(){k.print(),k.window.onfocus=function(){}},400)}},app.post=function(a,b,c){$.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json; charset=utf-8",traditional:!0,success:c})},app.lang={langType:0,setLangTyle:function(a){this.langType=+(a||0)},isRtl:function(){return 0==app.lang.langType},translate:function(a){return app.lang.lang?app.lang.lang[a]||a:a},q:[],translateAsync:function(a,b){app.lang.lang?b&&b(app.lang.lang[a]||a):this.q.push({key:a,callback:b})},setLang:function(a){if(a&&a.data&&(this.lang=a.data),this.lang||!this.inProgress){if(!this.lang&&!this.inProgress){var b=0==app.lang.langType?"fa":"en";this.inProgress=!0;var c=app.urlPrefix+"dist/locales/locale-"+b+".js?v="+app.version;return void $.getJSON(c,null,function(a){for(app.lang.setLang({data:a});app.lang.q.length>0;){var b=app.lang.q.pop();b.callback&&b.callback(app.lang.lang[b.key]||b.key)}})}var d;d=a&&a.selector?$(a.selector).find("*[data-trans-key]"):$("*[data-trans-key]"),d.each(function(){var a=$(this),b=a.data("translated");if(!b){var c=app.lang.lang[a.data("trans-key")],d=a.data("trans-attr");d?a.attr(d,c):a.text(c),a.data("translated",!0)}})}}};var app=app||{};app.dashboardLayoutVersion=2;var dashboard={defuals:{maxCols:12},charts:[],pageInfo:{},pageId:-1,arrangePer:!1,minChartSize:{1:[500,250],2:[350,350],3:[300,200],4:[300,300],5:[500,300],6:[300,200],7:[350,50],8:[300,300],9:[300,300]},padding:10,maxCols:12,baseDimantion:{y:30},serialize:function(){dashboard.gs.serialize()},drillDownResize:function(a,b){},setMaxCols:function(){var a=dashboard.getPagePosition();dashboard.maxCols=a?a.maxCol||12:12,$("#dashboard-col").val(dashboard.maxCols)},setInfo:function(a,b,c,d,e){this.arrangePer=d||!1,this.charts=a||[],this.pageInfo=b||{chartsOrder:[],layout:[],pageLayout:"30_30_30"},this.pageId=c||-1,this.forms=e||[],this.charts=this.charts.concat(this.forms),this.setMaxCols()},disable:function(){dashboard.gs.disable(),dashboard.gs.disable_resize()},enable:function(){dashboard.gs.enable(),dashboard.gs.enable_resize()},saveSerialize:function(){dashboard.serializeData=dashboard.gs.serialize();var a=dashboard.serializeData.map(function(a){var b;return b="form"===a.type?a.id:a.data.ChartInPageId,{type:a.type,chartIdPageId:b,col:a.wgd.col,row:a.wgd.row,size_x:a.wgd.size_x,size_y:a.wgd.size_y}}),b={pageId:this.pageId,chartsPosition:a,media:dashboard.media,maxCol:dashboard.maxCols};try{"undefined"==typeof dashboard.pageInfo.layout&&(dashboard.pageInfo.layout=[]);var c=dashboard.pageInfo.layout.filter(function(a){return a.media===dashboard.media});c.length>0?c[0].chartsPosition=a:dashboard.pageInfo.layout.push({media:dashboard.media,chartsPosition:a,maxCol:dashboard.maxCols})}catch(d){}$.ajax({type:"POST",url:app.urlPrefix+"api/DashboardPage/SetChartsOrder",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(a){}})},add:function(a,b,c,d,e){b=b>dashboard.maxCols?dashboard.maxCols:b,d=d>dashboard.maxCols?dashboard.maxCols:d,dashboard.gs.add_widget(a,b,c,d,e)},initGs:function(a){return dashboard.baseDimantion={x:$(".gridster").width()/dashboard.maxCols,y:50},dashboard.gs=$(".gridster>div").gridster({widget_margins:[0,0],widget_base_dimensions:[dashboard.baseDimantion.x,dashboard.baseDimantion.y],max_cols:dashboard.maxCols,min_cols:dashboard.maxCols,min_rows:1e3,resize:{enabled:!0,stop:function(a,b,c){dashboard.saveSerialize();var d=$(c).data("type");if("form"!==d){var e=$(c).find(".chart-data").data("settings");e.isDashboardResize=!0,$(c).find(".chart-data").charts(e.type,"refresh",e),e.widgetSize.size_y=+$(c).attr("data-sizey"),e.widgetSize.size_x=+$(c).attr("data-sizex")}}},serialize_params:function(a,b){var c=a.data("type"),d=a.data("id");return{type:c,id:d,data:a.find(".chart-data").data("settings"),wgd:b}},draggable:{handle:".content > .move, content > .move b, .content .title-content",cancel:".desc",start:function(a,b){},drag:function(a,b){},stop:function(a,b){$(b.$helper).removeClass("player-revert"),dashboard.saveSerialize()}}}).data("gridster"),a||(dashboard.gs.disable(),dashboard.gs.disable_resize()),dashboard.gs},deleteAll:function(){$("#ID0").data("settings");dashboard.gs.remove_widget($("#ID0"))},deleteChartFromGs:function(a,b){var c=$(a).parents(".chart-widget");dashboard.gs.remove_widget(c),b&&b()},getPagePosition:function(){var a=dashboard.pageInfo.layout.filter(function(a){return a.media<=dashboard.media}).sort(function(a,b){return+b.media-+a.media});if(0==a.length){var b=_.map(dashboard.pageInfo.layout,function(a){return a.media}),c=-1,d=1e3;_.each(dashboard.pageInfo.layout,function(a,b){var e=Math.abs(a.media-dashboard.media);e<d&&(d=e,c=b)}),c!=-1&&(a=[dashboard.pageInfo.layout[c]],a[0].media=b,a[0].maxCols=dashboard.maxCols)}return a[0]},getChartPosition:function(a,b,c){var d,e=null,f=1e3;"form"===a.type?(e="form",d=a.id):(d=a.pageId,f=+a.type);var g=dashboard.minChartSize[+f]||[300,300],h={col:1,row:1e3,size_x:Math.floor(g[0]/dashboard.baseDimantion.x)+1,size_y:Math.floor(g[1]/dashboard.baseDimantion.y)+1},i=[];try{var j=dashboard.getPagePosition();i=j.chartsPosition.filter(function(a){return a.chartIdPageId===d&&(!a.type||a.type===e)})}catch(k){}return i[0]||h},sortCharts:function(){try{this.charts.sort(function(a,b){try{var c=dashboard.getChartPosition(a),d=dashboard.getChartPosition(b),e=c.row==d.row?c.col>d.col?1:c.col<d.col?-1:0:c.row>d.row?1:c.row<d.row?-1:0;return e}catch(f){return-1e3}})}catch(a){Error(a)}},addTasks:[],drow:function(a){dashboard.initGs(this.arrangePer),dashboard.sortCharts();var b=0;this.charts.forEach(function(c,d){7!=+c.type&&b++;var e=b,f=setTimeout(function(){dashboard.addChart(c,null,!1,e*app.chartLoadDelay),d==dashboard.charts.length-1&&a&&a()},50*d);dashboard.addTasks.push(f)})},resize:function(){this.setMaxCols();var a=$(".chart-data").map(function(a,b){return $(b).data("settings")}).toArray();$(".gridster").remove(),$("#dashboard-chart-panel").html('<div class="gridster"><div></div></div>'),dashboard.initGs(this.arrangePer),a.forEach(function(a){dashboard.addChart(null,a,!0)}),dashboard.forms&&_.each(dashboard.forms,function(a){dashboard.addChart(a)})},addChart:function(a,b,c,d,e){var f;if(a&&"form"===a.type){var g=dashboard.getChartPosition(a),h=app.absoluteUrl+"sadaf/management/#/forms/"+a.id,i=!1,j="javascript:dashboard.deleteForm("+a.id+")",k=!1,l="";f=$('<div data-type="form" data-id="'+a.id+'" class="chart-widget"></div>');var m=dashboard.getFormTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.name,o,a.lastRefresh,l,k);f.append(m),f.find(".title-content").text(a.name),dashboard.add(f,g.size_x,g.size_y,g.col,g.row),$("body").trigger("form-widget-add",[a.id]),app.lang.setLang({selector:"div[data-type=form][data-id="+a.id+"]"})}else{"undefined"==typeof d&&(d=0),b&&(a={id:b.chartId,pageId:b.ChartInPageId,title:"undefined"!=typeof b.title?b.title:b.input.title,type:b.type.id,isCustom:b.type.isCustom,permissions:b.permissions,lastRefresh:b.lastRefresh,desc:b.desc});var n={chartId:a.id,ChartInPageId:a.pageId},o="ID"+a.pageId,p=b;b||(p=JSON.parse(a.detail));var q=p.chartProp.info||{},r=app.customChart.getConfig({isCustom:a.isCustom,id:+a.type},q),s=r.needServerData!==!1;q.dontShowTitle===!0&&(r.noTitle=!0),r.noTitle&&(q.dontShowTitle=!0),q.noPadding===!0&&(r.noPadding=!0);var k=!(!s||!a.isCustom&&7==+a.type),i=!(!s||!a.isCustom&&7==+a.type),h=app.absoluteUrl+"sadaf/management/#/charts/edit/0/"+n.chartId,j="javascript:dashboard.deleteChart("+n.ChartInPageId+", "+n.chartId+", "+a.permissions.DeletePermission+")",l=$("<p />");_.isEmpty(a.desc)||(l.html("<br/><b>"+app.lang.translate("desc")+":</b> "),l.append($("<span />").text(a.desc)));var t="combo-kpi"==p.dataType,m=dashboard.getChartTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.title,o,a.lastRefresh,l,k,t,r,q);if(f=$("<div class='chart-widget cid"+a.pageId+"'></div>"),e&&c&&e.find(".chart-data").data("isChart")?f=e.find(".chart-widget.cid"+a.pageId):f.append(m),f.find(".title-content").remove(),a.title&&!q.dontShowTitle&&(f.find(".title").append('<span class="title-content"></span>'),f.find(".title-content").text(a.title),f.find(".title-content").attr("title",a.title),f.find(".header.move").remove()),f.find(".desc-content").append(l),app.chartCommons.setBackground(f.find(".ui.card "),q),q.titleFont){var u=q.titleFont.align||"";app.lang.isRtl()||(u="right"===u?"left":"left"===u?"right":u),f.find(".ui.card .title-content").css({"font-size":q.titleFont.fontSize,color:q.titleFont.color,"font-family":q.titleFont.fontName,"font-weight":q.titleFont.bold?"bold":"normal","font-style":q.titleFont.italic?"italic":"normal","text-align":u}),f.find(".ui.card .title").css({"line-height":"1"})}f.find(".ui.card .title").css({"line-height":"1.2"}),r.noPadding&&f.find(".ui.card .title + .description").addClass("chart-fit-to-container"),a.permissions.Filter||f.find(".icon.filter").remove(),a.permissions.Description||f.find(".icon.info").remove(),a.permissions.Comment||f.find(".icon.comments").remove(),a.permissions.ExportExcel||f.find(".item.export-excel").remove(),a.isCustom&&f.find(".export-png").remove();var b=b||$.extend({permissions:a.permissions,parameters:n,chartId:n.chartId,editLink:h,removeLink:j,RemoveFromPage:this.arrangePer,ChartInPageId:a.pageId,input:{RefreshDatasource:a.RefreshDatasource},lastRefresh:a.lastRefresh,desc:a.desc,type:a.type,isCustom:a.isCustom},p);if(g=dashboard.getChartPosition(a),b.widgetSize=g,e)return void(c&&e.find(".chart-data").data("isChart")?e.find(".chart-data").charts(b.type,c,b):(e.append(f),f.find(".menu-bar ").remove(),f.find(".chart-data").charts(b.type,b)));if(dashboard.add(f,g.size_x,g.size_y,g.col,g.row),c&&e&&e.find(".chart-data").data("isChart"))f.find(".bar-chart").data("settings",b),f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refresh",b,!0);else{var v=setTimeout(function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},b)},a.isCustom||7!==+a.type?d:0);dashboard.addTasks.push(v)}app.lang.setLang({selector:".chart-widget.cid"+a.pageId})}f.find(".show-extra-info").on("click",function(){f.find(".ui.card .ui.dimmer.overflow-auto").dimmer("show")}),f.find(".dimmer-info").on("click",function(){f.find(".ui.card .ui.dimmer").dimmer("hide")}),f.find(".refresh-chart").on("click",function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refreshWithData",b,!0),f.find(".bar-chart").data("settings").titlebar.showProgress(!0)}),f.find(".export-excel").on("click",function(){var a=f.find(".chart-data").data("settings");app.chartCommons.setFilterParameter(a);try{a.parameters.TableInfo.IsPageValid=!0}catch(c){}$.ajax({type:"POST",url:app.urlPrefix+"api/BarChart/ExportToExcel",data:JSON.stringify({ChartId:b.chartId,ChartInPageId:b.ChartInPageId,TableInfo:a.parameters.TableInfo,IsPivot:1===+p.chartProp.info.aggregation,drillDown:a.parameters.drillDown,userControlFilter:a.parameters.userControlFilter,userVariable:a.parameters.userVariable,otherFilters:a.parameters.otherFilters,filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId)}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){window.location=app.urlPrefix+"api/BarChart/Download?name="+a.id}})}),f.find(".export-png").on("click",function(){var b=f.get(0);html2canvas(b,{background:null,scale:5,useCORS:!0,onclone:function(b){$(b).find(".cid"+a.pageId+" .header").remove(),$(b).find(".cid"+a.pageId+" .menu-bar").remove(),$(b).find(".cid"+a.pageId+" .title-content").css("padding","10px 0"),$(b).find(".cid"+a.pageId+" #sort_checkbox").remove(),$(b).find(".cid"+a.pageId+" .comment").remove(),$(b).find(".cid"+a.pageId+" .ui.card").css("background","none"),$(b).find(".cid"+a.pageId+" rect.background").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart .line").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart circle").css("fill","#fff"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("fill","none"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke-width","1px"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke","#000"),$(b).find(".cid"+a.pageId+" *").css("font-family","IRANSans,Droid,Tahoma,Arial"),$(b).find(".cid"+a.pageId+" .map-container  #state-borders").css("fill","none")}}).then(function(b){b.fillStyle=null,b.fillRect=null,b.toBlob(function(b){saveAs(b,a.title+".png")})})}),f.find(".export-print").on("click",function(){app.print.printSingle(".cid"+a.pageId,a.title)}),f.find(".clone-chart").on("click",function(){app.post(app.urlPrefix+"api/Charts/CloneChart",{Id:b.chartId,PageId:dashboard.pageId},function(a){if(a.result&&a.insertedId){var b=a.insertedId,c=app.urlPrefix+"api/dashboards/getSingleChartInfo?chartId="+b+"&chartInPageId="+a.chartInPageId;$.get(c,function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1),$("html, body").animate({scrollTop:$(document).height()-$(window).height()},1e3)})}})}),f.find(".chart-dimentions").on("click",function(){f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade")}),f.find(".show-chart-dimensions").on("click",function(){var a=f.find(".chart-dimentions-content");f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade"),""==a.html()&&(a.html('<div class="ui text active loader">در حال بارگذاری</div>'),$.ajax(app.urlPrefix+"api/chartdata/GetChart?Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId).done(function(c){
function d(a,b){return null!=a?"<ul class='sortable list-unstyled pointer' index='"+b+"'>"+a.map(function(a,b){return a.ShowFilter?'<li value="'+filterXSS(a.Uniquename)+'">  '+filterXSS(a.Caption)+'<i class="icon filter filter-member-dialog" style="float:left; margin-right:5px;"></i></li>':'<li value="'+filterXSS(a.Uniquename)+'"> '+filterXSS(a.Caption)+"</li>"}).join("")+"</ul>":""}function e(){function d(b,c){var d=b[c],e=[];a.find("ul[index="+c+"] li").each(function(a,b){var c=$(this).attr("value"),f=$.grep(d,function(a){return a.Uniquename==c})[0];f.Members=$(this).data("members"),e.push(f)}),b[c]=e}d(c,"Hierarchies"),d(c,"Where"),d(c,"SeriesLevel");var e=function(a){b.parameters={filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId),chartId:b.chartId,ChartInPageId:b.ChartInPageId},$("#ID"+b.ChartInPageId).charts({id:b.type,isCustom:b.isCustom},"refreshWithData",b,{refreshRelatedDatasources:!1})};e(c)}a.data("data",c);var f=null,g=null,h=null;f=d(c.Hierarchies,"Hierarchies"),g=d(c.Where,"Where"),h=d(c.SeriesLevel,"SeriesLevel");var i='<table class="ui single line unstackable table chart-design" xstyle="display:none" xstyle="position:absolute;margin-bottom:0px; background-color:#fff;display:none; border-bottom:1px solid silver">                                           <thead><tr class="">                                             <th style="'+(""==h?"display:none":"")+'"><span data-trans-key="شاخص‌ها (ستون‌های عددی)" > </span> </th>                                             <th style="'+(""==f?"display:none":"")+'"><span data-trans-key="ابعاد (ستون‌های رشته‌ای)" > </span> </th>                                             <th style="'+(""==g?"display:none":"")+'"><span data-trans-key="شرط" > </span></th>                                         </tr></thead>                                         <tr>                                             <td  style="'+(""==h?"display:none":"")+'"id="div-x" class="myc">'+h+'</td>                                             <td  style="'+(""==f?"display:none":"")+'"id="div-y" class="myc">'+f+'</td>                                             <td  style="'+(""==g?"display:none":"")+'"id="div-where" class="myc">'+g+"</td>                                         </tr>                                     </table>";a.html(i),a.find(".filter-member-dialog").on("click",function(){function a(a,b){app.helper.filterMemberDialog(a,b,function(a){d.data("members",a),e()})}var d=$(this).parent(),f=$(this).parent().attr("value"),g=c[$(this).closest("ul").attr("index")],h=($.grep(g,function(a,b){return a.Uniquename==f})[0],$(this).parent().data("members")),i=app.urlPrefix+"api/chartdata/GetMemberOfFilterHierarchy?Uniquename="+f+"&Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId;"undefined"==typeof h?$.ajax(i).done(function(b){$(this).parent().data("members",b),a(b,i)}):a(h,i)}),a.find(".sortable").sortable({start:function(a,b){b.placeholder.addClass("filter-placeholder"),b.placeholder.height(b.item.height()),b.placeholder.width(b.item.width()),b.placeholder.parent().width(b.item.width()),b.placeholder.parent().parent().width(b.item.width())},stop:function(a,b){e()}}),app.lang.setLang({selector:a.selector})}))}),f.find(".dropdown").lazyDropdown({onShow:function(a,b){f.find(".menu-bar").addClass("show-dropdown")},onHide:function(a,b){f.find(".menu-bar").removeClass("show-dropdown")}}),this.showEmptyMessageIfNeed()},showEmptyMessageIfNeed:function(){0==dashboard.charts.length?$("#chart-empty-message").hasClass("hidden")&&$("#chart-empty-message").transition("scale in"):$("#chart-empty-message").hasClass("hidden")||$("#chart-empty-message").transition("scale out")},deleteChart:function(a,b,c){if(a)c?$("#deleteChart .checkbox").show():$("#deleteChart .checkbox").hide(),$("#deleteChart").data("cId",a),$("#deleteChart").data("chartId",b),$("#deleteChart").modal("show");else{var a=$("#deleteChart").data("cId"),b=$("#deleteChart").data("chartId"),d=app.urlPrefix+"api/dashboardPage/removeChartFromPage";$("#deleteChart .action-btn").addClass("loading"),$.post(d,{ChartInPageId:a,pageId:dashboard.pageId},function(b){if(0==b)return void alert("شما مجوز پاک کردن این نمودار را ندارید");for(var c,d=0;d<dashboard.charts.length;d++)if(dashboard.charts[d].pageId==a){c=dashboard.charts[d].pageId,dashboard.charts.splice(d,1)}dashboard.deleteChartFromGs("#ID"+c,function(){$(this).remove(),dashboard.showEmptyMessageIfNeed()}),$("#deleteChart").modal("hide"),$("#deleteChart .action-btn").removeClass("loading")});var e=$("#delete-from-dash").prop("checked");e&&$.post(app.urlPrefix+"api/Charts/DeleteCharts",{Ids:["ChartId-"+b]},function(a){})}},deleteForm:function(a){$("body").trigger("delete-form",[a,dashboard.pageId])},setReturnUrl:function(a){app.mobileMode||(localStorage.setItem("returnUrl",window.location.href),localStorage.setItem("lastEditedChartId",a))},getChartTemplate:function(a,b,c,d,e,f,g,h,i,j,k,l){return'<div class="ui card">  <div class="content" style="">    <div class="header '+(a?"move":"")+'" style="position:absolute; width:50%;z-index:2;">&nbsp;</div>    <div class="title'+(l.noTitle===!0?" no-title ":a?" move":"")+'">            <div class="menu-bar" style="z-index:3;">                <i class="icon titlebar-icon" style="xbackground: #fff;width: 100%;position: absolute;display: block;top: 0;height: 100%;"></i>                '+(app.mobileMode?e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"":'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon titlebar-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit outline icon"></i></a>':"")+"                          "+(b?' <a class="item clone-chart"><span data-trans-key="تکرار" > </span> <i class="clone outline icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف نمودار از صفحه" > </span> <i class="trash alternate outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-excel"><span data-trans-key="خروجی اکسل" > </span> <i class="file excel outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-png"><span data-trans-key="export png"> </span> <i class="camera icon"></i></a>':"")+"                          "+(e?'<a class="item refresh-chart">'+app.lang.translate("data refresh")+' <i class="refresh icon"></i></a>':"")+"                          "+(j?'<a class="item export-print"><span data-trans-key="print" > </span> <i class="print icon"></i></a>':"")+'                        </div>                </div>                <div class=" ">                    '+(e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"")+"                    "+(!e||k?"":'<i class="filter icon chart-setting-icon show-chart-dimensions pointer titlebar-icon"></i>')+"                    "+(e&&app.commentOnChart?'<i class="comments icon chart-setting-icon show-chart-comments pointer titlebar-icon"></i>':"")+"                </div>")+'            </div>            </div>    <div class="description chart-data bar-chart" id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader mini"></div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: '+(app.mobileMode?"0":"4")+'px !important;"><div class="content"><div class="center"><div class="dimmer-info"><b>'+app.lang.translate("lastUpdate")+':</b> <span class="last-refresh"> </span><div class="desc-content"></div></div></div></div></div></div>'},getFormTemplate:function(a,b,c,d,e,f,g,h,i,j){return'<div class="ui card ">  <div class="content" style="background-color:#f4f6f9;">    <div class="header '+(a?"move":"")+'">            <div class="menu-bar ">                '+(a||b?'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف" > </span> <i class="trash alternate outline icon"></i></a>':"")+"                                                   </div>                </div>":"")+'                <div class="">                   <i xclass="info icon chart-setting-icon show-extra-info pointer"></i>                </div>            </div>        <span class="title-content"></span>    </div>    <div class="description form-content " id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader tiny">'+app.lang.translate("در حال بارگذاری")+'</div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: 4px !important;"><div class="content"><div class="center"><div class="dimmer-info desc-content"></div></div></div></div></div>'},setLastRefresh:function(a,b){var c=$(".cid"+a+" .last-refresh");c.html(app.chartCommons.lastRefreshDateFormat(b))}};angular.module("uibCollapseCat",[]).directive("uibCollapse",["$animate","$q","$parse","$injector",function(a,b,c,d){var e=d.has("$animateCss")?d.get("$animateCss"):null;return{link:function(d,f,g){function h(){f.hasClass("collapse")&&f.hasClass("in")||b.resolve(l(d)).then(function(){f.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),e?e(f,{addClass:"in",easing:"ease",to:{height:f[0].scrollHeight+"px"}}).start()["finally"](i):a.addClass(f,"in",{to:{height:f[0].scrollHeight+"px"}}).then(i)})}function i(){f.removeClass("collapsing").addClass("collapse").css({height:"auto"}),m(d)}function j(){return f.hasClass("collapse")||f.hasClass("in")?void b.resolve(n(d)).then(function(){f.css({height:f[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),e?e(f,{removeClass:"in",to:{height:"0"}}).start()["finally"](k):a.removeClass(f,"in",{to:{height:"0"}}).then(k)}):k()}function k(){f.css({height:"0"}),f.removeClass("collapsing").addClass("collapse"),o(d)}var l=c(g.expanding),m=c(g.expanded),n=c(g.collapsing),o=c(g.collapsed);d.$eval(g.uibCollapse)||f.addClass("in").addClass("collapse").attr("aria-expanded",!0).attr("aria-hidden",!1).css({height:"auto"}),d.$watch(g.uibCollapse,function(a){a?j():h()})}}}]);var manageApp=angular.module("management",["sadafForms","ngRoute","ngMaterial","ngAnimate","ngMessages","datasourceScheduleCat","datasourcePartitionExpressionCat","pascalprecht.translate","ngSanitize","mdColorPicker","ui.ace","ui.sortable","uibCollapseCat","textAngular","ngQuill","services"]);manageApp.config(["$locationProvider",function(a){a.hashPrefix("")}]),manageApp.config(["ngQuillConfigProvider",function(a){var b=Quill["import"]("attributors/style/size");b.whitelist=["12px","14px","16px","18px","20px","24px","28px","32px","38px","48px","72px"],Quill.register(b,!0),a.set({modules:{toolbar:[[{header:[1,2,!1]},"bold","italic","underline","strike",{size:["12px","14px","16px","18px","20px","24px","28px","32px","38px","48px","72px"]},{direction:"rtl"},{align:[]},{color:[]},{background:[]},"clean"]]},placeholder:"متن را وارد کنید",theme:"snow"})}]),manageApp.config(["$provide",function(a){}]),manageApp.config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("blue").accentPalette("indigo").warnPalette("red").backgroundPalette("grey"),a.theme("t1").primaryPalette("grey").accentPalette("red").warnPalette("red").backgroundPalette("grey")}]),manageApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js?v="+app.version}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]);var logout=_.debounce(function(){alert("مهلت اعتبار ارتباط شما با سایت پایان یافته، لطفا دوباره وارد شوید"),document.location="/account/login"},1e3);manageApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401===b.status&&logout(),a.reject(b)}}}]),manageApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b,a.defaults.headers.post.RequestVerificationToken=b}]),manageApp.config(["$provide",function(a){a.decorator("taOptions",["$delegate",function(a){return a.forceTextAngularSanitize=!0,a.toolbar=[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull"]],a.classes={focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},a}])}]);var service=["$http","$interval",function(a,b){var c;return{start:function(){},stop:function(){b.cancel(c)}}}];try{var sadaf=angular.module("sadaf");sadaf.factory("heartBeat",service),sadaf.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}try{var management=angular.module("management");management.factory("heartBeat",service),management.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{2:/[0,1,2]/,6:/[0,1,2,3,4,5,6]/,9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0}).directive("uiMask",["uiMaskConfig","$parse",function(a,b){"use strict";return{priority:100,require:"ngModel",restrict:"A",compile:function(){var c=a;return function(a,d,e,f){function g(a){return angular.isDefined(a)?(t(a),O?(l(),m(),!0):k()):k()}function h(a){angular.isDefined(a)&&(E=a,O&&x())}function i(a){return O?(H=p(a||""),J=o(H),f.$setValidity("mask",J),J&&H.length?q(H):void 0):a}function j(a){return O?(H=p(a||""),J=o(H),f.$viewValue=H.length?q(H):"",f.$setValidity("mask",J),""===H&&e.required&&f.$setValidity("required",!f.$error.required),J?H:void 0):a}function k(){return O=!1,n(),angular.isDefined(Q)?d.attr("placeholder",Q):d.removeAttr("placeholder"),angular.isDefined(R)?d.attr("maxlength",R):d.removeAttr("maxlength"),d.val(f.$modelValue),f.$viewValue=f.$modelValue,!1}function l(){H=L=p(f.$viewValue||""),I=K=q(H),J=o(H);var a=J&&H.length?I:"";e.maxlength&&d.attr("maxlength",2*C[C.length-1]),d.attr("placeholder",E),d.val(a),f.$viewValue=a}function m(){P||(d.bind("blur",u),d.bind("mousedown mouseup",v),d.bind("input keyup click focus",x),P=!0)}function n(){P&&(d.unbind("blur",u),d.unbind("mousedown",v),d.unbind("mouseup",v),d.unbind("input",x),d.unbind("keyup",x),d.unbind("click",x),d.unbind("focus",x),P=!1)}function o(a){return!a.length||a.length>=G}function p(a){var b="",c=D.slice();return a=a.toString(),angular.forEach(F,function(b){a=a.replace(b,"")}),angular.forEach(a.split(""),function(a){c.length&&c[0].test(a)&&(b+=a,c.shift())}),b}function q(a){var b="",c=C.slice();return angular.forEach(E.split(""),function(d,e){a.length&&e===c[0]?(b+=a.charAt(0)||"_",a=a.substr(1),c.shift()):b+=d}),b}function r(a){var b=e.placeholder;return"undefined"!=typeof b&&b[a]?b[a]:"_"}function s(){return E.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function t(a){var b=0;if(C=[],D=[],E="","string"==typeof a){G=0;var c=!1,d=0,e=a.split("");angular.forEach(e,function(a,e){S.maskDefinitions[a]?(C.push(b),E+=r(e-d),D.push(S.maskDefinitions[a]),b++,c||G++):"?"===a?(c=!0,d++):(E+=a,b++)})}C.push(C.slice().pop()+1),F=s(),O=C.length>1}function u(){S.clearOnBlur&&(M=0,N=0,J&&0!==H.length||(I="",d.val(""),a.$apply(function(){f.$setViewValue("")})))}function v(a){"mousedown"===a.type?d.bind("mouseout",w):d.unbind("mouseout",w)}function w(){N=B(this),d.unbind("mouseout",w)}function x(b){b=b||{};var c=b.which,e=b.type;if(16!==c&&91!==c){var g,h=d.val(),i=K,j=p(h),k=L,l=!1,m=z(this)||0,n=M||0,o=m-n,r=C[0],s=C[j.length]||C.slice().shift(),t=N||0,u=B(this)>0,v=t>0,w=h.length>i.length||t&&h.length>i.length-t,x=h.length<i.length||t&&h.length===i.length-t,D=c>=37&&c<=40&&b.shiftKey,E=37===c,F=8===c||"keyup"!==e&&x&&o===-1,G=46===c||"keyup"!==e&&x&&0===o&&!v,H=(E||F||"click"===e)&&m>r;if(N=B(this),!D&&(!u||"click"!==e&&"keyup"!==e)){if("input"===e&&x&&!v&&j===k){for(;F&&m>r&&!y(m);)m--;for(;G&&m<s&&C.indexOf(m)===-1;)m++;var I=C.indexOf(m);j=j.substring(0,I)+j.substring(I+1),l=!0}for(g=q(j),K=g,L=j,d.val(g),l&&a.$apply(function(){f.$setViewValue(j)}),w&&m<=r&&(m=r+1),H&&m--,m=m>s?s:m<r?r:m;!y(m)&&m>r&&m<s;)m+=H?-1:1;(H&&m<s||w&&!y(n))&&m++,M=m,A(this,m)}}}function y(a){return C.indexOf(a)>-1}function z(a){if(!a)return 0;if(void 0!==a.selectionStart)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();return b.moveStart("character",a.value?-a.value.length:0),b.text.length}return 0}function A(a,b){if(!a)return 0;if(0!==a.offsetWidth&&0!==a.offsetHeight)if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}function B(a){return a?void 0!==a.selectionStart?a.selectionEnd-a.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var C,D,E,F,G,H,I,J,K,L,M,N,O=!1,P=!1,Q=e.placeholder,R=e.maxlength,S={};e.uiOptions?(S=a.$eval("["+e.uiOptions+"]"),angular.isObject(S[0])&&(S=function(a,b){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(void 0===b[c]?b[c]=angular.copy(a[c]):angular.extend(b[c],a[c]));return b}(c,S[0]))):S=c,e.$observe("uiMask",g),e.$observe("placeholder",h);var T=!1;e.$observe("modelViewValue",function(a){"true"===a&&(T=!0)}),a.$watch(e.ngModel,function(c){if(T&&c){var d=b(e.ngModel);d.assign(a,f.$viewValue)}}),f.$formatters.push(i),f.$parsers.push(j),d.bind("mousedown mouseup",v),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);e<c;e++)if(e in b&&b[e]===a)return e;return-1})}}}}]);var ngApp=angular.module("management");ngApp.directive("menuContainer",function(){return{restrict:"E",transclude:!0,scope:{openMenuName:"="},controller:["$scope",function(a){var b=a.menus=[];a.openMenuName&&(a.openMenuName.set=function(a){_.forEach(b,function(b){b.name===a&&b.header.click(!0)})}),a.select=function(a){angular.forEach(b,function(a){a.selected=!1}),a.selected=!0},this.addMenu=function(a){a.header.click=function(c){var d=a.header.isOpen;c&&(d=!1),_.forEach(b,function(a){a.header.isOpen=!1,a.body.isOpen=!1}),a.header.isOpen=!d,a.body.isOpen=!d},b.push(a)}}],template:"<div ng-transclude ></div>"}}).directive("menuItem",function(){return{require:"^^menuContainer",restrict:"E",transclude:!0,scope:{name:"@"},link:function(a,b,c,d){d.addMenu(a)},controller:["$scope",function(a){a.select=function(){},this.addHeader=function(b){a.header=b},this.addBody=function(b){a.body=b}}],template:"<div ng-transclude></div><md-divider></md-divider>"}}).directive("menuHeader",function(){return{require:"^^menuItem",restrict:"E",transclude:!0,scope:{},link:function(a,b,c,d){d.addHeader(a)},controller:["$scope",function(a){}],template:'<md-list-item class="md-no-sticky pointer header" ng-click="click()" ng-class="{active: isOpen}">               <div layout="row" flex layout-align="start center">                                                                  <div ng-transclude style="display:inline-block"> </div>                                                          <span flex></span>                                                                                               <span class="material-icons icon-animate " ng-click="click()" ng-class="{rotate : isOpen}">keyboard_arrow_down</span>             </div>                                                                                                       </md-list-item>'}}).directive("menuBody",function(){return{restrict:"E",require:"^^menuItem",transclude:!0,scope:{},link:function(a,b,c,d){d.addBody(a)},template:'<div uib-collapse="!isOpen"><div class="menu-body-container" ng-transclude></div></div>'}}).directive("switchButton",function(){return{restrict:"E",transclude:!0,scope:{ngModel:"="},template:'<div style="display:inline-block" class="switch-button" ng-click="ngModel = !ngModel" ng-class="{ active : ngModel}"><div ng-transclude style="display:inline-block"></div></div>'}}).directive("sadafIndicator",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",config:"=?",series:"=",onChange:"&ngChange",hideThen:"@"},controller:["$scope","$translate",function(a,b){var c=a.model;a.hideThen;c.ifRow=c.ifRow||[{}],c.thenRow=c.thenRow||[{}],_.each(c.thenRow,function(a){a.iconModel={name:a.secondFieldIcon||"icon warning",type:"icon"}}),a.ops=[{value:"1",name:"برابر"},{value:"2",name:"نابرابر"},{value:"3",name:"بزرگ‌تر از"},{value:"4",name:"بزرگ‌تر مساوی"},{value:"5",name:"کوچک‌تر از"},{value:"6",name:"کوچک‌تر مساوی"},{value:"7",name:"contain"},{value:"8",name:"not_contain"}],a.thenOps=[{value:"1",name:"change_color"},{value:"2",name:"add_icon"},{value:"3",name:"change_back_color"},{value:"4",name:"change_style"},{value:"5",name:"replace"},{value:"6",name:"chart_background"},{value:"7",name:"رنگ علامت روی نقشه"}],a.config=a.config||{};var d=a.config.show||[1,2,3,4,5];a.thenOps=_.filter(a.thenOps,function(a){return d.indexOf(+a.value)!==-1})}],template:'<div>                                                                                                                                                         <div class="form-row layout-align-start-center layout-row" layout="row" layout-align="start center">                <label class= "col-sm-4" >نام شرط</label>                <span class="form-divider flex" flex=""></span>                <div class="col-sm-8">                    <div ng-click="model.labelIsColumn = !model.labelIsColumn" ng-class="{\'active\' : model.labelIsColumn}" class="ui mini icon basic compact button"><i class="ui icon terminal"></i></div>                    <select class="expression-select"  ng-model="model.labelColumn" ng-options="s as s for s in series" ng-show="model.labelIsColumn" ng-change="onChange()"></select>                    <input ng-hide="model.labelIsColumn" type="text" class="form-control ng-pristine ng-untouched ng-valid ng-not-empty" placeholder="نام شرط" ng-change="onChange()" ng-model-options="{ updateOn: \'blur\' }" ng-model="model.title" aria-invalid="false" style="">                </div></div>    <div ng-repeat="i in model.ifRow track by $index" class="form-row" xlayout="row" xlayout-align="start center">                                                                                                                      <select class="expression-select" ng-model="i.firstField" style="border-bottom: 1px solid silver !important;" ng-options="s as s for s in series" ng-change="onChange()"></select>                                                                 <select class="expression-select" style="direction: ltr; text-align:center;" ng-model="i.operand" ng-options="s.value as (s.name | translate) for s in ops" ng-change="onChange()"></select>                                                <div ng-click="i.secondFieldIsText = !i.secondFieldIsText" ng-class="{\'active\' : i.secondFieldIsText}" class="ui mini icon basic compact button"><i class="ui icon terminal"></i></div>                <select class="expression-select" style="border-bottom: 1px solid silver !important;" ng-model="i.secondFieldSelect" ng-options="s as s for s in series" ng-show="!i.secondFieldIsText" ng-change="onChange()"></select>                           <input ng-model="i.secondFieldInput" type="text" ng-show="i.secondFieldIsText"  ng-change="onChange()"/>                                                             <span xclass="ui mini basic compact icon button" ng-click="model.ifRow.splice( $index+1, 0, {})"><i class="ui tiny icon pointer plus"></i></span>                                                                                                     <span xclass="ui mini basic compact icon button" ng-click="model.ifRow.splice($index, 1); onChange()" ng-show="model.ifRow.length > 1"><i class="ui tiny icon pointer minus"></i></span>                             </div>                                                                                                                                                           <div ng-repeat="i in model.thenRow track by $index" ng-hide="hideThen" class="form-row" layout="row" layout-align="start center">                                                                          <span ng-show="model.thenRow.length > 1 && !$first">{{ \'and\' | translate }}</span>                                                                                 <span>{{ \'then\' | translate }}</span>                                                                                                                              <select style="max-width:60px" ng-model="i.firstField" ng-options="s as s for s in series" ng-change="onChange()"></select>                                                                 <select style="xmax-width:60px" ng-model="i.operand" ng-options="s.value as (s.name | translate) for s in thenOps" ng-change="onChange()"></select>                                            <span style="margin-left:3px;" md-color-picker ng-model="i.secondFieldColor" ng-show="i.operand == 1" md-color-default-tab="\'genericPalette\'"  on-change="onChange()"></span>               <span style="margin-left:3px;"  ng-show="i.operand == 1 && config.stripeEnable" ><label>رنگ به صورت هاشور<input ng-change="onChange()" ng-model="i.isStriped" type="checkbox" /></label></span>               <span style="margin-left:3px;" md-color-picker ng-model="i.symbolColor" ng-show="i.operand == 7" md-color-default-tab="\'genericPalette\'" on-change="onChange()"></span>            <span style="margin-left:3px;" md-color-picker ng-model="i.secondFieldBackColor" ng-show="i.operand == 6" md-color-default-tab="\'genericPalette\'" on-change="onChange()"></span>            <span style="margin-left:3px;" md-color-picker ng-model="i.secondFieldBackColor" ng-show="i.operand == 3" md-color-default-tab="\'genericPalette\'" on-change="onChange()"></span>            <select ng-show="i.operand == 4" ng-model="i.secondFieldStyle" ng-change="onChange()" ng-options="i.name as  i.value for i in [                                    {name:\'1\', value: \'normal\'  },                                     {name:\'2\', value: \'bold\'  },                                      {name:\'3\', value: \'italic\'  },                                     {name:\'4\', value: \'bold_italic\'  },                                     {name:\'5\', value: \'underline\'  },                                 ]">                                                                               </select>                                                                                                                                                            <input ng-model="i.secondFieldReplace" type="text" ng-show="i.operand == 5" />                                                                                                                                                                                                                                                            <div ng-show="i.operand == 2">             <sadaf-icons ng-model="i.secondFieldIcon" ng-change="onChange()"></sadaf-icons>        </div>                      <span class="ui mini basic compact icon button" ng-click="model.thenRow.splice( $index+1, 0, {secondFieldIcon:{name:\'icon warning\', type:\'icon\'}})"><i class="icon plus"></i></span>                                                                                                     <span class="ui mini basic compact icon button" ng-click="model.thenRow.splice($index, 1); onChange()" ng-show="model.thenRow.length > 1"><i class="icon minus"></i></span>                              </div>                                                                                                                                                           </div>'}}).directive("sadafContactList",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},controller:["$scope",function(a){a.model=a.model||[{}]}],template:'<div class="ui tiny form">                                                                                                     <div ng-repeat="i in model" class="fields" >                                                              <div class="field"><input ng-model="i.phone" type="text"  placeholder="{{\'phone\' | translate}}"/></div>                       <div class="field"><input ng-model="i.email" type="text"  placeholder="{{\'email\' | translate}}"/></div>                       <div class="field">                        <i class="icon tiny plus pointer grey" ng-click="model.splice( $index+1, 0, {})"></i>                                                   <i class="icon tiny minus pointer grey" ng-click="model.splice($index, 1)" ng-show="model.length > 1"></i>                        </div>                </div>                                                                                             </div>'}}).directive("sadafRemovable",function(){return{restrict:"E",transclude:!0,scope:{onDelete:"&onDelete"},controller:["$scope",function(a){a.model=a.model||[{}]}],template:'<div layout="row" layout-align="start center">                <span class ="material-icons small" ng-click="onDelete()">close</span>                <div ng-transclude></div>            </div>'}}).directive("fileread",[function(){return{scope:{fileread:"="},link:function(a,b,c){b.bind("change",function(b){a.$apply(function(){a.fileread=a.fileread||{},a.fileread=b.target.files[0]})})}}}]).directive("xtree",function(){return{restrict:"E",transclude:!0,scope:{root:"=ngModel",option:"=",url:"&"},controller:["$scope","$http","$translate",function(a,b,c){function d(a,b){b(a),a.nodes&&(_.forEach(a.nodes,function(a){d(a,b)}),_.forEach(a.contents,function(a){d(a,b)}))}a.root=a.root||{name:"root",open:!0},a.active=function(b){var c=b.active;a.option.multiple||d(a.root,function(a){a.active=!1}),b.active=c},a.selectAll=function(a,b){_.each(a.contents,function(a){a.active=b})}}],template:'<div class ="sadaf-tree">                                                                                                                                    <div style="list-style:none" class ="tree-element ul">                                                                                                       <div ng-repeat="data in [root]" class ="tree-element li" ng-include="\'tree_item_renderer.html\'"></div>                                             </div>                                                                                                                                               </div>                                                                                                                                                                                                                                                                                                            <script type="text/ng-template" id="tree_item_renderer.html">                                                                                                <collapse class ="block" selectable-dir="option.selectableDir" ng-model="data"                                                                               hide-icon="{{(!data.nodes || !data.nodes.length ) && ( option.justDir || ( !data.contents || !data.contents.length) ) && data.loaded }}">                                                                                                                                                                         <collapse-header class ="block" ng-click="$event.stopPropagation(); option.url(data)">                                                                       <md-checkbox ng-show="option.selectableDir" ng-model="data.active"ng-change="active(data)" ng-click="$event.stopPropagation()"                                       style="margin:0">{{data.name}}</md-checkbox>                                                                                                 <span ng-show="!option.selectableDir">{{data.name}}</span>                                                                                           </collapse-header>                                                                                                                                                                                                                                                                                                <collapse-body class ="block">                                                                                                                               <div class ="tree-element ul" style="list-style:none" >                                                                                                      <div class="ui active dimmer inverted" style="position:inherit; display:inline" ng-show="!data.loaded">                     <div class="ui active mini inline text loader">                                                         </div>                                                                                                                                                                        </div>                                                                                                                                                                        <div ng-show="data.loaded" class ="tree-element li"><md-checkbox ng-show="option.multiple" ng-click="$event.stopPropagation()" ng-model="data.selectAll" ng-change="selectAll(data, data.selectAll)"><small> {{"select_all" | translate}} </small></md-checkbox></div>                                                                                                                                               <div ng-repeat="data in data.nodes" class ="tree-element li" ng-include="\'tree_item_renderer.html\'"></div>                                             <div ng-repeat="u in data.contents" class ="tree-element li" ng-class ="{active : u.active}" ng-hide="option.justDir">                                       <md-checkbox ng-model="u.active" ng-change="active(u)" style="margin-bottom:0">{{u.name}}</md-checkbox>                                              </div>                                                                                                                                               </div>                                                                                                                                               </collapse-body>                                                                                                                                                                                                                                                                                              </collapse>                                                                                                                                                                                                                                                                                                   </script>'
}}).directive("menuPermission",function(){return{restrict:"E",transclude:!0,scope:{menus:"=",roles:"="},controller:["$scope","$http","$translate",function(a,b,c){}],template:'            <menu-item class="panel ">                <menu-header>{{ \'menus\' | translate }}</menu-header>                <menu-body>                    <div style="margin:0 20px">                                                              {{menus}}<collapse ng-repeat="(k,v) in menus">                                                                   <div layout="row">                                                                                             <collapse-header>                                                                                              {{k}}                                                                                                  </collapse-header>                                                                                         <span flex></span>                                                                                     </div>                                                                                                     <collapse-body>                                                                                                <div style="margin:0 20px">                                                                                <div ng-repeat="r in v" layout="row" layout-align="start center">                                              <md-checkbox ng-model="r.check">{{r.name}}</md-checkbox>                                                   <span flex></span>                                                                                                                                                                                                 </div>                                                                                                 </div>                                                                                                 </collapse-body>                                                                                       </collapse>                                                                                            </div>                                                                                         </menu-body>            </menu-item>            <menu-item class="panel ">                <menu-header>{{ \'datasources\' | translate }}</menu-header>                <menu-body>                    <datasource-permission ng-model="roles" class="block" type="chart" id="{{parent.id}}"></datasource-permission>                </menu-body>            </menu-item>'}}).directive("legendPosition",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",change:"&ngChange"},controller:["$scope","$http","$translate",function(a,b,c){a.model=a.model||"top left"}],template:'<div class="position-circles">                                                                                                                                                                                                                 <i ng-click="model=\'top left\';change()" ng-class="{active: model==\'top left\'}" class="icon circle" style="top:0;left:0"></i>                                            <i ng-click="model=\'top right\';change()" ng-class="{active: model==\'top right\'}" class="icon circle" style="top:0;right:0"></i>                                         <i ng-click="model=\'top center\';change()" ng-class="{active: model==\'top center\'}" class="icon circle" style="top:0;left:11px"></i>                                     <i ng-click="model=\'bottom left\';change()" ng-class="{active: model==\'bottom left\'}" class="icon circle" style="bottom:0;left:0"></i>                                   <i ng-click="model=\'bottom right\';change()" ng-class="{active: model==\'bottom right\'}" class="icon circle" style="bottom:0;right:0"></i>                                <i ng-click="model=\'bottom center\';change()" ng-class="{active: model==\'bottom center\'}" class="icon circle" style="bottom:0;left:11px"></i>                            <i ng-click="model=\'center right\';change()" ng-class="{active: model==\'center right\'}" class="icon circle" style="top:11px;right:0"></i>                                <i ng-click="model=\'center left\';change()" ng-class="{active: model==\'center left\'}" class="icon circle" style="top:11px;left:0"></i>                               </div>'}}).directive("sdFormat",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",change:"&ngChange"},controller:["$scope","$http","$translate",function(a,b,c){a.model=a.model||",.0f"}],template:"<select ng-change=\"change()\" ng-model=\"model\"  ng-options=\"i.name as  i.value for i in [                                    {name:'A', value: 'عادی'  },                                                                                                                             {name:'.0%', value:'درصد' },                                                                                                                               {name:',.1%', value:'#,#.0%'},                                                                                                                           {name:',.2%', value:'#,#.00%'},                                                                                                                          {name:',.0f', value:'#,#'},                                                                                                                              {name:',.1f', value:'#,#.0'},                                                                                                                            {name:',.2f', value:'#,#.00'},                                                                                                                           {name:',.3s', value:'#,#K'},                                                                                                                             {name:'(,.0f', value:'(#,#)'},                                                                                                                             {name:'(,.1f', value:'(#,#.0)'},                                                                                                                             {name:'(,.2f', value:'(#,#.00)'},                                                                                                                             {name:'custom', value:'سفارشی' },                                                                                                                   ]\">"}}).directive("sdTimeFunction",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","$translate",function(a,b,c){a.$watch("model",function(b){a.model&&a.model.variableDefaultFunction||(a.model=_.extend({},{variableDefaultFunction:"MonthToDate",functionDateFormat:"yy/mm/dd",functionUnitAgo:1,functionUnitAgoOffset:"1",functionUnitAgoTwo:1,functionUnitAgoTwoOffset:"1"},b))})}],templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/types/timeFunction.html?v="+app.version}}).directive("intervalFetch",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",fields:"=?",datasourceId:"@"},controller:["$scope","$http","$translate","intervalFetchService",function(a,b,c,d){function e(a){a.timex=moment.utc(a.time).fromNow(),a.time=moment.utc(a.time).format("jYYYY/jMM/jDD HH:mm:ss")}function f(){a.loadRequests=!0,a.loadRequestsError=!1,d.get(a.datasourceId,g,h).then(function(b){a.loadRequests=!1,_.each(b,function(a){e(a)}),a.requests=a.requests.concat(b),_.each(a.requests,function(a){a.duration=moment.duration(a.duration).format("h:mm:ss:SSS")}),g+=b.length,b.length<(h||20)&&(a.noMore=!0)},function(b){a.loadRequests=!1,a.loadRequestsError=!0})}var g=0,h=20;a.requests=[],$(".ui.dimmer.modals .interval-fetch-modal").remove(),a.model=a.model||{dateType:"jalali-date"},f(),a.more=function(){f()},a.deleteAll=function(){var b=confirm("با حذف تمام درخواست‌ها، اطلاعات موجود در منبع داده نیز پاک می‌شوند. آیا برای حذف همه اطمینان دارید؟");b&&(a.deleteAllProgress=!0,d.deleteAll(a.datasourceId).then(function(){a.deleteAllProgress=!1,a.requests=null},function(){a.deleteAllProgress=!1}))},a.addModel={},a.addNew=function(){return a.addModel.addFrom&&a.addModel.addTo?(a.addNewProgress=!0,void d.add(a.datasourceId,a.addModel.addFrom,a.addModel.addTo).then(function(b){a.addNewProgress=!1,b.refreshProgress=!1,e(b),a.requests=a.requests||[],a.requests.push(b),$(".ui.interval-fetch-modal").modal("hide")},function(){a.addNewProgress=!1,alert("اجرا با خطا مواجه شد!")})):void alert("مقادیر شروع و پایان باید وارد شود")},a.addModal=function(){$(".ui.interval-fetch-modal").modal("show")},a["delete"]=function(b){var c=confirm("آیا برای حذف اطمینان دارید؟");c&&(b.refreshProgress=!0,d.remove(b.id).then(function(){b.refreshProgress=!0,_.remove(a.requests,{id:b.id})},function(){alert("خطایی در حذف اطلاعات رخ داده است"),b.refreshProgress=!1}))},a.refresh=function(a){a.refreshProgress=!0,d.refresh(a.id).then(function(b){a.refreshProgress=!1,e(b),a.timex=b.timex,a.time=b.time,a.effectedRows=b.effectedRows,a.duration=b.duration},function(){a.refreshProgress=!1})},a.persian=persian,a.d3=d3}],templateUrl:app.urlPrefix+"dist/partial/management/directives/interval-fetch.html?v="+app.version}}).directive("fetchLoop",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","$translate",function(a,b,c){a.persian=persian,a.d3=d3}],templateUrl:app.urlPrefix+"dist/partial/management/directives/fetch-loop.html?v="+app.version}}).directive("rolesTree",function(){return{restrict:"E",transclude:!0,scope:{root:"="},controller:["$scope","$http","$translate","roles","$mdToast","utils",function(a,b,c,d,e,f){a.app=app,a.selected=null,a.deleteOne=function(b){a.selected=b;$(".role-delete-modal").modal("show")},a.deleteRole=function(c){function g(a,b){if(_.isArray(a.nodes))for(var c=0;c<a.nodes.length;c++){if(a.nodes[c].id==b.id)return void a.nodes.splice(c,1);g(a.nodes[c],b)}}a.deleteType=c?"with-child":"";var h=app.urlPrefix+"api/roles/delete"+(c?"?withChild=true":"");null!=a.selected&&(a.deleteProgress=!0,b.post(h,[a.selected.id]).then(function(b){d.reset(),g(a.root,a.selected);var c=e.simple().textContent("حذف انجام شد");e.show(c),$(".role-delete-modal").modal("hide"),console.log($(".role-delete-modal")),a.deleteProgress=!1},function(b){a.deleteProgress=!1,f.showErrorToast(b.data.desc),$(".role-delete-modal").modal("hide")}))},$(".ui.dimmer.modals .role-delete-modal").remove()}],templateUrl:app.urlPrefix+"dist/partial/management/directives/roles-tree.html?v="+app.version}}).directive("printSettings",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","$translate","roles","$mdToast","utils",function(a,b,c,d,e,f){}],templateUrl:app.urlPrefix+"dist/partial/management/directives/print-settings.html?v="+app.version}}).directive("sadafIcons",function(){return{scope:{model:"=ngModel",change:"&ngChange",type:"@"},controller:["$scope","$http","$translate","roles","$timeout","utils","$mdMenu",function(a,b,c,d,e,f,g){a.id=_.random(1e5,999999,!1),a.app=app,a.icons=["add to calendar icon","address book icon","address book outline icon","address card icon","address card outline icon","alarm icon","alarm mute icon","alarm mute outline icon","alarm outline icon","at icon","browser icon","bug icon","calendar icon","calendar outline icon","checked calendar icon","cloud icon","code icon","comment icon","comment outline icon","comments icon","comments icon","comments outline icon","copyright icon","creative commons icon","dashboard icon","delete calendar icon","external icon","external icon","external square icon","eyedropper icon","feed icon","find icon","hand pointer icon","handshake icon","hashtag icon","heartbeat icon","history icon","home icon","hourglass empty icon","hourglass end icon","hourglass full icon","hourglass half icon","hourglass start icon","id badge icon","id card icon","id card outline icon","idea icon","image icon","inbox icon","industry icon","lab icon","mail icon","mail outline icon","mail square icon","mouse pointer icon","open envelope icon","open envelope outline icon","options icon","paint brush icon","payment icon","percent icon","podcast icon","privacy icon","protect icon","registered icon","remove from calendar icon","search icon","setting icon","settings icon","shop icon","shopping bag icon","shopping basket icon","sidebar icon","signal icon","sitemap icon","tag icon","tags icon","tasks icon","terminal icon","text telephone icon","ticket icon","trademark icon","trophy icon","window close icon","window close outline icon","window maximize icon","window minimize icon","window restore icon","add to cart icon","add user icon","adjust icon","archive icon","ban icon","bookmark icon","call icon","call square icon","clone icon","cloud download icon","cloud upload icon","talk icon","talk outline icon","compress icon","configure icon","download icon","edit icon","erase icon","exchange icon","expand icon","external share icon","filter icon","hide icon","in cart icon","lock icon","mail forward icon","object group icon","object ungroup icon","pin icon","print icon","random icon","recycle icon","refresh icon","remove bookmark icon","remove user icon","repeat icon","reply all icon","reply icon","retweet icon","send icon","send outline icon","share alternate icon","share alternate square icon","share icon","share square icon","sign in icon","sign out icon","theme icon","translate icon","undo icon","unhide icon","unlock alternate icon","unlock icon","upload icon","wait icon","wizard icon","write icon","write square icon","announcement icon","birthday icon","help circle icon","help icon","info circle icon","info icon","warning circle icon","warning icon","warning sign icon","child icon","doctor icon","handicap icon","spy icon","student icon","user icon","user circle","user circle outline","user outline","users icon","female icon","gay icon","genderless icon","heterosexual icon","intergender icon","lesbian icon","male icon","man icon","neuter icon","non binary transgender icon","other gender horizontal icon","other gender icon","other gender vertical icon","transgender icon","woman icon","block layout icon","crop icon","grid layout icon","list layout icon","maximize icon","resize horizontal icon","resize vertical icon","zoom icon","zoom out icon","anchor icon","bar icon","bathtub icon","bomb icon","book icon","bullseye icon","calculator icon","cocktail icon","diamond icon","fax icon","fire extinguisher icon","fire icon","flag checkered icon","flag icon","flag outline icon","gift icon","hand lizard icon","hand peace icon","hand paper icon","hand rock icon","hand scissors icon","hand spock icon","law icon","leaf icon","legal icon","lemon icon","life ring icon","lightning icon","magnet icon","money icon","moon icon","plane icon","puzzle icon","road icon","rocket icon","shipping icon","shower icon","snowflake icon","soccer icon","sticky note icon","sticky note outline icon","suitcase icon","sun icon","thermometer empty icon","thermometer quarter icon","thermometer half icon","thermometer three quarters icon","thermometer full icon","travel icon","treatment icon","tv icon","umbrella icon","world icon","asterisk icon","certificate icon","circle icon","circle notched icon","circle thin icon","crosshairs icon","cube icon","cubes icon","ellipsis horizontal icon","ellipsis vertical icon","quote left icon","quote right icon","spinner icon","square icon","square outline icon","add circle icon","add square icon","check circle icon","check circle outline icon","check square icon","checkmark box icon","checkmark icon","minus circle icon","minus icon","minus square icon","minus square outline icon","move icon","plus icon","plus square outline icon","radio icon","remove circle icon","remove circle outline icon","remove icon","selected radio icon","toggle off icon","toggle on icon","area chart icon","bar chart icon","camera retro icon","film icon","line chart icon","newspaper icon","photo icon","pie chart icon","sound icon","angle double down icon","angle double left icon","angle double right icon","angle double up icon","angle down icon","angle left icon","angle right icon","angle up icon","arrow circle down icon","arrow circle left icon","arrow circle outline down icon","arrow circle outline left icon","arrow circle outline right icon","arrow circle outline up icon","arrow circle right icon","arrow circle up icon","arrow down icon","arrow left icon","arrow right icon","arrow up icon","caret down icon","caret left icon","caret right icon","caret up icon","chevron circle down icon","chevron circle left icon","chevron circle right icon","chevron circle up icon","chevron down icon","chevron left icon","chevron right icon","chevron up icon","long arrow down icon","long arrow left icon","long arrow right icon","long arrow up icon","pointing down icon","pointing left icon","pointing right icon","pointing up icon","toggle down icon","toggle left icon","toggle right icon","toggle up icon","mobile icon","tablet icon","battery empty icon","battery low icon","battery medium icon","battery high icon","battery full icon","desktop icon","disk outline icon","game icon","keyboard icon","laptop icon","plug icon","power icon","file archive outline icon","file audio outline icon","file code outline icon","file excel outline icon","file icon","file image outline icon","file outline icon","file pdf outline icon","file powerpoint outline icon","file text icon","file text outline icon","file video outline icon","file word outline icon","folder icon","folder open icon","folder open outline icon","folder outline icon","level down icon","level up icon","trash icon","trash outline icon","barcode icon","bluetooth alternative icon","bluetooth icon","css3 icon","database icon","fork icon","html5 icon","microchip icon","openid icon","qrcode icon","rss icon","rss square icon","server icon","usb icon","empty heart icon","empty star icon","frown icon","heart icon","meh icon","smile icon","star half empty icon","star half icon","star icon","thumbs down icon","thumbs outline down icon","thumbs outline up icon","thumbs up icon","backward icon","closed captioning icon","eject icon","fast backward icon","fast forward icon","forward icon","music icon","mute icon","pause circle icon","pause circle outline icon","pause icon","play icon","record icon","step backward icon","step forward icon","stop circle icon","stop circle outline icon","stop icon","unmute icon","video play icon","video play outline icon","volume down icon","volume off icon","volume up icon","bicycle icon","building icon","building outline icon","bus icon","car icon","coffee icon","compass icon","emergency icon","first aid icon","food icon","h icon","hospital icon","hotel icon","location arrow icon","map icon","map outline icon","map pin icon","map signs icon","marker icon","military icon","motorcycle icon","paw icon","ship icon","space shuttle icon","spoon icon","street view icon","subway icon","taxi icon","train icon","television icon","tree icon","university icon","columns icon","sort alphabet ascending icon","sort alphabet descending icon","sort ascending icon","sort content ascending icon","sort content descending icon","sort descending icon","sort icon","sort numeric ascending icon","sort numeric descending icon","table icon","bitcoin icon","dollar icon","euro icon","lira icon","pound icon","ruble icon","rupee icon","shekel icon","won icon","yen icon","wheelchair icon","asl interpreting icon","assistive listening systems icon","audio description icon","blind icon","braille icon","deafness icon","low vision icon","sign language icon","universal access icon","volume control phone icon","align center icon","align justify icon","align left icon","align right icon","attach icon","bold icon","copy icon","cut icon","font icon","header icon","indent icon","italic icon","linkify icon","list icon","ordered list icon","outdent icon","paragraph icon","paste icon","save icon","strikethrough icon","subscript icon","superscript icon","text cursor icon","text height icon","text width icon","underline icon","unlinkify icon","unordered list icon"],a.faIcons=["abacus","acorn","ad","address-book","address-card","adjust","air-freshener","alarm-clock","alicorn","align-center","align-justify","align-left","align-right","allergies","ambulance","american-sign-language-interpreting","analytics","anchor","angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up","angry","ankh","apple-alt","apple-crate","archive","archway","arrow-alt-circle-down","arrow-alt-circle-left","arrow-alt-circle-right","arrow-alt-circle-up","arrow-alt-down","arrow-alt-from-bottom","arrow-alt-from-left","arrow-alt-from-right","arrow-alt-from-top","arrow-alt-left","arrow-alt-right","arrow-alt-square-down","arrow-alt-square-left","arrow-alt-square-right","arrow-alt-square-up","arrow-alt-to-bottom","arrow-alt-to-left","arrow-alt-to-right","arrow-alt-to-top","arrow-alt-up","arrow-circle-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-down","arrow-from-bottom","arrow-from-left","arrow-from-right","arrow-from-top","arrow-left","arrow-right","arrow-square-down","arrow-square-left","arrow-square-right","arrow-square-up","arrow-to-bottom","arrow-to-left","arrow-to-right","arrow-to-top","arrow-up","arrows-alt-h","arrows-alt-v","arrows-alt","arrows-h","arrows-v","arrows","assistive-listening-systems","asterisk","at","atlas","atom-alt","atom","audio-description","award","axe-battle","axe","backpack","backspace","backward","badge-check","badge-dollar","badge-percent","badge","badger-honey","balance-scale-left","balance-scale-right","balance-scale","ballot-check","ballot","ban","band-aid","barcode-alt","barcode-read","barcode-scan","barcode","bars","baseball-ball","baseball","basketball-ball","basketball-hoop","bat","bath","battery-bolt","battery-empty","battery-full","battery-half","battery-quarter","battery-slash","battery-three-quarters","bed","beer","bell-school-slash","bell-school","bell-slash","bell","bezier-curve","bible","bicycle","binoculars","birthday-cake","blanket","blender-phone","blender","blind","bold","bolt","bomb","bone-break","bone","bong","book-alt","book-dead","book-heart","book-open","book-reader","book-spells","book","bookmark","books","booth-curtain","bow-arrow","bowling-ball","bowling-pins","box-alt","box-ballot","box-check","box-fragile","box-full","box-heart","box-open","box-up","box-usd","box","boxes-alt","boxes","boxing-glove","braille","brain","briefcase-medical","briefcase","broadcast-tower","broom","browser","brush","bug","building","bullhorn","bullseye-arrow","bullseye-pointer","bullseye","burn","bus-alt","bus-school","bus","business-time","cabinet-filing","calculator-alt","calculator","calendar-alt","calendar-check","calendar-edit","calendar-exclamation","calendar-minus","calendar-plus","calendar-star","calendar-times","calendar","camera-alt","camera-retro","camera","campfire","campground","candle-holder","candy-corn","cannabis","capsules","car-alt","car-battery","car-bump","car-crash","car-garage","car-mechanic","car-side","car-tilt","car-wash","car","caret-circle-down","caret-circle-left","caret-circle-right","caret-circle-up","caret-down","caret-left","caret-right","caret-square-down","caret-square-left","caret-square-right","caret-square-up","caret-up","cart-arrow-down","cart-plus","cat","cauldron","certificate","chair-office","chair","chalkboard-teacher","chalkboard","charging-station","chart-area","chart-bar","chart-line-down","chart-line","chart-pie-alt","chart-pie","check-circle","check-double","check-square","check","chess-bishop-alt","chess-bishop","chess-board","chess-clock-alt","chess-clock","chess-king-alt","chess-king","chess-knight-alt","chess-knight","chess-pawn-alt","chess-pawn","chess-queen-alt","chess-queen","chess-rook-alt","chess-rook","chess","chevron-circle-down","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-double-down","chevron-double-left","chevron-double-right","chevron-double-up","chevron-down","chevron-left","chevron-right","chevron-square-down","chevron-square-left","chevron-square-right","chevron-square-up","chevron-up","child","church","circle-notch","circle","city","claw-marks","clipboard-check","clipboard-list-check","clipboard-list","clipboard-prescription","clipboard","clock","clone","closed-captioning","cloud-download-alt","cloud-download","cloud-drizzle","cloud-hail-mixed","cloud-hail","cloud-meatball","cloud-moon-rain","cloud-moon","cloud-rain","cloud-rainbow","cloud-showers-heavy","cloud-showers","cloud-sleet","cloud-snow","cloud-sun-rain","cloud-sun","cloud-upload-alt","cloud-upload","cloud","clouds-moon","clouds-sun","clouds","club","cocktail","code-branch","code-commit","code-merge","code","coffee-togo","coffee","coffin","cog","cogs","coins","columns","comment-alt-check","comment-alt-dollar","comment-alt-dots","comment-alt-edit","comment-alt-exclamation","comment-alt-lines","comment-alt-minus","comment-alt-plus","comment-alt-slash","comment-alt-smile","comment-alt-times","comment-alt","comment-check","comment-dollar","comment-dots","comment-edit","comment-exclamation","comment-lines","comment-minus","comment-plus","comment-slash","comment-smile","comment-times","comment","comments-alt-dollar","comments-alt","comments-dollar","comments","compact-disc","compass-slash","compass","compress-alt","compress-wide","compress","concierge-bell","container-storage","conveyor-belt-alt","conveyor-belt","cookie-bite","cookie","copy","copyright","corn","couch","cow","credit-card-blank","credit-card-front","credit-card","cricket","crop-alt","crop","cross","crosshairs","crow","crown","cube","cubes","curling","cut","dagger","database","deaf","democrat","desktop-alt","desktop","dewpoint","dharmachakra","diagnoses","diamond","dice-d10","dice-d12","dice-d20","dice-d4","dice-d6","dice-d8","dice-five","dice-four","dice-one","dice-six","dice-three","dice-two","dice","digital-tachograph","diploma","directions","divide","dizzy","dna","do-not-enter","dog-leashed","dog","dollar-sign","dolly-empty","dolly-flatbed-alt","dolly-flatbed-empty","dolly-flatbed","dolly","donate","door-closed","door-open","dot-circle","dove","download","drafting-compass","dragon","draw-circle","draw-polygon","draw-square","drum-steelpan","drum","drumstick-bite","drumstick","duck","dumbbell","dungeon","ear","eclipse-alt","eclipse","edit","eject","elephant","ellipsis-h-alt","ellipsis-h","ellipsis-v-alt","ellipsis-v","empty-set","engine-warning","envelope-open-dollar","envelope-open-text","envelope-open","envelope-square","envelope","equals","eraser","euro-sign","exchange-alt","exchange","exclamation-circle","exclamation-square","exclamation-triangle","exclamation","expand-alt","expand-arrows-alt","expand-arrows","expand-wide","expand","external-link-alt","external-link-square-alt","external-link-square","external-link","eye-dropper","eye-evil","eye-slash","eye","fast-backward","fast-forward","fax","feather-alt","feather","female","field-hockey","fighter-jet","file-alt","file-archive","file-audio","file-certificate","file-chart-line","file-chart-pie","file-check","file-code","file-contract","file-csv","file-download","file-edit","file-excel","file-exclamation","file-export","file-image","file-import","file-invoice-dollar","file-invoice","file-medical-alt","file-medical","file-minus","file-pdf","file-plus","file-powerpoint","file-prescription","file-signature","file-spreadsheet","file-times","file-upload","file-user","file-video","file-word","file","fill-drip","fill","film-alt","film","filter","fingerprint","fire-extinguisher","fire-smoke","fire","first-aid","fish","fist-raised","flag-alt","flag-checkered","flag-usa","flag","flame","flask-poison","flask-potion","flask","flushed","fog","folder-minus","folder-open","folder-plus","folder-times","folder","folders","font","football-ball","football-helmet","forklift","forward","fragile","frog","frown-open","frown","function","funnel-dollar","futbol","gamepad","gas-pump-slash","gas-pump","gavel","gem","genderless","ghost","gift-card","gift","glass-martini-alt","glass-martini","glasses-alt","glasses","globe-africa","globe-americas","globe-asia","globe-stand","globe","golf-ball","golf-club","gopuram","graduation-cap","greater-than-equal","greater-than","grimace","grin-alt","grin-beam-sweat","grin-beam","grin-hearts","grin-squint-tears","grin-squint","grin-stars","grin-tears","grin-tongue-squint","grin-tongue-wink","grin-tongue","grin-wink","grin","grip-horizontal","grip-vertical","h-square","h1","h2","h3","hammer-war","hammer","hamsa","hand-heart","hand-holding-box","hand-holding-heart","hand-holding-magic","hand-holding-seedling","hand-holding-usd","hand-holding-water","hand-holding","hand-lizard","hand-paper","hand-peace","hand-point-down","hand-point-left","hand-point-right","hand-point-up","hand-pointer","hand-receiving","hand-rock","hand-scissors","hand-spock","hands-heart","hands-helping","hands-usd","hands","handshake-alt","handshake","hanukiah","hashtag","hat-witch","hat-wizard","haykal","hdd","head-side","head-vr","heading","headphones-alt","headphones","headset","heart-circle","heart-rate","heart-square","heart","heartbeat","helicopter","helmet-battle","hexagon","highlighter","hiking","hippo","history","hockey-mask","hockey-puck","hockey-sticks","home-heart","home","hood-cloak","horse","hospital-alt","hospital-symbol","hospital","hot-tub","hotel","hourglass-end","hourglass-half","hourglass-start","hourglass","house-damage","house-flood","hryvnia","humidity","hurricane","i-cursor","id-badge","id-card-alt","id-card","image","images","inbox-in","inbox-out","inbox","indent","industry-alt","industry","infinity","info-circle","info-square","info","inhaler","integral","intersection","inventory","italic","jack-o-lantern","jedi","joint","journal-whills","kaaba","key-skeleton","key","keyboard","keynote","khanda","kidneys","kiss-beam","kiss-wink-heart","kiss","kite","kiwi-bird","knife-kitchen","lambda","lamp","landmark-alt","landmark","language","laptop-code","laptop","laugh-beam","laugh-squint","laugh-wink","laugh","layer-group","layer-minus","layer-plus","leaf-heart","leaf-maple","leaf-oak","leaf","lemon","less-than-equal","less-than","level-down-alt","level-down","level-up-alt","level-up","life-ring","lightbulb-dollar","lightbulb-exclamation","lightbulb-on","lightbulb-slash","lightbulb","link","lips","lira-sign","list-alt","list-ol","list-ul","list","location-arrow","location-circle","location-slash","location","lock-alt","lock-open-alt","lock-open","lock","long-arrow-alt-down","long-arrow-alt-left","long-arrow-alt-right","long-arrow-alt-up","long-arrow-down","long-arrow-left","long-arrow-right","long-arrow-up","loveseat","low-vision","luchador","luggage-cart","lungs","mace","magic","magnet","mail-bulk","male","mandolin","map-marked-alt","map-marked","map-marker-alt-slash","map-marker-alt","map-marker-check","map-marker-edit","map-marker-exclamation","map-marker-minus","map-marker-plus","map-marker-question","map-marker-slash","map-marker-smile","map-marker-times","map-marker","map-pin","map-signs","map","marker","mars-double","mars-stroke-h","mars-stroke-v","mars-stroke","mars","mask","medal","medkit","megaphone","meh-blank","meh-rolling-eyes","meh","memory","menorah","mercury","meteor","microchip","microphone-alt-slash","microphone-alt","microphone-slash","microphone","microscope","mind-share","minus-circle","minus-hexagon","minus-octagon","minus-square","minus","mobile-alt","mobile-android-alt","mobile-android","mobile","money-bill-alt","money-bill-wave-alt","money-bill-wave","money-bill","money-check-alt","money-check","monitor-heart-rate","monkey","monument","moon-cloud","moon-stars","moon","mortar-pestle","mosque","motorcycle","mountain","mountains","mouse-pointer","music","narwhal","network-wired","neuter","newspaper","not-equal","notes-medical","object-group","object-ungroup","octagon","oil-can","oil-temp","om","omega","otter","outdent","paint-brush-alt","paint-brush","paint-roller","palette","pallet-alt","pallet","paper-plane","paperclip","parachute-box","paragraph","parking-circle-slash","parking-circle","parking-slash","parking","passport","pastafarianism","paste","pause-circle","pause","paw-alt","paw-claws","paw","peace","pegasus","pen-alt","pen-fancy","pen-nib","pen-square","pen","pencil-alt","pencil-paintbrush","pencil-ruler","pencil","pennant","people-carry","percent","percentage","person-booth","person-carry","person-dolly-empty","person-dolly","person-sign","phone-office","phone-plus","phone-slash","phone-square","phone-volume","phone","pi","pie","pig","piggy-bank","pills","place-of-worship","plane-alt","plane-arrival","plane-departure","plane","play-circle","play","plug","plus-circle","plus-hexagon","plus-octagon","plus-square","plus","podcast","podium-star","podium","poll-h","poll-people","poll","poo-storm","poo","poop","portrait","pound-sign","power-off","pray","praying-hands","prescription-bottle-alt","prescription-bottle","prescription","presentation","print-slash","print","procedures","project-diagram","pumpkin","puzzle-piece","qrcode","question-circle","question-square","question","quidditch","quote-left","quote-right","quran","rabbit-fast","rabbit","racquet","rainbow","raindrops","ram","ramp-loading","random","receipt","rectangle-landscape","rectangle-portrait","rectangle-wide","recycle","redo-alt","redo","registered","repeat-1-alt","repeat-1","repeat-alt","repeat","reply-all","reply","republican","retweet-alt","retweet","ribbon","ring","road","robot","rocket","route-highway","route-interstate","route","rss-square","rss","ruble-sign","ruler-combined","ruler-horizontal","ruler-triangle","ruler-vertical","ruler","running","rupee-sign","sad-cry","sad-tear","save","scalpel-path","scalpel","scanner-keyboard","scanner-touchscreen","scanner","scarecrow","school","screwdriver","scroll-old","scroll","scrubber","scythe","search-dollar","search-location","search-minus","search-plus","search","seedling","server","shapes","share-all","share-alt-square","share-alt","share-square","share","sheep","shekel-sign","shield-alt","shield-check","shield-cross","shield","ship","shipping-fast","shipping-timed","shoe-prints","shopping-bag","shopping-basket","shopping-cart","shovel","shower","shredder","shuttle-van","shuttlecock","sigma","sign-in-alt","sign-in","sign-language","sign-out-alt","sign-out","sign","signal-1","signal-2","signal-3","signal-4","signal-alt-1","signal-alt-2","signal-alt-3","signal-alt-slash","signal-alt","signal-slash","signal","signature","sitemap","skeleton","skull-crossbones","skull","slash","sliders-h-square","sliders-h","sliders-v-square","sliders-v","smile-beam","smile-plus","smile-wink","smile","smog","smoke","smoking-ban","smoking","snake","snow-blowing","snowflake","socks","solar-panel","sort-alpha-down","sort-alpha-up","sort-amount-down","sort-amount-up","sort-down","sort-numeric-down","sort-numeric-up","sort-up","sort","spa","space-shuttle","spade","spider-black-widow","spider-web","spider","spinner-third","spinner","splotch","spray-can","square-full","square-root-alt","square-root","square","squirrel","staff","stamp","star-and-crescent","star-exclamation","star-half-alt","star-half","star-of-david","star-of-life","star","stars","steering-wheel","step-backward","step-forward","stethoscope","sticky-note","stomach","stop-circle","stop","stopwatch","store-alt","store","stream","street-view","strikethrough","stroopwafel","subscript","subway","suitcase-rolling","suitcase","sun-cloud","sun-dust","sun-haze","sun","sunrise","sunset","superscript","surprise","swatchbook","swimmer","swimming-pool","sword","swords","synagogue","sync-alt","sync","syringe","table-tennis","table","tablet-alt","tablet-android-alt","tablet-android","tablet-rugged","tablet","tablets","tachometer-alt-average","tachometer-alt-fast","tachometer-alt-fastest","tachometer-alt-slow","tachometer-alt-slowest","tachometer-alt","tachometer-average","tachometer-fast","tachometer-fastest","tachometer-slow","tachometer-slowest","tachometer","tag","tags","tally","tape","tasks","taxi","teeth-open","teeth","temperature-frigid","temperature-high","temperature-hot","temperature-low","tennis-ball","terminal","text-height","text-width","th-large","th-list","th","theater-masks","thermometer-empty","thermometer-full","thermometer-half","thermometer-quarter","thermometer-three-quarters","thermometer","theta","thumbs-down","thumbs-up","thumbtack","thunderstorm-moon","thunderstorm-sun","thunderstorm","ticket-alt","ticket","tilde","times-circle","times-hexagon","times-octagon","times-square","times","tint-slash","tint","tire-flat","tire-pressure-warning","tire-rugged","tire","tired","toggle-off","toggle-on","toilet-paper-alt","toilet-paper","tombstone-alt","tombstone","toolbox","tooth","toothbrush","torah","torii-gate","tornado","tractor","trademark","traffic-cone","traffic-light-go","traffic-light-slow","traffic-light-stop","traffic-light","train","transgender-alt","transgender","trash-alt","trash","treasure-chest","tree-alt","tree","trees","triangle","trophy-alt","trophy","truck-container","truck-couch","truck-loading","truck-monster","truck-moving","truck-pickup","truck-ramp","truck","tshirt","tty","turkey","turtle","tv-retro","tv","umbrella-beach","umbrella","underline","undo-alt","undo","unicorn","union","universal-access","university","unlink","unlock-alt","unlock","upload","usd-circle","usd-square","user-alt-slash","user-alt","user-astronaut","user-chart","user-check","user-circle","user-clock","user-cog","user-crown","user-edit","user-friends","user-graduate","user-injured","user-lock","user-md","user-minus","user-ninja","user-plus","user-secret","user-shield","user-slash","user-tag","user-tie","user-times","user","users-class","users-cog","users-crown","users","utensil-fork","utensil-knife","utensil-spoon","utensils-alt","utensils","value-absolute","vector-square","venus-double","venus-mars","venus","vial","vials","video-plus","video-slash","video","vihara","volcano","volleyball-ball","volume-down","volume-mute","volume-off","volume-slash","volume-up","volume","vote-nay","vote-yea","vr-cardboard","walking","wallet","wand-magic","wand","warehouse-alt","warehouse","watch-fitness","watch","water-lower","water-rise","water","weight-hanging","weight","whale","wheat","wheelchair","whistle","wifi-1","wifi-2","wifi-slash","wifi","wind-warning","wind","window-alt","window-close","window-maximize","window-minimize","window-restore","window","windsock","wine-bottle","wine-glass-alt","wine-glass","won-sign","wrench","x-ray","yen-sign","yin-yang"],
a.faBrand=["500px","accessible-icon","accusoft","acquisitions-incorporated","adn","adversal","affiliatetheme","algolia","alipay","amazon-pay","amazon","amilia","android","angellist","angrycreative","angular","app-store-ios","app-store","apper","apple-pay","apple","asymmetrik","audible","autoprefixer","avianex","aviato","aws","bandcamp","behance-square","behance","bimobject","bitbucket","bitcoin","bity","black-tie","blackberry","blogger-b","blogger","bluetooth-b","bluetooth","btc","buromobelexperte","buysellads","cc-amazon-pay","cc-amex","cc-apple-pay","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","centercode","chrome","cloudscale","cloudsmith","cloudversify","codepen","codiepie","connectdevelop","contao","cpanel","creative-commons-by","creative-commons-nc-eu","creative-commons-nc-jp","creative-commons-nc","creative-commons-nd","creative-commons-pd-alt","creative-commons-pd","creative-commons-remix","creative-commons-sa","creative-commons-sampling-plus","creative-commons-sampling","creative-commons-share","creative-commons-zero","creative-commons","critical-role","css3-alt","css3","cuttlefish","d-and-d-beyond","d-and-d","dashcube","delicious","deploydog","deskpro","dev","deviantart","digg","digital-ocean","discord","discourse","dochub","docker","draft2digital","dribbble-square","dribbble","dropbox","drupal","dyalog","earlybirds","ebay","edge","elementor","ello","ember","empire","envira","erlang","ethereum","etsy","expeditedssl","facebook-f","facebook-messenger","facebook-square","facebook","fantasy-flight-games","firefox","first-order-alt","first-order","firstdraft","flickr","flipboard","fly","font-awesome-alt","font-awesome-flag","font-awesome","fonticons-fi","fonticons","fort-awesome-alt","fort-awesome","forumbee","foursquare","free-code-camp","freebsd","fulcrum","galactic-republic","galactic-senate","get-pocket","gg-circle","gg","git-square","git","github-alt","github-square","github","gitkraken","gitlab","gitter","glide-g","glide","gofore","goodreads-g","goodreads","google-drive","google-play","google-plus-g","google-plus-square","google-plus","google-wallet","google","gratipay","grav","gripfire","grunt","gulp","hacker-news-square","hacker-news","hackerrank","hips","hire-a-helper","hooli","hornbill","hotjar","houzz","html5","hubspot","imdb","instagram","internet-explorer","ioxhost","itunes-note","itunes","java","jedi-order","jenkins","joget","joomla","js-square","js","jsfiddle","kaggle","keybase","keycdn","kickstarter-k","kickstarter","korvue","laravel","lastfm-square","lastfm","leanpub","less","line","linkedin-in","linkedin","linode","linux","lyft","magento","mailchimp","mandalorian","markdown","mastodon","maxcdn","medapps","medium-m","medium","medrt","meetup","megaport","microsoft","mix","mixcloud","mizuni","modx","monero","napster","neos","nimblr","nintendo-switch","node-js","node","npm","ns8","nutritionix","odnoklassniki-square","odnoklassniki","old-republic","opencart","openid","opera","optin-monster","osi","page4","pagelines","palfed","patreon","paypal","penny-arcade","periscope","phabricator","phoenix-framework","phoenix-squadron","php","pied-piper-alt","pied-piper-hat","pied-piper-pp","pied-piper","pinterest-p","pinterest-square","pinterest","playstation","product-hunt","pushed","python","qq","quinscape","quora","r-project","ravelry","react","reacteurope","readme","rebel","red-river","reddit-alien","reddit-square","reddit","renren","replyd","researchgate","resolving","rev","rocketchat","rockrms","safari","sass","schlix","scribd","searchengin","sellcast","sellsy","servicestack","shirtsinbulk","shopware","simplybuilt","sistrix","sith","skyatlas","skype","slack-hash","slack","slideshare","snapchat-ghost","snapchat-square","snapchat","soundcloud","speakap","spotify","squarespace","stack-exchange","stack-overflow","staylinked","steam-square","steam-symbol","steam","sticker-mule","strava","stripe-s","stripe","studiovinari","stumbleupon-circle","stumbleupon","superpowers","supple","teamspeak","telegram-plane","telegram","tencent-weibo","the-red-yeti","themeco","themeisle","think-peaks","trade-federation","trello","tripadvisor","tumblr-square","tumblr","twitch","twitter-square","twitter","typo3","uber","uikit","uniregistry","untappd","usb","ussunnah","vaadin","viacoin","viadeo-square","viadeo","viber","vimeo-square","vimeo-v","vimeo","vine","vk","vnv","vuejs","weebly","weibo","weixin","whatsapp-square","whatsapp","whmcs","wikipedia-w","windows","wix","wizards-of-the-coast","wolf-pack-battalion","wordpress-simple","wordpress","wpbeginner","wpexplorer","wpforms","wpressr","xbox","xing-square","xing","y-combinator","yahoo","yandex-international","yandex","yelp","yoast","youtube-square","youtube","zhihu"];var h=_.map(a.icons,function(a){return{text:a,mark:'<i data-name="'+a+'" class="pointer icons-menu '+a+'"></i>'}}),i=_.map(a.faIcons,function(a){return{text:a,mark:'<i data-name="fal fa-'+a+'" class="pointer icons-menu fal fa-'+a+'"></i>'}}),j=_.map(a.faIcons,function(a){return{text:a,mark:'<i data-name="far fa-'+a+'" class="pointer icons-menu far fa-'+a+'"></i>'}}),k=_.map(a.faIcons,function(a){return{text:a,mark:'<i data-name="fas fa-'+a+'" class="pointer icons-menu fas fa-'+a+'"></i>'}}),l=_.map(a.faBrand,function(a){return{text:a,mark:'<i data-name="fab fa-'+a+'" class="pointer icons-menu fab fa-'+a+'"></i>'}}),m=h.concat(i,j,k,l);m=_.map(m,function(a,b){return{index:Math.floor(b/9),text:a.text,mark:a.mark}}),m=_.groupBy(m,"index"),m=_.map(m,function(a,b){return{text:_.map(a,"text").join(""),mark:"<tr><td>"+a.map(function(a){return a.mark}).join("</td><td>")+"</td></tr>"}}),data=m;var n,o="contentArea"+a.id;e(function(){n=new Clusterize({rows:_.map(data,"mark"),scrollId:"scrollArea"+a.id,contentId:o,callbacks:{mapFunction:function(a){return{markup:a}},clusterChanged:function(){$("#"+o).find("tr:not(.clusterize-extra-row) td i").on("click",function(){var b=$(this).data("name");e(function(){a.model=a.model||{},a.model.name=b,a.model.type="icon",g.hide(),a.change&&a.change()},0)})}}})},0),a.filter=function(a){n.update(_.map(data.filter(function(b){return b.text.indexOf(a)!=-1}),"mark"))},a.picModel={select:function(b){a.model=a.model||{},a.model.name=b,a.model.type="image",a.change&&a.change(),a.$apply()}},a.type=a.type||"image, icon",console.log("#### $scope.type",a.type),a.hasImage=a.type.indexOf("image")!=-1,a.hasIcon=a.type.indexOf("icon")!=-1}],templateUrl:app.urlPrefix+"dist/partial/management/directives/icons.html?v="+app.version}}).service("intervalFetchService",["$http",function(a){var b=function(b,c,d){return c||(c=0),d||(d=20),a.get(app.urlPrefix+"api/intervalfetchs/get/"+b,{params:{offset:c,count:d}}).then(function(a){return a.data})},c=function(b){return a.get(app.urlPrefix+"api/intervalfetchs/refresh/"+b).then(function(a){return a.data})},d=function(b,c,d){return a.post(app.urlPrefix+"api/intervalfetchs/add/",{id:b,from:c,to:d}).then(function(a){return a.data})},e=function(b){return a.post(app.urlPrefix+"api/intervalfetchs/deleteAll/"+b)},f=function(b){return a.post(app.urlPrefix+"api/intervalfetchs/delete/"+b)};return{get:b,refresh:c,deleteAll:e,add:d,remove:f}}]).directive("matrixSelect",function(){return{restrict:"E",transclude:!0,scope:{model:"=ngModel",dimColor:"=",ngChange:"&?"},controller:["$scope","$http","$translate","roles","$mdToast","utils","$timeout",function(a,b,c,d,e,f,g){a.app=app,a.$watch("dimColor",function(b){if(a.model=a.model||{enable:!1},a.model.data=a.model.data||{},b){var c=!1;for(var d in b)!a.model.data[d]&&b[d]&&(a.model.data[d]={check:!0},c=!0);c&&g(function(){a.ngChange()},1)}},!0),a.clear=function(){a.model.data={},a.dimColor={},a.ngChange()}}],template:'            <div class="form-row" layout="row" layout-align="start center">                                                 <div class="col-sm-offset-4 col-sm-8">                                                                          <div class="checkbox">                                                                                          <label class="">                                                                                                <input type="checkbox" ng-change="ngChange()" ng-model="model.enable" />                                    انتخاب برچسب‌های نمایش                                                                  </label>                                                                                                </div>                                                                                                  </div>                                                                                                  </div>                                                                                                      <div class= "ui mini segment" ng-show="model.enable" >                                                                                                             <div class="ui mini compact button" ng-click="clear()">پاک کردن</div>                                                                                       <div ng-repeat="(key, value) in model.data">                                                                                                                     <div class="form-row" layout="row" layout-align="start center">                                                                                                              <div class= "col-sm-offset-4 col-sm-8">                                                                                                                                        <div class="checkbox">                                                                                                                                                           <label class="">                                                                                                                                                                 <input type="checkbox" ng-model="model.data[key].check" ng-change="ngChange()" />   {{key}}                                 </label>                                                                                                                                                                 </div>                                                                                                                                                                   </div>                                                                                                                                                               </div >                                                                                                                                                              </div>            </div>'}});var ngApp=angular.module("management");ngApp.controller("menusCtrl",["$scope","$http","$sce","$routeParams","$location","$mdSidenav","toolbar","$timeout","$translate","$mdMedia","iframeService",function(a,b,c,d,e,f,g,h,i,j,k){var l={"Moderation/DataSource/index/":"/datasources","Account/UsersList":"/users","Account/RolesList":"/roles","Moderation/Charts/index/":"/charts","Moderation/GlobalVariable/index/":"/variables","Moderation/DatasourceInterRelation/index/":"/datasourceJoin","Moderation/AutoUpdate/index/":"/settings/update","Moderation/Settings/Mail/":"/settings/mail","Moderation/Settings/GeneralSettings/":"/settings",onlineUsers:"/onlineUsers",licence:"/licence"},m={"Account/UsersList":"person","Account/RolesList":"group","Moderation/DataSource/index/":"storage","Moderation/Charts/index/":"timeline","Moderation/GlobalVariable/index/":"space_bar","Moderation/DatasourceInterRelation/index/":"linear_scale","Moderation/AutoUpdate/index/":"update","Moderation/Settings/Mail/":"mail","Moderation/Settings/GeneralSettings/":"settings",onlineUsers:"rowing",licence:"card_membership",dashboards:"dashboard",syncUserVariablesList:"sync",eventNotifications:"notifications_none","forms/list":"assignment"};a.iframeService=k,a.lock=j("gt-md"),a.toolbar=g,a.app=app,a.persian=persian,a.mainMenuType=1,a.toggle=function(){console.log("### locl",a.lock,j("gt-md")),j("gt-md")?a.lock=!a.lock:(f("r").toggle(),console.log("### call toggle"))},b.get(app.urlPrefix+"api/menus/MenuCategories/3").then(function(b){function c(){a.closeAll();var b=e.path();_.each(a.menuCategories.data,function(a){_.each(a.menus,function(c){c.active=!1,b.replace(/^\/(.*)/i,"$1")==c.menu.Link.replace(/^\/(.*)/i,"$1")&&(c.active=!0,a.isOpen=!0)})})}a.menuCategories=b.data;try{a.menuCategories.data[4].menus.splice(0,1)}catch(d){}var f=e.path();_.each(a.menuCategories.data,function(a){_.each(a.menus,function(a){a.menu.icon=m[a.menu.Link]||"code",a.menu.Link=l[a.menu.Link]||a.menu.Link})}),f&&"/"!=f&&"/nothings"!=f||e.path(a.menuCategories.isRoleAdmin?"/roles":a.menuCategories.data[0].menus[0].menu.Link),c(),a.$on("$locationChangeStart",function(a,b,d){c()})}),a.setLink=function(a){f("r").toggle(),h(function(){e.path(a.menu.Link)},400)},a.closeNav=function(){f("r").toggle()},a.closeAll=function(b){_.each(a.menuCategories.data,function(a){b?a.category.Id!==b.category.Id&&(a.isOpen=!1):a.isOpen=!1})},a.gotoDashboard=function(){e.path()},0==+$("#lang").val()?i.use("fa"):i.use("en")}]),ngApp.service("toolbar",[function(){function a(a){f=a}function b(){return f}function c(a){e=a}function d(){e&&e.toggle()}var e,f=[{name:"",click:function(){}}];return{setTitles:a,getTitles:b,setSideNave:c,toggleSideNave:d}}]);var ngApp=angular.module("management");ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/datasources/add/mssql/:type/:packageId?/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/mssql.html?v="+app.version,controller:"datasourceMssqlCtrl"}).when("/datasources/add/file/:packageId?/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/file.html?v="+app.version,controller:"datasourcefileCtrl"}).when("/datasources/add/web/:packageId?/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/web.html?v="+app.version,controller:"datasourceWebCtrl"}).when("/datasources/add/join/:packageId?/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/join.html?v="+app.version,controller:"datasourceJoinCtrl"}).when("/datasources/new/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/new.html?v="+app.version,controller:"datasourceNewCtrl"}).when("/datasources/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/list.html?v="+app.version,controller:"datasourceListCtrl"}).when("/datasourceJoin",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/interRelation.html?v="+app.version,controller:"interRelationCtrl"}).when("/charts/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/charts/list.html?v="+app.version,controller:"chartsListCtrl"}).when("/charts/edit/:packageId?/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/charts/editor.html?v="+app.version,controller:"chartsEditorCtrl"}).when("/charts/new/:type/:packageId/:datasourceId?/:charttype?",{templateUrl:app.urlPrefix+"dist/partial/management/charts/editor.html?v="+app.version,controller:"chartsEditorCtrl"}).when("/variables",{templateUrl:app.urlPrefix+"dist/partial/management/datasource/list.html?v="+app.version,controller:"datasourceCtrl"}).when("/users",{templateUrl:app.urlPrefix+"dist/partial/management/account/userList.html?v="+app.version,controller:"usersListCtrl"}).when("/users/edit/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/account/userEdit.html?v="+app.version,controller:"userEditCtrl"}).when("/roles",{templateUrl:app.urlPrefix+"dist/partial/management/account/roleList.html?v="+app.version,controller:"rolesListCtrl"}).when("/roles/edit/:id?/:parent?",{templateUrl:app.urlPrefix+"dist/partial/management/account/roleEdit.html?v="+app.version,controller:"roleEditCtrl"}).when("/variables",{templateUrl:app.urlPrefix+"dist/partial/management/account/variables.html?v="+app.version,controller:"variablesCtrl"}).when("/settings/update",{templateUrl:app.urlPrefix+"dist/partial/management/account/update.html?v="+app.version,controller:"updateCtrl"}).when("/settings/mail",{templateUrl:app.urlPrefix+"dist/partial/management/account/mail.html?v="+app.version,controller:"mailCtrl"}).when("/settings",{templateUrl:app.urlPrefix+"dist/partial/management/account/settings.html?v="+app.version,controller:"settingsCtrl"}).when("/onlineUsers",{templateUrl:app.urlPrefix+"dist/partial/management/account/onlineUsers.html?v="+app.version,controller:"onlineUsersCtrl"}).when("/licence",{templateUrl:app.urlPrefix+"dist/partial/management/account/licence.html?v="+app.version,controller:"licenceCtrl"}).when("/activeDirectory",{templateUrl:app.urlPrefix+"dist/partial/management/account/activeDirectory.html?v="+app.version,controller:"activeDirectoryCtrl",controllerAs:"ad"}).when("/userBulkInsert",{templateUrl:app.urlPrefix+"dist/partial/management/account/userBulkInsert.html?v="+app.version,controller:"userBulkInsertCtrl",controllerAs:"ubi"}).when("/syncUserVariablesList",{templateUrl:app.urlPrefix+"dist/partial/management/account/syncUserVariablesList.html?v="+app.version,controller:"syncUserVariablesListCtrl",controllerAs:"cnl"}).when("/syncUserVariablesDetail/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/account/syncUserVariablesDetail.html?v="+app.version,controller:"syncUserVariablesDetailCtrl",controllerAs:"cnl"}).when("/logs",{templateUrl:app.urlPrefix+"dist/partial/management/account/log.html?v="+app.version,controller:"logCtrl"}).when("/upload_chart",{templateUrl:app.urlPrefix+"dist/partial/management/account/uploadChart.html?v="+app.version,controller:"uploadChart"}).when("/upload_chart/:id",{templateUrl:app.urlPrefix+"dist/partial/management/account/uploadChartDetail.html?v="+app.version,controller:"uploadChartDetail"}).when("/dashboards/:id",{templateUrl:app.urlPrefix+"dist/partial/management/dashboard/detail.html?v="+app.version,controller:"dashboardDetailCtrl"}).when("/dashboards",{templateUrl:app.urlPrefix+"dist/partial/management/dashboard/dashboards.html?v="+app.version,controller:"dashboardsCtrl"}).when("/themes",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/compare-data",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/eventNotifications",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/telegram-config",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/process-all-tables",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/login-page-logo",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/olap-tables/:id?",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/menu-category",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/userVariables",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/userVariables/:name",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"}).when("/chart-import",{templateUrl:app.urlPrefix+"dist/partial/management/account/themes.html?v="+app.version,controller:"themesCtrl"})}]);var ngApp=angular.module("management");ngApp.service("templates",[function(){var a={package_dialog:app.urlPrefix+"dist/partial/management/packages/select-package.html"};return{tmpl:a}}]);var ngApp=angular.module("management");ngApp.controller("activeDirectoryCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","roles",function(a,b,c,d,e,f,g,h,i){var j=this;a.utils=h,a.app=app,g("Active Directory Integration").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),j.moment=moment,j.bindOption=2,i.get().then(function(a){j.roles=a.data.list}),$(".ui.dimmer.modals .cert-modal").remove(),this.getList=function(){j.progress=!0,b.post(app.urlPrefix+"api/activedirectory/GetUserList",JSON.stringify({server:j.server,user:j.user,pass:j.pass,container:j.container,bindOption:j.bindOption,ssl:j.ssl,approveHash:j.approveHash})).then(function(a){j.progress=!1,j.approveHash=null,a.data.result&&(j.data=a.data.list,$(".cert-modal").modal("hide")),a.data.result||(j.cert=a.data.cert,j.certHash=a.data.hash,$(".cert-modal").modal("show"))})["catch"](function(a){j.approveHash=null,h.showErrorToast(a.data.desc),j.progress=!1,$(".cert-modal").modal("hide")})},j.approveCert=function(){j.approveHash=j.certHash,j.getList()},this.selectAll=function(a){_.forEach(j.data,function(b){b.select=a})},this.saveSelectedUsers=function(){j.saveProgress=!0,j.moment=moment;var a=_.filter(j.data,{select:!0}).map(function(a){return{server:a.server,user:a.SamAccountName,pass:a.DisplayName,container:j.container,bindOption:j.bindOption,approveHash:a.approveHash,ssl:a.ssl}}),d=_.filter(j.roles,{check:!0});b.post(app.urlPrefix+"api/activedirectory/SaveUsers",JSON.stringify({users:a,roles:d})).then(function(a){if(j.saveProgress=!1,a.data&&a.data.length)j.error=c.trustAsHtml("<ul><li>"+a.data.map(function(a){return filterXSS(a.user)+", "}).join("</li><li>")+"</li></ul>");else{var b=e.simple().textContent("کاربرهای انتخاب شده با موفقیت به سیستم اضافه شدند");e.show(b)}j.data=null},function(a){h.showErrorToast(a.data.desc),j.saveProgress=!1})}}]);var ngApp=angular.module("management");ngApp.controller("userBulkInsertCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","roles",function(a,b,c,d,e,f,g,h,i){var j=this;a.utils=h,a.app=app,g("اضافه کردن گروهی کاربرها").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),j.bindOption=2,i.get().then(function(a){j.roles=a.data.list}),j.process=function(){if(!j.rawData||!j.rawData.length)return void alert("داده‌ی درستی وارد نشده است");var a=_.split(j.rawData,/[\r\n]/);j.data=_.map(a,function(a){var b=_.split(a,/[;\t]/),c={name:"",family:"",username:"",password:"",complex:!1,needChange:!1};return b.length>=1&&(c.name=b[0]),b.length>=2&&(c.family=b[1]),b.length>=3&&(c.username=b[2]),b.length>=4&&(c.password=b[3]),b.length>=5&&+b[4]&&(c.complex=!0),b.length>=6&&+b[5]&&(c.needChange=!0),c})},this.selectAll=function(a){_.forEach(j.data,function(b){b.select=a})},this.saveSelectedUsers=function(){j.saveProgress=!0;var a=_.filter(j.data,{select:!0}),c=_.filter(j.roles,{check:!0});b.post(app.urlPrefix+"api/users/bulkinsert",JSON.stringify({users:a,roles:c})).then(function(a){j.saveProgress=!1;var b=e.simple().textContent("کاربرهای انتخاب شده با موفقیت به سیستم اضافه شدند");e.show(b),_.each(a.data.existed,function(a){_.find(j.data,{username:a.username}).status=1}),_.each(a.data.inserted,function(a){_.find(j.data,{username:a.username}).status=2})},function(a){h.showErrorToast(a.data.desc),j.saveProgress=!1})}}]);var ngApp=angular.module("management");ngApp.controller("syncUserVariablesListCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","roles","$mdDialog",function(a,b,c,d,e,f,g,h,i,j){function k(a){e.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}var l=this;l.utils=h,l.app=app;g("User Variable Sync").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),l.progress=!0,b.get(app.urlPrefix+"api/syncUserVariables/get").then(function(a){l.progress=!1,l.data=a.data},function(){l.progress=!1,k("خطایی در دریافت اطلاعات رخ داده است")}),l.sync=function(a,c){c.progress=!0,b.post(app.urlPrefix+"api/syncUserVariables/sync?id="+c.Id).then(function(a){c.progress=!1,c.LastRefresh=a.data.LastRefresh,e.show(e.simple().textContent(" منبع داده "+c.DatasourceName+"  و متغیر "+c.VariableName+" با موفقیت همگام شدند"))},function(){c.progress=!1,k("خطایی در همگام‌سازی رخ داده است")})},l["delete"]=function(a,c){var d=j.confirm().title("حذف برای همیشه؟").textContent("آیا ارتباط بین منبع داده "+c.DatasourceName+"  و متغیر "+c.VariableName+" حذف شود؟").ariaLabel("حذف").targetEvent(a).ok("حذف!").cancel("لغو");j.show(d).then(function(){b.post(app.urlPrefix+"api/syncUserVariables/delete?id="+c.Id).then(function(a){e.show(e.simple().textContent("عملیات با موفقیت به اتمام رسید")),_.remove(l.data,{Id:c.Id})},function(){k("خطایی در حذف رخ داده است")})})}}]),ngApp.controller("syncUserVariablesDetailCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","datasources","$routeParams",function(a,b,c,d,e,f,g,h,i,j){function k(a){n.getInfoProgress=!1,n.error=a.data.desc}function l(){n.error=null}function m(a){e.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}var n=this;a.utils=h,a.app=app;var o="undefined"!=typeof j.id?j.id:0;if(g("User Variable Sync").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),o>0){n.getInfoProgress=!0;var p=app.urlPrefix+"api/syncUserVariables/get/"+o;b.get(p).then(function(a){n.userProperties=[],n.selectedDatasource={id:a.data.DatasourceId,name:a.data.DatasourceName},n.usernameColumn=a.data.UsernameColumn,n.variableValueColumn=a.data.VariableValueColumn,n.variableName=a.data.VariableName,n.getColumns()},function(a){k(a)})}n.selectDatasource=function(a){i.select(a,{type:["datasources"]}).then(function(a){l(),n.selectedDatasource=a.selected[0],n.getColumns()})},n.getColumns=function(){i.getColumns(n.selectedDatasource.id).then(function(a){n.getInfoProgress=!1,n.datasourceColumns=a.CubeInfo.Dimensions[0].Hierarchies,n.userProperties=a.UsersProperty},function a(b){a(b)})},n.saveAndSync=function(c){return a.syncForm.$valid?(n.syncProgress=!0,n.syncError=null,n.effectedUsers=null,void b.post(app.urlPrefix+"api/syncUserVariables/saveAndSync",{id:o,datasourceId:n.selectedDatasource.id,usernameColumn:n.usernameColumn,variableValueColumn:n.variableValueColumn,variableName:n.variableName}).then(function(a){n.syncProgress=!1,n.effectedUsers=a.data.effected,o=a.data.id,e.show(e.simple().textContent("عملیات با موفقیت به اتمام رسید"))},function(a){n.syncProgress=!1,n.syncError=a.data.desc,m("خطایی در روند همگام سازی به وجود آمده است")})):void m("فیلدهای ضروری باید پر شوند")}}]);var ngApp=angular.module("management");ngApp.controller("licenceCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils",function(a,b,c,d,e,f,g,h){a.utils=h,g("licence_manager").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),a.progress=!0,b.get(app.urlPrefix+"api/licence/get").then(function(b){a.progress=!1,a.data=b.data}),a.clear=function(){b.post(app.urlPrefix+"api/licence/clear").then(function(a){window.location=app.urlPrefix+"Account/LogOff"})}}]);var ngApp=angular.module("management");ngApp.filter("htmlSafe",["$sce",function(a){return function(b){return a.trustAsHtml(filterXSS(b))}}]),ngApp.controller("mailCtrl",["$scope","$http","$sce","$timeout","$mdToast",function(a,b,c,d,e){function f(a){return a&&(a=a.trim()),_.isEmpty(a)}function g(){return!(f((a.port||"")+"")||f(a.host)||f((a.timeout||"")+"")||f(a.username)||f(a.password))||(a.message=null,a.error=c.trustAsHtml("فیلدهای ضروری باید پر شوند"),!1)}function h(b,c){return!(b.result||!b.cert)&&($(".mail-cert-modal").modal("show"),a.certMode=c,a.cert=b.cert,a.certHash=b.hash,!0)}$(".ui.dimmer.modals .mail-cert-modal").remove(),a.moment=moment,a.save=function(d){a.message=null,a.error=null,g()&&(a.progress=!0,b.post(app.urlPrefix+"api/Settings/Mail",JSON.stringify({port:a.port,host:a.host,ssl:a.ssl,timeout:a.timeout,username:a.username,password:a.password,approveHash:a.approveHash}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){if(a.progress=!1,a.approveHash=null,$(".mail-cert-modal").modal("hide"),!h(b.data,"save"))if(b.data.result){window.history.back();var d=e.simple().textContent("تغییرات ثبت شد");e.show(d)}else a.message=null,a.error=c.trustAsHtml(filterXSS(b.data.error))},function(b){$(".mail-cert-modal").modal("hide"),a.approveHash=null,a.progress=!1,a.message=null,a.error=c.trustAsHtml(filterXSS(b.data.desc))}))},a.approveCert=function(){a.approveHash=a.certHash,"test"===a.certMode&&a.test(),"save"===a.certMode&&a.save()},a.test=function(d){a.error=null,a.message=null,g()&&(a.progress=!0,b.post(app.urlPrefix+"api/Settings/Test",JSON.stringify({port:a.port,host:a.host,ssl:a.ssl,timeout:a.timeout,username:a.username,password:a.password,approveHash:a.approveHash}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){if(a.progress=!1,$(".mail-cert-modal").modal("hide"),a.approveHash=null,!h(b.data,"test"))if(b.data.result){a.message=c.trustAsHtml("ارسال پست الکترونیک با اطلاعات وارد درست است");var d=e.simple().textContent("ارسال پست الکترونیک با اطلاعات وارد درست است");e.show(d)}else a.message=null,a.error=c.trustAsHtml(filterXSS(b.data.error))},function(b){$(".mail-cert-modal").modal("hide"),a.approveHash=null,a.progress=!1,a.message=null,a.error=c.trustAsHtml(filterXSS(b.data.desc))}))},a.infoProgress=!0,b.get(app.urlPrefix+"api/settings/getMailInfo").then(function(b){a.infoProgress=!1;var c=b.data;a.port=c.port,a.host=c.host,a.ssl=c.ssl,a.timeout=c.timeout,a.username=c.username,a.password=c.password},function(b){a.infoProgress=!1,a.error=c.trustAsHtml(filterXSS(b.data.desc))})}]);var ngApp=angular.module("management");ngApp.controller("onlineUsersCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils",function(a,b,c,d,e,f,g,h){a.utils=h,g("online_users").then(function(b){a.listTranslate=b,f.setTitles([{name:b,onclick:function(){}}])}),a.kick=function(a){b.post(app.urlPrefix+"api/onlineusers/kick/"+a.id).then(function(a){})},a.progress=!0,b.get(app.urlPrefix+"api/onlineusers/get").then(function(b){a.progress=!1,a.data=b.data.list,a.SecurityCertPatch=b.data.SecurityCertPatch})}]);var ngApp=angular.module("management");ngApp.controller("roleEditCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","$sce","roles","menus","utils","datasources",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc)),t(b.data.desc)}function p(){l.getParentMenu(a.parent).then(function(b){var c=_.groupBy(b.data,"id");_.each(c,function(a,b){if(a.length>1)for(var c=1;c<a.length;c++)a[c].disable=!0,a[c].enableParent=a[0].parent}),_.forEach(b.data,function(a){a.check=!1}),a.menus=_.groupBy(b.data,function(a){return JSON.stringify({name:a.parent,id:a.parentId})}),a.menusFlat=b.data,_.forEach(a.menus,function(a){_.forEach(a,function(a){a.action=1})}),a.menuCategoriesAction={},s()}),r()}function q(){b.get(app.urlPrefix+"api/users/get?parentRole="+a.parent+"&role="+a.id).then(function(b){a.progress=!1,a.users=b.data.list,a.manageableUsers=_.map(b.data.list,_.clone),s()},m.error)}function r(){b.get(app.urlPrefix+"api/roles/GetRoleFunctional?id="+a.parent).then(function(b){_.each(a.actions,function(a){_.each(a.childes,function(a){a.disable=!0,_.isArray(b.data)&&(a.disable=b.data.indexOf(a.id)===-1)})}),console.log(a.actions)})}function s(){a.model&&a.users&&a.menus&&a.themes&&a.mainmenus&&(console.log("#### call restore"),a.model.FirstMenuId=a.model.FirstMenuId+"",a.model.dashboardVariables=a.model.dashboardVariables||[],a.model.FunctionalActions&&_.forEach(a.actions,function(b){_.forEach(b.childes,function(b){b.check=a.model.FunctionalActions.indexOf(b.id)!==-1})}),_.forEach(a.users,function(b){b.check=a.model.Users.indexOf(b.id)!==-1}),_.forEach(a.manageableUsers,function(b){
b.check=a.model.ManageableUsers.indexOf(b.id)!==-1}),_.forEach(a.model.MenuActions,function(b){var c=b.split("-").map(function(a){return+a}),d=c[0],e=c[1];_.forEach(a.menus,function(a,b){var c=_.find(a,{id:e});if(c)return c.action=d,c.check=!0,!1})}),a.datasources=a.model.DatasourceActions.map(function(a){return JSON.parse(a)}),a.charts=a.model.ChartActions.map(function(a){return JSON.parse(a)}),_.each(a.charts,function(b){var c=_.find(a.model.ChartExtraPermissions,{id:b.id});c&&(b.chartExtraPermissions=c.permissions)}),_.forEach(a.model.MenuCategoryActions,function(b){var c=b.split("-").map(function(a){return+a}),d=c[0],e=c[1],f=!1;_.forEach(a.menus,function(b,c){var g=JSON.parse(c);if(g.id===e)return a.menuCategoriesAction[g.id]=d,f=!0,!1}),f||delete a.menuCategoriesAction[e]}),a.forms=a.model.forms,_.each(a.themes,function(b){var c=_.find(a.model.themes,{id:b.id});c&&(b.action=c.action,b.check=!0)}),_.each(a.mainmenus,function(b){var c=_.find(a.model.mainmenus,{id:b.id});c&&(b.action=c.action,b.check=!0)}),a.model.activeTheme=a.model.activeTheme||-1,console.log("#### end restore"),a.restoreFinish=!0)}function t(a){c.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}function u(b){b?(a.model.DatasourceActions=a.datasources.map(function(a){return a.action+"-"+a.id}),a.model.ChartActions=a.charts.map(function(a){return a.action+"-"+a.id}),a.model.ChartExtraPermissions=a.charts.map(function(a){return{id:a.id,permissions:a.chartExtraPermissions}}),a.model.forms=a.forms?a.forms.map(function(a){return{id:a.id,action:a.action,recordPermission:a.recordPermission}}):[],a.model.themes=a.themes?_.filter(a.themes,{check:!0}).map(function(a){return{id:a.id,action:a.action}}):[],a.model.mainmenus=a.mainmenus?_.filter(a.mainmenus,{check:!0}).map(function(a){return{id:a.id,action:a.action}}):[]):(a.model.DatasourceActions=a.datasources.map(function(a){return JSON.stringify(a)}),a.model.ChartActions=a.charts.map(function(a){JSON.stringify(a)}),a.model.forms=a.forms?a.forms.map(function(a){return{id:a.id,action:a.action,recordPermission:a.recordPermission}}):[]),a.model.Users=_.filter(a.users,{check:!0}).map(function(a){return a.id}),a.model.ManageableUsers=_.filter(a.manageableUsers,{check:!0}).map(function(a){return a.id}),a.model.MenuActions=[],_.forEach(a.menus,function(b){var c=_.filter(b,function(a){return a.check&&!a.disable});_.forEach(c,function(b){a.model.MenuActions.push(b.action+"-"+b.id)})}),a.model.MenuCategoryActions=[],_.forEach(a.menuCategoriesAction,function(b,c){+b&&a.model.MenuCategoryActions.push(b+"-"+c)}),a.model.FunctionalActions=[],a.model.ParentRole=a.parent,_.forEach(a.actions,function(b){var c=_.filter(b.childes,{check:!0});_.forEach(c,function(b){a.model.FunctionalActions.push(b.id)})})}a.app=app;var v={ChartAdd:1,ChartView:2,ChartEdit:3,ChartDelete:4,MenuAdd:5,MenuView:6,MenuEdit:7,MenuDelete:8,DataSourceAdd:9,DataSourceView:10,DataSourceEdit:11,DataSourceDelete:12,FormAdd:22,FormView:23,FormEdit:24,FormDelete:25,AdminAccessOnCharts:13,AdminAccessOnMenus:14,AdminAccessOnDataSources:15,AdminAccessOnForms:21,DashboardAddDeleteArragneCharts:16,ManageAllUsersAndRoles:17,ViewManageMainMenu:18,ArrangeMenus:19,UploadChart:26,UserChangeInfo:27,UserChangePassword:28,ViewLogs:29,Chart_Extra_comment:30,Chart_Extra_excel:31,Chart_Extra_desc:32,Chart_Extra_filter:33,ThemeAdd:34,ThemeView:35,ThemeEdit:36,ThemeDelete:37};a.actions=[{title:"مدیریت نمودارها",childes:[{id:v.ChartAdd,name:"ساخت نمودار جدید"},{id:v.ChartView,name:"مشاهده نمودار"},{id:v.ChartEdit,name:"ویرایش نمودار"},{id:v.ChartDelete,name:"حذف نمودار"},{id:v.Chart_Extra_comment,name:"مجوز کامنت روی تمام نمودارها"},{id:v.Chart_Extra_excel,name:"مجوز خروجی اکسل روی تمام نمودارها"},{id:v.Chart_Extra_filter,name:"مجوز فیلتر روی تمام نمودارها"},{id:v.Chart_Extra_desc,name:"مجوز توضیحات روی تمام نمودارها"}]},{title:"مدیریت منوها",childes:[{id:v.MenuAdd,name:"ساخت منوی جدید"},{id:v.MenuView,name:"مشاهده منو"},{id:v.MenuEdit,name:"ویرایش منو"},{id:v.MenuDelete,name:"حذف منو"}]},{title:"مدیریت فرم‌ها",childes:[{id:v.FormAdd,name:"ساخت فرم جدید"},{id:v.FormView,name:"مشاهده فرم"},{id:v.FormEdit,name:"ویرایش فرم"},{id:v.FormDelete,name:"حذف فرم"}]},{title:"مدیریت منابع داده",childes:[{id:v.DataSourceAdd,name:"ساخت منبع داده‌ی جدید"},{id:v.DataSourceView,name:"مشاهده منبع داده"},{id:v.DataSourceEdit,name:"ویرایش منبع داده"},{id:v.DataSourceDelete,name:"حذف منبع داده"}]},{title:"مدیریت پوسته‌ها",childes:[{id:v.ThemeAdd,name:"ساخت پوسته جدید"},{id:v.ThemeView,name:"مشاهده پوسته"},{id:v.ThemeEdit,name:"ویرایش پوسته"},{id:v.ThemeDelete,name:"حذف پوسته"}]},{title:"مدیریت صفحات داشبوردی و کاربران و نقش‌ها",childes:[{type:"input",id:v.ArrangeMenus,name:"تغییر ترتیب منوها"}]},{title:"دسترسی کامل",childes:[{type:"input",id:v.AdminAccessOnCharts,name:"دسترسی کامل به تمام نمودارها"},{type:"input",id:v.AdminAccessOnMenus,name:"دسترسی کامل به تمام منوها"},{type:"input",id:v.AdminAccessOnDataSources,name:"دسترسی کامل به تمام منابع داده"},{type:"input",id:v.AdminAccessOnForms,name:"دسترسی کامل به تمام فرم‌ها"}]},{title:"سایر مجوز‌ها",childes:[{id:v.UploadChart,name:"آپلود کردن نمودار"},{id:v.UserChangeInfo,name:"تغییر اطلاعات کابران زیرمجموعه"},{id:v.UserChangePassword,name:"تغییر کلمه عبور کابران زیرمجموعه"},{id:v.ManageAllUsersAndRoles,name:"مدیر اصلی سیستم"},{id:v.ViewLogs,name:"مشاهده لاگ‌های سیستم"}]}];var w="undefined"!=typeof e.id?e.id:0;a.parent="undefined"!=typeof e.parent?+e.parent:0;var x=w>0;a.id=w,a.isEdit=x,k.get().then(function(b){a.isAdmin=b.data.isAdmin;var c=_.filter(b.data.list,{isAdmin:!0});x&&(c=_.reject(c,{id:+a.id})),a.isAdmin&&(c=[{name:"بدون پدر",id:0}].concat(c)),x||0!==a.parent||(a.parent=c[0].id,a.changeParent()),a.roles=c}),b.get(app.urlPrefix+"api/themes/getnames").then(function(b){a.themes=b.data.list,a.selectThemes=_.extend([],b.data.list),a.selectThemes.splice(0,0,{name:"پیش فرض",id:-1}),_.each(a.themes,function(a){a.action=1}),s()})["catch"](function(){a.themes=[],a.selectThemes=_.extend([],[]),s()}),b.get(app.urlPrefix+"api/mainmenus/get/-1").then(function(b){a.mainmenus=b.data.list,a.useApp=b.data.useApp,_.each(a.mainmenus,function(a){a.action=1}),s()})["catch"](function(){a.mainmenus=[],s()}),a.jsonParse=function(a){return JSON.parse(a)},a.setViewPermission=function(b,c){var d=JSON.parse(b).id;_.some(c,{check:!0})?a.menuCategoriesAction[d]=a.menuCategoriesAction[d]||1:delete a.menuCategoriesAction[d]},q(),a.datasources=[],a.addDatasource=function(b){n.select(b,{type:["datasources"],multipleDatasource:!0,parentRole:a.parent}).then(function(b){var c=_.filter(b.selected,function(b){return!_.some(a.datasources,{id:b.id})});a.datasources=a.datasources.concat(c.map(function(a){return{id:a.id,name:a.name,action:1,permissions:a.permissions}}))})},a.clearDatasources=function(){a.datasources=[]},a.charts=[],a.addChart=function(b){n.select(b,{type:["charts"],parentRole:a.parent}).then(function(b){var c=_.filter(b.selected,function(b){return!_.some(a.charts,{id:b.id})});a.charts=a.charts.concat(c.map(function(a){return{id:a.id,name:a.name,action:1,permissions:a.permissions}}))})},a.clearCharts=function(){a.charts=[]},a.extraActionAllx=[],a.$watch("extraActionAllx",function(b,c){_.isArray(b)&&_.each(a.charts,function(a){a.chartExtraPermissions=b.slice()})},!0),a.datasourceActionAll=1,a.chartActionAll=1,a.actionAll=function(b,c){var d="datasource"===b?a.datasources:a.charts;"datasource"===b?a.datasourceActionAll:a.chartActionAll;_.forEach(d,function(a){var b=0;a.permissions.ViewPermission&&(b=1),a.permissions.EditPermission&&(b=2),a.permissions.DeletePermission&&(b=4),a.action=+c>b?b:+c})},x?b.get(app.urlPrefix+"api/roles/getInfo?id="+w).then(function(b){new Date;if(a.model=b.data.model,a.securityCertPatch=b.data.securityCertPatch,a.licenseThemes=b.data.themes,a.useApp=b.data.useApp,a.sign=b.data.sign,a.childs=b.data.childs,!a.licenseThemes){var c=_.indexOf(a.actions,{title:"مدیریت پوسته‌ها"});c!==-1&&a.actions.splice(c,1)}_.each(a.childs,function(b){b.parent===a.id&&(b.parent=0)}),a.childTree=k.createTree(a.childs),a.model.ParentRole&&(a.parent=a.model.ParentRole),p(),a.isAdmin=b.data.isAdmin,s()},o):(p(),a.restoreFinish=!0),a["delete"]=function(b,c){var d=a.charts;"chart"===b&&(d=a.charts),"datasource"===b&&(d=a.datasources);var e=_.findIndex(d,{id:c});e!==-1&&d.splice(e,1)},a.changeParent=function(){u(!1),p(),q()},b.get(app.urlPrefix+"api/users/getPropertyAutoCompleteEntries").then(function(b){a.auto=b.data,a.auto.keys=_.map(a.auto.keys,function(a){return{title:a}}),console.log("$scope.auto.keys",a.auto.keys),a.auto.flatValues=[],_.each(a.auto.values,function(b){_.each(b.values,function(b){a.auto.flatValues.indexOf(b)===-1&&a.auto.flatValues.push(b)})})},o),a.autocompeleteConfig={templates:{message:function(){}}},a.saveProgress=!1,i(["permission_view","permission_view_edit","permission_view_edit_delete"]).then(function(b){a.actionsKey=[{v:1,c:b.permission_view},{v:2,c:b.permission_view_edit},{v:4,c:b.permission_view_edit_delete}]}),a.save=function(d){a.restoreFinish&&(console.log("#### save"),a.saveProgressState=d?"exit":"stay",a.error=null,a.testResult=null,u(!0),console.log("#### save setModelData ",a.model),a.saveProgress=!0,b.post(app.urlPrefix+"api/roles/edit",a.model).then(function(b){a.saveProgress=!1,k.reset(),i(["new_role_created","edit_complete"]).then(function(a){var b=c.simple().textContent(x?a.edit_complete:a.new_role_created);c.show(b)}),d?f.path("/roles"):x||f.path("/roles/edit/"+b.data+"/"+a.parent)},function(b){a.saveProgress=!1,a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc)),t(b.data.desc)}))},a.checkAll=function(a){_.forEach(a.childes,function(b){b.disable||(b.check=a.checkAll)})},a.addFormSettings={},a.onFormSelect=function(b,c){a.forms=a.forms||[],_.each(b,function(b){_.some(a.forms,{id:b.id})||a.forms.push({id:b.id,name:b.name,action:1})}),h(function(){c.visible=!1},0)}}]),ngApp.filter("filterUsers",function(){return function(a,b){return a&&b?_.filter(a,function(a){return a.username.indexOf(b.username)!==-1||a.name.indexOf(b.username)!==-1}):a}}),ngApp.directive("formPremission",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","formsService",function(a,b,c){}],template:'<div class="ui mini input">                        <sm-dropdown model="model" class="multiple selection" items="[                                                            {k:\'new record\', v:5},                                                            {k:\'edit record\', v:6},                                                            {k:\'delete record\', v:7},                                                            '+(app.license.formBatch?"{k:'batch edit', v:12},{k:'batch delete', v:13},":"")+'                                                          ]" label="item.k" value="item.v" default-text=""></sm-dropdwon>                    </div>'}});var ngApp=angular.module("management");ngApp.controller("rolesListCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","roles","toolbar","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.utils=j,i("لیست نقش‌ها").then(function(a){l.setTitles([{name:a,click:function(){f.path("/roles")}}])}),a.progress=!0,k.get().then(function(b){a.progress=!1,a.data=_.filter(b.data.list,{editPermission:!0}),a.securityCertPatch=b.data.securityCertPatch,a.root=k.createTree(a.data)}),a.isSelected=function(){return _.some(a.data,{select:!0})},a["new"]=function(a){f.path("roles/edit")},a.deleteOne=function(b){_.each(a.data,function(a){a.select=!1}),b.select=!0,a["delete"]()},a.deleteRole=function(d){a.deleteType=d?"with-child":"";var e=app.urlPrefix+"api/roles/delete"+(d?"?withChild=true":""),f=_.filter(a.data,{select:!0}).map(function(a){return a.id});a.deleteProgress=!0,b.post(e,f).then(function(b){a.data=_.filter(a.data,function(a){return b.data.indexOf(a.id)==-1}),k.reset(),a.root=k.createTree(a.data);var d=c.simple().textContent("حذف انجام شد");c.show(d),$(".role-delete-modal").modal("hide"),console.log($(".role-delete-modal")),a.deleteProgress=!1},function(b){a.deleteProgress=!1,j.showErrorToast(b.data.desc),$(".role-delete-modal").modal("hide")})},$(".ui.dimmer.modals .role-delete-modal").remove(),a["delete"]=function(a){$(".role-delete-modal").modal("show")},a["goto"]=function(a,b){f.path("roles/edit/"+a.id)};var n,o=null;a.$watch("search",function(){h.cancel(n),n=h(function(){"undefined"!=typeof a.search&&(null!==o&&o.resolve(),o=m.defer(),a.progress=!0,b.get(app.urlPrefix+"api/roles/get?query="+a.search,{timeout:o.promise}).then(function(b){a.progress=!1,a.data=b.data.list}))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox})}}]);var ngApp=angular.module("management");ngApp.controller("settingsCtrl",["$scope","$http","$sce","$timeout","$mdToast","roles",function(a,b,c,d,e,f){a.saveProgress=!1,$(".ui.dimmer.modals .sms-cert-modal").remove(),a.moment=moment,a.license=app.license,a.app=app,a.langs=[{key:0,value:"فارسی"},{key:1,value:"English"}],a.rebuildOlap=function(c){var d=confirm("آیا برای انجام انجام عملیات ساخت مجدد اطمینان دارید؟");d&&(a.rebuildProcess=!0,b.post(app.urlPrefix+"api/olap/rebuild").then(function(){a.rebuildProcess=!1,alert("عملیات موفق")},function(){a.rebuildProcess=!1,alert("خطا در انجام عملیات")}))},f.get().then(function(b){a.roles=b.data.list}),b.get(app.urlPrefix+"api/users/get").then(function(b){a.users=b.data.list}),b.get(app.urlPrefix+"api/LocationIp/get").then(function(b){a.locations=b.data}),a.save=function(d){a.saveProgress=!0,a.error=null,b.post(app.urlPrefix+"api/Settings/save",JSON.stringify(a.model),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){if(a.saveProgress=!1,b.data.result){var d=e.simple().textContent("تغییرات ثبت شد");e.show(d)}else a.error=c.trustAsHtml(filterXSS(b.data.error))})["catch"](function(b){a.saveProgress=!1,a.error=c.trustAsHtml(filterXSS(b.data.desc))})},a.checkSmsCert=function(){a.certCheckProgress=!0,b.get(app.urlPrefix+"api/sms/VerifyUrlCert").then(function(b){a.certCheckProgress=!1,a.invelidCert=!b.data.result,$(".sms-cert-modal").modal("show"),b.data.result||(a.cert=b.data.cert,a.hash=b.data.hash)})["catch"](function(){a.certCheckProgress=!1,alert("خطایی رخ داده است")})},a.approveCert=function(){a.certProgress=!0,b.post(app.urlPrefix+"api/sms/ApproveCert",{hash:a.hash}).then(function(b){a.certProgress=!1,$(".sms-cert-modal").modal("hide"),a.model.smsApprovedHash=a.hash})["catch"](function(){a.certProgress=!1,alert("خطایی رخ داده است")})},b.get(app.urlPrefix+"api/settings/getGeneralInfo").then(function(b){a.model=b.data.model,a.model.preventLoginRules=a.model.preventLoginRules||[],a.securityCertPatch=b.data.securityCertPatch,a.cdn=b.data.cdn,a.compareData=b.data.compareData,a.verification=b.data.verification,a.uploadLogo=b.data.uploadLogo}),a.addCdn=function(){a.model.cdn=a.model.cdn||{},a.model.cdn.items=a.model.cdn.items||[],a.model.cdn.items.push({type:0})},a.previewFile=function(b,c){var e=b.files[0];if(e.size>102400)return void alert("حجم فایل باید کمتر از ۱۰۰ کیلو بایت باشد");var f=new FileReader;$(b).attr("index");f.addEventListener("load",function(){d(function(){c?a.model.logoInverse=f.result:a.model.logo=f.result},0)},!1),e&&f.readAsDataURL(e)},a.appUpdate=function(){a.appUpdateProgress=!0,b.post(app.urlPrefix+"api/settings/updateApp").then(function(){a.appUpdateProgress=!1,alert("به روز رسانی با موفقیت انجام شد")})["catch"](function(){a.appUpdateProgress=!1,alert("خطا در عملیات به روز رسانی")})},a.rescheduleProcess=!1,a.reschedule=function(){a.rescheduleProcess=!0,b.post(app.urlPrefix+"api/Datasources/setAllDatasourceSchedule").then(function(b){var c=b.data.list.length;alert("تعداد "+c+" منبع داده با موفقیت دوباره زمانبدی شد"),a.rescheduleProcess=!1})["catch"](function(){alert("اشکال در اجرای برنامه"),a.rescheduleProcess=!1})}}]);var ngApp=angular.module("management");ngApp.controller("themesCtrl",["$scope","$http","$sce","$timeout","$location","roles","datasources","$routeParams",function(a,b,c,d,e,f,g,h){a.datasources=g,a.license=app.license,a.id="undefined"!=typeof h.id?h.id:0,a.variableName=h.name,a.path=e.path(),a.compareDataModel={datasources:g},a.isOlapTables=/\/olap-tables.*/.test(a.path),a.isUserVariableDetail=/\/userVariables\/.+/.test(a.path),a.onSaveTable=function(a){d(function(){e.path("/olap-tables/"+a.datasourceId)},0)}}]);var ngApp=angular.module("management"),mapType={Account:"مدیریت ورورد و کاربران",DataIntegrity:"صحت داده",BarChart:"خروجی اکسل و نمودار درختی",Charts:"نمودارها",CustomCharts:"نمودار دلخواد",Dashboard:"داشبورد",DashboardPage:"مدیریت داشبورد ",Dashboards:"داشبوردها",DataSource:"مدیریت منابع داده",DatasourceInterRelation:"مدیریت ارتباط بین منابع داده",Datasources:"لیست منابع داده",Excel:"خروجی اکسل",Filter:"فیلتر",Forms:"فرمها",GlobalVariable:"متغیرهای سراسری",Intervalfetchs:"دریافت دوره‌ای داده‌ها",JoinDataSource:"ارتباط بین منابع داده",Logs:"لاگ برنامه",Map:"دریافت نقشه",Maps:"مدیریت نقشه",Menu:"مدیریت منوها",Menus:"لیست منوها در قسمت مدیریت برنامه",Notification:"اعلان‌ها",OlapChartDesign:"مدیریت ساخت نمودار",Package:"مدیریت فولدرها",Permissions:"دریافت مجوز",Permission:"مجوزها",Profile:"پروفایل کاربر",Roles:"نقش‌ها",Sadaf:"کنترلر اصلی برنامه",Settings:"مدیریت تنظیمات برنامه",Users:"مدیریت کاربران",WebResource:"مدیریت وب سرویس‌ها",Alert:"هشدارها",Obfuscator:"درهم ساز",Captcha:"کپچا",License:"مجوز استفاده برنامه",RefreshManager:"تازه کردن منبع داده",ActiveDirectory:"اکتیودایرکتوری",Email:"پست الکترونیک"},mapOperation={VerifyCode:"کد احراز هویت",RemoveOldestRecord:"حذف رکوردهای قدیمی",Obfuscate:"درهم کردن",DeObfuscate:"باز کردن",LimitNotification:"اعلان محدودیت",Check:"بررسی",Activation:"فعال کردن لایسنس برنامه",Add:"اضافه کردن",AddMenu:"اضافه کردن منو",ChangePass:"تغییر کلمه عبور",Checkusername:"بررسی نام کاربری",Clone:"تکرار",CloneChart:"تکرار نمودار",Copy:"کپی",Create:"ایجاد",CubeInformation:"دریافت اطلاعات منبع داده",Dashboard:"داشبورد",Delete:"حذف",DeleteCharts:"حذف نمودارها",DeleteMenu:"حذف منو",Download:"دانلود",DuplicateMenu:"تکرار منو",Edit:"ویرایش",EditMenu:"ویرایش منو",Export:"خروجی",ExportToExcel:"خروجی به اکسل",GeneralSettings:"تنظیمات کلی",Get:"دریافت",GetCaptcha:"دریافت کد کپچا",GetChartMenus:"دریافت منوهای نمودار",GetChartPermissions:"دریافت مجوزهای نمودار",GetCurrent:"دریافت اطلاعات کاربر فعلی",GetDatasourceDimension:"دریافت یک ستون از منبع داده",GetDatasourceList:"لیست منابع داده",GetDatasourcePermissions:"مجوزهای منبع داده",GetEditor:"دریافت اطلاعات مربوط به ساخت نمودار",GetGeneralInfo:"دریافت اطلاعات تنظیمات",GetMailInfo:"دریافت اطلاعات ایمیل سامانه",GetMember:"دریافت داده‌های یک ستون از منبع داده",GetPropertyAutoCompleteEntries:"دریافت اطلاعات متغیرهای قبلی تعریف شده در سامانه برای نمایش لیست خودکار متغیرهای قبلی در ساخت متغیر زمان ویرایش کاربر",GetRecords:"دریافت رکوردهای لاگ",GetRelatedDatasource:"دریافت لیست منابع داده مرتبط با یک منبع داده",GetRoleFunctional:"دریافت لیست مجوزهای عملیاتی یک نقش",GetSingleChartInfo:"دریافت اطلاعات کلی از یک نمودار",GetTreeData:"دریافت اطلاعات نمودار درختی",Help:"راهنما",Index:"اکشن پیش فرض برنامه در کنترلر پیش فرض‌(sadaf)",Login:"ورود به برنامه",LogOff:"خروج از برنامه",MainMenu:"دریافت منوهای اصلی (مدیریت - داشبوردها)",Management:"اکشن مدیریت مربوط به کنترلر پیش فرض (برای باز شدن صفحه مدیریت این اکشن فراخوانی می‌شود)",MenuCategories:"دریافت لیست گروه‌های منو به همراه زیر منوها",MoveToPackage:"انتقال منابع داده یا نمودارها به یک پوشه",New:"جدید",Refresh:"تازه کردن",RemoveChartFromPage:"حذف نمودار از صفحه داشبورد",Sample:"نمایش داده های نمونه از فایل بارگذاری شده اکسل",Save:"ذخیره",SaveChart:"ذخیره نمودار",SendActivationSms:"ارسال کد فعالسازی پیامک در روند ثبت نام",SetChartsOrder:"ذخیره ترتیب نمودارها",Signup:"ثبت نام",ToogleFullscreen:"حالت تمام صفحه کردن داشبورد",Update:"به روز رسانی کاربر",UpdateSettings:"به روز رسانی تنظیمات",Upload:"آپلود نقشه جدید",UploadFiles:"آپلود فایل اکسل",VerifyPassword:"بررسی درست بودن کلمه عبور",View:"نمایش",AcceptInvalidCertificate:"تایید گواهینامه نامعتبر توسط کاربر",CheckCertificate:"بررسی گواهینامه",GetList:"دریافت لیست",CanLogin:"بررسی امکان لاگین"},mapResult={Begin:"شروع عملیات",End:"پایان عملیات",Failed:"اجرای ناموفق عملیات",Ok:"اجرای موفق"};ngApp.controller("logCtrl",["$scope","$http","$sce","$timeout","$mdToast","roles",function(a,b,c,d,e,f){function g(a){return Object.keys(a).map(function(b,c){return{label:a[b]||b,value:b}})}function h(){a.filters.page=a.page,a.getListProgress=!0,b.post(app.urlPrefix+"api/logs/getRecords",a.filters).then(function(b){a.getListProgress=!1,a.logs=b.data.list,a.checkList=b.data.checkList,a.pageCount=b.data.pageCount,a.page=b.data.page,a.securityCertPatch=b.data.securityCertPatch})["catch"](function(){a.getListProgress=!1})}a.saveProgress=!1,$(".ui.dimmer.modals .settings").remove(),f.get().then(function(b){a.roles=b.data.list}),a.mapType=_.sortBy(g(mapType),"label"),a.mapOperation=_.sortBy(g(mapOperation),"label"),a.mapResult=_.sortBy(g(mapResult),"label"),a.filters={},a.filters.rowCount=20,a.filters.sortKeys=[{order:"desc",name:"time"},{order:"desc",name:"date"}],a.langs=[{key:0,value:"فارسی"},{key:1,value:"English"}],a.showModal=function(){$(".ui.modal.settings").modal("show")},a.save=function(d){a.saveProgress=!0,b.post(app.urlPrefix+"api/logs/save",JSON.stringify(a.model),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){a.saveProgress=!1,$(".ui.modal.settings").modal("hide");var c=e.simple().textContent("تغییرات ثبت شد");e.show(c),a.error=null})["catch"](function(b){a.saveProgress=!1,a.error=c.trustAsHtml(b.data.desc)})},a.sortBy=function(b){if("sign"!==b){a.filters.sortKeys=a.filters.sortKeys||[];var c=_.remove(a.filters.sortKeys,{name:b}),d={order:"desc",name:b};c&&c.length>0&&(d=c[0]),d.order="desc"===d.order?"asc":"desc",a.filters.sortKeys.push(d),h()}},a.orderIcon=function(b){var c=_.find(a.filters.sortKeys,{name:b});return c?c&&"desc"==c.order?"down":"up":""},b.get(app.urlPrefix+"api/logs/get").then(function(b){a.model=b.data}),h(),a.filter=function(){a.page=0,h()},a.prevPage=function(){return a.page--,a.page<0?void(a.page=0):void h()},a.nextPage=function(){return a.page++,a.page>=a.pageCount?void a.page--:void h()}}]),ngApp.filter("dicMap",function(){return function(a,b){return"type"===b?mapType[a]||a:"operation"===b?mapOperation[a]||a:"result"===b?mapResult[a]||a:void 0}});var ngApp=angular.module("management");ngApp.controller("uploadChart",["$scope","$http","$sce","$timeout","$mdToast","customChart","utils",function($scope,$http,$sce,$timeout,$mdToast,customChart,utils){$(".ui.dimmer.modals .new-custom-chart-modal").remove(),$scope.utils=utils,$scope.model={},$scope.add=function(){$scope.model={},$(".new-custom-chart-modal").modal("show")},$scope.remove=function(a,b){var c=confirm(app.lang.translate("delete custom chart desc"));c&&customChart.remove(a.id).then(function(){$scope.data.splice(b,1);var a=$mdToast.simple().textContent("حذف انجام شد");$mdToast.show(a)})["catch"](function(){utils.showErrorToast("خطا در انجام عملیات")})},$scope.edit=function(a){$(".new-custom-chart-modal").modal("show"),$scope.editProgress=!0,customChart.get(a.id).then(function(a){$scope.editProgress=!1,$scope.model=a.model})["catch"](function(){$scope.editProgress=!1,utils.showErrorToast("خطا در انجام عملیات")})},$scope.editCat=function(){var a=_.find($scope.categories,{id:$scope.model.categoryId}),b=prompt("نام جدید را وارد کنید",a.name);b&&$http.post(app.urlPrefix+"api/customCharts/editCategory/"+a.id,'"'+b+'"').then(function(){a.name=b})},$scope.deleteCat=function(){var a=_.find($scope.categories,{id:$scope.model.categoryId}),b=_.findIndex($scope.categories,{id:$scope.model.categoryId}),c=confirm("ایا برای حذف دسته‌بندی "+a.name+" اطمینان دارید؟");c&&$http.post(app.urlPrefix+"api/customCharts/removeCategory/"+a.id).then(function(){$scope.categories.splice(b,1)})},customChart.get().then(function(a){$scope.data=a.list,$scope.categories=a.categories}),$scope.save=function(ev){if($scope.model.settingsTemplate=$scope.model.settingsTemplate||"{}",!$scope.model.name||!$scope.model.name.trim())return void alert("نام را وارد کنید");try{if(eval("var sTemp = "+$scope.model.settingsTemplate),"undefined"==typeof sTemp)return void alert("الگوی تنظیمات درست نیست");$scope.model.settingsTemplate=JSON.stringify(sTemp,null,"    ")}catch(e){return void alert("الگوی تنظیمات درست نیست")}$scope.saveProgress=!0,$http.post(app.urlPrefix+"api/customCharts/edit",$scope.model).then(function(a){var b=a.data;$scope.saveProgress=!1,$(".new-custom-chart-modal").modal("hide");var c=$mdToast.simple().textContent("ذخیره با موفقیت انجام شد");if($mdToast.show(c),$scope.model.id){var d=_.find($scope.data,{id:$scope.model.id});d.name=b.name}else $scope.data=$scope.data||[],$scope.data.push({id:b.id,name:b.name})})["catch"](function(a){alert("خطا در انجام عملیات "+a.data.desc),$scope.saveProgress=!1})}}]);var ngApp=angular.module("management");ngApp.controller("uploadChartDetail",["$scope","$http","$sce","$timeout","$mdToast","customChart","utils","$routeParams",function($scope,$http,$sce,$timeout,$mdToast,customChart,utils,$routeParams){function aceLoaded(a,b){a.renderer.setPadding(18),a.commands.addCommand({name:"myCommand",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(a){$timeout(function(){$scope.save()},0)}}),$scope.insertFormula=function(b){a.insert(b),a.focus()}}$scope.utils=utils,$scope.model={},$scope.app=app,$scope.add=function(){$scope.model={},$(".new-custom-chart-modal").modal("show")},$scope.aceOption={useWrapMode:!0,showGutter:!1,theme:"sqlserver",mode:"sqlserver",maxLines:14,onLoad:aceLoaded,require:["beautify"]},$scope.remove=function(a,b){var c=confirm(app.lang.translate("delete custom chart desc"));c&&customChart.remove(a.id).then(function(){$scope.data.splice(b,1);var a=$mdToast.simple().textContent("حذف انجام شد");$mdToast.show(a)})["catch"](function(){utils.showErrorToast("خطا در انجام عملیات")})},$scope.edit=function(){$scope.editProgress=!0,customChart.get($routeParams.id).then(function(a){$scope.editProgress=!1,$scope.model=a.model,$scope.categories=a.categories})["catch"](function(){$scope.editProgress=!1,utils.showErrorToast("خطا در انجام عملیات")})},$scope.edit(),$scope.editCat=function(){var a=_.find($scope.categories,{id:$scope.model.categoryId}),b=prompt("نام جدید را وارد کنید",a.name);b&&$http.post(app.urlPrefix+"api/customCharts/editCategory/"+a.id,'"'+b+'"').then(function(){a.name=b})},$scope.deleteCat=function(){var a=_.find($scope.categories,{id:$scope.model.categoryId}),b=_.findIndex($scope.categories,{id:$scope.model.categoryId}),c=confirm("ایا برای حذف دسته‌بندی "+a.name+" اطمینان دارید؟");c&&$http.post(app.urlPrefix+"api/customCharts/removeCategory/"+a.id).then(function(){$scope.categories.splice(b,1)})},$scope.save=function(ev){if($scope.model.settingsTemplate=$scope.model.settingsTemplate||"{}",!$scope.model.name||!$scope.model.name.trim())return void alert("نام را وارد کنید");try{if(eval("var sTemp = "+$scope.model.settingsTemplate),"undefined"==typeof sTemp)return void alert("الگوی تنظیمات درست نیست");$scope.model.settingsTemplate=JSON.stringify(sTemp,null,"    ")}catch(e){return void alert("الگوی تنظیمات درست نیست")}$scope.saveProgress=!0,$http.post(app.urlPrefix+"api/customCharts/edit",$scope.model).then(function(a){var b=a.data;$scope.saveProgress=!1,$(".new-custom-chart-modal").modal("hide");var c=$mdToast.simple().textContent("ذخیره با موفقیت انجام شد");if($mdToast.show(c),$scope.model.id){var d=_.find($scope.data,{id:$scope.model.id});d.name=b.name}else $scope.data=$scope.data||[],$scope.data.push({id:b.id,name:b.name})})["catch"](function(a){alert(a.data.desc),$scope.saveProgress=!1})}}]);var ngApp=angular.module("management");ngApp.controller("updateCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","datasources",function(a,b,c,d,e,f,g,h,i,j,k){a.progress=!0,b.get(app.urlPrefix+"api/users/get").then(function(b){a.progress=!1,a.data=b.data.list},j.error),j.onError(function(b){a.error=b,a.progress=!1}),a.isSelected=function(){return _.some(a.data,{select:!0})},a["new"]=function(a){f.path("users/edit")},a["delete"]=function(e){var f=app.urlPrefix+"api/users/delete",g=_.filter(a.data,{select:!0}).map(function(a){return a.id}),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){a.data=_.filter(a.data,function(a){return b.data.indexOf(a.id)==-1});var d=c.simple().textContent("حذف انجام شد");c.show(d)},function(a){j.showErrorToast(a.data.desc)})})},a["goto"]=function(a,b){f.path("users/edit/"+a.id)};var l;a.$watch("search",function(){h.cancel(l),l=h(function(){"undefined"!=typeof a.search&&(a.progress=!0,b.get(app.urlPrefix+"api/users/get?query="+a.search).then(function(b){a.progress=!1,a.data=b.data.list}))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox})}}]);var ngApp=angular.module("management");ngApp.controller("userEditCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","$sce","roles",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc))}function m(){a.model&&a.model.Roles&&a.roles&&(!a.model.mainRole&&a.roles.length&&(a.model.mainRole=a.roles[0].id),_.forEach(a.roles,function(b){a.model.Roles.indexOf(b.id)!==-1&&(b.check=!0)}),_.forEach(a.managebleRoles,function(b){a.model.ManagebleRoles.indexOf(b.id)!==-1&&(b.check=!0)}))}function n(a,b){a&&(a.check&&b.push(a.id),_.each(a.nodes,function(a){n(a,b)}))}function o(){var b=[];n(a.root,b),a.selectedRoles=_.filter(a.roles,function(a){return b.indexOf(a.id)!==-1})}function p(a){c.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}function q(a){var b=new persianDate(a).format("YYYY/MM/DD");return depersian(b)}var r="undefined"!=typeof e.id?e.id:0,s=r>0;a.id=r,a.isEdit=s,a.app=app;var t=$("#user-expire-time").pDatepicker({autoClose:!0,format:"YYYY/MM/DD",initialValue:!1,onSelect:function(b){a.model.Expire=q(b)}});k.get().then(function(b){var c=performance.now();a.roles=angular.merge([],b.data.list),_.forEach(a.roles,function(a){a.action=1,a.check=!1}),a.managebleRoles=angular.merge([],a.roles),m();var d=_.filter(a.roles,{isAdmin:!0}),e=_.filter(a.managebleRoles,{isAdmin:!0});a.root=k.createTree(d),a.root2=k.createTree(e),o(),console.log("### get role time",performance.now()-c)}),a.urlbaseAdd=function(){a.model.urlbaseActiveRole=a.model.urlbaseActiveRole||{},a.model.urlbaseActiveRole.items=a.model.urlbaseActiveRole.items||[],a.model.urlbaseActiveRole.items.push({})},a.props=[],s?b.get(app.urlPrefix+"api/users/getInfo?id="+r).then(function(b){a.model=b.data.data,a.sign=b.data.sign,a.verification=b.data.verification,a.roleAdmins=b.data.roleAdmins,a.model.Properties&&(a.props=JSON.parse(a.model.Properties)),m(),a.model.Expire&&t.setDate(1e3*moment(a.model.Expire,"jYYYY/jMM/jDD").unix())},l):a.model={active:!0},a.verify=function(){a.verifyProgress=!0,b.post(app.urlPrefix+"api/users/verify?id="+r).then(function(b){a.verifyProgress=!1,a.model.isNameAuthenticated=b.data.isNameAuthenticated,a.model.isMobileAuthenticated=b.data.isMobileAuthenticated,a.model.FirstName=b.data.FirstName,a.model.LastName=b.data.LastName})["catch"](function(){a.verifyProgress=!1})},a.approve=function(){a.approveProgress=!0,b.post(app.urlPrefix+"api/users/approve?id="+r).then(function(){a.approveProgress=!1,a.model.isNameAuthenticated=!0,a.model.isMobileAuthenticated=!0})["catch"](function(){a.approveProgress=!1})},b.get(app.urlPrefix+"api/users/getPropertyAutoCompleteEntries").then(function(b){a.auto=b.data,a.auto.flatValues=[],
_.each(a.auto.values,function(b){_.each(b.values,function(b){a.auto.flatValues.indexOf(b)===-1&&a.auto.flatValues.push(b)})})},l),a.$watch("root",function(a){o()},!0),a.saveProgress=!1,a.save=function(){if(a.error=null,a.testResult=null,!a.userForm.$valid)return void i("form_invalid").then(function(a){p(a)});var d=[];n(a.root,d);var e=[];n(a.root2,e),a.model.Roles=d,a.model.ManagebleRoles=e;var g=_.indexOf(d,a.model.mainRole);return g===-1&&d.length?void p("نقش اصلی باید در لیست نقش‌ها انتخاب شده باشد"):(a.model.Properties=JSON.stringify(_.map(a.props,function(a){return{Key:a.Key,Value:a.Value}})),a.saveProgress=!0,void b.post(app.urlPrefix+"api/users/edit",a.model).then(function(b){a.saveProgress=!1;var d=c.simple().textContent(s?"تغییرات ثبت شد":"منبع داده جدید ایجاد شد");c.show(d),f.path("/users")},function(b){a.saveProgress=!1,a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc))}))}}]);var ngApp=angular.module("management");ngApp.controller("usersListCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","datasources","toolbar","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.utils=j,i("لیست کاربران").then(function(a){l.setTitles([{name:a,click:null}])}),a.app=app,a.timeFormat=function(a){return a?moment(a).format("jYYYY/jMM/jDD HH:mm:ss"):""},a.progress=!0,b.get(app.urlPrefix+"api/users/get").then(function(b){a.progress=!1,a.data=b.data.list,a.securityCertPatch=b.data.securityCertPatch},j.error),j.onError(function(b){a.error=b,a.progress=!1}),a.isSelected=function(){return _.some(a.data,{select:!0})},a["new"]=function(a){f.path("users/edit")},a["delete"]=function(e){var f=app.urlPrefix+"api/users/delete",g=_.filter(a.data,{select:!0}).map(function(a){return a.id}),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){a.data=_.filter(a.data,function(a){return b.data.indexOf(a.id)==-1});var d=c.simple().textContent("حذف انجام شد");c.show(d)},function(a){j.showErrorToast(a.data.desc)})})},a["goto"]=function(a,b){f.path("users/edit/"+a.id)};var n,o;a.$watch("search",function(){h.cancel(n),n=h(function(){"undefined"!=typeof a.search&&(o&&o.resolve(),o=m.defer(),a.progress=!0,b.get(app.urlPrefix+"api/users/get?query="+a.search,{timeout:o.promise}).then(function(b){a.progress=!1,a.data=b.data.list}))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox})}}]);var ngApp=angular.module("management");ngApp.controller("variablesCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","datasources","$mdMedia","toolbar",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){return a.DefaultValue=JSON.parse(a.DefaultValue),a.DefaultValue&&(a.DefaultValue=a.DefaultValue.map(function(a){return a.replace(/\[(index|calc)-\d+\]/gim,"")})),a}function o(a,b){return d.show({controller:["$scope","$mdDialog","$timeout",function(a,c,d){a.cancel=function(){c.cancel()},a.select=function(){return a.gbForm.$valid?void c.hide(a.model):void a.gbForm.$setSubmitted()},a.model={Name:"",Scope:0,DefaultValue:[]},b&&(a.model=angular.merge({},b))}],parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:l("sm")||l("xs"),template:'<md-dialog aria-label="{{\'choose\' | translate}}" ng-cloak >                                                                               <md-toolbar md-theme="default">                                                                                                                            <div class ="md-toolbar-tools">                                                                                                         <h2>{{\'choose\' | translate}}</h2>                                                                                                 <span flex></span>                                                                                                                  <span class ="material-icons" ng-click="cancel()">close</span>                                                                  </div>                                                                                                                          </md-toolbar>                                                                                                                       <md-dialog-content>                                                                                                                     <div class ="md-dialog-content" flex>                                                                                               <form name="gbForm">                                                                                                                   <div layout="row" layout-align="start center">                                                                                           <md-input-container flex="50" >                                                                                                         <label>{{\'name\' | translate}}</label>                                                                                             <input required name="name" ng-model="model.Name" md-autofocus>                                                                     <div ng-messages="gbForm.name.$error" ng-if=\'gbForm.$submitted || gbForm.name.$touched\'>                                            <div ng-message="required">{{\'form_username_required\' | translate}}</div>                                                       </div>                                                                                                                          </md-input-container>                                                                                                               <md-input-container flex="50">                                                                                                          <label>{{\'scope\' | translate}}</label>                                                                                            <md-select  ng-model="model.Scope">                                                                                                     <md-option value="0">{{\'scope_all_page\' | translate}}</md-option>                                                                 <md-option value="1">{{\'scope_current_page\' | translate}}</md-option>                                                         </md-select>                                                                                                                    </md-input-container>                                                                                                       </form>                                                                                                                             </div>                                                                                                                                                                                                                                                                     <md-chips flex ng-model="model.DefaultValue"                                                                                             ng-click=" $event.stopPropagation()"                                                                                                ng-change="row"                                                                                                                     placeholder="{{\'insert_user_prop_value\' | translate}}"                                                                            delete-button-label="{{\'delete_user_prop_value\' | translate}}"                                                                    delete-hint="{{\'press_delete_user_prop_value\' | translate}}"                                                                      secondary-placeholder="{{\'add_user_prop_value\' | translate}}"></md-chips>                                                                                                                                                                                     </div>                                                                                                                          </md-dialog-content>                                                                                                                <md-dialog-actions layout="row">                                                                                                        <md-button ng-click="select()" >                                                                                                        {{\'choose\' | translate}}                                                                                                      </md-button>                                                                                                                        <md-button ng-click="cancel()">                                                                                                         {{\'cancel\' | translate}}                                                                                                      </md-button>                                                                                                                    </md-dialog-actions>                                                                                                        </md-dialog>'})}a.utils=j,i("متغیرهای سراسری").then(function(a){m.setTitles([{name:a,click:null}])}),a.progress=!0,b.get(app.urlPrefix+"api/globalvariable/getlist").then(function(b){a.progress=!1,a.data=b.data,a.data=a.data.map(function(a){return n(a)})},j.error),j.onError(function(b){a.error=b,a.progress=!1}),a.isSelected=function(){return _.some(a.data,{select:!0})},a["new"]=function(d){o(d).then(function(d){b.post(app.urlPrefix+"api/globalvariable/add",d).then(function(b){a.data=a.data||[],a.data.push(n(b.data)),i("new_variable_created").then(function(a){var b=c.simple().textContent(a);c.show(b)})})})},a["delete"]=function(e){var f=app.urlPrefix+"api/globalvariable/deleteAll",g=_.filter(a.data,{select:!0}).map(function(a){return a.Id}),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){a.data=_.filter(a.data,function(a){return b.data.indexOf(a.Id)==-1}),i("delete_complete").then(function(a){var b=c.simple().textContent(a);c.show(b)})},function(a){j.showErrorToast(a.data.desc)})})},a["goto"]=function(a,d){o(d,a).then(function(d){b.post(app.urlPrefix+"api/globalvariable/add",d).then(function(b){a.DefaultValue=n(b.data).DefaultValue,i("edit_complete").then(function(a){var b=c.simple().textContent(a);c.show(b)})})})};var p;a.$watch("search",function(){h.cancel(p),p=h(function(){"undefined"!=typeof a.search&&(a.progress=!0,b.get(app.urlPrefix+"api/users/get?query="+a.search).then(function(b){a.progress=!1,a.data=b.data.list}))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox})}}]),function(){function a(a,b){var c=1,d=b.map(function(a){return a.toLowerCase()});if(d.indexOf(a.toLowerCase())===-1)return a;for(;d.indexOf(a.toLowerCase()+c)!==-1;)c++;return a+c}function b(a,b){return a.filter(function(a){return!a.type||"kpi"!==a.type&&"measure"!==a.type}).map(function(a){return{Name:a.Name,UniqueName:a.UniqueName,Top:a.Top,preventChangeByUser:a.preventChangeByUser,sortOrder:a.sortOrder,sortKey:a.sortKey,sortFormula:a.sortFormula,CalcId:a.CalcId,formula:a.formula,formulas:a.formulas,applyLevel:a.applyLevel||0,IsNamedSet:"namedset"===a.type,aggregation:a.aggregation,Members:a.members&&a.members.list?a.members.list.filter(function(a){return a.Checked}).map(function(a){return b?a.UniqueName:a.Name}):[],UserProperties:a.userProperty?a.userProperty.filter(function(a){return a.Checked}).map(function(a){return a.Name}):[],GlobalViariable:a.globalVariable?a.globalVariable.filter(function(a){return a.Checked}).map(function(a){return a.Id}):[],NumericFilter:a.members?JSON.stringify(a.members.numericFilter):"",IsNumeric:!!a.members&&a.members.isNumeric,filter:a.members?a.members.filter:{},detail:JSON.stringify(a.detail||{})}})}function c(a,b){for(var c in a)if("customChartSettingTemplat"!==c)try{var d=a[c].series;if("undefined"==typeof d||!d||!a.hasOwnProperty(c))continue;var e=k(b);if(c!==e){delete a[c];continue}for(var e in d)d.hasOwnProperty(e)&&a.series.indexOf(e)===-1&&delete d[e]}catch(f){}}function d(a){var b=_.merge({},e(a.chartProp,a.chartType,a.dimensions,a.measures,a.where));return delete b.levelTypes,{prop:b,type:_.merge({},a.chartType)}}function e(a,b,c,e,f,g){_.isUndefined(a.tree)||_.remove(a.tree.dimensions,function(a){return _.isUndefined(_.find(c,{Name:a.name}))});var h=k(b);a[h]||(a[h]=m[h]);var i=a[h]||{};try{g&&(a.levelTypes.props[+a.levelTypes.current]=d(g)),a.levelTypes.enable||(a.levelTypes.props=[])}catch(j){}return i.levelTypes=a.levelTypes,i}function f(a){return _.find(app.charts.list,{type:a})}function g(b,c,d,e){var f=b.Formula?b.Formula:b.UniqueName,g="SUM("+f+")",h="SUM";b.IsNumeric||(g=""+f,h="NONE",e.measures.length||(g="COUNT("+f+")",h="COUNT")),b.Top={IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"};var i=$.extend({},b,{formula:g,aggregation:h});return+d.info.aggregation===-1&&(i.formula=f,i.aggregation="NONE"),i.Name=a(b.Name,c.map(function(a){return a.Name})),i}function h(b,c){var d=$.extend({},b,{sortOrder:"ASC",sortKey:"NONE",sortFormula:b.Formula?b.Formula:b.UniqueName,formula:b.Formula?b.Formula:b.UniqueName,applyLevel:0,detail:{histogramCategory:{enable:!1,width:10,count:7,overflowEnable:!1,underflowEnable:!1,overflow:100,underflow:0,type:"auto",customLabels:[],customLabelEnable:!1}}});return d.Name=a(b.Name,c.map(function(a){return a.Name})),d}function i(b,c){var d=$.extend({},b,{sortOrder:"ASC",sortKey:"NONE",formula:b.Formula?b.Formula:b.UniqueName});return d.Name=a(b.Name,c.map(function(a){return a.Name})),d}function j(a){var b=a.chartType.id,c=a.chartProp[n[+b]];return a.chartType.isCustom?{needDim:!0,needMeasure:!0,needServerData:!0}:a.chartType.id>10?f(a.chartType.id).config:app.chartCommons.getChartConfig(+b,c.info)}function k(a){var b=n[a.id];return a.id>10&&(b="key-"+a.id),a.isCustom&&(b="customChart"),b}var l={1:{name:app.lang.translate("bar"),type:1},2:{name:app.lang.translate("stack-bar"),type:1},3:{name:app.lang.translate("خطی"),type:1},4:{name:app.lang.translate("stack-line"),type:1},5:{name:app.lang.translate("area"),type:1},6:{name:app.lang.translate("stack area"),type:1},7:{name:app.lang.translate("pie"),type:2},8:{name:app.lang.translate("donut"),type:2},9:{name:app.lang.translate("arc gauge"),type:4},10:{name:app.lang.translate("نمودار رادار"),type:8},11:{name:app.lang.translate("نقشه"),type:6},12:{name:app.lang.translate("نمودار درختی"),type:9},13:{name:app.lang.translate("aggregated table"),type:5},14:{name:app.lang.translate("table"),type:5},15:{name:app.lang.translate("single select"),type:7},16:{name:app.lang.translate("multi select"),type:7},17:{name:app.lang.translate("تاریخ"),type:7},18:{name:app.lang.translate("محدوده تاریخ"),type:7},19:{name:app.lang.translate("range number"),type:7},20:{name:app.lang.translate("search"),type:7},21:{name:app.lang.translate("percent-stack-bar"),type:1},22:{name:app.lang.translate("percent-stack-line"),type:1},23:{name:app.lang.translate("percent-stack-area"),type:1},24:{name:app.lang.translate("multi part arc gauge"),type:4},25:{name:app.lang.translate("linear gauge"),type:4},26:{name:app.lang.translate("multi part linear gauge"),type:4},27:{name:app.lang.translate("number"),type:4},28:{name:app.lang.translate("جعبه‌ای"),type:1},29:{name:app.lang.translate("جدول فرم"),type:5},30:{name:app.lang.translate("تغییر شاخص"),type:7},31:{name:app.lang.translate("کلید فیلتر"),type:7}},m={bar:{info:{aggregation:"1",canExportXlsx:!0,refreshPeriod:"0",horizontalLines:!0,sortMeasures:!1,showSortBox:!0,formatString:",.0f",stackedBar:"1",stackedLine:"1",tooltip:"2",tooltipHeader:"{{set.key}}",tooltipFormat:'{{point.label}}: <span class="ltr inline" style="padding:0; margin:0;"><b>{{point.data}}</b></span>',xAxisLen:20,font:{bold:!1,color:"#333333",italic:!1,fontSize:"12px",fontName:"IRANSans",formatString:",.0f",formatStringCustom:",.0f"},secondaryY:{enable:!1,ticksType:"auto",ticksCount:10,ticksSpace:20,measures:{},font:{bold:!1,color:"#333333",italic:!1,fontSize:"12px",fontName:"IRANSans",formatString:",.0f",formatStringCustom:",.0f"}},xAxisRotate:"-90",AxeY:{ticksType:"auto",ticksCount:10,ticksSpace:20},showLegends:!0}},map:{info:{aggregation:"1",canExportXlsx:!0,refreshPeriod:"0",borderColor:"#374649",defaultColor:"#eeeeee",borderWidth:.5,tooltip:"3",tooltipFormat:'{{point.label}}: <span class="ltr inline" style="padding:0; margin:0;"><b>{{point.data}}</b></span>',tooltipHeader:"{{set.key}}",map:{selectedMap:"1"},chartType:"pie",showLabels:!1,mapType:"path",chartSize:50,realMap:{initialZoom:5,fillOpacity:.5},showLegend:!0,selectableArea:!0}},pie:{info:{aggregation:"1",canExportXlsx:!0,tooltip:"3",hole:"50",refreshPeriod:"0",formatString:",.0f",colorType:1,tooltipHeader:"{{set.key}}",tooltipFormat:"{{point.label}}: {{point.data}} :: {{point.percentage}}%",sort:!1}},tree:{info:{selectable:"one",aggregation:"1",canExportXlsx:!0,tooltip:"3",refreshPeriod:"0",formatString:",.0f",tooltipHeader:"{{set.key}}",tooltipFormat:"{{point.label}}: {{point.data}} :: {{point.percentage}}%",variableId:"-1",variableDefaultType:"NONE",functionDateFormat:"yy/mm/dd",functionUnitAgo:1,functionUnitAgoTwo:0,functionUnitAgoOffset:1,functionUnitAgoTwoOffset:1,dateFormatValue:"yy/mm/dd",justFilterDirectChild:!0}},gauge:{info:{font:{bold:!0,color:"#333333",italic:!1,fontSize:"34px",fontName:"IRANSans",formatString:",.0f",formatStringCustom:",.0f"},aggregation:"1",canExportXlsx:!0,textBold:!0,textItalic:!1,refreshPeriod:"0",segmentType:"singleSegment",style:"arc",height:"medium",formatString:",.2f",fontSize:"3em",color:"#333333",colorAriaThree:"#e14d57",colorAriaTwo:"#FBEE58",colorAriaOne:"#71b37c"}},radar:{info:{labelWidth:100,aggregation:"1",canExportXlsx:!0,refreshPeriod:"0",formatString:",.0f"}},table:{info:{aggregation:"1",canExportXlsx:!0,refreshPeriod:"0",sortMeasures:!1,condensed:!1,bordered:!1,stripped:!0,hover:!0,showHeader:!0,showRowNumber:!1,rowAsKey:!1,selectable:"multi",showAddButton:!0,cellHeight:60}},userControl:{info:{aggregation:"1",canExportXlsx:!1,showFilterIcon:"0",type:"combo",comboStyle:"bootstrap",label:"",sliderRange:"min-max",dateFormatShow:"yy/mm/dd",dateOp:"eq",sliderFormat:",.0f",variableId:"-1",variableDefaultType:"NONE",functionDateFormat:"yy/mm/dd",functionUnitAgo:1,functionUnitAgoTwo:0,functionUnitAgoOffset:1,functionUnitAgoTwoOffset:1,dateFormatValue:"yy/mm/dd",textOperand:"or",useLike:!0,useNormal:!0}},text:{info:{aggregation:"1",canExportXlsx:!1,formatString:",.0f",refreshPeriod:"0",showFilterIcon:"0",html:""}}},n={1:"bar",2:"pie",4:"gauge",8:"radar",5:"table",6:"map",7:"userControl",9:"tree",10:"text"},o=angular.module("management");o.directive("draggableItems",["$timeout","refreshChartService",function(a,b){return function(a,c,d){function f(){$("#columnList .datasource-field").draggable({appendTo:".chart-editor",helper:"clone",start:function(a,b){$(b.helper).addClass("ui-helper"),$(b.helper).width($(a.currentTarget).width())}}),$("#divX, #divY, #divProv").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:":not(.ui-sortable-helper)",drop:function(c,d){var f=$(this).attr("id");if(a.$parent.isOlap){var j=d.draggable.attr("type"),k=null;if("measure"===j||"kpi"===j){if("divY"!==f)return;k="measure"===j?_.find(a.$parent.olapCubes[+a.$parent.selectedOlapCube||0].Measures,{UniqueName:d.draggable.data("name")}):_.find(a.$parent.olapCubes[+a.$parent.selectedOlapCube||0].Kpis,{UniqueName:d.draggable.data("name")}),k.type=j,a.$apply(function(){var b="divX"===f?a.dimensions:"divY"===f?a.measures:a.where;b.push($.extend({},k))})}if("dimension"===j){var l=d.draggable.attr("group-name");k=a.$parent.olapCubes[+a.$parent.selectedOlapCube||0].Dimensions[+d.draggable.attr("DimIndex")].group[l][+d.draggable.attr("index")],k.type="dimension";var m="divX"===f?a.dimensions:"divY"===f?a.measures:a.where;a.$apply(function(){m.push($.extend({},k))})}if("namedset"===j){var l=d.draggable.attr("group-name");k=a.$parent.olapCubes[+a.$parent.selectedOlapCube||0].NamedSets[+d.draggable.attr("index")],k.type="namedset";var m="divX"===f?a.dimensions:"divY"===f?a.measures:a.where;a.$apply(function(){m.push($.extend({},k))})}b.refreshChart()}else a.$apply(function(){var b=e(a.$parent.chartProp,a.$parent.chartType,null,null,null,a.$parent),c=a.dimensions.concat(a.measures).concat(a.where),j="divX"===f?a.dimensions:"divY"===f?a.measures:a.where,k="divX"===f?h:"divY"===f?g:i;j.push($.extend({},k(a.datasource.CubeInfo.Dimensions[+d.draggable.attr("DimIndex")].Hierarchies[+d.draggable.attr("index")],c,b,a)))}),b.refreshChart()}})}a.$last&&f()}}]),o.service("refreshChartService",["$timeout",function(a){var b,c=function(a){b=a},d=function(a){b&&b(a)};return{refreshChart:d,registerRefreshFunction:c}}]),o.controller("chartsEditorCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","$compile","$mdSidenav","$mdMedia","menus","datasources","roles","refreshChartService","customChart",function(a,i,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(){function b(){return angular.element("#divProp div")?(angular.element("#divProp div").remove(),angular.element("#divProp").append(h),v(angular.element("#divProp"))(a),void(a.chartType.isCustom||a.refreshChart())):void s(b,50)}var c=function(b,c){a.chartProp.customChartSettingTemplat=b,a.chartProp[c]=a.chartProp[c]||{general:{},series:{},info:{aggregation:1}},a.chartProp[c].config=a.chartProp.customChartSettingTemplat.config,_.each(a.chartProp.customChartSettingTemplat.general,function(b){b&&b.key&&"undefined"==typeof a.chartProp[c].general[b.key]&&(a.chartProp[c].general[b.key]=b["default"]),"section"===b.type&&_.each(b.items,function(b){b&&b.key&&"undefined"==typeof a.chartProp[c].general[b.key]&&(a.chartProp[c].general[b.key]=b["default"])})}),a.customChartDefaultSeries={},_.each(a.chartProp.customChartSettingTemplat.series,function(b,d){"undefined"==typeof a.chartProp[c].series[b.key]&&(a.customChartDefaultSeries[b.key]=b["default"]),"section"===b.type&&_.each(b.items,function(b){"undefined"==typeof a.chartProp[c].series[b.key]&&(a.customChartDefaultSeries[b.key]=b["default"])})}),a.chartProp[c].series._default=_.merge({},a.customChartDefaultSeries),a.refreshChart()};if(a.chartType.isCustom)C.getSettingsTemplate(a.chartType.id).then(function(a){c(JSON.parse(a||"{}"),"customChart")});else if(a.chartType.id>10){var d=f(a.chartType.id),e=k(a.chartType),g=d.settings;d.getSettings&&(g=d.getSettings()),c(g,e)}var h={};a.cntrName="chartsEditorCtrl";var e=k(a.chartType);switch(+a.chartType.id){case 1:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="bar" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 2:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="pie" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 4:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="gauge" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 5:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="table" dimensions="dimensions" measures="measures" where="where" datasource="datasource"  filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 6:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="map" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 7:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="userControl" dimensions="dimensions" measures="measures" where="where" datasource="datasource"  filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 8:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="radar" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 9:h='<div  ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="tree" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;case 10:h='<div ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="text" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>';break;default:h='<div ng-chart-properties management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="bar" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>'}a.chartType.isCustom&&(h='<div ng-chart-properties key="'+e+'" management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="customChart" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>'),!a.chartType.isCustom&&a.chartType.id>10&&(h='<div ng-chart-properties key="'+e+'" management-only="managementOnly" api-key="apiKey" open-menu-name="menu" ng-model="chartProp" is-olap="isOlap" data-type="key-'+a.chartType.id+'" dimensions="dimensions" measures="measures" where="where" datasource="datasource" filter-exception="filterException" calculated-fields="calculatedFields"></div>'),s(b,0)}function E(b){_.forEach(b.Dimensions,function(a){a.group=_.groupBy(a.Hierarchies,"DisplayFolder")}),b.pkiGroup=_.groupBy(b.Kpis,"ParentUniquename"),b.MeasureGroups=b.MeasureGroups||[],b.MeasureGroups.unshift({name:"All",caption:"همه"}),a.selectedMeasureGroup="All",a.datasource.CubeInfo=a.olapCubes[a.selectedOlapCube]}function F(){return"combo-kpi"===a.type}function G(){var b=a.chartProp.extraKpi||[];if(b=b.filter(function(a){return a.name}).map(function(a){return a.name}),a.chartProp.series=(a.chartTriggeredSeries||[]).concat(b),a.chartType.isCustom||a.chartType.id>10){var c=k(a.chartType);_.each(a.chartProp.series,function(b){a.chartProp[c]&&a.chartProp[c].series&&(a.chartProp[c].series[b]=_.merge({},a.customChartDefaultSeries,a.chartProp[c].series[b]||{}))})}}function H(){a.menusSelected&&a.menus&&_.forEach(a.menus,function(b){_.forEach(b,function(b){a.menusSelected.indexOf(b.id)!==-1&&(b.check=!0)})})}function I(){if("undefined"!=typeof Storage){var a=localStorage.getItem("returnUrl");if(localStorage.removeItem("returnUrl"),!_.isUndefined(a)&&!_.isEmpty(a))return void(window.location.href=a)}window.history.length<=2?q.path("charts"):window.history.back()}function J(){var b=345;$("#tdChart").css("height",$(window).height()-b+"px").css("overfolw","auto"),$("#menu").css("height",$(".panel-body.chart-design").height()+"px").css("overfolw","auto"),$("#chrt-prop").css("height",$(".panel-body.chart-design").height()+"px").css("overfolw","auto"),"combo-kpi"===a.type&&$("#tdChart").css("height",$(window).height()-b+140+"px").css("overfolw","auto")}function K(){var b=a.chartProp[k(a.chartType)];return b||(a.chartProp=a.chartProp||$.extend({},m),b=a.chartProp[k(a.chartType)]||{}),b}function L(){a.rolePermissions&&a.roles&&(a.rolePermissionLoaded=!0,_.forEach(a.roles,function(b){var c=_.find(a.rolePermissions,{roleId:b.id});c&&(b.action=1==c.actionSum?1:3==c.actionSum?2:4,_.isArray(c.extra)&&(b.extra=c.extra.slice()),b.check=!0)}))}a.defaultIcon=app.urlPrefix+"images/chart-icons/unknown.png",a.oldcharts=[{title:"",items:[{type:1,title:"bar",iconLink:app.urlPrefix+"images/chart-icons/d3-bar.png"},{type:2,title:"bar-stack",iconLink:app.urlPrefix+"images/chart-icons/d3-bar-stack.png"},{type:21,title:"percent-stack-bar",iconLink:app.urlPrefix+"images/chart-icons/d3-bar-stack-percent.png"},{type:3,title:"خطی",iconLink:app.urlPrefix+"images/chart-icons/d3-line.png"},{type:4,title:"stack-line",iconLink:app.urlPrefix+"images/chart-icons/d3-line-stack.png"},{type:22,title:"percent-stack-line",iconLink:app.urlPrefix+"images/chart-icons/d3-line-stack-percent.png"},{type:5,title:"area",iconLink:app.urlPrefix+"images/chart-icons/d3-area.png"},{type:6,title:"stack area",iconLink:app.urlPrefix+"images/chart-icons/d3-area-stack.png"},{type:23,title:"percent-stack-area",iconLink:app.urlPrefix+"images/chart-icons/d3-area-stack-percent.png"},{type:28,title:"جعبه‌ای",iconLink:app.urlPrefix+"images/chart-icons/d3-box.png"},{type:7,title:"pie",iconLink:app.urlPrefix+"images/chart-icons/d3-pie.png"},{type:8,title:"donut",iconLink:app.urlPrefix+"images/chart-icons/d3-donut.png"},{type:9,title:"arc gauge",iconLink:app.urlPrefix+"images/chart-icons/d3-gauge.png"},{type:24,title:"multi part arc gauge",iconLink:app.urlPrefix+"images/chart-icons/d3-gauge-multi.png"},{type:25,title:"linear gauge",iconLink:app.urlPrefix+"images/chart-icons/d3-gauge-horiz.png"},{type:26,title:"multi part linear gauge",iconLink:app.urlPrefix+"images/chart-icons/d3-gauge-horiz-multi.png"},{type:27,title:"number",iconLink:app.urlPrefix+"images/chart-icons/digit.png"},{type:10,title:"نمودار رادار",iconLink:app.urlPrefix+"images/chart-icons/d3-radar.png"},{type:11,title:"نقشه",iconLink:app.urlPrefix+"images/chart-icons/d3-map.png"},{type:12,title:"نمودار درختی",iconLink:app.urlPrefix+"images/chart-icons/tree-data.png"},{type:13,title:"aggregated table",iconLink:app.urlPrefix+"images/chart-icons/table-aggr.png"},{type:14,title:"table",iconLink:app.urlPrefix+"images/chart-icons/table.png"},{type:29,title:"جدول فرم - ورود اطلاعات",iconLink:app.urlPrefix+"images/chart-icons/table-form.png"}]},{title:"",items:[{type:15,title:"single select",iconLink:app.urlPrefix+"images/chart-icons/combo.png"},{type:16,title:"multi select",iconLink:app.urlPrefix+"images/chart-icons/combo-multi.png"},{type:17,title:"تاریخ",iconLink:app.urlPrefix+"images/chart-icons/date.png"},{type:18,title:"محدوده تاریخ",iconLink:app.urlPrefix+"images/chart-icons/date-range.png"},{type:19,title:"range number",iconLink:app.urlPrefix+"images/chart-icons/slider.png"},{type:20,title:"search",iconLink:app.urlPrefix+"images/chart-icons/search.png"},{type:30,title:"تغییر شاخص",iconLink:app.urlPrefix+"images/chart-icons/kpi.png"
},{type:31,title:"کلید فیلتر",iconLink:app.urlPrefix+"images/chart-icons/key.png"}]}],a.app=app;var M="undefined"!=typeof p.packageId?p.packageId:0,N="undefined"!=typeof p.id?p.id:0,O="undefined"!=typeof p.charttype?p.charttype:0,P=(p.type,N>0);a.isEdit=P,a.id=N;var Q,R,S=N,T=app.urlPrefix+"api/olapchartdesign/SaveChart",U=P;a.managementOnly={id:N},a.olapData={measures:[],kpis:[]},a.dimensions=[],a.measures=[],a.where=[],console.log("### call editor"),a.newChartList=[],a.newChartEnable=chartUtils.enableNewCharts,chartUtils.enableNewCharts&&(a.newChartList=_.flatten(app.charts.list.map(function(a){return a.expandedChartType})),s(function(){var b=$(".chart-selector").popup({popup:$(".ui.flowing.basic.admission.popup"),transition:"scale",on:"click"});a.hidemenu=function(c){b.popup("hide"),s(function(){a.changeChartType(c)},0)}},0)),a.chartDimensions=[],a.chartMeasures=[],a.getChartName=function(a){var b="";return l[a]?b=l[a].name:_.each(app.charts.list,function(c){_.each(c.expandedChartType,function(c){c.type===a&&(b=c.name)})}),b||"نمودار دلخواه"},a.chartType={isCustom:!1,id:1},O&&(a.chartType={isCustom:!1,id:5},a.expandedChartType=29),a.chartProp=$.extend({},m),a.relatedDatasource=[],a.filterException={},a.calculatedFields={},a.selectedTab=0,a.updateDatasources=function(b){s(function(){a.datasource=a.datasource})},a.showAddDatasource=function(){z.select(null,{type:["datasources"]}).then(function(b){var c=b.selected[0];a.addRelatedDatasource(c.id)})},a.showRelatedDatasource=function(b){o.show({controller:["$scope","$mdDialog",function(b,c){b.$scope=a,a.relatedDatasourceList||i.get(app.urlPrefix+"api/olapchartdesign/GetRelatedDatasource?DataSourceId="+Q).then(function(b){a.relatedDatasourceList=b.data.filter(function(b){return a.datasource.CubeInfo.Dimensions.map(function(a){return+a.UniqueName}).indexOf(+b.Id)===-1})}),b.cancel=function(){c.cancel()}}],templateUrl:"chart-editor/related-datasource.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:x("sm")||x("xs")})},a.removeRelatedDatasource=function(b,c){a.relatedDatasource.splice(a.relatedDatasource.indexOf(+c.UniqueName),1);var d=a.datasource.CubeInfo.Dimensions.splice(b,1);d[0].Hierarchies.forEach(function(b){function c(a){var c=a.map(function(a){return a.UniqueName}).indexOf(b.UniqueName);c!==-1&&a.splice(c,1)}c(a.dimensions),c(a.measures),c(a.where)}),a.refreshChart()},a.addRelatedDatasource=function(b){i.get(app.urlPrefix+"api/datasources/GetDatasourceDimension?DataSourceId="+b).then(function(c){a.finishedJob++,a.finishedJob===a.maxJob&&a.$broadcast("finishJobs"),a.datasource.CubeInfo.Dimensions.push(c.data),a.relatedDatasource.indexOf(b)===-1&&a.relatedDatasource.push(b)},function(){a.datasource.CubeInfo.Dimensions.push({Name:b+" - [حذف شده]",UniqueName:b+""}),a.finishedJob++,a.finishedJob===a.maxJob&&a.$broadcast("finishJobs"),a.refreshChart()})},a.filterRelatedDatasource=function(b){console.log("####",a.rdsQuery);var c=!0;return a.rdsQuery&&(c=b.Name.indexOf(a.rdsQuery)!=-1),c&&a.relatedDatasource.indexOf(+b.Id)===-1},a.menu={name:"salam"},a.refreshingCube=function(){var b=a.olapCubes[a.selectedOlapCube];a.refreshCube=!0,i.post(app.urlPrefix+"api/olapchartdesign/ResetCube?CubeName="+b.Name+"&DataSourceId="+Q).then(function(){a.refreshCube=!1},function(){a.refreshCube=!1,alert("اشکال در روند اجرای برنامه")})},a.gettingData=!0,a.collapseAll=function(b){_.each(a.olapCubes[+a.selectedOlapCube].Dimensions,function(a){a.expand=b}),a.measureExp=b,a.kpiExp=b},a.changeCube=function(){var b=a.olapCubes[a.selectedOlapCube];b.Dimensions||i.get(app.urlPrefix+"api/olapchartdesign/GetCubeInnerData?CubeName="+b.Name+"&DataSourceId="+Q).then(function(b){performance.now();a.olapCubes[a.selectedOlapCube]=b.data.CubeInfo,E(a.olapCubes[a.selectedOlapCube])},function(){})},a.gr=function(a,b,c){return _.groupBy(a,b)},a.getColumnList=function(){a.datasource||i.get(app.urlPrefix+"api/OlapChartDesign/CubeInformation?DataSourceId="+Q).then(function(b){a.gettingData=!1;var c=b.data;a.isOlap=c.isOlap,a.datasource=c,c.isOlap&&(a.olapCubes=c.olapCubes,a.selectedOlapCube="0",E(a.olapCubes[0])),a.$broadcast("datasourceReady")})},a.gotoDatasource=function(a){var b={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6},c=0;if(5===a.SystemType)return void q.path("olap-tables"+(a.UniqueName?"/"+a.UniqueName:""));if(6===a.SystemType||4===a.SystemType)return void alert("امکان ویرایش منابع داده سیستمی وجود ندارد");switch(a.DatasourceType){case b.MySQL:q.path("datasources/add/mssql/"+b.MySQL+"/"+c+"/"+a.UniqueName);break;case b.MsOlap:q.path("datasources/add/mssql/"+b.MsOlap+"/"+c+"/"+a.UniqueName);break;case b.MSSQL:q.path("datasources/add/mssql/"+b.MSSQL+"/"+c+"/"+a.UniqueName);break;case b.File:q.path("datasources/add/file/"+c+"/"+a.UniqueName);break;case b.WebResource:q.path("datasources/add/web/"+c+"/"+a.UniqueName);break;case b.JoinDatasource:q.path("datasources/add/join/"+c+"/"+a.UniqueName)}},a.changeDatasource=function(b,c){z.select(null,{type:["datasources"]}).then(function(d){var e=d.selected[0];i.get(app.urlPrefix+"api/datasources/GetDatasourceDimension?DataSourceId="+e.id).then(function(d){a.datasource.CubeInfo.Dimensions.splice(c,1,d.data),0===c&&(Q=e.id),a.relatedDatasource.indexOf(+b.UniqueName)!==-1&&a.relatedDatasource.splice(a.relatedDatasource.indexOf(+b.UniqueName),1,e.id);var f=function(a){return a?a.replace("id"+b.UniqueName,"id"+e.id):a},g=function(a){a.UniqueName=f(a.UniqueName),a.sortFormula=f(a.sortFormula),a.formula=f(a.formula),a.Levels[0].UniqueName=f(a.Levels[0].UniqueName),a.Levels[1].UniqueName=f(a.Levels[1].UniqueName)};_.each(a.dimensions,g),_.each(a.measures,g),_.each(a.where,g),a.refreshChart()})})},a.gotoChart=function(a){q.path("charts/edit/0/"+a.Id)};var V,W=function(b){o.show({controller:["$scope","$mdDialog",function(b,c){b.parent=a,b.cancel=function(){b.parent.memberQuery=null,c.cancel()},b.save=function(){b.parent.memberQuery=null,b.parent.refreshChart(),c.cancel()}}],templateUrl:"editor/filterMember.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:x("sm")||x("xs")})},X=_.debounce(function(){console.log(a.memberQuery,V),a.filterMember(V,!0)},400);a.memberQueryChange=function(){X()},a.memberProgress=!1,a.filterMember=function(b,c,d){V=b,c||W();b.members&&!b.members.list;a.memberProgress=!0,i.post(app.urlPrefix+"api/OlapChartDesign/GetMember",JSON.stringify({CubeName:a.isOlap?a.olapCubes[+a.selectedOlapCube||0].Name:"",Uniquename:a.isOlap?b.UniqueName:b.formula,aggregation:b.aggregation,orderBy:"NONE"===b.sortKey?b.formula:b.sortFormula,orderType:b.sortOrder,DataSourceId:Q,calculatedFields:[],query:a.memberQuery}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(c){var e=c.data;if(e.result){var f={name:b.Name,isNumeric:e.isNumeric,list:e.data,numericFilter:{type:"condition",conditions:[{condition:"none",parameter:"0"},{condition:"none",parameter:"0"}],conditionType:"and",func:"aboveAvg"},aggregation:b.aggregation,filter:{type:"value",funcType:"time"}};if(f=_.extend({},f,b.members),b.members){var g=_.filter(b.members.list,{Checked:!0}),h=_.differenceWith(e.data,g,function(a,b){return a.UniqueName==b.UniqueName});f.list=g.concat(h);var i=_.filter(b.members.list,{Checked:!0});i.forEach(function(a){var b=_.find(f.list,{UniqueName:a.UniqueName});b&&(b.Checked=!0)})}b.members=f}a.members=b.members,d&&d(),a.memberProgress=!1})["catch"](function(){a.memberProgress=!1}),b.userProperty=a.datasource.UsersProperty.map(function(a){var c={Name:a};return b.userProperty&&(c.Checked=_.some(b.userProperty,{Name:a,Checked:!0})),c}).slice(0),b.globalVariable=a.datasource.GlobalVariable.map(function(a){var c={Name:a.Name,Id:a.Id};return b.globalVariable&&(c.Checked=_.some(b.globalVariable,{Id:a.Id,Checked:!0})),c}).slice(0),a.globalVariable=b.globalVariable,a.userProperty=b.userProperty},a.checkAll=function(a,b){a&&a.forEach(function(a){a.Checked=b})},a.sortableOptions={stop:function(){s(function(){a.refreshChart()},0)},receive:function(a,b){$(a.target).attr("id"),$(b.sender).attr("id")}},a.refreshChart=function(c){app.chartCommons.drillDown.clearAll();var d=$.extend({needDim:!0,needMeasure:!0,needServerData:!0},j(a));a.chartRenderError=null;var f=app.customChart.getConfig(a.chartType)||{};if(!a.chartType.isCustom){if(!F()&&d.needDim&&0===a.dimensions.length)return $("#divChart").empty(),void t("chart_editor_need_measure").then(function(b){a.chartRenderError=b});if(!F()&&d.needMeasure&&0===a.measures.length)return $("#divChart").empty(),void t("chart_editor_need_measure").then(function(b){a.chartRenderError=b});if(F()&&!a.combo.selectedChart.length)return $("#divChart").empty(),void t("chart_editor_need_chart").then(function(b){a.chartRenderError=b})}if(f.needServerData!==!1&&!F()&&d.needMeasure&&0===a.measures.length)return $("#divChart").empty(),void t("chart_editor_need_measure").then(function(b){a.chartRenderError=b});if(f.needServerData!==!1&&F()&&!a.combo.selectedChart.length)return $("#divChart").empty(),void t("chart_editor_need_chart").then(function(b){a.chartRenderError=b});if(c&&$("#divChart").data("isChart")){var g=$("#divChart").data("settings");if("undefined"==typeof g.input)return;g.input.result||(c=null),F()||!d.needServerData||g.input.fields||7!==+a.chartType.id||a.chartType.isCustom||(c="refreshWithData")}var h={Title:"",CubeName:a.isOlap?a.olapCubes[+a.selectedOlapCube||0].Name:"xxx",Description:"",Hierarchies:b(a.dimensions,a.isOlap),Where:b(a.where,a.isOlap),SeriesLevel:b(a.measures,a.isOlap),DataSourceId:Q,Detail:JSON.stringify({chartProp:e(a.chartProp,a.chartType,a.dimensions,a.measures,a.where,a),needServerData:d.needServerData,tableInfo:a.tableInfo,relatedDatasource:a.relatedDatasource,filterException:a.filterException,calculatedFields:a.calculatedFields,dataType:a.type,combo:a.combo})};a.isOlap&&(h.Measurs=_.map(_.filter(a.measures,["type","measure"]),"UniqueName"),h.Kpis=_.map(_.filter(a.measures,["type","kpi"]),"UniqueName"));var i={ChartInfo:h,notEditMode:!1},k={chartProp:e(a.chartProp,a.chartType,a.dimensions,a.measures,a.where,a),parameters:i,editMode:!0,needServerData:d.needServerData,tableInfo:a.tableInfo,relatedDatasource:a.relatedDatasource,calculatedFields:a.calculatedFields,dataType:a.type,combo:a.combo};$("#divChart").data("chartInfo",h),app.chartCommons.drillDown.clear(-1),clearTimeout(a.lastRefreshTimeout),a.lastRefreshTimeout=setTimeout(function(){k.permissions={},k.type=a.chartType,k.title=a.chartName||"",c||$("#divChart").empty(),dashboard.addChart(null,k,c,0,$("#divChart"))},400),$("#divChart").off("legendClick"),$("#divChart").on("legendClick",function(b,c,d,e){s(function(){a.menu.set("series"),a.chartProp.selectedSeries=e.key},20)})},B.registerRefreshFunction(a.refreshChart),a.gotoDimentionSettings=function(b,c){a.menu.set("dimension"),a.menu.selectedDimension=c+""},a.gotoMeasureSettings=function(b,c){a.menu.set("measure"),a.menu.selectedMeasure=c+""},a.gotoWhereSettings=function(b,c){a.menu.set("where"),a.menu.selectedwhere=c+""},$("#divChart").bind("tableInfo",null,function(b,c){s(function(){var b=a.tableInfo?a.tableInfo.Limit||10:10;a.tableInfo=c.TableInfo,a.tableInfo.Limit=b,a.chartProp.tableInfo=a.tableInfo},0)}),$("#divChart").bind("columnsWidth",null,function(b,c){s(function(){a.chartProp.table.info.columnsWidth=c.columnsWidth},0)}),a.$watch("chartProp.extraKpi",function(b){_.isArray(a.chartProp.series)&&G()},!0),$("#divChart").off("chartproperty"),$("#divChart").on("chartproperty",null,function(b,c){s(function(){a.chartTriggeredSeries=c,G()},0)}),$("#divChart").bind("dimColor",null,function(b,c){s(function(){a.chartProp.dimColor=a.chartProp.dimColor||{},_.each(c,function(b){a.chartProp.dimColor[b]={}}),a.chartProp.matrix=_.merge({},a.chartProp.dimColor)},0)}),y.get().then(function(b){_.forEach(b.data,function(a){a.check=!1});var c=_.sortBy(b.data,["parentOrder","order"]);a.menus=_.groupBy(angular.merge([],c),"parent"),H()}),a.showDialog=function(b,c){o.show({controller:["$scope","$mdDialog",function(b,d){b.parent=a,b.cancel=function(){d.cancel()},b.save=function(){P||b.parent.saveNewChart(c),d.cancel()}}],templateUrl:"editor/save-chart.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:x("sm")||x("xs")})},a.save=function(b,c){return U?void a.saveNewChart(c):void a.showDialog(b,c)},a.cancel=function(){I()},a["delete"]=function(b){var c=app.urlPrefix+"api/Charts/DeleteCharts",d=o.confirm().title("حذف برای همیشه؟").textContent("آیا برای حذف نمودار "+a.chartName+" اطمینان دارید؟").ariaLabel("حذف").targetEvent(b).ok("حذف!").cancel("لغو");o.show(d).then(function(){i.post(c,["ChartId-"+a.id]).then(function(a){if(a.data.result){var b=n.simple().textContent("حذف انجام شد");n.show(b),2===window.history.length?q.path("charts"):window.history.back()}},function(){var a=n.simple().textContent("اشکال در حذف!");n.show(a)})})},a.saveNewChart=function(d){if(!a.chartName)return t("form_name_required").then(function(a){u.showErrorToast(a)}),!1;var f=_.filter(a.roles,{check:!0}).map(function(a){return a.action+"-"+a.id}),g=_.filter(a.roles,{check:!0}).map(function(a){return{id:a.id,permissions:a.extra}}),h=[];_.forEach(a.menus,function(a){_.forEach(a,function(a){a.check&&h.push(a.id)})}),c(a.chartProp,a.chartType);var k=$.extend({needDim:!0,needMeasure:!0,needServerData:!0},j(a));a.combo&&!U&&(a.combo.title=$("#chartTitleFarsi").val());var l=e(a.chartProp,a.chartType,a.dimensions,a.measures,a.where,a),m={datasourceId:Q,relatedDatasource:a.relatedDatasource,dimensions:a.dimensions,measures:a.measures,where:a.where,chartType:a.chartType,expandedChartType:a.expandedChartType,chartProp:l,needServerData:k.needServerData,tableInfo:a.tableInfo,filterException:a.filterException,calculatedFields:a.calculatedFields,dataType:a.type,combo:a.combo,isOlap:a.isOlap,selectedOlapCube:a.selectedOlapCube,extraKpi:a.chartProp.extraKpi},o={id:S,editMode:U,xChartType:a.chartType.id,isCustom:a.chartType.isCustom,xTitleFarsi:a.chartName,chartUniquename:"",cubeName:a.isOlap?a.olapCubes[+a.selectedOlapCube||0].Name:"xxx",hierarchy:b(a.dimensions,a.isOlap),where:b(a.where,a.isOlap),seriesLevel:b(a.measures,a.isOlap),ChartActions:f,chartExtraActions:g,Menus:h,detail:JSON.stringify(m),DataSourceId:Q,Desc:a.chartDesc,PackageId:M,managementOnly:a.managementOnly};return a.isOlap&&(o.measures=_.map(_.filter(a.measures,["type","measure"]),"UniqueName"),o.kpis=_.map(_.filter(a.measures,["type","kpi"]),"UniqueName")),a.saveProgress=!0,i.post(T,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){a.saveProgress=!1,t("chart_editor_save_success").then(function(a){n.show(n.simple().textContent(a))}),a.$broadcast("save-chart"),q.path("charts/edit/"+M+"/"+b.data.id).replace(),z.reset(),d&&I()})["catch"](function(){a.saveProgress=!1,n.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>خطا در ذخیره‌سازی</span></md-toast>',hideDelay:3e3,position:"bottom left"})}),!0},a.addLevelType=function(){"undefined"==typeof a.chartProp.levelTypes&&(a.chartProp.levelTypes={enable:!0,current:0,props:[d(a)]}),a.chartProp.levelTypes.enable=!0;var b=a.chartProp.levelTypes;b.props=b.props||[{}],b.props.push(d(a));var c=b.current;b.current=b.props.length-1+"",a.changeLevelType(b.current,c)},a.removeLevelType=function(){var b=a.chartProp.levelTypes;b.props.length<2||(_.isArray(b.props)&&b.props.length&&a.chartProp.levelTypes.props.splice(b.props.length-1,1),+b.current===b.props.length&&(b.current=+b.current-1+"",a.changeLevelType(b.current,+b.current+1)),1===b.props.length&&(b.enable=!1))},a.changeLevelType=function(b,c){var e=a.chartProp.levelTypes;e.props=e.props||[],e.props.length>+c&&(e.props[+c]=d(a));var f=_.merge({},e.props[+b]);if(f&&f.type){var g=k(f.type);a.chartProp[g]=_.merge({},f.prop),a.chartType=_.merge({},f.type)}D()},a.restore=function(b){var c={datasourceId:-1,dimensions:[],relatedDatasource:[],measures:[],where:[],chartType:1,chartProp:{},tableInfo:null,filterException:{},calculatedFields:{},isOlap:!1};b=$.extend({},c,b),Q=b.datasourceId,a.relatedDatasource=b.relatedDatasource,a.where=b.where,a.chartType=b.chartType,"undefined"==typeof b.chartType.isCustom&&(a.chartType={isCustom:!1,id:b.chartType});var d={},e=k(a.chartType);if(d[e]=b.chartProp,d.levelTypes=b.chartProp.levelTypes,a.dimensions=b.dimensions,a.measures=b.measures,a.chartProp=_.merge({},m,d),a.expandedChartType=b.expandedChartType,a.tableInfo=b.tableInfo,a.filterException=b.filterException,a.calculatedFields=b.calculatedFields||{},a.chartProp.extraKpi=b.extraKpi||[],a.maxJob=0,a.finishedJob=-1,a.isOlap=b.isOlap,a.selectedOlapCube=b.selectedOlapCube,a.selectedOlapCube=_.findIndex(a.olapCubes,{Name:a.chart.CubeName})+"",a.isOlap&&0!==+a.selectedOlapCube&&a.changeCube(),a.type=b.dataType,a.combo=b.combo||{},a.combo.synonyms=a.combo.synonyms||[],a.combo.aggregation=a.combo.aggregation||0,a.maxJob=a.relatedDatasource?a.relatedDatasource.length:0,a.relatedDatasource.forEach(function(b){a.addRelatedDatasource(b)}),_.each(a.combo.selectedChart,function(b){i.get(app.urlPrefix+"api/charts/get?id="+b.Id).then(function(c){if(!c.data)return _.remove(a.combo.selectedChart,{Id:b.Id}),void a.refreshChart();var d=_.find(a.combo.selectedChart,{Id:b.Id});d.Name=c.data.Name})}),_.isUndefined(a.expandedChartType)){var f=_.findKey(l,_.find(l,{type:+a.chartType.id}));a.expandedChartType=+f}D()},a.chagePivotFormula=function(b){a.measures&&(1===b?a.measures.forEach(function(a){var b="SUM("+a.UniqueName+")",c="SUM";a.IsNumeric||(b="COUNT("+a.UniqueName+")",c="COUNT"),a.formula=b,a.aggregation=c}):a.measures.forEach(function(a){a.formula=a.UniqueName,a.aggregation="NONE"}))},a.setType=function(b){a.type=b,"combo-kpi"!==b?a.getColumnList():a.$broadcast("datasourceReady"),J()},a.charts=[],a.getCharts=function(){i.get(app.urlPrefix+"api/charts/get").then(function(b){b.data.result?a.charts=b.data.list:a.charts=[]},function(){a.charts=[]})},a.showChartsDialog=function(){$("#charts-modal").modal("show"),a.charts&&a.charts.length||a.getCharts()},a.combo={combineType:0,aggregation:0,selectedChart:[],synonyms:[]},a.addChart=function(b){a.combo.selectedChart.push(b),a.refreshChart()},a.selectChart=function(b){z.select(b,["charts"]).then(function(b){"charts"===b.type&&(_.forEach(b.selected,function(b){a.combo.selectedChart.push({Id:b.id,Name:b.name})}),a.refreshChart())})},C.get().then(function(b){a.customCharts=b.list,a.customCharts2=_.groupBy(b.list,"category"),_.each(b,function(a){l[a.id+1e3]={name:a.name,type:a.id}})}),a.getChartTypeBaseOnExtendedType=function(a){if(l[a])return l[a].type;var b=-1;return _.each(app.charts.list,function(c){_.each(c.expandedChartType,function(d){d.type===a&&(b=c.type)})}),b},l={1:{name:app.lang.translate("bar"),type:1},2:{name:app.lang.translate("stack-bar"),type:1},3:{name:app.lang.translate("خطی"),type:1},4:{name:app.lang.translate("stack-line"),type:1},5:{name:app.lang.translate("area"),type:1},6:{name:app.lang.translate("stack area"),type:1},7:{name:app.lang.translate("pie"),type:2},8:{name:app.lang.translate("donut"),type:2},9:{name:app.lang.translate("arc gauge"),type:4},10:{name:app.lang.translate("نمودار رادار"),type:8},11:{name:app.lang.translate("نقشه"),type:6},12:{name:app.lang.translate("نمودار درختی"),type:9},13:{name:app.lang.translate("aggregated table"),type:5},14:{name:app.lang.translate("table"),type:5},15:{name:app.lang.translate("single select"),type:7},16:{name:app.lang.translate("multi select"),type:7},17:{name:app.lang.translate("تاریخ"),type:7},18:{name:app.lang.translate("محدوده تاریخ"),type:7},19:{name:app.lang.translate("range number"),type:7},20:{name:app.lang.translate("search"),type:7},21:{name:app.lang.translate("percent-stack-bar"),type:1},22:{name:app.lang.translate("percent-stack-line"),type:1},23:{name:app.lang.translate("percent-stack-area"),type:1},24:{name:app.lang.translate("multi part arc gauge"),type:4},25:{name:app.lang.translate("linear gauge"),type:4},26:{name:app.lang.translate("multi part linear gauge"),type:4},27:{name:app.lang.translate("number"),type:4},28:{name:app.lang.translate("جعبه‌ای"),type:1},29:{name:app.lang.translate("جدول فرم"),type:5},30:{name:app.lang.translate("تغییر شاخص"),type:7},31:{name:app.lang.translate("کلید فیلتر"),type:7}},a.expandedChartType=a.expandedChartType||1;var Y=1;if(a.changeChartType=function(b,c){Y=a.expandedChartType,app.chartCommons.clicked=!0,a.expandedChartType=b;var d=_.extend({},a.chartType),e=a.getChartTypeBaseOnExtendedType(b);e===-1?a.chartType.id=b-1e3:a.chartType.id=e,a.chartType.isCustom=c||!1,14!==Y&&29!==Y||14===a.expandedChartType||a.chagePivotFormula(1),14===Y||14!==a.expandedChartType&&29!==a.expandedChartType||a.chagePivotFormula(-1),app.chartCommons.expandedType=a.expandedChartType;var f=K();app.chartCommons.changeSeriesPropertyBaseOnExpandedType(f),D(),f=K(),f.indicator=a.chartProp[k(d)].indicator},P)a.selectedTab=1,i.get(app.urlPrefix+"api/charts/GetChartMenus?id="+N).then(function(b){a.menusSelected=b.data,H()}),A.get().then(function(b){a.roles=angular.merge({},b.data.list),_.forEach(a.roles,function(a){a.action=1,a.extra=[],a.check=!1}),L()}),i.get(app.urlPrefix+"api/permissions/getChartPermissions?id="+a.id).then(function(b){a.rolePermissions=b.data.list,L()}),a.app=app,i.get(app.urlPrefix+"api/charts/getEditor?id="+N).then(function(b){Q=b.data.dataSourceId,R=b.data.type,a.sign=b.data.sign,a.chart=b.data.chart,a.apiKey={key:b.data.ApiKey,id:N};var c=JSON.parse(b.data.chart.Detail);a.$on("datasourceReady",function(){a.restore(c)}),a.setType(R),a.chartName=a.chart.Name,a.chartDesc=a.chart.Description,a.managementOnly=b.data.managementOnly,a.managementOnly=a.managementOnly||{},a.managementOnly.id=N,a.managementOnly.restore=function(b){a.restore(JSON.parse(b.detail))}},function(a){a.data.desc?alert(a.data.desc):alert("خطا در دریافت اطلاعات نمودار")});else{Q=p.datasourceId,R=p.type,"combo-kpi"===R&&_.forEach(z.lastSelected.charts,function(b){a.combo.selectedChart.push({Id:b.id,Name:b.name})}),a.setType(R),app.chartCommons.expandedType=a.expandedChartType;var Z=K();app.chartCommons.changeSeriesPropertyBaseOnExpandedType(Z),D()}a._=_,a.existIn=function(a,b){return _.some(b,{UniqueName:a.UniqueName})},a.notInMeasureGroup=function(a){},a.addToChart=function(b){var c=!b.IsNumeric,d=e(a.chartProp,a.chartType,null,null,null,a),f=a.dimensions.concat(a.measures).concat(a.where),i=c?a.dimensions:a.measures,j=c?h:g;i.push($.extend({},j(b,f,d,a))),B.refreshChart()},a.hide=function(b,c,d){if("measure"===c){var e=b.GroupName===a.selectedMeasureGroup||"All"===a.selectedMeasureGroup,f=!0;a.query&&(f=_.includes(normilize(b.Name).toLowerCase(),normilize(a.query).toLowerCase()));var g=!e||!f;return g}if("dimension"===c){var e=_.indexOf(b.MeasureGroups,a.selectedMeasureGroup)!==-1||"All"===a.selectedMeasureGroup,f=!0;if(a.query){f=_.includes(normilize(b.Name),normilize(a.query));for(var h=0;h<b.Hierarchies.length&&!(f=_.includes(normilize(b.Hierarchies[h].Name).toLowerCase(),normilize(a.query).toLowerCase()));h++);}return!e||!f}if("check-name"===c){var f=!0;return a.query&&(f=_.includes(normilize(b.Name).toLowerCase(),normilize(a.query).toLowerCase())),!f}}}]),o.directive("ngChartProperties",function(){return{restrict:"AE",require:"^ngModel",scope:{ngModel:"=",dimensions:"=",measures:"=",where:"=",datasource:"=",type:"@",key:"@",apiKey:"=",isOlap:"=",relatedDatasourceList:"=",calculatedFields:"=",filterException:"=",openMenuName:"=",managementOnly:"="},templateUrl:function(a,b){var c=/key-\d+/.test(b.type);if(c)return app.urlPrefix+"dist/partial/management/charts/directives/types/customChart.html?v="+app.version;switch(b.type){case"customChart":return app.urlPrefix+"dist/partial/management/charts/directives/types/customChart.html?v="+app.version;case"bar":return app.urlPrefix+"dist/partial/management/charts/directives/types/barLine.html?v="+app.version;case"map":return app.urlPrefix+"dist/partial/management/charts/directives/types/map.html?v="+app.version;case"pie":return app.urlPrefix+"dist/partial/management/charts/directives/types/pie.html?v="+app.version;case"gauge":return app.urlPrefix+"dist/partial/management/charts/directives/types/gauge.html?v="+app.version;case"radar":return app.urlPrefix+"dist/partial/management/charts/directives/types/radar.html?v="+app.version;case"table":return app.urlPrefix+"dist/partial/management/charts/directives/types/table.html?v="+app.version;case"userControl":return app.urlPrefix+"dist/partial/management/charts/directives/types/userControl.html?v="+app.version;case"tree":return app.urlPrefix+"dist/partial/management/charts/directives/types/tree.html?v="+app.version;case"text":return app.urlPrefix+"dist/partial/management/charts/directives/types/text.html?v="+app.version;default:return app.urlPrefix+"dist/partial/management/charts/directives/types/customChart.html?v="+app.version}},controller:["$scope","$timeout","$http",function(a,b,c){a.cntrName="ngChartProperties",a.license=app.license||{},a._=_,a.changeColor=function(b,c,d){$(b.target).colorSelector(c&&c[d]?c[d]:"#1f77b4",function(e){$(b.target).css("background-color",e),a.$apply(function(){c&&(c[d]=e),a.refreshChart("refresh"),a.changeAllSeries(d,e)})})},a.refreshChart=function(b){a.$parent.refreshChart(b)},a.chagePivotFormula=function(b){a.$parent.chagePivotFormula(b)},a.setTableInfoLimit=function(b,c){a.$parent.tableInfo=a.$parent.tableInfo||{},"undefined"!=typeof b&&null!==b&&(a.$parent.tableInfo.Limit=b),"undefined"!=typeof c&&(a.$parent.tableInfo.useDistinct=c)},a.$parent.dereg&&a.$parent.dereg(),a.$parent.dereg=a.$watch("dimensions",function(b,c){if("undefined"!=typeof b){a.ngModel.tree=a.ngModel.tree||{},a.ngModel.tree.dimensions=a.ngModel.tree.dimensions||[];for(var d=0;d<b.length;d++){var e=b[d],f=_.filter(a.ngModel.tree.dimensions,{name:e.Name}).length;f||a.ngModel.tree.dimensions.push({type:0===d?"id":1===d?"parent":2===d?"name":"type",name:e.Name})}}},!0),a.changeAllSeries=function(b,c){if("{All}"===a.ngModel.selectedSeries){var d=a.ngModel[a.type].series;d["{All}"]||(d["{All}"]={});var e=d["{All}"][b];e=_.isUndefined(e)?c:e;for(var f in d)d[f][b]=_.isObject(e)?_.merge({},e):e,console.log("### set",f,b,e)}},c.get(app.urlPrefix+"api/forms/get").then(function(b){a.formList=b.data.list})}],link:function(){app.lang.setLang()}}}),o.directive("managementOnlyDir",function(){return{scope:{managementOnly:"="},controller:["$scope","$timeout",function(a,b){a.updateModel=function(b){a.managementOnly.notifications=b},a.render=!0,a.updateModel=function(c){a.managementOnly.notifications=c,a.render=!1,b(function(){a.render=!0},0)};var c=null;a.detail=function(b){c=b,a.chart=JSON.parse(b.detail),console.log(b,a.chart),a.chart.name=a.$parent.$parent.$parent.$parent.getChartName(a.chart.expandedChartType)},a["if"]=!0,a.$on("save-chart",function(){a["if"]=!1,b(function(){a["if"]=!0},100)}),a.restore=function(){a.managementOnly.restore(c)}}],template:'<div>                <menu-item class="">                    <menu-header style="position:relative" class="pointer">                        <div data-toggle="" href="#events">اعلان‌های سیستمی</div>                    </menu-header>                    <menu-body id="events" class="prop-section form-horizontal">                        <register-notification type="\'chart\'" onupdate="updateModel" ng-model="managementOnly.notifications" ng-if="render"></register-notification>                    </menu-body>                </menu-item>                <menu-item class="">                    <menu-header style="position:relative" class="pointer">                        <div data-toggle="" href="#events">ویرایش‌های قبلی</div>                    </menu-header>                    <menu-body id="events" class="prop-section form-horizontal">                        <versions ng-if="if" id="{{managementOnly.id}}" type="1" on-restore="restore(model)" on-detail="detail(model)" class="small"></versions>                        <div ng-show="chart" class="ui segment secondary">                             <div><b>نوع نمودار: </b>{{chart.name}}</div>                                <ul><b>شاخص‌ها</b><li ng-repeat="i in chart.measures">{{i.Name}} {{i.formula}}</li></ul>                                <ul><b>ابعاد</b><li ng-repeat="i in chart.dimensions">{{i.Name}} {{i.formula}}</li></ul>                                <div class="ui mini button" ng-click="restore()">بازنشانی</div>                           </div>                    </menu-body>                </menu-item>                </div>'}}),o.service("customChart",["$http",function(a){var b=function(b){return b?a.get(app.urlPrefix+"api/customCharts/get/"+b).then(function(a){return a.data}):a.get(app.urlPrefix+"api/customCharts/get").then(function(a){return a.data})},c=function(b){return a.get(app.urlPrefix+"api/customCharts/getSettingsTemplate/"+b).then(function(a){return a.data})},d=function(b){return a.post(app.urlPrefix+"api/customCharts/remove/"+b).then(function(a){return a.data})};return{get:b,getSettingsTemplate:c,remove:d}}]),o.directive("topMeasure",function(){return{restrict:"E",scope:{model:"=?ngModel",change:"&ngChange",dims:"=?dims"},link:function(a,b,c,d){},controller:["$scope",function(a){a.dims=a.dims||[],a.model&&(a.model.selectedDims=a.model.selectedDims||{})}],template:'                                                                                                                 <div class="form-row" layout="row" layout-align="start center" layout-wrap>                                                                 <md-switch ng-model="model.IsTop" ng-change="change()">                                                                         {{ \'isTop\' | translate }}                                                                                             </md-switch>                                                                                                            </div>                                                                                                                      <div ng-if="model.IsTop">                                                                                                       <div class="form-row" layout="row" layout-align="start center">                                                                 <label>{{ \'top\' | translate }}</label>                                                                                    <span class="form-divider" flex></span>                                                                                     <div>                                                                                                                           <md-switch ng-model="model.IsPercent" ng-change="change()" style="display:inline">                                              {{ \'IsPercent\' | translate }}                                                                                         </md-switch>                                                                                                                                                                                                                                            <input type="number" class="form-control" placeholder="{{ \'top\' | translate }}"                                                  ng-model-options="{ updateOn: \'blur\' }"                                                                                   ng-change="change()"                                                                                                        ng-model="model.Top" />                                                                                                                                                                                                                          <select class="selectpicker form-control"                                                                                           ng-model="model.TopOrder"                                                                                                   ng-change="change()"                                ng-options="color.name as  color.value for color in [                                    {name:\'DESC\', value: \'نزولی\'  },                                     {name:\'ASC\', value: \'صعودی\'  },                                     ]">                                                                                               </select>                                                                                                               </div>                                                                                                                  </div>                                                                                                                      <div class="form-row" layout="row" layout-align="start center">                                                                 <label>{{ \'Applied_to\' | translate }}</label>                                                                             <span class="form-divider" flex></span>                    <div>                                                                                                                           <md-checkbox ng-repeat="d in dims track by $index" ng-model="model.selectedDims[d.Name]" ng-change="change()">{{d.Name}}</md-checkbox>                       </div>                                                                                                                  </div>                                                                                                                  </div>                                                                                                                      '
}})}();var ngApp=angular.module("management");ngApp.controller("chartsListCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","utils","datasources","toolbar","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){var c=new Date;a.progress=!1,a.allData=b.data.list,a.securityCertPatch=b.data.securityCertPatch,a.pageCount=40,a.page=1,a.maxPage=Math.ceil(a.allData.length/a.pageCount),a.setPage=function(b){a.page=b,a.data=a.allData.slice((a.page-1)*a.pageCount,a.page*a.pageCount)},a.setPage(1),i("لیست نمودارها").then(function(c){a.listTranslate=c,b.data.path.unshift({name:c,id:null}),a.path=b.data.path.map(function(b){return b.click=function(){a["goto"]({type:1,id:b.id})},b}),l.setTitles(a.path)}),h(function(){console.log("Process time: "+(new Date-c))},0)}function o(){return _.map(_.filter(a.data,{select:!0}),function(a){return 2===a.type?"ChartId-"+a.id:"PackageId-"+a.id})}function p(b){var c=_.lastIndexOf(a.data.map(function(a){return a.type}),1);c==-1?a.data=b.concat(a.data):Array.prototype.splice.apply(a.data,[c+1,0].concat(b))}function q(a){j.showErrorToast(a.data.desc)}function r(b){a.data=_.filter(a.data,function(a){var c=2==a.type?"ChartId-"+a.id:"PackageId-"+a.id;return b.indexOf(c)==-1})}a.utils=j;var s="undefined"!=typeof e.id?e.id:0;a.app=app,a._=_;var t=m.defer(),u=s?"?packageId="+s:"";a.progress=!0,b.get(app.urlPrefix+"api/charts/getList"+u,{timeout:t.promise}).then(function(a){n(a)},q),j.onError(function(b){a.error=b,a.progress=!1}),i("لیست نمودارها").then(function(b){a.listTranslate=b});var v=function(){return _.some(a.data,{select:!0})};a.menuInvalidate=function(){var b=v(),c=_.filter(a.data,{select:!0,type:1}).length,d=_.filter(a.data,{select:!0,type:2}).length;a.canCopy=b,a.canDelete=b,a.canForward=b,a.canExport=b,a.canDirEdit=1==c&&0==d},a.copy=function(){var d=app.urlPrefix+"api/Charts/CloneCharts",e=o();b.post(d,e).then(function(b){if(b.data.result){if(b.data.inserted){var d=_.findIndex(a.data,{type:2});a.data.splice.apply(a.data,[d,0].concat(b.data.inserted))}b.data.packages&&p(b.data.packages);var e=c.simple().textContent("کپی انجام شد");c.show(e)}},q)},a["delete"]=function(e){var f=app.urlPrefix+"api/Charts/DeleteCharts",g=o(),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){if(b.data.result){b.data.deletedIds&&r(b.data.deletedIds);var d=c.simple().textContent("حذف انجام شد");c.show(d),a.menuInvalidate()}},q)})},a.forward=function(a){k.select(a,{type:["charts"],justDir:!0,selectableDir:!0,multipleChart:!1}).then(function(a){var d=a.selected[0];if(e.id==d.id){var f=c.simple().textContent("موارد انتخاب شده در همین پوشه هستند");return void c.show(f)}var g=o();b.post(app.urlPrefix+"api/Charts/MoveToPackage",{Ids:g,packageId:d.id}).then(function(a){r(a.data.ids);var b=c.simple().textContent("انتقال انجام شد");c.show(b)},q)},q)},a.dirEdit=function(b){var d=o(),e=d[0].replace("PackageId-","");g.edit(b,2,e,function(b){_.find(a.data,{select:!0}).name=b.data.info.Name;var d=c.simple().textContent("نام پوشه تغییر کرد");c.show(d)},q)},a.newPackage=function(a){g.create(a,1,e.id,function(a){p([{id:a.data.info.Id,name:a.data.info.Name,type:1}]);var b=c.simple().textContent("پوشه جدید ایجاد شد");c.show(b),k.reset()})},a["goto"]=function(a,b){1==a.type?f.path("charts"+(a.id?"/"+a.id:"")):2==a.type&&f.path("charts/edit/"+s+"/"+a.id)},a.getTypeName=function(a){var b=1,c=2,d=3,e=5,f=6,g=7,h=8,i=9,j="";switch(+a){case b:j="Bar";break;case c:j="Pie";break;case d:j="Line";break;case e:j="Table";break;case f:j="Map";break;case g:j="User Control";break;case h:j="Radar";break;case i:j="Tree"}return j},a.getChartTypeImage=function(a){var b="",c={};switch(c.BAR=1,c.PIE=2,c.LINE=3,c.GAUGE=4,c.TABLE=5,c.MAP=6,c.USER_CONTROL=7,c.RADAR=8,c.TREE=9,+a){case c.BAR:b=app.urlPrefix+"Images/bar.png";break;case c.GAUGE:b=app.urlPrefix+"Images/guage.png";break;case c.PIE:b=app.urlPrefix+"Images/pie.png";break;case c.LINE:b=app.urlPrefix+"Images/line.png";break;case c.TABLE:b=app.urlPrefix+"Images/table.png";break;case c.MAP:b=app.urlPrefix+"Images/map.png";break;case c.USER_CONTROL:b=app.urlPrefix+"Images/combo_box.png";break;case c.RADAR:b=app.urlPrefix+"Images/radar_plot.png";break;case c.TREE:b=app.urlPrefix+"Images/tree.png"}return b};var w;a.$watch("search",function(){h.cancel(w),w=h(function(){"undefined"!=typeof a.search&&(a.progress=!0,null!==t&&t.resolve(),t=m.defer(),b.get(app.urlPrefix+"api/charts/getList?q="+a.search,{timeout:t.promise}).then(function(a){n(a)},q))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox}),a.menuInvalidate()},a.newChart=function(a){k.select(a,{type:["charts","datasources"]}).then(function(a){"charts"==a.type?(k.lastSelected.charts=a.selected,f.path("charts/new/combo-kpi/"+(e.id?e.id:"0"))):f.path("charts/new/normal/"+(e.id?e.id:"0")+"/"+a.selected[0].id)})},a.sortDetail={},a.sort=function(b){a.sortDetail[b]=a.sortDetail[b]||{},a.sortDetail[b].isDesc=!a.sortDetail[b].isDesc;var c=_.filter(a.data,{type:1}),d=_.filter(a.data,{type:2});d=_.sortBy(d,[b]),c=_.sortBy(c,[b]),a.sortDetail[b].isDesc||(d=_.reverse(d),c=_.reverse(c)),a.data=c.concat(d)},a["export"]=function(){var c=o(),d=_.filter(a.data,{select:!0,type:2}).map(function(a){return a.id});console.log(c,d),b.post(app.urlPrefix+"api/Charts/export",d).then(function(a){console.log(a.data);var b=new Blob([a.data],{type:"text/plain;charset=utf-8;"});saveAs(b,"thing.txt")})}}]),function(a){var b=angular.module("management");b.directive("alert",["$timeout","$http","datasources",function(b,c,d){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/alert.html?v="+app.version,scope:{model:"=prop",config:"="},controller:["$scope","$sce",function(e,f){e.name="ALERT_CONTROLLER",e.s=f,e.alertTypes=[{name:"sms",value:"پیام کوتاه"},{name:"email",value:"پست الکترونیک"}],app.license.telegram&&e.alertTypes.push({name:"telegram",value:"تلگرام"}),e.contactList=[{phone:"",email:""}],e.roleList=null,e.userList=null,e.schedule={occure:"daily",dailyRecurs:1,weeklyRecurs:1,weeklySat:!1,weeklySun:!1,weeklyMon:!1,weeklyTus:!1,weeklyWen:!1,weeklyThu:!1,weeklyFri:!1,monthlyDayOf:1,monthlyRecurs:1,dailyFrequency:"once",dailyFrequencyAtHour:"1200",dailyFrequencyRecur:1,dailyFrequencyRecurType:"hour",dailyFrequencyStart:"1200",dailyFrequencyStop:"2359"},e.getPreview=function(a,b){console.log("### alertx c",a);var d=e.$parent.$parent.$parent.$parent.id;return 0==+d?void a("ابتدا باید نمودار را ذخیره کنید"):(a.previewProgress=!0,void c.post(app.urlPrefix+"api/Alert/preview",{id:d,alert:a,isPreview:b}).then(function(b){a.previewProgress=!1,a.preview=b.data})["catch"](function(b){a.previewProgress=!1,a.preview={result:!1,message:b.data}}))},e.selectDatasource=function(a,b){d.select(a,{type:["datasources"]}).then(function(a){b.error=null,b.selectedDatasource=a.selected[0],b.selectedDatasourceId=a.selected[0].id,b.datasourceCaptionsColumn=[],e.getColumns(b)})},e.getColumns=function(a){d.getColumns(a.selectedDatasource.id).then(function(b){a.getInfoProgress=!1,a.datasourceColumns=b.CubeInfo.Dimensions[0].Hierarchies,a.userProperties=b.UsersProperty},function(b){a.error=b})},e.newAlert=function(){e.model[e.config.name].alerts.push({type:"sms",body:"@{name}\n@{update-time}\n@{content}\n@{filters}",rules:[{}],schedule:_.merge({},e.schedule),format:"[@{k} :: ][, ][@{m}: @{n}]",selectedSeries:[],contactType:"role"}),b(function(){app.lang.setLang()},0)},e.formatClock=function(a){var b=a+"";return b.substr(0,2)+":"+b.substr(2)},e.model[e.config.name]&&(e.model[e.config.name].alerts=a.extend([],e.model[e.config.name].alerts)),e.addContact=function(a){a.contactList||(a.contactList=[{email:"",phone:""}]),0==a.contactList.length&&(a.contactList=[{email:"",phone:""}]),e.contactList=a.contactList},e.addSchedule=function(a){a.schedule||(a.schedule={occure:"daily",dailyRecurs:1,weeklyRecurs:1,weeklySat:!1,weeklySun:!1,weeklyMon:!1,weeklyTus:!1,weeklyWen:!1,weeklyThu:!1,weeklyFri:!1,monthlyDayOf:1,monthlyRecurs:1,dailyFrequency:"once",dailyFrequencyAtHour:"1200",dailyFrequencyRecur:1,dailyFrequencyRecurType:"hour",dailyFrequencyStart:"1200",dailyFrequencyStop:"2359"}),e.schedule=a.schedule},e.addUser=function(a){function b(){a.userList&&0!=a.userList.length||(a.userList=e.serverUserList.map(function(a){return{name:a.name,id:a.id,username:a.username}})),e.userList=a.userList}e.serverUserList?b():c.get(app.urlPrefix+"Account/GetUsers").then(function(a){e.serverUserList=a.data.list,b()})},e.addRole=function(a){function b(){a.roleList&&0!=a.roleList.length||(a.roleList=e.serverRoleList.map(function(a){return{name:a.name,id:a.id}})),e.roleList=a.roleList}e.serverRoleList?b():c.get(app.urlPrefix+"Account/GetRoles").then(function(a){e.serverRoleList=a.data.list,b()})},e.changeItem=function(c,d){var f=a.extend({},c.rules[d]);app.indicator(e.model.series,f,function(a,e){b(function(){c.rules[d]=a},0)},[])},e.toggleSelectedSeries=function(a,b){a.selectedSeries||(a.selectedSeries=[]);var c=a.selectedSeries.indexOf(b);c==-1?a.selectedSeries.push(b):a.selectedSeries.splice(c,1)},e.persian=function(a){return persian(a)},e.mapOp={1:"برابر باشد با",2:"برابر نباشد با",3:"بزرگتر باشد از",4:"بزرگتر يا مساوي باشد از",5:"کوچکتر باشد از",6:"کوچکتر يا مساوي باشد از",7:"شامل",8:"نباشد شامل"}}],link:function(){app.lang.setLang()}}}])}(jQuery),function(a){var b=angular.module("management");b.filter("filterCalculateFields",function(){return function(a,b){for(var c=[],d=0;d<a.length;d++)d<b&&c.push(a[d]);return c}}),b.directive("calculateFields",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/calculateField.html?v="+Math.random(),scope:{calculatedFields:"="},controller:["$scope","$mdDialog","$mdMedia",function(b,c,d){b.refreshChart=function(a){b.$parent.refreshChart(a)};var e=-1;b.add=function(a){e=-1,b.currentFormula={},b.showDialog(a)},b.edit=function(a,c){e=a,b.currentFormula={name:b.calculatedFields.fields[a].name,formula:b.calculatedFields.fields[a].formula},b.showDialog(c)},b.calculatedFields=b.calculatedFields||{},b.calculatedFields.fields=b.calculatedFields.fields||[],b.save=function(){if(!b.currentFormula.name)return alert("فیلد نام نمی تواند خالی باشد"),!1;var a=_.some(b.calculatedFields.fields,function(a){return a.name.trim()==b.currentFormula.name.trim()})||_.some(b.$parent.ngModel.series,function(a){return a.trim()==b.currentFormula.name.trim()});return!a||e!=-1&&b.calculatedFields.fields[e].name==b.currentFormula.name?(e==-1?b.calculatedFields.fields.push({name:b.currentFormula.name,formula:b.currentFormula.formula}):(b.calculatedFields.fields[e].name=b.currentFormula.name,b.calculatedFields.fields[e].formula=b.currentFormula.formula),!0):(alert("نام انتخابی تکراری است"),!1)},b.showDialog=function(e){c.show({controller:["$scope","$mdDialog",function(c,d){c.parent=b,c.cancel=function(){d.cancel()},c.save=function(){c.parent.save()&&(c.parent.refreshChart(),d.cancel())},c.addColumn=function(b,d){c.parent.currentFormula.formula||(c.parent.currentFormula.formula=""),c.parent.currentFormula.formula+=" {R+0, ["+b+"]} ",a(".formula-input").focus()}}],templateUrl:"editor/calc/calc-fields-modal.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:d("sm")||d("xs")})}}],link:function(){app.lang.setLang()}}})}(jQuery),function(a){var b=angular.module("management");b.directive("dimMeasWhere",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/dimMeasWhere.html?v="+app.version,scope:{dimensions:"=",measures:"=",where:"=",datasource:"=",model:"=?model"},controller:["$scope","$mdDialog","$mdMedia","$timeout",function(a,b,c,d){a.model=a.model||{},a.model.selectedDimension=0,a.model.selectedMeasure=0,a.model.selectedwhere=0,a.tConfig={format:!0,font:!1,bold:!1,size:!1,color:!1,align:!1},a.addFormula=function(a){a.formulas=a.formulas||[],a.formulas.push({})},a.changeFormula=function(a){a.members=null},a.change=function(){d(function(){a.$parent.refreshChart()},1)},a.addLabel=function(){a.dimensions[a.model.selectedDimension].detail.histogramCategory.customLabels.push({name:""})},a.refreshChart=function(b){a.$parent.refreshChart(b)},a.$watch("datasource",function(b){b&&(a.dimentionWithNone=[{UniqueName:"NONE",Name:"خودش"},{UniqueName:"CUSTOM_FORMULA",Name:"سفارشی ..."}].concat(b.CubeInfo.Dimensions[0].Hierarchies))},!0),a.changeDimensionName=function(b,c){var d=c.Name,e=a.dimensions.concat(a.measures).concat(a.where).map(function(a){return a.Name})||[],f=e.filter(function(a){return a===d}).length>1;f?(c.Name=b,setTimeout(function(){alert("نام انتخاب شده تکراری است")},0)):a.refreshChart()},a.changeMeasureAggregation=function(b){var c=a.measures[+b].aggregation,d=a.measures[+b],e=d.Formula?d.Formula:d.UniqueName;"NONE"==c?d.formula=e:d.formula=c+"("+e+")",a.changeFormula(a.measures[+b])},a.showDialog=function(c,d,e){var f=c;b.show({controller:["$scope","$mdDialog",function(b,d){function g(a,c){a.renderer.setPadding(18),i=a.getSession(),b.insertFormula=function(b){a.insert(b),a.focus()}}b.parent=a;var h;switch(c){case"dimention":b.formula=a.dimensions[a.model.selectedDimension].formula;break;case"measure":b.formula=e.formula,h=e;break;case"where":b.formula=a.where[a.model.selectedwhere].formula}b.aceOption={useWrapMode:!0,showGutter:!1,theme:"sqlserver",mode:"sqlserver",maxLines:14,onLoad:g,require:["ace/ext/beautify"]};var i;b.aceOption.onChange=function(a){b.formula=i.getValue()},b.cancel=function(){d.cancel()},b.save=function(){switch(f){case"dimention":a.dimensions[a.model.selectedDimension].formula=b.formula;break;case"measure":h.formula=b.formula;break;case"where":a.where[a.model.selectedwhere].formula=b.formula}d.cancel()}}],templateUrl:"editor/formula/edit.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:!1,fullscreen:!0})}}],link:function(){app.lang.setLang()}}})}(jQuery),function(a){var b=angular.module("management");b.directive("filterExcept",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/filterExcept.html?v="+app.version,scope:{datasource:"=",filterException:"="},controller:["$scope","$mdDialog","$mdMedia",function(a,b,c){a.refreshChart=function(b){a.$parent.refreshChart(b)},a.toggleAllToList=function(b){a.filterException.allFields=a.filterException.allFields||[];var c=a.filterException.allFields.indexOf(b.UniqueName);c!=-1?a.filterException.allFields.splice(c,1):(a.filterException.allFields.push(b.UniqueName),a.filterException.fields=_.reject(a.filterException.fields,function(a){var c="\\[id"+b.UniqueName+"\\]";return new RegExp(c).test(a.UniqueName)}))},a.toggleToList=function(b){a.filterException.fields=a.filterException.fields||[];var c=_.filter(a.filterException.fields,{Name:b.Name,UniqueName:b.UniqueName});c.length?c.forEach(function(b){a.filterException.fields.splice(_.indexOf(a.filterException.fields,b),1)}):a.filterException.fields.push({Name:b.Name,UniqueName:b.UniqueName})},a.isInList=function(b){return _.filter(a.filterException.fields,{UniqueName:b.Name,UniqueName:b.UniqueName}).length},a.getDatasourceName=function(b){var c=_.find(a.datasource.CubeInfo.Dimensions,function(a){return a.UniqueName==b});return c?c.Name.replace(/as id\d+/gi,""):""},a.showDialog=function(d){b.show({controller:["$scope","$mdDialog",function(b,c){b.parent=a,b.cancel=function(){c.cancel()}}],templateUrl:"editor/filter-except/select-except-modal.html",parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:!1,fullscreen:c("sm")||c("xs")})}}],link:function(){app.lang.setLang()}}})}(jQuery),function(a){var b=angular.module("management");b.service("myService",["$http",function(a){var b=null;this.getMenus=function(){return null==b&&(b=a.get(app.urlPrefix+"api/menus/get")),b}}]),b.factory("myFactory",function(){return{sayHello:function(a){return"Hi "+a+"!"}}}),b.directive("generalSettings",["myService","myFactory",function(a,b){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/generalSettings.html?v="+app.version,scope:{apiKey:"=",model:"=ngModel",props:"=",change:"&ngChange"},controller:["$scope",function(b){b.menus=[],b.ff=function(){b.change()},b.license=app.license,b.model.exportApiParams=b.model.exportApiParams||[{columns:[{}]}],b.prefix=window.location.origin+app.urlPrefix,a.getMenus().then(function(a){var c=a.data;0===c.filter(function(a){return+a.id===-1}).length,b.menus=c},function(){b.error="خطا در دریافت اطلاعات"})}],link:function(){app.lang.setLang()}}}]),b.directive("selectKpi",[function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/selectKpi.html?v="+app.version,scope:{model:"=ngModel",change:"&ngChange"},controller:["$scope",function(a){a.addExtraKpi=function(){a.model.extraKpi.push({})},a.removeExtraKpi=function(b){a.model.extraKpi.splice(b,1)}}],link:function(b,c,d){app.lang.setLang(),a(c).find(".ui.button.font-popup").popup({popup:a(c).find(".ui.popup"),transition:"scale",on:"click"})}}}])}(jQuery),function(a){var b=angular.module("management");b.directive("globalVariable",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/globalVariable.html?v="+app.version,scope:{dimensions:"=",measures:"=",prop:"="},controller:["$scope",function(a){}],link:function(){app.lang.setLang()}}})}(jQuery),function(a){var b=angular.module("management");b.directive("numberFormat",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/numberFormat.html?v="+app.version,scope:{model:"=ngModel"},controller:["$scope",function(b){b.model=a.extend({formatString:",.2f",formatStringCustom:",.2f"},b.model),b.refreshChart=function(a){b.$parent.refreshChart(a)}}],link:function(){app.lang.setLang()}}})}(jQuery),function(a){var b=angular.module("management");b.directive("textEditor",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/textEditor.html?v="+app.version+new Date,scope:{model:"=prop",sonChange:"&?onChange","default":"=?",config:"=?"},controller:["$scope","$timeout",function(a,b){a.config=_.merge({format:!0,bold:!0,size:!0,font:!0,color:!0,align:!0,rotate:!1,anchor:!1,position:!1},a.config),a.model=_.merge({bold:!1,color:"#333333",align:"right",italic:!1,fontSize:"12px",fontName:"IRANSans",formatString:",.2f",formatStringCustom:",.2f",rotate:0,anchor:"end",position:"end"},a["default"]||{},a.model),a.onChange=function(){b(function(){a.sonChange()},0)}}],link:function(b,c,d){app.lang.setLang(),a(c).find(".ui.button.font-popup").popup({popup:a(c).find(".ui.popup"),transition:"scale",on:"click"})}}})}(jQuery),function(a){var b=angular.module("management");b.directive("generalCustomControl",function(){return{templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/generalControl.html?v="+app.version,scope:{parent:"=?",item:"=?",change:"&?"},controller:["$scope",function(a){a.onchange=function(b){if(a.item.onchange){var c=b||a.parent[a.item.key];a.item.onchange(c,a.parent,a.item)}a.change()}}]}})}(jQuery),function(a){var b=angular.module("management");b.directive("dimentionColorSelector",function(){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/dimentionColorSelector.html?v="+app.version,scope:{model:"=ngModel",dimColor:"=",ngChange:"&?"},controller:["$scope","$timeout",function(a,b){a.model=a.model||{enable:!1,palette:"1",data:{}},a.colorSet=function(b){var c=d3.scaleOrdinal(d3.schemeCategory10);switch(+a.model.palette){case 2:c=d3.scaleOrdinal(d3.schemeBrBG[11]);break;case 3:c=d3.scaleOrdinal(d3.schemePuOr[11]);break;case 4:c=d3.scaleOrdinal(d3.schemeRdGy[11])}var d=0;_.each(a.model.data,function(a){a.color&&!b||(a.color=c(d)),d++})},a.$watch("dimColor",function(b){if(_.isObject(a.model)||(a.model={}),a.model=a.model||{enable:!1,palette:"1"},a.model.data=a.model.data||{},b)for(var c in b)a.model.data[c]=a.model.data[c]||b[c];a.colorSet(!1)},!0),a.clear=function(){a.model.data={},a.dimColor={},a.ngChange()}}]}})}(jQuery),function(a){var b=angular.module("management");b.directive("mapSelector",["$timeout",function(b){return{restrict:"E",scope:{model:"=prop"},controller:["$scope","$http","$mdDialog","$mdMedia",function(b,c,d,e){b.model=a.extend({selectedMap:"1"},b.model),b.refreshList=function(){b.list=null,b.getList()},b.getList=function(){b.list||c.get(app.urlPrefix+"api/Map/GetList").then(function(a){a.data.result&&(b.list=a.data.list)})},b.getList(),b.showUploadDialog=function(c){d.show({controller:["$scope","$mdDialog","$timeout","$mdToast",function(c,d,e,f){c.parent=b,c.cancel=function(){d.cancel()},c.selectFile=function(){a("#file-upload[type=file]").click()},c.upload=function(){function b(){e(function(){var a=f.simple().textContent("آپلود ناموفق بود");f.show(a)},0)}if(!c.name||!c.file){var g=f.simple().textContent("نام و فایل نقشه را وارد کنید");return void f.show(g)}var h=new FormData;h.append("file",c.file),h.append("name",c.name);var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&e(function(){var a=JSON.parse(i.response);console.log("map data",a),c.parent.list.push({id:a.id,name:a.name})},0)},i.upload.addEventListener("load",function(){e(function(){d.cancel();var a=f.simple().textContent("آپلود با موفقیت انجام شد");f.show(a)},0)}),i.upload.addEventListener("error",b),i.upload.addEventListener("abort",b),i.open("POST",app.urlPrefix+"api/Map/Upload");var j=a("input[name=__RequestVerificationToken]").val();i.setRequestHeader("__RequestVerificationToken",j),i.send(h)},c.d3=d3}],templateUrl:"editor/map/upload-map.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:e("sm")||e("xs")})},b.showEditDialog=function(a){d.show({controller:["$scope","$mdDialog","$timeout","$mdToast",function(a,d,e,f){a.parent=b,a.cancel=function(){d.cancel()},a.remove=function(b,d){var e=confirm("آیا برای حذف اطمینان دارید؟");e&&(b.progressRemove=!0,c.post(app.urlPrefix+"api/Map/remove/"+b.id).then(function(c){b.progressRemove=!1,a.parent.list.splice(d,1)})["catch"](function(){b.progressRemove=!1,alert("عملیات ناموفق")}))},a.edit=function(a,b){a.progressEdit=!0,c.post(app.urlPrefix+"api/Map/edit",a).then(function(b){a.progressEdit=!1,a.change=!1})["catch"](function(){a.progressEdit=!1,alert("عملیات ناموفق")})}}],templateUrl:"editor/map/edit-map.html",parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:e("sm")||e("xs")})}}],templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/types/mapSelector.html?v="+app.version}}])}(jQuery),function(a){var b=angular.module("management");b.directive("tableIndicator",["$timeout",function(a){return{restrict:"E",scope:{prop:"=",dimensions:"=",measures:"=",config:"="},controller:["$scope","$http",function(a,b){a.prop[a.config.name]&&(a.prop[a.config.name].indicator=a.prop[a.config.name].indicator||[],a.model=a.prop[a.config.name].indicator,a.change=function(){a.$parent.refreshChart("refresh")},a.changeItem=function(a){},a.copy=function(a,b){var c=angular.copy(a[b]);a.splice(b,0,c)})}],link:function(){app.lang.setLang()},templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/types/tableIndicator.html?v="+app.version}}])}(jQuery),function(a){var b=angular.module("management");b.directive("userControlVariableRelation",["$timeout",function(b){return{restrict:"E",scope:{prop:"=",dimensions:"=",measures:"=",type:"="},controller:["$scope","$http",function(a,c){a.$parent.dereg&&a.$parent.dereg(),a.$parent.mdereg&&a.$parent.mdereg(),a.$parent.dereg=a.$watch("dimensions",function(b,c){a.prop[a.type].info.dimensions=a.dimensions},!0),a.$parent.mdereg=a.$watch("measures",function(b,c){a.prop[a.type].info.measures=a.measures},!0),a.list||c.get(app.urlPrefix+"api/GlobalVariable/GetList").then(function(b){b.data.unshift({Id:"-1",Name:"NONE"}),a.list=b.data}),a.AddGlobalVariables=function(){app.globalVariableHelper.AddGlobalVariables(function(c){b(function(){a.list.push({Id:c.Id,Name:c.Name}),a.prop[a.type].info.variableId=c.Id+""},0)})}}],templateUrl:app.urlPrefix+"dist/partial/management/charts/directives/types/variableRelation.html?v="+app.version,link:function(c,d,e){var f=e.selector;angular.element(a(f)).bind("default-value",function(a,d,e,f,g){b(function(){c.prop[c.type].info.variableDefault={values:e,type:f,valuesCaption:g}},0)}),app.lang.setLang()}}}])}(jQuery);var ngApp=angular.module("management");ngApp.controller("datasourcefileCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$window","$sce","datasources",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc))}function m(a){c.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}function n(b){a.sheets=b.result.list,a.savedFileName=b.result.savedFileName,a.filename=b.result.filename,a.sheetName=a.sheets[0],a.changeSheet()}function o(b){var c="",d=_.map(b,function(a,b){return"<tr>"+_.map(a,function(a){return 0===b?"<th>"+filterXSS(a)+"</th>":"<td>"+filterXSS(a)+"</td>"}).join("")+"</tr>"}).join("");c='<table class="table">'+d+"</table>",a.testResult=j.trustAsHtml(c)}function p(){var a=$("#main-form").width();$("#testResult").css("max-width",a+"px"),$("#testResult").css("overflow","auto")}a.app=app;var q={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6};a.license=app.license;var r="undefined"!=typeof e.packageId?e.packageId:0,s="undefined"!=typeof e.id?e.id:0,t=(e.type,s>0);a.isEdit=t,a.id=s;var u=!1;t&&(b.get(app.urlPrefix+"api/datasources/GetInfo?type="+q.File+"&id="+s).then(function(b){a.name=b.data.name,a.modelType=b.data.modelType,a.keepHistory=b.data.keepHistory,u=b.data.keepHistory,a.metainfo=b.data.metainfo,a.sign=b.data.sign,a.tableName=b.data.tableName},l),b.get(app.urlPrefix+"api/Excel/Sample?id="+s).then(function(a){a.data?o(a.data):($("#queryResult").html(""),$("#test-result").removeClass().addClass("alert alert-danger").show().find("span").html("اشکال در دریافت اطلاعات").append('<p style="text-align: left;margin-top:7px;">'+filterXSS(a.error)+"</p>"))},l)),a.save=function(){if(a.error=null,!a.fileForm.$valid)return void m("فیلدهای ضروری باید پر شوند");a.testResult=null;var d=_.filter(a.roles,{check:!0}).map(function(a){return a.action+"-"+a.id});if(!a.keepHistory&&u){var e=confirm("در صورت ذخیره منبع داده، با توجه به عدم انتخاب گزینه نگهداری تاریخچه، رکوردهای قبلی پاک می‌شوند. آیا برای ادامه اطمینان دارید؟");if(!e)return}b.post(app.urlPrefix+"api/Excel/save",{SheetName:a.sheetName,savedFileName:a.savedFileName,filename:a.filename,DataSourceName:a.name,KeepHistory:a.keepHistory,Id:s,type:a.extention,PackageId:r,RolesActions:d,ModelType:a.modelType,metainfo:a.metainfo,AceProvider:a.aceProvider}).then(function(a){function b(){window.history.length<=2?f.path("/datasources/"+r):window.history.back()}var d=c.simple().textContent(t?"تغییرات ثبت شد":"منبع داده جدید ایجاد شد");c.show(d),b(),k.reset()},l)},a.extention="XLS",a.aceProvider="12",a.progress=-1,a.changeSheet=function(){b.get(app.urlPrefix+"api/Excel/data?file="+a.savedFileName+"&name="+a.filename+"&sheetName="+encodeURIComponent(a.sheetName)+"&AceProvider="+a.aceProvider).then(function(b){b.data?o(b.data):a.error=j.trustAsHtml("اشکال در دریافت اطلاعات")})},$("#input-file-id").fileupload({dataType:"json",url:app.urlPrefix+"api/Excel/UploadFiles",autoUpload:!1,done:function(a,b){h(function(){switch(b.formData.type){case"XLS":n(b);break;case"CSV":o(b.result);break;case"XML":}},0)},add:function(b,c){h(function(){a.uploadData=c,a.fileName=j.trustAsHtml(filterXSS(c.files[0].name+"<br><sub><b>حجم:</b> "+(c.files[0].size/1024).toFixed(2)+" KB</sub>"));var b=c.files[0].name.match(/\.[^.]+$/);if(null!==b){var d=b[0];".xlsx"!==d&&"xls"!==d||(a.extention="XLS"),".csv"===d&&(a.extention="CSV"),".xml"===d&&(a.extention="XML")}},0)},error:function(b,c){h(function(){a.error=j.trustAsHtml(filterXSS('<div class="ltr"><b>'+b.responseJSON.title+"</b> <br/>"+b.responseJSON.desc+"</div>"))},0)}}).on("fileuploadprogressall",function(b,c){var d=parseInt(c.loaded/c.total*100,10);h(function(){a.progress=d},0)}),a.uploadData,a.upload=function(){a.error=null,a.testResult=null,a.uploadData.formData={type:a.extention,aceProvider:a.aceProvider},a.uploadData.submit(),a.progress=0,p()}}]);var ngApp=angular.module("management"),ngApp=angular.module("management");ngApp.service("interRelation",["$http",function(a){var b,c=function(){return b=a.get(app.urlPrefix+"api/datasourceInterRelation/get")};return{get:c,reset:function(){b=null}}}]),ngApp.controller("interRelationCtrl",["$scope","$http","$mdToast","$mdDialog","$translate","interRelation","$mdMedia","utils","toolbar",function(a,b,c,d,e,f,g,h,i){function j(b){d.show({controller:["$scope","$mdDialog","$timeout",function(b,c,d){b.parent=a,b.cancel=function(){c.cancel()},b.parent.cancel=b.cancel,b.change=function(a,b){}}],parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:g("sm")||g("xs"),templateUrl:"datasourceRelation/add-relation.html"})}a.utils=h,e("interRelation").then(function(a){i.setTitles([{name:a,click:null}])}),a.progress=!0,f.get().then(function(b){a.progress=!1,a.data=b.data.list.map(function(a){var b=JSON.parse(a.data);return b.conditions.forEach(function(a){if("string"==typeof a.left){var b=a.left;a.left={column:b,isText:!1,formula:null},a.op="="}if("string"==typeof a.right){var b=a.right;a.right={column:b,isText:!1,formula:null}}}),b.id=a.id,b}),a.getList(function(){a.modalRelationObject={conditions:[{}],left:-1,right:-1}})}),a.modalRelationObject={conditions:[{}],left:0,right:0},a.$watch("modalRelationObject",function(a,b){console.log(a,b)},!0),a.datasourceChange=function(){console.log("setSelected")};var k=!0;a.getList=function(c){k?(k=!1,b.get(app.urlPrefix+"api/JoinDataSource/GetDatasourceList").then(function(b){a.datasourceList=b.data,c&&c()})):c&&c()},a.add=function(c){return 0==a.modalRelationObject.conditions.length?(alert("حداقل یک رابطه تعریف کنید"),!1):(a.modalRelationObject.name=a.datasourceList.filter(function(b){return+a.modalRelationObject.left==b.Id})[0].Name+" - "+a.datasourceList.filter(function(b){return+a.modalRelationObject.right==b.Id})[0].Name,a.addProgress=!0,a.error=null,void b.post(app.urlPrefix+"api/DatasourceInterRelation/Save",JSON.stringify(a.modalRelationObject),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){a.addProgress=!1;var c=b.data;if(c.result){if(a.modalRelationObject.id){var d=a.data.filter(function(b){return b.id===a.modalRelationObject.id})[0];d=angular.extend({},a.modalRelationObject)}else a.modalRelationObject.id=c.id,a.data.splice(a.data.length,0,a.modalRelationObject);a.cancel()}else a.error=$sce.trustAsHtml(filterXSS(c.message))})["catch"](function(b){a.addProgress=!1,a.error=$sce.trustAsHtml(filterXSS(b.data.title))}))},a.cancel=function(){},a["new"]=function(b){a.modalRelationObject={conditions:[{op:"="}],left:0,right:0},j(b)},a.edit=function(b,c){a.modalRelationObject=c,j(b)},a["delete"]=function(e){var f=app.urlPrefix+"api/DatasourceInterRelation/Delete",g=_.filter(a.data,{select:!0}).map(function(a){return a.id}),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){if(b.data.deleted&&(a.data=_.filter(a.data,function(a){return b.data.deleted.indexOf(a.id)===-1})),b.data.errors&&b.data.errors.length)c.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+b.data.errors.join("\n")+"</span></md-toast>",hideDelay:3e3,position:"bottom left"});else{
var d=c.simple().textContent("حذف انجام شد");c.show(d)}})})},a.selectedCount=function(){return console.log("### selectedCount"),_.filter(a.data,{select:!0}).length},a.selectAll=function(){console.log("### selectedCount1"),_.forEach(a.data,function(b){b.select=a.selectAllCheckbox})},a.restore=function(b){console.log("### selectedCount2"),a.modalRelationObject=b},a.getLastFocus=function(b){console.log("### selectedCount4"),a.lastFocus=b.target;var c=b.target;if(c)if("selectionStart"in c)a.selectionStart=c.selectionStart,a.selectionEnd=c.selectionEnd;else if(document.selection){c.focus();var d=document.selection.createRange(),e=document.selection.createRange().text.length;d.moveStart("character",-c.value.length),a.selectionStart=d.text.length-e}},a.addFormula=function(b,c){$(a.lastFocus).focus();var d=$(a.lastFocus).val(),e="[id"+c+"].["+b+"]",f=0;d=d.substring(0,a.selectionStart)+d.substring(a.selectionEnd,d.length);var g=d.substring(0,a.selectionStart)+e+d.substring(a.selectionStart,d.length);$(a.lastFocus).val(g);var h=$(a.lastFocus).get(0);h.setSelectionRange(a.selectionStart+f,a.selectionStart+f),a.selectionStart=a.selectionStart+f,a.selectionEnd=a.selectionStart}}]),ngApp.filter("filterColumns",function(){return function(a,b,c,d){if(console.log("### selectedCount5"),a){var e=b.map(function(a){return c?a.left:a.right}).filter(function(a,b){return a!=-1&&b!=+d});return a.filter(function(a){return e.indexOf(a)==-1})}}});var ngApp=angular.module("management");ngApp.controller("datasourceJoinCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$window","$sce","$mdMedia","utils","datasources",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){a.saveProgress=!1,a.testProgress=!1,a.error=j.trustAsHtml(filterXSS("<b>"+b.data.title+"</b> <br/>"+b.data.desc))}function o(){2==window.history.length?f.path("/datasources/"+s):window.history.back()}function p(){return{id:t,isEdit:u,name:a.name,disable:a.disable,disableMessage:a.disableMessage,selectedDs:a.selectedDatasource.map(function(a){return a.Id}),selectedFields:a.selectedFields,relationsList:a.relationsList.map(function(a){return{left:a.left,right:a.right,includeRight:a.includeRight,includeLeft:a.includeLeft,repeatRows:a.repeatRows,conditions:a.conditions.map(function(a){return{left:a.left,right:a.right,op:a.op}})}}),script:a.script,relationType:a.relationType,aliasArray:JSON.stringify(a.aliasArray),isSchedule:a.isSchedule,schedule:a.schedule,partitions:a.partitions}}function n(b){a.saveProgress=!1,a.testProgress=!1,a.scriptProgress=!1,a.error=j.trustAsHtml("<b>"+filterXSS(b.data.title)+"</b> <br/>")}function q(a,b){return d.show({controller:["$scope","$mdDialog","$timeout",function(a,c,d){function e(b,c){b.renderer.setPadding(18),a.insertFormula=function(a){b.insert(a),b.focus()}}a.cancel=function(){c.cancel()},a.save=function(){c.hide(a.formula)},b&&(a.formula=b),a.aceOption={useWrapMode:!0,showGutter:!1,theme:"sqlserver",mode:"sqlserver",maxLines:14,onLoad:e,require:["ace/ext/beautify"]}}],parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:!0,template:'<md-dialog aria-label="{{\'editor\' | translate}}" ng-cloak class="fullscreen-dialog">                                 <md-toolbar>                                                                                                                            <div class="md-toolbar-tools">                                                                                                          <h2>{{\'editor\' | translate}}</h2>                                                                                                   <span flex></span>                                                                                                                  <md-button class="md-icon-button" ng-click="cancel()">                                                                                  <span class="material-icons">close</span>                                                                                       </md-button>                                                                                                                    </div>                                                                                                                          </md-toolbar>                                                                                                                       <md-dialog-content layout-margin flex layout="row" class="md-dialog-contentx">                                                          <style>                                                                                                                                 .ace_editor {                                                                                                                           border: 1px solid #efefef;                                                                                                      }                                                                                                                                                                                                                                                                           .ace_editor, .ace_editor div {                                                                                                          font: 16px/normal \'Courier New\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;                              }                                                                                                                                                                                                                                                                   md-dialog.fullscreen-dialog {                                                                                                           max-width: 100%;                                                                                                                    max-height: 100%;                                                                                                                   width: 100%;                                                                                                                        height: 100%;                                                                                                                       border-radius: 0;                                                                                                               }                                                                                                                               </style>                                                                                                                                                                                                                                                                <div class="ltr" flex="100" ui-ace="aceOption" ng-model="formula">                                                                      select * from tbl_meuns                                                                                                         </div>                                                                                                                                                                                                                                                              </md-dialog-content>                                                                                                                <md-dialog-actions layout="row">                                                                                                        <md-button ng-click="save()">                                                                                                           {{ \'ذخیره\' | translate }}                                                                                                        </md-button>                                                                                                                        <md-button ng-click="cancel()">                                                                                                         {{ \'cancel\' | translate }}                                                                                                      </md-button>                                                                                                                    </md-dialog-actions>                                                                                                            </md-dialog>'})}var r={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6};a.utils=l,a.license=app.license,a.app=app;var s="undefined"!=typeof e.packageId?e.packageId:0,t="undefined"!=typeof e.id?e.id:0,u=(e.type,t>0);a.isEdit=u,a.id=t,a.model={},u&&b.get(app.urlPrefix+"api/datasources/GetInfo?type="+r.JoinDatasource+"&id="+t).then(function(b){a.restore(b.data.model,b.data.list),a.sign=b.data.sign},n);var v=!1;a.isSchedule=!1,a.selectedDatasource=[],a.selectedFields=[],a.relationsList=[],a.relationType="QUERY";var w=function(c){return a.datasourceListPromise||(a.datasourceListPromise=b.get(app.urlPrefix+"api/JoinDataSource/GetDatasourceList")),a.datasourceListPromise};a.select=function(b){d.show({controller:["$scope","$mdDialog",function(b,c){w().then(function(c){a.datasourceList=c.data,b.datasourceList=c.data,_.forEach(b.datasourceList,function(a){a.check=!1})}),b.select=function(){_.filter(b.datasourceList,{check:!0}).forEach(function(b){a.addItemToDatasource(b.Id)}),c.hide()},b.cancel=function(){c.cancel()}}],templateUrl:"join/datasource_select.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:k("sm")||k("xs")})},a.exploreDatasource=function(c,e){d.show({controller:["$scope","$mdDialog",function(d,e){d.exploreError=null,d.explor=null,b.post(app.urlPrefix+"api/JoinDataSource/ExploreDatasource",JSON.stringify({Id:a.selectedDatasource[c].Id}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(a){d.exploreError=null;var b=_.map(a.data.datasourceExplore,function(a,b){return"<tr>"+_.map(a,function(a){return 0==b?"<th>"+a+"</th>":"<td>"+a+"</td>"}).join("")+"</tr>"}).join("");d.explor=j.trustAsHtml('<table class="table">'+filterXSS(b)+"</table>")},function(b){a.exploreError=j.trustAsHtml(filterXSS(b.data.title+"<br/>"+b.data.desc))}),d.cancel=function(){e.cancel()}}],templateUrl:"join/datasource_explor.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:k("sm")||k("xs")})},a.showRelationDialog=function(b){d.show({controller:["$scope","$mdDialog",function(b,c){b.$scope=a,b.cancel=function(){a.cancelItemtoRelationsList(),c.cancel()},b.ok=function(){a.addItemtoRelationsList(),c.hide()}}],templateUrl:"join/datasource_add_relation.html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:k("sm")||k("xs")})},a.addItemToDatasource=function(b){var c=a.selectedDatasource.filter(function(a){return a.Id.replace(/(\d+)-\d+/,"$1")==b}).length,d=a.datasourceList.filter(function(a){return a.Id==b});if(d&&d.length>0){for(var e=[],f=0;f<d[0].PartitionCount;f++)e.push({index:f,check:!0});a.selectedDatasource.push({Id:d[0].Id+"-"+c,Name:d[0].Name+(c>0?" شماره"+c:""),Fields:d[0].Fields,Partitions:e})}},a.removeSelectedDatasource=function(b){var c=a.selectedDatasource[b];a.selectedDatasource.splice(b,1),a.relationsList=a.relationsList.filter(function(a){return a.left!=c.Id&&a.right!=c.Id}),a.selectedFields=a.selectedFields.filter(function(a){var b=a.split(",");return b[0]!=c.Id})},a.persian=function(a){return persian(a)},a.aliasArray={},a.toggleSelectedFields=function(b){var c=a.selectedFields.indexOf(b);c>-1?a.selectedFields.splice(c,1):a.selectedFields.push(b)},a.toggleSelectedFieldsCheckAll=function(b,c){for(var d=$(c.target).prop("checked"),e=0;e<b.Fields.length;e++){var f=b.Id+","+e,g=a.selectedFields.indexOf(f);g>-1&&!d&&a.selectedFields.splice(g,1),g==-1&&d&&a.selectedFields.push(f)}},a.addRelationLimit=function(){a.modalRelationObject.conditions.push({left:0,op:"=",right:0})},a.removeRelationLimit=function(b){a.modalRelationObject.conditions.splice(b,1)},a.addItemtoRelationsList=function(){v||a.relationsList.push(a.modalRelationObject),a.cancelItemtoRelationsList()},a.cancelItemtoRelationsList=function(){v=!1,a.modalRelationObject={conditions:[{left:0,op:"=",right:0}],left:"0",right:"0",includeRight:!0,includeLeft:!0,repeatRows:!1}},a.editRelation=function(b){v=!0,$("#add-relation-modal").modal("show"),a.modalRelationObject=a.relationsList[b]},a.cancel=function(){o()},a.deleteDatasource=function(a){$(a.target).button("loading");var c=$("#datasource-id").val();b.post(app.urlPrefix+"api/JoinDataSource/Delete",JSON.stringify({id:c}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){$(a.target).button("reset"),b.data.result&&app.router.navigate("Moderation/DataSource/index/",{trigger:!0})})},a.restore=function(b,c){a.isEdit=!0,a.datasourceList=c,b.selectedDs=b.selectedDs||[],c.forEach(function(c){for(var d=b.selectedDs.filter(function(a){return+a.replace(/(\d+)-\d+/,"$1")==+c.Id}),e=0;e<d.length;e++){for(var f=d[e],g=+f.replace(/(\d+)-(\d+)/,"$2"),h=[],e=0;e<c.PartitionCount;e++)h.push({index:e,check:!0});var i={Id:f,Name:c.Name+(g>0?" شماره"+g:""),Fields:c.Fields,Partitions:h};a.selectedDatasource.push(i)}}),a.selectedFields=b.selectedFields||[],a.relationsList=b.relationsList||[],a.name=b.name,a.modelType=b.modelType,a.disable=b.disable,a.disableMessage=b.disableMessage,a.script=b.script,a.relationType=b.relationType,a.aliasArray=JSON.parse(b.aliasArray),a.isSchedule=b.isSchedule,a.schedule=b.schedule,a.partitions=b.partitions||[]},a.saveJoin=function(c){var d=p();d.packageId=s,d.RolesActions=_.filter(a.roles,{check:!0}).map(function(a){return a.action+"-"+a.id}),d.modelType=a.modelType,a.saveProgress=!0,b.post(app.urlPrefix+"api/JoinDataSource/SaveRelation",JSON.stringify(d),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){a.saveProgress=!1,a.error=null,o(),m.reset()},n)},a.getScript=function(c){var d=p();a.scriptProgress=!0,b.post(app.urlPrefix+"api/JoinDataSource/GetScript",JSON.stringify(d),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){a.scriptProgress=!1,b.data.result?(a.script=b.data.script,a.error=null):a.error=j.trustAsHtml(filterXSS(b.data.message))})},a.test=function(c){var d=p();a.testProgress=!0,b.post(app.urlPrefix+"api/JoinDataSource/Test",JSON.stringify(d),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){var c=b.data;a.testProgress=!1,c.result?(a.testResult=c.queryResult,a.error=null):a.error=j.trustAsHtml(filterXSS(c.message))})},a.modalRelationObject={conditions:[{left:0,op:"=",right:0}],left:"0",right:"0",includeRight:!0,includeLeft:!0,repeatRows:!1},a.showDialog=function(b){q(b,a.script).then(function(b){a.script=b})}}]);var ngApp=angular.module("management");ngApp.controller("datasourceListCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate","datasources","utils","toolbar","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){var c=new Date;a.progress=!1,a.securityCertPatch=b.data.securityCertPatch,a.allData=b.data.list,a.pageCount=40,a.page=1,a.maxPage=Math.ceil(a.allData.length/a.pageCount),a.setPage=function(b){a.page=b,a.data=a.allData.slice((a.page-1)*a.pageCount,a.page*a.pageCount)},a.setPage(1),i("لیست منابع داده").then(function(c){a.listTranslate=c,b.data.path.unshift({name:c,id:null}),a.path=b.data.path.map(function(b){return b.click=function(){a["goto"]({type:1,id:b.id})},b}),l.setTitles(a.path)}),h(function(){console.log("Process time: "+(new Date-c))},0)}function o(){return _.map(_.filter(a.data,{select:!0}),function(a){return[a.id,a.type]})}function p(b){var c=_.lastIndexOf(a.data.map(function(a){return a.type}),1);c==-1?a.data=b.concat(a.data):Array.prototype.splice.apply(a.data,[c+1,0].concat(b))}function q(b){a.data=_.filter(a.data,function(a){return!_.some(b,{id:a.id,type:a.type})})}function r(b){y=!1,a.timeDatasourceId=b.id,a.timeDatasourceName=b.name,a.timeDatasourceModelType=b.modelType,$(".datatime-modal").modal("show")}function s(a){k.showErrorToast(a.data.desc)}a.utils=k;var t="undefined"!=typeof e.id?e.id:0;a.app=app,a._=_;var u=t?"?packageId="+t:"",v=m.defer();a.progress=!0,b.get(app.urlPrefix+"api/datasources/get"+u,{timeout:v.promise}).then(function(a){n(a)},s),$(".ui.dimmer.modals .datatime-modal").remove();var w=function(){return _.some(a.data,{select:!0})};a.menuInvalidate=function(){console.log("#### menuInvalidate");var b=w(),c=_.filter(a.data,{select:!0,type:1}).length,d=_.filter(a.data,{select:!0,type:2}).length;a.canCopy=b,a.canDelete=b,a.canForward=b,a.canDirEdit=1==c&&0==d},a.copy=function(){var d=app.urlPrefix+"api/Datasources/Clone",e=o();b.post(d,e).then(function(b){if(b.data.result){b.data.datasources&&_.each(b.data.datasources,function(b){a.data.splice(_.findIndex(a.data,{type:2}),0,b)}),b.data.packages&&p(b.data.packages);var d=c.simple().textContent("کپی انجام شد");c.show(d)}},s)},a["delete"]=function(e){var f=app.urlPrefix+"api/Datasources/Delete",g=o(),h=d.confirm().title("حذف برای همیشه؟").textContent(g.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(e).ok("حذف!").cancel("لغو");d.show(h).then(function(){b.post(f,g).then(function(b){if(b.data.result){b.data.deletedIds&&q(b.data.deletedIds);var d=c.simple().textContent("حذف انجام شد");c.show(d),a.menuInvalidate()}},s)},function(){a.status="You decided to keep your debt."})},a.forward=function(a){j.select(a,{type:["datasources"],justDir:!0,selectableDir:!0,multipleChart:!1}).then(function(a){var d=a.selected[0];if(e.id==d.id){var f=c.simple().textContent("موارد انتخاب شده در همین پوشه هستند");return void c.show(f)}var g=o();b.post(app.urlPrefix+"api/datasources/MoveToPackage",{Ids:g,packageId:d.id}).then(function(a){q(a.data.ids);var b=c.simple().textContent("انتقال انجام شد");c.show(b)},s)})},a.dirEdit=function(b){var d=o();g.edit(b,2,d[0][0],function(b){_.find(a.data,{select:!0}).name=b.data.info.Name;var d=c.simple().textContent("نام پوشه تغییر کرد");c.show(d)},s)},a.newPackage=function(a){g.create(a,2,e.id,function(a){p([{id:a.data.info.Id,name:a.data.info.Name,type:1}]);var b=c.simple().textContent("پوشه جدید ایجاد شد");c.show(b),j.reset()},s)},a.insertChart=function(a,b){f.path("charts/new/normal/0/"+a.id)},a.gotoChart=function(a){f.path("charts/edit/0/"+a.id)},a["goto"]=function(a,b){var c={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6};if(4===a.systemType||1===a.systemType)return void alert("امکان ویرایش منابع داده سیستمی وجود ندارد");if(6===a.systemType)return void r(a);if(5===a.systemType)return void f.path("olap-tables"+(a.id?"/"+a.id:""));if(1===a.type&&f.path("datasources"+(a.id?"/"+a.id:"")),2==a.type)switch(a.dsType){case c.MySQL:f.path("datasources/add/mssql/"+c.MySQL+"/"+t+"/"+a.id);break;case c.MsOlap:f.path("datasources/add/mssql/"+c.MsOlap+"/"+t+"/"+a.id);break;case c.MSSQL:f.path("datasources/add/mssql/"+c.MSSQL+"/"+t+"/"+a.id);break;case c.File:f.path("datasources/add/file/"+t+"/"+a.id);break;case c.WebResource:f.path("datasources/add/web/"+t+"/"+a.id);break;case c.JoinDatasource:f.path("datasources/add/join/"+t+"/"+a.id)}},a.getTypeName=function(a){var b=1,c=2,d=3,e=4,f=5,g=6,h="";switch(+a){case b:h="MsOlap";break;case c:h="MSSQL";break;case d:h="MySQL";break;case e:h="File";break;case f:h="WebResource";break;case g:h="JoinDatasource"}return h};var x;a.$watch("search",function(){h.cancel(x),x=h(function(){"undefined"!=typeof a.search&&(a.progress=!0,null!==v&&v.resolve(),v=m.defer(),b.get(app.urlPrefix+"api/datasources/get?q="+a.search,{timeout:v.promise}).then(function(a){n(a)},s))},400)}),a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox}),a.menuInvalidate()},a.newDatasource=function(a){f.path("datasources/new/"+(e.id?e.id:""))};var y=!1;a.addTimeDatasoure=function(b){y=!0,i(["Create Time Datasource","Enter the datasource name.","name","ok","cancel"]).then(function(b){a.timeDatasourceId=0,a.timeDatasourceName=null,a.timeDatasourceModelType=0,$(".datatime-modal").modal("show")})},a.createDatatime=function(){a.timeDatasourceProgress=!0,b.get(app.urlPrefix+"api/datasources/createDatetimeDatasource?name="+a.timeDatasourceName+"&pId="+t+"&type="+a.timeDatasourceModelType+"&id="+a.timeDatasourceId).then(function(b){y?a.data.splice(_.findIndex(a.data,{type:2}),0,b.data):a.data.splice(_.findIndex(a.data,{type:2,id:b.data.id}),1,b.data),a.timeDatasourceProgress=!1,$(".datatime-modal").modal("hide")},function(){a.timeDatasourceProgress=!1,$(".datatime-modal").modal("hide"),alert("خطایی در ساخت منبع داده رخ داده است")})},a.sortDetail={},a.sort=function(b){a.sortDetail[b]=a.sortDetail[b]||{},a.sortDetail[b].isDesc=!a.sortDetail[b].isDesc;var c=_.filter(a.data,{type:1}),d=_.filter(a.data,{type:2});d=_.sortBy(d,[b]),c=_.sortBy(c,[b]),a.sortDetail[b].isDesc||(d=_.reverse(d),c=_.reverse(c)),a.data=c.concat(d)}}]);var ngApp=angular.module("management");ngApp.controller("datasourceMssqlCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$window","$sce","roles","datasources",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(b){a.error=j.trustAsHtml("<b>"+filterXSS(b.data.title)+"</b> <br/>")}function n(){2==window.history.length?f.path("/datasources/"+r):window.history.back()}function o(){$("md-content").animate({scrollTop:4e3},500)}function p(a,b){return d.show({controller:["$scope","$mdDialog","$timeout",function(a,c,d){function e(b,c){b.renderer.setPadding(18),a.insertFormula=function(a){b.insert(a),b.focus()}}a.cancel=function(){c.cancel()},a.save=function(){c.hide(a.formula)},b&&(a.formula=b),a.aceOption={useWrapMode:!0,showGutter:!1,theme:"sqlserver",mode:"sqlserver",maxLines:14,onLoad:e,require:["ace/ext/beautify"]}}],parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:!0,template:'<md-dialog aria-label="{{\'editor\' | translate}}" ng-cloak class="fullscreen-dialog">                                 <md-toolbar>                                                                                                                            <div class="md-toolbar-tools">                                                                                                          <h2>{{\'editor\' | translate}}</h2>                                                                                                   <span flex></span>                                                                                                                  <md-button class="md-icon-button" ng-click="cancel()">                                                                                  <span class="material-icons">close</span>                                                                                       </md-button>                                                                                                                    </div>                                                                                                                          </md-toolbar>                                                                                                                       <md-dialog-content layout-margin flex layout="row" class="md-dialog-contentx">                                                          <style>                                                                                                                                 .ace_editor {                                                                                                                           border: 1px solid #efefef;                                                                                                      }                                                                                                                                                                                                                                                                           .ace_editor, .ace_editor div {                                                                                                          font: 16px/normal \'Courier New\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;                              }                                                                                                                                                                                                                                                                   md-dialog.fullscreen-dialog {                                                                                                           max-width: 100%;                                                                                                                    max-height: 100%;                                                                                                                   width: 100%;                                                                                                                        height: 100%;                                                                                                                       border-radius: 0;                                                                                                               }                                                                                                                               </style>                                                                                                                                                                                                                                                                <div class="ltr" flex="100" ui-ace="aceOption" ng-model="formula">                                                                      select * from tbl_meuns                                                                                                         </div>                                                                                                                                                                                                                                                              </md-dialog-content>                                                                                                                <md-dialog-actions layout="row">                                                                                                        <md-button ng-click="save()">                                                                                                           {{ \'ذخیره\' | translate }}                                                                                                        </md-button>                                                                                                                        <md-button ng-click="cancel()">                                                                                                         {{ \'cancel\' | translate }}                                                                                                      </md-button>                                                                                                                    </md-dialog-actions>                                                                                                            </md-dialog>'})}var q={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6};a.license=app.license,a.app=app;var r="undefined"!=typeof e.packageId?e.packageId:0,s="undefined"!=typeof e.id?e.id:0,t=e.type,u=s>0;a.id=s,a.isEdit=u,a.type=t,a.schedule={},a.schedulePartition=[],u?b.get(app.urlPrefix+"api/datasources/GetInfo?type="+t+"&id="+s).then(function(b){if(a.model=b.data.model,a.sign=b.data.sign,a.tableName=b.data.tableName,a.model.Schedule&&(a.schedule=JSON.parse(a.model.Schedule)),a.model.schedulePartition&&(a.schedulePartition=JSON.parse(a.model.schedulePartition)),a.model.Type=t,a.model.intervalFetch){var c=[a.model.intervalFetch.fieldTrash].concat(a.model.intervalFetch.fieldId||[]);a.fields=c}},m):a.model={Authentication:0,CollationDefault:1,AutoRefresh:"15",Type:t},a.saveProgress=!1,a.cancel=function(){n()},a.save=function(d){a.model.saveData=d,a.error=null,a.testResult=null,a.model.Schedule=JSON.stringify(a.schedule),a.model.schedulePartition=JSON.stringify(a.schedulePartition),a.model.RolesActions=_.filter(a.roles,{check:!0}).map(function(a){return a.action+"-"+a.id}),a.saveProgress=!0,b.post(app.urlPrefix+"api/Datasources/AddMsOlap",{model:a.model,Type:t,IsEdit:u,PackageId:r}).then(function(b){a.saveProgress=!1;var d=c.simple().textContent(u?"تغییرات ثبت شد":"منبع داده جدید ایجاد شد");c.show(d),n(),l.reset()},function(b){a.saveProgress=!1,a.error=j.trustAsHtml("<b>"+filterXSS(b.data.desc)+"</b> <br/>"),o()})},a.testProgress=!1,app.http=b,app.scope=a,a.test=function(){a.error=null,a.testResult=null,a.mssql.$submitted=!0,a.model.Schedule=JSON.stringify(a.schedule),a.model.schedulePartition=JSON.stringify(a.schedulePartition),a.testProgress=!0,b.post(app.urlPrefix+"api/Datasources/TestMsOlap",a.model).then(function(b){a.testProgress=!1;var c="";if(t!==q.MsOlap||a.model.Query){var d=_.map(b.data.queryResult,function(a,b){return"<tr>"+_.map(a,function(a){return 0===b?"<th>"+filterXSS(a)+"</th>":"<td>"+filterXSS(a)+"</td>"}).join("")+"</tr>"}).join("");c='<table class="table">'+d+"</table>",a.fields=b.data.queryResult[0]}t!==q.MsOlap||a.model.Query||(c='<div style="background-color:#dff0d8" flex>اتصال با موفقیت برقرار شد</div>'),a.testResult=j.trustAsHtml(c)},function(b){a.testProgress=!1,a.error=j.trustAsHtml("<b>"+filterXSS(b.data.desc)+"</b> <br/>"),o()})},a.showDialog=function(b){p(b,a.model.Query).then(function(b){a.model.Query=b})},a.clearCacheProgress=!1,a.clearCache=function(){a.clearCacheProgress=!0,b.post(app.urlPrefix+"api/Datasources/clearCache/"+s).then(function(b){a.clearCacheProgress=!1})["catch"](function(){a.clearCacheProgress=!1})},a.detail=function(b){function c(a){var b=[{val:"0",label:"در لحظه"},{val:"1",label:"هر یک دقیقه"},{val:"5",label:"هر پنج دقیقه"},{val:"15",label:"هر پانزده دقیقه"},{val:"30",label:"هر سی دقیقه"},{val:"60",label:"هر یک ساعت"},{val:"1440",label:"هر روز"},{val:"10080",label:"هر هفته"},{val:"40320",label:"هر ماه"},{val:"2147483647",label:"عدم به‌روز رسانی"},{val:"-1",label:"زمانبندی..."},{val:"-2",label:"تقسیم‌بندی..."}],c=_.find(b,{val:a+""});return c?c.label:""}a.detailModel=b,a.detailModel.ScheduleParse=JSON.parse(b.Schedule),a.detailModel.Detail=JSON.parse(b.Detail),a.detailModel.MetaInfoParse=JSON.parse(b.MetaInfo),a.detailModel.AutoRefreshLabel=c(a.detailModel.AutoReresh),console.log(a.detailModel),a.showDetailModel=!0},a.restoreVersion=function(){function b(b){a.model[b]=a.detailModel.Detail[b]}if(b("DisableMessage"),b("Host"),b("Username"),b("Port"),b("Query"),b("Disable"),b("Database"),b("Authentication"),b("CollationDefault"),b("ColumnStoreIndex"),b("intervalFetch"),a.model.Name=a.detailModel.Name,a.model.AutoRefresh=a.detailModel.AutoReresh+"",a.model.ModelType=a.detailModel.ModelType,a.detailModel.Schedule&&(a.schedule=JSON.parse(a.detailModel.Schedule)),a.detailModel.schedulePartition&&(a.schedulePartition=JSON.parse(a.detailModel.schedulePartition)),a.detailModel.intervalFetch){var c=[a.detailModel.intervalFetch.fieldTrash].concat(a.detailModel.intervalFetch.fieldId||[]);a.fields=c}}}]);var ngApp=angular.module("management");ngApp.controller("datasourceNewCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$translate",function(a,b,c,d,e,f,g,h,i){var j={MsOlap:1,MSSQL:2,
MySQL:3,File:4,WebResource:5,JoinDatasource:6},k="undefined"==typeof e.id?0:e.id;i(["sql server title","sql server desc","analysis service title","analysis service desc","file title","file desc","web service title","web service desc","datasource join title","datasource join desc"]).then(function(b){a.list=[{href:"datasources/add/mssql/"+j.MSSQL+"/"+k,icon:app.urlPrefix+"Images/ds-type-db.png",title:b["sql server title"],desc:b["sql server desc"]},{href:"datasources/add/mssql/"+j.MsOlap+"/"+k,icon:app.urlPrefix+"Images/ds-type-xmla.png",title:b["analysis service title"],desc:b["analysis service desc"]},{href:"datasources/add/file/"+k,icon:app.urlPrefix+"Images/ds-type-upload.png",title:b["file title"],desc:b["file desc"]},{href:"datasources/add/web/"+k,icon:app.urlPrefix+"Images/ds-type-point.png",title:b["web service title"],desc:b["web service desc"]},{href:"datasources/add/join/"+k,icon:app.urlPrefix+"Images/join-datasource.png",title:b["datasource join title"],desc:b["datasource join desc"]}],app.license.olap&&a.list.push({href:"olap-tables",icon:app.urlPrefix+"Images/calculated-table.png",title:"جدول محاسباتی",desc:"برای ساخت یک جدول جدید از روی مدل‌هایی که به صورت DAX ذخیره کرده‌اید از این گزینه استفاده کنید."})}),a["goto"]=function(a){console.log(a),f.path(a.href)}}]),function(a){var b=angular.module("datasourcePartitionExpressionCat",["ngAnimate","ui.mask","datasourceScheduleCat"]);b.directive("partitionExpression",["$timeout","$http",function(b,c){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/datasource/PartitionExprission.html",scope:{type:"=?",datasources:"=?",partition:"=ngModel"},controller:["$scope","$http",function(c,d){c.type||(c.type=1),c.partition||(c.partition=[]),c.newPartition=function(){c.partition.push({formulas:[{}],datasources:[],autoRefresh:60,schedule:{}}),b(function(){app.lang.setLang()},0)},c.getPartitionName=function(a){var b={0:"اول",1:"دوم",2:"سوم",3:"چهارم",4:"‍‍‍پنجم",5:"ششم",6:"هفتم",7:"هشتم",8:"نهم",9:"دهم"};return+a<10?b[+a]:"اضافه"},c.addDatasourceToPartition=function(d){var e=c.datasources.filter(function(a){return a.Id==d.id});e.length>0?d.partitions=a.extend(!0,[],e[0].Partitions):d.partitions=[],b(function(){app.lang.setLang()},0)},app.lang.setLang()}],link:function(){app.lang.setLang()}}}])}(jQuery),function(){var a=angular.module("datasourceScheduleCat",["ngAnimate","ui.mask","ngMaterial"]);a.directive("datasourceSchedule",["$timeout","$http",function(a,b){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/datasource/Schedule.html?v="+app.version,scope:{model:"=?ngModel"},controller:["$scope","$http","$element","$mdMedia","$mdDialog",function(a,b,c,d,e){function f(b,c){b.model=a.model,b.cancel=function(){c.cancel()},b.checkValue=function(){"second"==b.model.dailyFrequencyRecurType&&+b.model.dailyFrequencyRecur<10&&(b.model.dailyFrequencyRecur=10)},b.save=function(){c.hide(b.model)}}a.model&&a.model.occure||(a.model={occure:"daily",dailyRecurs:1,weeklyRecurs:1,weeklySat:!0,weeklySun:!1,weeklyMon:!1,weeklyTus:!1,weeklyWen:!1,weeklyThu:!1,weeklyFri:!1,monthlyDayOf:1,monthlyRecurs:1,dailyFrequency:"once",dailyFrequencyAtHour:"0600",dailyFrequencyRecur:1,dailyFrequencyRecurType:"hour",dailyFrequencyStart:"0001",dailyFrequencyStop:"2359"}),a.formatClock=function(a){var b=a+"";return b.substr(0,2)+":"+b.substr(2)},a.edit=function(a){function b(a){}var c=d("sm")||d("xs");e.show({controller:["$scope","$mdDialog",f],templateUrl:app.urlPrefix+"dist/partial/management/datasource/scheduleDialog.html?v="+Math.random(),parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,fullscreen:c}).then(b)}}]}}]),a.directive("datasourceScheduleCaption",["$timeout","$http",function(a,b){return{restrict:"E",template:"            {{'اجرا هر' | translate}}            {{model.occure!='daily'? '' : (model.dailyRecurs>1?model.dailyRecurs:'') + ' روز'}}            {{model.occure!='weekly'? '' : (model.weeklyRecurs>1?model.weeklyRecurs:'') + ' هفته' + ' در '}}            {{model.occure!='weekly'? '' : (model.weeklySat?'شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklySun?'یک شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklyMon?'دو شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklyTus?'سه شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklyWen?'چهار شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklyThu?'پنج شنبه، ':'') }}            {{model.occure!='weekly'? '' : (model.weeklyFri?'جمعه':'') }}            {{model.occure!='monthly'? '' : (model.monthlyRecurs>1?model.monthlyRecurs:'') + ' ماه '}}            {{model.occure!='monthly'? '' : 'روز ' +  model.monthlyDayOf }}            {{model.dailyFrequency=='once'? 'راس ساعت ' +  formatClock(model.dailyFrequencyAtHour):'' }}            {{model.dailyFrequency=='recur'? 'هر ' +  model.dailyFrequencyRecur + (model.dailyFrequencyRecurType=='hour'?'ساعت ':model.dailyFrequencyRecurType=='minute'?'دقیقه ':'ثانیه ') + 'بین ساعت ' + formatClock(model.dailyFrequencyStart) + ' و '+ formatClock(model.dailyFrequencyStop):'' }}",scope:{model:"=?ngModel"},controller:["$scope","$http","$element","$mdMedia","$mdDialog",function(a,b,c,d,e){console.log("### [datasourceScheduleCaption] model",a.model),a.formatClock=function(a){var b=a+"";return b.substr(0,2)+":"+b.substr(2)}}]}}])}(),function(){var a=angular.module("management");a.directive("schemaTypes",[function(){return{templateUrl:app.urlPrefix+"dist/partial/management/datasource/schemaTypes.html?v="+app.version,scope:{model:"=?ngModel",id:"=?"},controller:["$scope","$http",function(a,b){a.types=[{name:"INT",type:0},{name:"BIGINT",type:1},{name:"DECIMAL",type:2},{name:"NVARCHAR_100",type:3},{name:"NVARCHAR_400",type:4},{name:"NVARCHAR_4000",type:5},{name:"NVARCHAR_MAX",type:6},{name:"DATE",type:7},{name:"DATE_TIME",type:8},{name:"BOOLEAN",type:9},{name:"FLOAT",type:10},{name:"UNKOWN",type:11},{name:"DATE_TIME2",type:12}];var c=0;a.$watch("model",function(b){c++,c>=3&&(a.change=!0,console.log("### chage model",a.change,b))},!0),a.save=function(){a.saveProgress=!0,b.post(app.urlPrefix+"api/datasources/changeSchema/"+a.id,a.model).then(function(){a.saveProgress=!1,a.change=!1})["catch"](function(b){a.error=b.data.desc,a.saveProgress=!1})},a.remove=function(){var c=confirm("با پاک کردن اسکیما، داده‌های قبلی به همراه اسکیمای جدول نیز پاک خواهند شد. آیا برای اینکار اطمینان دارید؟");c&&(a.removeProgress=!0,b.post(app.urlPrefix+"api/datasources/cleanDatasource/"+a.id).then(function(){a.removeProgress=!1,a.model=[]})["catch"](function(b){a.error=b.data.desc,a.removeProgress=!1}))}}]}}])}(),function(){var a=angular.module("management");a.directive("changeTableName",[function(){return{templateUrl:app.urlPrefix+"dist/partial/management/datasource/changeTableName.html?v="+app.version,scope:{id:"=?",tableName:"=?"},controller:["$scope","$http",function(a,b){$(".ui.dimmer.modals .rename-table-name").remove(),a.open=function(){a.name=a.tableName,a.name=a.name.substr(4,1e3),$(".rename-table-name").modal("show")},a.change=function(){a.error=null,a.saveProgress=!0,b.post(app.urlPrefix+"api/datasources/changeTableName/"+a.id,{name:a.name}).then(function(){a.tableName=a.name,a.saveProgress=!1,$(".rename-table-name").modal("hide")})["catch"](function(b){a.error=b.data.desc,a.saveProgress=!1})}}]}}])}();var ngApp=angular.module("management");ngApp.controller("datasourceWebCtrl",["$scope","$http","$mdToast","$mdDialog","$routeParams","$location","packages","$timeout","$window","$sce","datasources",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){a.saveProgress=!1,a.testProgress=!1,a.error=b.data.desc}function m(b){a.model.isEdit=s,a.model.isTest=b,a.model.id=r,a.model.parameters=a.parameters.filter(function(a){return a.name}).map(function(a){return[a.name,a.value,a.type]}),a.model.Schedule=JSON.stringify(a.schedule),a.model.RolesActions=_.filter(a.roles,{check:!0}).map(function(a){return a.action+"-"+a.id})}function n(){2==window.history.length?f.path("/datasources/"+q):window.history.back()}function o(a){c.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}var p={MsOlap:1,MSSQL:2,MySQL:3,File:4,WebResource:5,JoinDatasource:6},q="undefined"!=typeof e.packageId?e.packageId:0,r="undefined"!=typeof e.id?e.id:0,s=(e.type,r>0);a.license=app.license,a.app=app,a.isEdit=s,a.id=r,a.model={contentType:"1",packageId:q},b.get(app.urlPrefix+"api/JoinDataSource/GetDatasourceList?noColumn=true").then(function(b){a.datasourceList=_.filter(b.data,{Type:5})}),s&&b.get(app.urlPrefix+"api/datasources/GetInfo?type="+p.WebResource+"&id="+r).then(function(b){if(a.model=b.data.model,a.sign=b.data.sign,a.tableName=b.data.tableName,a.model.Schedule&&(a.schedule=JSON.parse(a.model.Schedule)),a.model.parameters&&(a.parameters=a.model.parameters.map(function(a){return{name:a[0],value:a[1],type:a[2]||"Query"}})),a.model.intervalFetch){var c=[a.model.intervalFetch.fieldTrash].concat(a.model.intervalFetch.fieldId||[]);c=_.uniq(c),a.fields=c}},l),a.schedule={},a.parameters=[{type:"Query"}],a.paging={type:"numbers",enable:!1,from:0,to:10},a.saveProgress=!1,a.save=function(d){return a.model.saveData=!(!d&&a.isEdit),a.error=null,a.testResult=null,a.webForm.$valid?(m(!1),link=app.urlPrefix+"api/WebResource/Add",a.saveProgress=!0,void b.post(link,a.model).then(function(b){a.saveProgress=!1;var d=c.simple().textContent(s?"تغییرات ثبت شد":"منبع داده جدید ایجاد شد");c.show(d),n(),k.reset()},l)):void o("فیلدهای ضروری باید پر شوند")},a.testProgress=!1,a.test=function(){return a.error=null,a.testResult=null,a.webForm.$valid?(m(!0),link=app.urlPrefix+"api/WebResource/Add",a.testProgress=!0,void b.post(link,a.model).then(function(b){a.testProgress=!1;var c="",d=_.map(b.data.list,function(a,b){return"<tr>"+_.map(a,function(a){return 0==b?"<th>"+filterXSS(a)+"</th>":"<td>"+filterXSS(a)+"</td>"}).join("")+"</tr>"}).join("");c='<table class="table">'+d+"</table>",a.testResult=j.trustAsHtml(c),a.fields=b.data.list[0]},l)):void o("فیلدهای ضروری باید پر شوند")},a.clearCacheProgress=!1,a.clearCache=function(){a.clearCacheProgress=!0,b.post(app.urlPrefix+"api/Datasources/clearCache/"+r).then(function(b){a.clearCacheProgress=!1})["catch"](function(){a.clearCacheProgress=!1})},a.detail=function(b){function c(a){var b=[{val:"0",label:"در لحظه"},{val:"1",label:"هر یک دقیقه"},{val:"5",label:"هر پنج دقیقه"},{val:"15",label:"هر پانزده دقیقه"},{val:"30",label:"هر سی دقیقه"},{val:"60",label:"هر یک ساعت"},{val:"1440",label:"هر روز"},{val:"10080",label:"هر هفته"},{val:"40320",label:"هر ماه"},{val:"2147483647",label:"عدم به‌روز رسانی"},{val:"-1",label:"زمانبندی..."},{val:"-2",label:"تقسیم‌بندی..."}],c=_.find(b,{val:a+""});return c?c.label:""}a.detailModel=b,a.detailModel.ScheduleParse=JSON.parse(b.Schedule),a.detailModel.Detail=JSON.parse(b.Detail),a.detailModel.MetaInfoParse=JSON.parse(b.MetaInfo),a.detailModel.AutoRefreshLabel=c(a.detailModel.AutoReresh),console.log(a.detailModel),a.showDetailModel=!0},a.restoreVersion=function(){function b(b,c){a.model[b]=a.detailModel.Detail[c||b]}if(b("type","Type"),b("url","Url"),b("method","Method"),b("jsonPostProcess"),b("rawBody"),b("resultTag"),b("resultTagNameSpace"),b("resultTagUseValue"),b("loginByToken"),b("paging"),b("parameters","Parameters"),b("authenticationType","AuthenticationType"),b("user","User"),b("ColumnStoreIndex"),b("streamMode"),b("schema"),b("intervalFetch"),b("contentType"),a.model.name=a.detailModel.Name,a.model.AutoRefresh=a.detailModel.AutoReresh+"",a.model.ModelType=a.detailModel.ModelType,a.detailModel.Schedule&&(a.schedule=JSON.parse(a.detailModel.Schedule)),a.detailModel.schedulePartition&&(a.schedulePartition=JSON.parse(a.detailModel.schedulePartition)),a.detailModel.intervalFetch){var c=[a.detailModel.intervalFetch.fieldTrash].concat(a.detailModel.intervalFetch.fieldId||[]);a.fields=c}}}]);var ngApp=angular.module("management");ngApp.service("indicator",["$mdDialog","$mdMedia","$rootScope","templates","$http",function(a,b,c,d,e){var f=function(c,e){function f(a,b){a.cancel=function(){b.cancel()}}var g=b("sm")||b("xs");return a.show({controller:["$scope","$mdDialog",f],parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:g,templateUrl:d.tmpl.package_dialog})};return{get:f}}]);var ngApp=angular.module("management");ngApp.service("packages",["$mdDialog","$mdMedia","$rootScope","$http",function(a,b,c,d){function e(a,b){return f||(f=d.post(app.urlPrefix+"api/Package/GetPackagesObject",{scope:a,withContent:b})),f}var f,g=function(c,d,f,g,h){function i(a,b){function c(a,b){b(a),a.subPackages&&_.forEach(a.subPackages,function(a){c(a,b)})}e(d,f).then(function(b){a.root=b.data.root,console.log("set root in package service ",a.root)}),a.clearSelect=function(){c(a.root,function(a){a.select=!1})},a.cancel=function(){b.cancel()},a.select=function(){var d=null;c(a.root,function(a){a.select&&(d=a)}),b.hide(d)}}var j=b("sm")||b("xs");a.show({controller:i,templateUrl:app.urlPrefix+"dist/partial/management/packages/select-package.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:j}).then(g,h)},h=function(b,c,e,g,h,i){var j=a.prompt().title("ایجاد پوشه جدید").textContent("نام پوشه جدید را وارد کنید").placeholder("نام پوشه").ariaLabel("نام پوشه").targetEvent(b).ok("ایجاد").cancel("لغو");a.show(j).then(function(a){f=null,d.post(app.urlPrefix+"api/Package/Create",{name:a,scope:c,parentId:e}).then(g,h)},i)},i=function(b,c,e,g,h,i){var j=a.prompt().title("تغییر نام پوشه").textContent("نام جدید را وارد کنید").placeholder("نام پوشه").ariaLabel("نام پوشه").targetEvent(b).ok("تغییر").cancel("لغو");a.show(j).then(function(a){f=null,d.post(app.urlPrefix+"api/Package/Edit",{id:e,name:a}).then(g,h)},i)};return{name:"packages",select:g,create:h,edit:i}}]);var ngApp=angular.module("management");ngApp.service("utils",["$http","$translate","$sce","$mdToast",function(a,b,c,d){function e(a,b){if("undefined"==typeof b&&(b=app.lang.isRtl()),!b)return a;var c={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"};return a+="",a.replace(/(\d)/g,function(a,b){return c[b]||a})}function f(a){var b={"۰":0,"۱":1,"۲":2,"۳":3,"۴":4,"۵":5,"۶":6,"۷":7,"۸":8,"۹":9};return a+="",a.replace(/([۰۱۲۳۴۵۶۷۸۹])/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function g(a){var b={"ي":"ی","إ":"ا","ؤ":"و","أ":"ا","ک":"ك"};return a+="",a.replace(/(.)/g,function(a,c){return b[c]||a})}function h(a){var b=c.trustAsHtml(filterXSS("<b>"+a.data.title+"</b> <br/>"+a.data.desc));j&&j(b)}function i(a){d.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}var j,k=function(a){j=a};return{persian:e,depersian:f,normilize:g,error:h,onError:k,showErrorToast:i}}]);var cat=angular.module("settingsCat",["ngAnimate"]);cat.controller("myController",["$scope","$http","$sce","$timeout",function(a,b,c,d){a.langs=[{key:0,value:"فارسی"},{key:1,value:"English"}],a.save=function(d){$(d.target).button("loading"),b.post(app.urlPrefix+"api/Settings/GeneralSettings",JSON.stringify({Brand:a.brand,Language:a.language}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){$(d.target).button("reset"),b.data.result?($("a.navbar-brand").text(b.data.brand),window.history.back()):a.error=c.trustAsHtml(filterXSS(b.data.error))})},a.restore=function(b){b&&d(function(){var c=JSON.parse(b);console.log(c),a.brand=c.Brand,a.language=c.Language},0)}}]);var cat=angular.module("settingsCat",["ngAnimate"]);cat.controller("myController",["$scope","$http","$sce","$timeout",function(a,b,c,d){a.save=function(d){b.post(app.urlPrefix+"api/Settings/Mail",JSON.stringify({port:a.port,host:a.host,ssl:a.ssl,timeout:a.timeout,username:a.username,password:a.password}),{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(b){b.data.result?window.history.back():a.error=c.trustAsHtml(filterXSS(b.data.error))})},a.restore=function(b){b&&d(function(){var c=JSON.parse(b);console.log("[settingsCat] "),console.log(c),a.port=c.port,a.host=c.host,a.ssl=c.ssl,a.timeout=c.timeout,a.username=c.username,a.password=c.password},0)}}]);var ngApp=angular.module("management");ngApp.controller("dashboardsCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","menus","$mdDialog",function(a,b,c,d,e,f,g,h,i,j){function k(){return _.map(_.filter(a.data,{select:!0}),function(a){return a.id})}a.utils=h,a.app=app;var l=function(){return _.some(a.data,{select:!0})};a.selectAll=function(){a.data&&_.forEach(a.data,function(b){b.select=a.selectAllCheckbox}),a.menuInvalidate()},a["delete"]=function(c){var d=app.urlPrefix+"api/menus/Delete",f=k(),g=j.confirm().title("حذف برای همیشه؟").textContent(f.length+" مورد برای حذف انتخاب شده است").ariaLabel("حذف").targetEvent(c).ok("حذف!").cancel("لغو");j.show(g).then(function(){b.post(d,f).then(function(b){b.data&&(a.data=_.filter(a.data,function(a){return _.indexOf(b.data,a.id)===-1}));var c=e.simple().textContent("حذف انجام شد");e.show(c),a.menuInvalidate()})})},a.menuInvalidate=function(){var b=l();a.canCopy=b,a.canDelete=b,a.canForward=b},a.progress=!0,i.get().then(function(b){a.progress=!1,a.data=b.data,_.each(a.data,function(a){a.time=0===a.updateDate?"":moment.utc(a.updateDate).format("jYYYY/jMM/jDD HH:mm:ss")})})}]);var ngApp=angular.module("management");ngApp.controller("dashboardDetailCtrl",["$scope","$http","$sce","$timeout","$mdToast","toolbar","$translate","utils","menus","$routeParams","mainmenus","menuCategories","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){b.get(app.urlPrefix+"api/users/get").then(function(b){a.users=b.data.list},h.error)}function o(){2==window.history.length?m.path("/dashboards"):window.history.back()}a.utils=h,a.app=app,a.id=j.id,i.getMenu(j.id).then(function(b){a.model=b.data.model,a.sign=b.data.sign,a.model.notifications=a.model.notifications||{},a.metadataModule=b.data.metadataModule}),a.render=!0,a.updateModel=function(b){a.model.notifications=b,a.render=!1,d(function(){a.render=!0},0),console.log("$scope.updateModel ",b)},k.get(-1).then(function(b){a.mainMenus=b.data.list}),l.get().then(function(b){a.menuCategories=b.data.list}),n(),a.save=function(){a.saveProgress=!0,a.error=null,a.model.rolesAction=_.filter(a.roles,{check:!0}).map(function(a){return{action:a.action,id:a.id,name:a.name}}),i.save(a.model).then(function(b){a.saveProgress=!1,a.model=b.data,0==a.id&&m.path("/dashboards/"+b.data.id);var c=e.simple().textContent("تغییرات با موفقیت ذخیره شد");e.show(c)})["catch"](function(b){a.saveProgress=!1,a.error=c.trustAsHtml(filterXSS(b.data.desc))})},a.restore=function(b){_.extend({},a.model);_.each(b.rolesAction,function(b){b.check=!1;var c=_.find(a.roles,{id:b.id});c&&(c.action=b.action,c.check=!0)}),a.model=b,a.save()},a.detail=function(b){a.detailModel=b,console.log(b),a.showDetailModel=!0},a.getRoleName=function(b){if(a.roles){var c=_.find(a.roles,{id:b});if(c)return c.name}return"نامشخص"},a.cancel=function(){o()}}]),function(){var a=angular.module("management");a.directive("datasourceMetainfo",["$timeout","$http","roles",function(a,b,c){return{restrict:"E",templateUrl:app.urlPrefix+"dist/partial/management/datasource/datasourceMetainfo.html?v="+app.version,scope:{model:"=ngModel"},controller:["$scope","$http",function(a,b){a.show=app.datasourceMetadata,a.model=a.model||{}}]}}])}();