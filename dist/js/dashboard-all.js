/* داشبورد مدیریت صدف 
 sadafdashboard.ir 


*/
// داشبورد مدیریتی صدف info@sadafdashboard.ir

function prepareData(a,b){for(var c=[],d=(a.matrix||[],0);d<a.matrix.length;d++){var e={};e.index=a.matrix[d][0],e.label=a.matrix[d][1],e.onClickVal=a.matrix[d][2],e.value=a.matrix[d][3],e.kpis=a.kpis.data[d],e.series=a.series.data[d];var f=[];if(e.kpis)for(var g=0;g<e.kpis.length;g++){for(var h=[],i=0;i<e.kpis[g].length;i++)h.push(parseFloat(e.kpis[g][i])||0);f.push(h)}e.kpis=f,f=[];for(var g=0;g<e.series.length;g++)isNaN(e.series[g])?f.push(e.series[g]||0):f.push(parseFloat(e.series[g])||0);e.series=f,c.push(e)}return c}function persian(a,b){if(!b)return a;var c={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"};return a+="",a.replace(/(\d)/g,function(a,b){return c[b]||a})}function depersian(a){var b={"۰":0,"۱":1,"۲":2,"۳":3,"۴":4,"۵":5,"۶":6,"۷":7,"۸":8,"۹":9};return a+="",a.replace(/([۰۱۲۳۴۵۶۷۸۹])/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function normilize(a){var b={"ي":"ی","إ":"ا","ؤ":"و","أ":"ا","ک":"ك"};return a+="",a.replace(/(.)/g,function(a,c){return b[c]||a})}var app=app||{};app.chartCommons={},app.chartCommons.tooltip={tooltipFormatter:function(set,fh,f,showPersain){var body=set.points.map(function(point){var bodyFormat=f||'{{point.label}}: <p class="ltr inline" style="padding:0; margin:0;" ><b>{{point.data}}</b></p>';return bodyFormat.replace(/{{([^(}})]+)}}/gm,function(i,p1){if(!p1.match(/point\.(data|label|color|format|percentage)/))return p1;var e=eval(p1);return"NaN"===e&&(e="تعریف نشده"),isNaN(e)?e:persian(d3.format(point.format)(e),showPersain)})}).join("<br/>"),headerFormat=fh||"",header=headerFormat.replace(/{{([^(}})]+)}}/gm,function(i,p1){var e=eval(p1);return isNaN(e)||"set.key"==p1?e:persian(d3.format(set.format)(e),showPersain)});return header&&body.trim()&&(header+="<BR/>"),r='<div style="margin:0;text-align: right; padding:0;direction: rtl;">'+header+body+"</div>",r}},app.chartCommons.highchartSetTheme=function(){var a=d3.scale.category10();Highcharts.setOptions({lang:{loading:"در حال بارگذاری...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",numericSymbols:["k","M","G","T","P","E"],resetZoom:"حالت اولیه",resetZoomTitle:"حالت اولیه 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/4.1.4/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/4.1.4/gfx/vml-radial-gradient.png"}}),Highcharts.theme={chart:{},xAxis:{title:{text:null,align:"middle"}},yAxis:{endOnTick:!1,title:{text:null,align:"middle"},labels:{formatter:function(){return persian(d3.format(",")(this.value))}},lineWidth:2,lineColor:"#D8D8D8",tickWidth:1},tooltip:{valueSuffix:"",useHTML:!0,formatter:function(){return"<b>"+this.x+"</b>: <b>"+this.series.tooltipOptions.pointFormatter(this)+"</b>"},headerFormat:"",style:{"text-align":"right"}},plotOptions:{bar:{dataLabels:{enabled:!0}},series:{animation:{duration:800,easing:"easeInCubic"},allowPointSelect:!0,fillOpacity:.1,marker:{fillColor:"#FFFFFF",lineWidth:2,lineColor:null}}},credits:{enabled:!1},colors:[1,2,3,4,5,6,7,8,9,10].map(function(b,c){return a(c)}),chart:{animation:{duration:400,easing:"linear"},panning:!0,panKey:"shift"},title:{text:null,style:{color:"#000",font:"bold 16px Droid, Tahoma, Arial"}},subtitle:{style:{color:"#666666",font:"bold 12px Droid, Tahoma, Arial"}},legend:{itemStyle:{font:"9pt Droid, Tahoma, Arial",color:"black"},itemHoverStyle:{color:"gray"}}},Highcharts.setOptions(Highcharts.theme)},app.chartCommons.getError=function(a){if(!a.result){var b=0==+a.errorType?"منبع داده غیر فعال است":"اشکال در پرس و جو";return"<div class='temporal error'> <h4>"+b+"</h4><p>"+a.errorMessage+"</p></div>"}return"<div class='temporal error'> مشکلی در روند برنام ایجاد شده است</div>"},app.chartCommons.openLink=function(a){if(-1!=a.dashboardId)location.hash="/dashboard/"+a.dashboardId;else{var b=window.open(a.link,"_blank");b?b.focus():alert("Please allow popups for this site")}},app.chartCommons.calculateFields=function(series,calcFormulas,columnIsNumeric){function calc(item,series,columnIsNumeric){function getCell(a,b,c){return b=0>b?0:b>=a.length?a.length-1:b,c=0>c?0:c>=a[0].length?a[0].length-1:c,a[b][c]}if(-1==series.labels.indexOf(item.name)&&series.data instanceof Array){var isValid=/^({\s*r?([+-]?\d*)\s*,?\s*c?(\d*)}|[\d\s\+-\/\)\(\*]*|'[^']*')*$/gim.test(item.formula);if(!isValid)return void alert("### Not valid "+item.formula);for(var indexes=[],repFormula=item.formula.replace(/{\s*r?([\+-]?\d*)\s*,?\s*c?(\d*)}/gim,function(a,b,c){return indexes.push({row:+b,col:+c}),"$"+(indexes.length-1)}),i=0;i<series.data.length;i++){var rowFormula=repFormula.replace(/\$(\d+)/gim,function(a,b){var c=indexes[+b],d=getCell(series.data,c.row+i,c.col);return columnIsNumeric&&!columnIsNumeric[c.col]?"'"+d+"'":d||0});series.data[i].push(eval(rowFormula))}series.labels.push(item.name)}}return;var formulas},app.chartCommons.drillDown={filters:[],add:function(a,b,c,d){var e=_.find(this.filters,{chartInPageId:a});if(_.isUndefined(e)){var f={chartInPageId:a,datasourceId:b,drillDown:[{key:c,value:d}]};return this.filters.push(f),f.drillDown}var g=_.find(e.drillDown,{key:c});return _.isUndefined(g)||_.remove(e.drillDown,{key:c}),e.drillDown.push({key:c,value:d}),e.drillDown},up:function(a,b){var c=_.find(this.filters,{chartInPageId:a});if(_.isUndefined(c))return[];_.isUndefined(b)&&(b=1);for(var d=0;b>d;d++)c.drillDown.length>0&&c.drillDown.pop();return c.drillDown},get:function(a){return _.find(this.filters,{chartInPageId:a})},clear:function(a){return _.remove(this.filters,{chartInPageId:a})},clearAll:function(){this.filters=[]}},app.chartCommons.getFilterHierarchy=function(a,b){function c(a){if(_.isArray(a)){for(var b=0;b<a.length;b++){var c=a[b];"undefined"!=typeof c.Members&&c.Members&&(c.Members=c.Members.filter(function(a,b){return a.IsChecked}),c.FilteredMemberByUser=!0)}return a}}var b=$(".cid"+a+" .chart-dimentions-content").data("data");return _.isUndefined(b)?null:{Hierarchies:c(b.Hierarchies),Where:c(b.Where),SeriesLevel:c(b.SeriesLevel)}},app.chartCommons.userFilter={filters:[],setUserControlFilters:function(a){this.filters=[],_.isArray(a)&&(this.filters=a)},setFilter:function(a){if(0==this.filters.length)return void this.filters.push(a);var b=_.find(this.filters,{chartInPageId:a.chartInPageId,dimensionName:a.dimensionName});_.isUndefined(b)||_.remove(this.filters,{chartInPageId:a.chartInPageId,dimensionName:a.dimensionName}),this.filters.push(a)},setFilterIfNotExist:function(a){if(!(_.isEmpty(a.values)||_.isArray(a.values)&&0==a.values.length)){if(0==this.filters.length)return void this.filters.push(a);var b=_.find(this.filters,{chartInPageId:a.chartInPageId});_.isUndefined(b)&&this.filters.push(a)}},getFilterValue:function(a){var b=_.find(this.filters,{chartInPageId:a});return _.isUndefined(b)?null:b}},app.chartCommons.lastRefreshDateFormat=function(a){if(!a)return"";if(0!=app.lang.langType)return a.D+"/"+a.M+"/"+a.Y+" - "+a.h+":"+a.m+":"+a.s+" ";var b="";a.Diff&&a.Diff<86400&&(b+=" - <b>",b+=a.Diff<60?Math.floor(a.Diff)+" ثانیه پیش":a.Diff<3600?Math.floor(a.Diff/60)+" دقیقه پیش":Math.floor(a.Diff/3600)+" ساعت پیش",b+="</b>");var c=1==+a.M?"فروردین":2==+a.M?"اردیبهشت":3==+a.M?"خرداد":4==+a.M?"تیر":5==+a.M?"مرداد":6==+a.M?"شهریور":7==+a.M?"مهر":8==+a.M?"آبان":9==+a.M?"آذر":10==+a.M?"دی":11==+a.M?"بهمن":"اسفند";return persian(a.D+" "+c+" ماه "+a.Y+" ساعت "+a.h+":"+a.m+":"+a.s+" "+b,!0)},app.chartCommons.setFilterParameter=function(a){var b=a.input&&a.input.RefreshDatasource?a.input.RefreshDatasource:null,c=app.chartCommons.getFilterParameter(a.ChartInPageId,b);a.parameters.drillDown=c.drillDown,a.editMode||(a.parameters.otherFilters=c.otherFilters,a.parameters.userControlFilter=c.userControlFilter,a.parameters.userVariable=c.userVariable)},app.chartCommons.getFilterParameter=function(a,b){var c={drillDown:null},d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:a});_.isUndefined(d)||(c.drillDown=d.drillDown),c.otherFilters=_.filter(app.chartCommons.drillDown.filters,function(c){if(!b)return!1;var d=-1!=b.indexOf(c.datasourceId);return d&&c.chartInPageId!=a}),c.userControlFilter=$.extend([],_.filter(app.chartCommons.userFilter.filters,function(a){if(!b)return!1;var c=-1!=b.indexOf(a.datasourceId);return c}));var e=JSON.parse(localStorage.getItem("userVariable"));return c.userVariable=e,c},app.chartCommons.expandedType=1,app.chartCommons.changeSeriesPropertyBaseOnExpandedType=function(a,b){var c=app.chartCommons.expandedType;1==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="1",a.info.stackedLine="1"),2==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="2",a.info.stackedLine="1"),21==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="3",a.info.stackedLine="1"),3==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-dot-area",a.areaOpacity=.1)}),a.info.stackedBar="1",a.info.stackedLine="1"),4==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.areaOpacity=.1,a.lineType="line-dot-area",a.seriesType="line")}),a.info.stackedBar="1",a.info.stackedLine="2"),22==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.areaOpacity=.1,a.seriesType="line",a.lineType="line-dot-area")}),a.info.stackedBar="1",a.info.stackedLine="3"),5==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="1"),6==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="2"),23==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="3"),7==c&&(a.info.hole="0"),8==c&&(a.info.hole="50"),14==c&&(a.info.aggregation="-1"),13==c&&(a.info.aggregation="1"),15==c&&(a.info.type="combo"),16==c&&(a.info.type="multi"),17==c&&(a.info.type="datepicker"),18==c&&(a.info.type="datepicker-range"),19==c&&(a.info.type="slider"),20==c&&(a.info.type="text"),9==c&&(a.info.segmentType="singleSegment",a.info.style="arc"),24==c&&(a.info.segmentType="multiSegment",a.info.style="arc"),25==c&&(a.info.segmentType="singleSegment",a.info.style="horizontal"),26==c&&(a.info.segmentType="multiSegment",a.info.style="horizontal")},app.chartCommons.setDefault=function(a,b,c){var d=d3.scale.category10();_.isUndefined(b)||_.each(b,function(b,e){var f=d(e),g=c;a.series=a.series||{};var h={bar:{seriesColor:f,seriesType:"bar",formatString:",.0f",numberFactor:"1",showValues:!1,hidden:!1,cumulative:!1,cumulative_formula:"sum",lineFace:"5,0",lineWeight:"2",lineStyle:"linear",lineType:"line-dot-area",showValueColor:"#333333",areaOpacity:.1,formatStringCustom:",.0f",font:{bold:!1,color:"#333333",italic:!1,fontSize:"11px",fontName:"IRANSans",formatString:",.3s",formatStringCustom:",.0f"},top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},map:{hidden:!1,formatString:",.0f",colorStart:"#31a354",colorEnd:"#c7e9c0",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},pie:{main:!0,numberFactor:"1",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},gauge:{type:"value",typeMs:"value",numberFactor:"1",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},radar:{numberFactor:"1",seriesColor:f,top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},table:{numberFactor:"1",textAlign:"right",formatString:",.0f",fontSize:"1em",textItalic:!1,textBold:!1,color:"#000000",rowResult:"0",isHidden:!1,top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},userControl:{numberFactor:"1",type:"value"},text:{}},i=!1;_.isUndefined(a.series[b])&&(i=!0),a.series[b]=$.extend({},h[g],a.series[b]),i&&app.chartCommons.changeSeriesPropertyBaseOnExpandedType(a,b)})},app.chartCommons.commentUtils={getLabelsMeasures:function(a){var b=[],c=[];return a.matrix?(_.each(a.matrix,function(a){b.push(a[1])}),_.each(a.series.labels,function(a){c.push(a)})):b=a.headers,{labels:b,measures:c}},getCommentCount:function(a,b,c){return a.filter(function(a){return b==a.label&&a.measure==c}).length},getChartSelector:function(a){return".cid"+a},clickOnCommentIcon:function(a,b){d3.event.preventDefault(),d3.event.stopPropagation(),$(app.chartCommons.commentUtils.getChartSelector(b)).trigger("new-comment",a)},highlight:function(a,b){var c=!1;_.each(a,function(a){a.classed("selected",!1)}),_.each(a,function(a){return c?!1:void a.each(function(a){return b.category==a.category&&b.seriesLable==a.seriesLable?(d3.select(this).classed("selected",!0),c=!0,!1):void 0})})},setOnHighlightListener:function(a,b){var c=$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections")||[];c.push(a),$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections",c),$(app.chartCommons.commentUtils.getChartSelector(b)).off("highlight-element"),$(app.chartCommons.commentUtils.getChartSelector(b)).on("highlight-element",function(a,c){if(c){var d=$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections")||[];app.chartCommons.commentUtils.highlight(d,c)}})},destroyListener:function(a){$(app.chartCommons.commentUtils.getChartSelector(a)).data("collections",null)},addCommentIcon:function(a,b,c,d){var e=b.append("g").attr("transform",function(a,b){return"translate("+c(a,b)+","+d(a,b)+")scale(0.38)"}).attr("class",function(a){return"comment"+(a.commentCount?" show":"")}).on("click",function(b){app.chartCommons.commentUtils.clickOnCommentIcon(b,a)});e.append("rect").attr({width:50,height:24,"class":"comment-background"}),e.append("path").attr("d","M10.718,18.561l6.78,5.311C17.609,23.957,17.677,24,17.743,24  c0.188,0,0.244-0.127,0.244-0.338v-5.023c0-0.355,0.233-0.637,0.548-0.637L21,18c2.219,0,3-1.094,3-2s0-13,0-14s-0.748-2-3.014-2  H2.989C0.802,0,0,0.969,0,2s0,13.031,0,14s0.828,2,3,2h6C9,18,10.255,18.035,10.718,18.561z"),e.append("text").text(function(a){return a.commentCount?persian(a.commentCount,!0):""}).attr({x:34,y:"0.7em"}).style({"font-size":"20px"})},updateIconCommentCount:function(a,b,c){function d(a){a.each(function(a){a.seriesLable==b.measure&&a.category==b.label&&(d3.select(this).select("text").text(c?persian(c,!0):""),d3.select(this).classed("show",c>0))})}var e=d3.selectAll(app.chartCommons.commentUtils.getChartSelector(a)+" .comment"),f=d3.selectAll("#"+app.chartCommons.commentUtils.getChartInModalSelector(a)+" .comment");d(f),d(e)},getChartInModalSelector:function(a){return"modal-chart-container-"+a},showLastVersionChart:function(){}},app.chartCommons.renderComments=function(a,b){function c(){var a='<div class="ui fuild modal '+v.substring(1,1e3)+' rtl"  style="cursor: initial;">     <i class="close icon"></i>     <div class="header">نسخه قبلی نمودار</div>     <div class="content" id="'+v.substring(1,1e3)+'" style="height:350px">         <div class="ui active inverted dimmer"><div class="ui text loader">آماده‌سازی نمودار</div></div>     </div></div>';if(0==$(v).length){var b=$(a);$("body").append(b),b.modal({allowMultiple:!0,onVisible:function(){app.chartCommons.commentUtils.showLastVersionChart()},onHidden:function(){$(v+" .content").html('<div class="ui active inverted dimmer"><div class="ui text loader">آماده‌سازی نمودار</div></div>')}})}}function d(a){return'<div class="ui mini label value comment-value" data-label="'+a.label+'" data-measure="'+a.measure+'" data-value="'+a.value+'" style="">  '+a.measure+" در "+a.label+": "+persian(d3.format(",.2f")(a.value),!0)+"</div>"}function e(a){var c="";return+a.chartVersion!=+b.version&&(c=persian(" نسخه "+a.chartVersion+" نمودار ",!0),c='            <span class="version pointer" style="color:red;" data-version="'+a.chartVersion+'">'+c+"</span>"),'<div class="comment" data-id="'+a.id+'">    <div class="content">        <span class="author">'+a.username+'</span>        <span class="value-string">'+d(a)+'</span>        <div class="metadata">            <span class="date">'+moment(a.time).fromNow()+"</span>"+c+'        </div>        <div class="text">            <span class="comment-text">'+a.comment+'            </span>            <span class="auto-hide animated ">            <a class="reply pointer metadata"> پاسخ </a>'+(a.userId==app.userId?'            <a class="edit pointer metadata"> ویرایش </a>':"")+(a.userId==app.userId?'            <a class="remove pointer metadata"> حذف </a>':"")+'            </span>        </div>        <div class="actions">        </div>    </div>'+(a.childs&&a.childs.length?f(a.childs):"")+"</div>"}function f(a,b){var c=(a||[]).map(e,b).join("");return'<div class="ui tiny relaxed threaded comments '+(b?" root":"")+'" '+(b?'style=" '+(w?"":"min-height:"+t+"px; overflow:auto;")+'   flex-grow: 1;flex-shrink: 1;flex-basis: 0px;"':"")+">"+c+"</div>"}function g(c){var d=b.FinalWhereList.map(function(a){var b='<div class="ui orange mini label"><span>'+a.Key.replace(/\[id\d+\].\[(.*)\]/,"$1")+': </span><span style="font-weight:200;">'+a.Value.join(",")+"</span></div>";return b}).join(""),e=f(c,!0),g='<form class="ui tiny form">  <div class="final-where">'+d+'</div>  <div class="comment-modal-value"><span class="measure-value"></span> در <span class="label-value"></span>  <span class="value-value"></span></div>  <div class="field">    <textarea type="text"  rows="1" placeholder=" نظر شما چیست؟ خط جدید با Cntl + Enter"></textarea>  </div></form>';return'<div class="ui modal comment-modal comment-section rtl modal'+a.ChartInPageId+'" style="cursor: initial;">     <i class="close icon"></i>     <div class="header">کامنت گذاری</div>     <div class="content '+(w?"scrolling":"")+'" style="padding:0">         <div class="ui mobile reversed stackable padded grid">             <div class="six wide column" '+(w?"":'style="border-left: 1px solid #dcddde;display: flex;flex-direction: column;justify-content: flex-end;"')+">"+e+'     <div class="header" style="flex"></div>'+g+'             </div>             <div class="six wide column chart-container" id="'+r+'" >                   <div class="ui active inverted dimmer"><div class="ui text loader">آماده‌سازی نمودار</div></div>             </div>         </div>     </div></div>'}function h(){A.find(".selected-comment").remove(),A.find(".selected-comment-edit").remove(),B.val(null)}function i(a,c){if(!a||!c)return"";var d=y.indexOf(a),e=z.indexOf(c),f=b.series.data[d][e];return f}function j(a){B.val(a.comment),!a.seriesLable;var b=i(a.seriesLable,a.measure);F.data("v",a.seriesLable),E.data("v",a.measure),B.focus(),D.hide(),a.seriesLable&&(D.show(),F.text(a.seriesLable),E.text(a.measure),G.text(persian(d3.format(",.2f")(b),!0)))}function k(c){c.find(".version").on("click",function(){var b=$(this).data("version");app.chartCommons.commentUtils.showLastVersionChart=function(){$(v+" .content").charts(a.type,{id:v.substring(1,1e3),parameters:{type:a.dataType,fromCommentDialog:!0,lastVersionInfo:{version:b,lastVersionChartId:a.chartId}}})},$(v).modal("show")}),c.find(".reply").on("click",function(){var a=$(this).parents(".comment").data("id");h(),$selectedComment=$('<div class="ui mini label selected-comment field" data-id="'+a+'">پاسخ به '+a+' <i class="icon close" style="margin:0;"/>  </div>'),A.find(".ui.form").prepend($selectedComment),$selectedComment.find(".icon").on("click",h),B.focus()}),c.find(".edit").on("click",function(){var a=$(this).parents(".comment").data("id"),b=$(this).parents(".comment").first();h(),$selectedComment=$('<div class="ui mini label selected-comment-edit field" data-id="'+a+'"> ویرایش '+a+' <i class="icon close" style="margin:0;"/>  </div>'),A.find(".ui.form").prepend($selectedComment),$selectedComment.find(".icon").on("click",h),j({comment:b.find(".comment-text").first().text().trim(),label:b.find(".value").first().data("label"),measure:b.find(".value").first().data("measure")})}),c.find(".remove").on("click",function(){var c=$(this).parents(".comment").data("id"),d=$(this).parents(".comment").first(),e=confirm("در صورت حذف کامنت تمام پاسخ‌ها نیز حذف می‌شوند. آیا برای حذف اطمینان دارید؟");if(e){var f=app.urlPrefix+"api/chartComments/Delete?id="+c;$.post(f).done(function(e){d.transition("scale");var f=null;if(_.each(u,function(a){a.id==c&&(f=a)}),l(b.comment,c,function(a,b,d){b.id==c&&a.splice(d,1)}),f){var g=app.chartCommons.commentUtils.getCommentCount(u,e.label,e.measure);app.chartCommons.commentUtils.updateIconCommentCount(a.ChartInPageId,e,g)}})}})}function l(a,b,c){var d=null,e=0;return _.each(a,function(f){if(c&&c(a,f,e),f.id==b)return d=f,!1;var g=l(f.childs,b);return g?(d=g,!1):void e++}),d}function m(a){A.find(" .root.comments > .comment").hide(),_.each(a,function(a){A.find(" .root.comments > .comment[data-id="+a.id+"]").show()})}function n(a){return u.filter(function(b){return a.category==b.label&&a.seriesLable==b.measure})}function o(){var c=_.extend({},a);c.id=r,c.fromCommentDialog=!0,$("#"+c.id).empty(),app.chartCommons.commentUtils.destroyListener(c.ChartInPageId),app.chartCommons.draw(c.type,b,c,!1),$("#"+r).on("select-series",function(a,b){j({comment:"",label:b.category,measure:b.seriesLable}),m(n(b))})}function p(){function b(b){C.removeClass("loading"),B.val(null),h(),u=u||[];var c=l(u,o);if(c)c.childs=c.childs||[],c.childs.push(b);else{u.push(b);var d=app.chartCommons.commentUtils.getCommentCount(u,b.label,b.measure);app.chartCommons.commentUtils.updateIconCommentCount(a.ChartInPageId,b,d)}var g=A.find(".comments.root");if(o){if($parentComment=A.find(".comment[data-id="+o+"] .comments"),0==$parentComment.length){$parentComment=A.find(".comment[data-id="+o+"]");var i=$(f());$parentComment.append(i),$parentComment=i}g=$parentComment}var j=$(e(b));g.append(j),k(j),setTimeout(function(){var a=A.find(".root.comments [data-id="+b.id+"]"),c=A.find(".root.comments");c.animate({scrollTop:c.scrollTop()+a.offset().top-c.height()+a.height()},400),setTimeout(function(){a.transition("pulse")},400)},400)}var c=F.data("v"),g=E.data("v");if(_.isArray(c)&&(c=c[0]),_.isArray(g)&&(g=g[0]),_.isEmpty(B.val()))return void alert("کامنت خود را بنویسید");if(_.isEmpty(c))return void alert("یکی از ردیف‌های اطلاعاتی را انتخاب کنید");if(_.isEmpty(g))return void alert("یکی از داده‌ها را انتخاب کنید");var j=i(c,g),m=$(q+" .chart-data").data("settings"),n=app.chartCommons.getFilterParameter(m.ChartInPageId,m.input.RefreshDatasource),o=A.find(".selected-comment").data("id"),p=A.find(".selected-comment-edit").data("id"),r={where:m.input.FinalWhereList,chartId:m.chartId,dashboardId:dashboard.pageId,datasourceId:m.input.DataSourceId,dimention:m.input.CurrentDimName,input:JSON.stringify(m.input),drillDown:n.drillDown,otherFilters:n.otherFilters,userControlFilter:n.userControlFilter,userVariable:n.userVariable,comment:B.val().trim(),parentId:o,label:c,measure:g,value:j};return C.addClass("loading"),p?void $.post(app.urlPrefix+"api/ChartComments/edit?id="+p+"&text="+B.val().trim()+"&label="+c+"&measure="+g+"&value="+j).done(function(a){C.removeClass("loading"),h(),B.val(null);var b=A.find(".comment[data-id="+p+"]").first(),c=A.find(".comment[data-id="+p+"] .comment-text").first(),e=A.find(".comment[data-id="+p+"] .value-string").first();c.text(a.comment),e.html(d(a)),setTimeout(function(){b.transition("pulse")},400)}).fail(function(a){C.removeClass("loading")}):void $.ajax({type:"POST",url:app.urlPrefix+"api/ChartComments/save/0",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",dataType:"json",success:b,error:function(a){C.removeClass("loading")}})}if(b.FinalWhereList){var q=app.chartCommons.commentUtils.getChartSelector(a.ChartInPageId),r=app.chartCommons.commentUtils.getChartInModalSelector(a.ChartInPageId),s=$(q+" .show-chart-comments"),t=300;$(q+" .comment-section").remove();var u=b.comment;if(!a.fromCommentDialog){var v=".last-version-modal";$(".comment-modal.modal"+a.ChartInPageId).remove(),$(q).off("new-comment"),s.off("click"),c();var w=$(window).width()<768;if(u){moment.locale("fa"),$(q).data("init-befor",!0);var x=app.chartCommons.commentUtils.getLabelsMeasures(b),y=x.labels,z=x.measures,A=$(g(u)),B=A.find("textarea"),C=A.find(".button"),D=(A.find(".chart-container"),A.find(".comment-modal-value")),E=A.find(".measure-value"),F=A.find(".label-value"),G=A.find(".value-value"),H={type:"modal",render:function(){$(q).append(A),k(A),B.on("keyup",function(a){return 13==a.keyCode&&a.ctrlKey?void B.val(B.val()+"\n"):void(13==a.keyCode&&p())}),"modal"==this.type&&(A.modal({allowMultiple:!0,onVisible:function(){o(),$(app.chartCommons.commentUtils.getChartSelector(a.ChartInPageId)).trigger("highlight-element",[H.highlightedValue])}}),s.on("click",function(){var a={category:y[0],seriesLable:z[1]};$(q).trigger("new-comment",a)})),"popup"==this.type&&s.popup({popup:$(q+" .popup.ui"),target:$(q+" .ui.card .content"),title:"کامنت‌ها",position:"top right",boundary:$(".main-container"),on:"click",lastResort:!0,prefer:"opposite",onShow:function(a,b){$(q+" .menu-bar").addClass("show-dropdown")},onVisible:function(){$parentDiv=$(".main-container.full-height-container"),$innerListItem=A,$parentDiv.animate({scrollTop:$parentDiv.scrollTop()-$parentDiv.height()+$innerListItem.offset().top+$innerListItem.height()+40},400)},onHide:function(a,b){$(q+" .menu-bar").removeClass("show-dropdown")}})},show:function(){"modal"==this.type&&A.modal("show"),"popup"==this.type&&s.popup("show")}};H.render(),$(q).on("new-comment",function(a,b){j({comment:"",seriesLable:b.category,measure:b.seriesLable}),m(n(b)),H.highlightedValue=b,H.show(),$(q).trigger("highlight-element",[H.highlightedValue])})}}}},jQuery.fn.extend({lazyDropdown:function(a){return this.each(function(){var b=$(this);b.on("click",function(c){b.data("init-dd")||(c.stopPropagation(),c.preventDefault(),b.data("init-dd",!0),b.dropdown(a),b.click())})})}}),d3.selection.prototype.settingsIcon=function(a){return},d3.selection.prototype.legend=function(a,b){var c=this.append("div").attr("class","legend-div temporal").append("div").attr("class","list-inline").style("margin-bottom","12px");return c.selectAll("nothingd").data(a.data).enter().append("span").text(function(a){return persian(a.label,b)}).attr("class","pointer legend-item").on("click",function(b,c){a.selector&&$(a.selector).trigger("legendClick",[b.label,c,b])}).append("span").attr("class","legend-color").style("background-color",function(a){return a.color}),c},d3.selection.prototype.breadcrumb=function(a,b,c,d){var e=a.slice(0);"undefined"!=typeof e[0]&&null!==e[0]&&e.unshift(app.lang.translate("پاک کردن"));var f=e[e.length-1];if(e.splice(e.length-1,1),e.length>0){var g=function(a,d){var f=$("#"+b.id).hasClass("fromCommentDialog");if(!f){var g=c.isProgress,h=c.showProgress;if(!g()){h(!0);var i=app.chartCommons.drillDown.up(b.ChartInPageId,e.length-d);b.parameters={drillDown:i,isUp:!0,upLevel:e.length-d,chartId:b.chartId,ChartInPageId:b.ChartInPageId},b.drill="up",$("#"+b.id).charts(b.type,"refreshWithData",b)}}},h='<div class="ui mini breadcrumb floated right temporal">'+e.map(function(a){return'<a class="section clickable">'+a+"</a>"}).join('<i class="left arrow icon divider"></i>')+'<i class="left arrow icon divider"></i><div class="section active">'+f+"</div></div>";return $(this[0][0]).append(h),void $(this[0][0]).find(".breadcrumb .clickable").each(function(a,b){$(this).on("click",function(){g(0,a)})})}},d3.selection.prototype.titlebar=function(a){var b,c=d3.select(this[0][0]),d=function(){return"visible"==$(c[0][0]).find(".myprogress").css("visibility")},e=$(c[0][0]).parents(".ui.card").find(".progress-overall"),f=function(a){a?($(c[0][0]).find("*").attr("disabled",!0),$(c[0][0]).find(".myprogress").css("visibility","visible"),e.fadeIn()):($(c[0][0]).find("*").attr("disabled",!1),$(c[0][0]).find(".myprogress").css("visibility","hidden"),e.fadeOut())};return{title:b,showProgress:f,isProgress:d}};var d3Utils={prepareDataForBarChart:function(a,b,c,d,e,f){var g=d3.scale.category10();$.each(a,function(a,h){if(!h.kpis)return!0;var i=[];return $.each(h.kpis,function(a,c){var e=b.chartProp.series[d[a]]||b.chartProp.series["default"];g(a);"undefined"==typeof e&&"undefined"!=typeof model&&(e=$.extend(!0,{},"undefined"!=typeof model.seriesProp[d[a]]?model.seriesProp[d[a]]:model.seriesProp["default"]),e.seriesColor=g(a)),i.push({data:c,prop:e,key:d[a],label:f&&f.length>a?f[a]:d[a],type:"kpi",seriesLable:f&&f.length>a?f[a]:d[a],type:"kpi",category:h.label})}),h.series?($.each(h.series,function(a,d){var f=b.chartProp.series[c[a]],g={type:"series",data:isNaN(d)?d:d*parseFloat(f.numberFactor),prop:f,key:c[a],label:e&&e.length>a?e[a]:c[a],seriesLable:e&&e.length>a?e[a]:c[a],category:h.label};g.commentCount=app.chartCommons.commentUtils.getCommentCount(b.input.comment,g.category,g.label),i.push(g)}),void(h.series=i)):!0})},convertToKeyValue:function(a){var b=_.map(a.series.labels,function(b,c){var d=a.seriesLablesCaptions&&a.seriesLablesCaptions.length>c;return{key:b,value:d?a.seriesLablesCaptions[c]:b}}),c=_.map(a.kpis.labels,function(b,c){var d=a.kpisLablesCaptions&&a.kpisLablesCaptions.length>c;return{key:b,value:d?a.kpisLablesCaptions[c]:b}});return{seriesLabels:b,kpiLabels:c}}},app=app||{};app.helper=app.helper||{},function(){function a(a){for(var d=0;d<a.length;d++)for(var e=0;e<b.length;e++)a.charAt(d)===b[e]&&(a=a.replace(a.charAt(d),c[e]));return a}var b=["ي","إ","ؤ","أ","ي","ك"],c=["ی","ا","و","ا","ی","ک"];app.helper.filterMemberDialogOk=function(){var a=$("#filter-member-dialog").data("data");$("#filter-member-dialog .li ").each(function(b,c){var d=$(this).find("input"),e=$.grep(a.members,function(a){return a.Uniquename==d.attr("value")})[0];e.IsChecked=d.prop("checked")}),a.onfinish(a.members),$("#filter-member-dialog").modal("hide")},app.helper.filterMemberDialog=function(b,c,d){function e(a,b,c){var d='<div class=" " style="height:50vh; overflow:auto;"> '+b.map(function(a,b){return'<div class="li"><input value="'+a.Uniquename+'" type="checkbox" id="member-'+b+'" '+(a.IsChecked?" checked ":"")+' /> <label class="unstyled-lable" for="member-'+b+'">'+a.Caption+"</label></div>"}).join("")+"</div>";c.find(".member-list").html(d),$("#filter-member-dialog").modal("refresh")}var f=function(d){var f=window.innerHeight,g=$("#filter-member-dialog").outerHeight(),h=f-g-50;body='<div class="ui form"><input type="text" class="form-control" id="filter-member-search" placeholder="جستجو"></div>                    <input id="select-all-member-filter" type="checkbox" style="margin-top:10px"/><label style="margin-right:5px;" for="select-all-member-filter"> همه </label>                    <div class="member-list"></div>';var i=$("#filter-member-dialog #filter-member-dialog-content");i.html(body),$("#select-all-member-filter").change(function(){var a=this.checked;$("#filter-member-dialog ul li input").filter(function(){return $(this).is(":visible")}).prop("checked",a)}),e(h,b,i);var j;$("#filter-member-dialog #filter-member-search").keyup(function(){var b=$(this).val().toLowerCase();if(b=a(b),c){if(b&&1==b.length)return;clearTimeout(j),j=setTimeout(function(){$.ajax(c+"&query="+b).done(function(a){var b=$("#filter-member-dialog").data("data");b.members=a,e(h,a,i)})},400)}else $("#filter-member-dialog li").show(),$("#filter-member-dialog li").filter(function(){var c=$(this).text().toLowerCase();return c=a(c),-1==c.indexOf(b.toLowerCase())}).hide()})};$("#filter-member-dialog").modal({onVisible:f}).modal("show"),$("#filter-member-dialog").data("data",{members:b,onfinish:d}),$("#filter-member-dialog").modal("show")}}($),function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function c(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}c.prototype={show:function(){var c=this.getTitle();if(c&&this.enabled){var d=this.tip();d.find(".tipsy-inner")[this.options.html?"html":"text"](c),d[0].className="tipsy",d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);
var e=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth||0,height:this.$element[0].offsetHeight||0});if("object"==typeof this.$element[0].nearestViewportElement){var f=this.$element[0],g=f.getBoundingClientRect();e.width=g.width,e.height=g.height}var h,i=d[0].offsetWidth,j=d[0].offsetHeight,k=b(this.options.gravity,this.$element[0]);switch(k.charAt(0)){case"n":h={top:e.top+e.height+this.options.offset,left:e.left+e.width/2-i/2};break;case"s":h={top:e.top-j-this.options.offset,left:e.left+e.width/2-i/2};break;case"e":h={top:e.top+e.height/2-j/2,left:e.left-i-this.options.offset};break;case"w":h={top:e.top+e.height/2-j/2,left:e.left+e.width+this.options.offset};break;case"c":h={top:e.top+e.height/2-j/2,left:e.left+e.width/2-i/2}}2==k.length&&("w"==k.charAt(1)?h.left=e.left+e.width/2-15:h.left=e.left+e.width/2-i+15),d.css(h).addClass("tipsy-"+k),d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+k.charAt(0),this.options.className&&d.addClass(b(this.options.className,this.$element[0])),this.options.fade?d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):d.css({visibility:"visible",opacity:this.options.opacity});var l=this,m=function(a){return function(){l.$tip.stop(),l.tipHovered=a,a||(0===l.options.delayOut?l.hide():setTimeout(function(){"out"==l.hoverState&&l.hide()},l.options.delayOut))}};d.hover(m(!0),m(!1))}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title"),"object"==typeof a.context.nearestViewportElement&&a.children("title").length&&a.append("<original-title>"+(a.children("title").text()||"")+"</original-title>").children("title").remove()},getTitle:function(){var a,b=this.$element,c=this.options;if(this.fixTitle(),"string"==typeof c.title){var d="title"==c.title?"original-title":c.title;a=b.children(d).length?b.children(d).html():b.attr(d)}else"function"==typeof c.title&&(a=c.title.call(b[0]));return a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){function d(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function e(){var a=d(this);a.hoverState="in",0===b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function f(){var a=d(this);if(a.hoverState="out",0===b.delayOut)a.hide();else{var c=function(){a.tipHovered&&b.hoverlock||"out"==a.hoverState&&a.hide()};setTimeout(c,b.delayOut)}}if(b===!0)return this.data("tipsy");if("string"==typeof b){var g=this.data("tipsy");return g&&g[b](),this}if(b=a.extend({},a.fn.tipsy.defaults,b),b.hoverlock&&0===b.delayOut&&(b.delayOut=100),"manual"!=b.trigger){var h=b.live?"live":"bind",i="hover"==b.trigger?"mouseenter":"focus",j="hover"==b.trigger?"click":"blur",k="hover"==b.trigger?"mouseleave":"blur";this[h](i,e)[h](k,f)[h](j,f)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover",hoverlock:!1},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1?c[1]:!1},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return g.offset().top<e&&(d.ns="n"),g.offset().left<f&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-g.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-g.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery);var app=app||{};app.charts=app.charts||{},app.charts.bar={},app.charts.bar.draw=function(a,b,c,d){function e(a,b,c){var d=c.indexOf(a.firstField),e=b[d],f=a.secondFieldIsText?a.secondFieldInput:b[c.indexOf(a.secondFieldSelect)];switch(e=depersian(e),f=depersian(f),isNaN(f)||(f=+f),isNaN(e)||(e=+e),+a.operand){case 1:return e==f;case 2:return e!=f;case 3:return e>f;case 4:return e>=f;case 5:return f>e;case 6:return f>=e;case 7:return e.indexOf(f)>-1;case 8:return e.indexOf(f)<=-1}}function f(a,c,d){b.chartProp.indicator&&b.chartProp.indicator.forEach(function(b){var f=!0;$.each(b.ifRow,function(a,b){return e(b,c,d)?void 0:(f=!1,!1)}),f&&a.map(function(a){return a.thenRows=a.thenRows||[],a.thenRows.push(b.thenRow),a})})}function g(a,c,d,e){var f=G[a].series;return 1==c&&d&&"undefined"!=typeof e&&(f=f.filter(function(a){return a.prop.seriesType==d&&!a.prop.hidden}),f=[f[e]]),2==c&&(f=f.filter(function(a){return!a.prop.hidden})),f=f.map(function(a){return{data:a.data,label:a.prop.name||a.label,format:z(a.prop),color:a.prop.seriesColor}}),app.chartCommons.tooltip.tooltipFormatter({points:f,key:G[a].label,sum:d3.sum(f,function(a){return a.data}),avg:d3.sum(f,function(a){return a.data})/f.length,format:f.length>0?f[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,u)}function h(a){var b=a[0].series.filter(function(a,b){return"line"==a.prop.seriesType&&!a.prop.hidden}),c=b.map(function(b,c){var d={label:b.label,prop:b.prop,values:a.map(function(a,c){var d={label:a.label+"#"+a.index,value:a.series.filter(function(a,c){return a.label==b.label})[0].data,valueLabel:a.series.filter(function(a,c){return a.label==b.label})[0].data,prop:a.series.filter(function(a,c){return a.label==b.label})[0].prop,onClickVal:a.onClickVal,primv:a.value,category:a.label,commentCount:a.series.filter(function(a,c){return a.label==b.label})[0].commentCount,seriesLable:b.label};return d}),valueStacked:a.map(function(a,c){return{label:a.label+"#"+a.index,valueLabel:a.series.filter(function(a,c){return a.label==b.label})[0].data,value:a.series.filter(function(a,c){return a.label==b.label})[0].data,prop:a.series.filter(function(a,c){return a.label==b.label})[0].prop,onClickVal:a.onClickVal,primv:a.value}})};return d}),d=0==c.length?[]:c[0].valueStacked.map(function(a){return Math.abs(a.value)});return c.forEach(function(a,b){if(0!=b){var e=c[b-1];a.valueStacked.forEach(function(a,b){d[b]+=Math.abs(a.value),a.value+=e.valueStacked[b].value})}}),F&&c.forEach(function(a,b){a.valueStacked.forEach(function(a,b){a.value=a.value/d[b]*100})}),c.forEach(function(a,b){a.prop.dontShowZeroValue&&(a.values=a.values.filter(function(a){return a.value>0}),a.valueStacked=a.valueStacked.filter(function(a){return a.value>0}))}),c}function i(){clearTimeout(db),bol=P.property("checked"),b.isSort=bol;var a=Q[0][0].selectedIndex,c=Q[0][0].value,d=(Q[0][0],!0);a>=k.length&&(d=!1),xa.domain(b.isSort?G.sort(function(a,b){return na=a.series.filter(function(a){return a.label==c}),nb=b.series.filter(function(a){return a.label==c}),na instanceof Array?(na=na[0],nb=nb[0],"series"==na.type?nb.data-na.data:nb.data[0]-na.data[0]):0}).map(function(a){return a.label+"#"+a.index}):G.sort(function(a,b){return a.index-b.index}).map(function(a){return a.label+"#"+a.index})),za.domain(b.isSort?G.filter(ca).sort(function(a,b){return na=a.series.filter(function(a){return a.label==c}),nb=b.series.filter(function(a){return a.label==c}),na instanceof Array?(na=na[0],nb=nb[0],"series"==na.type?nb.data-na.data:nb.data[0]-na.data[0]):0}).map(function(a){return a.label+"#"+a.index}):G.filter(ca).sort(function(a,b){return a.index-b.index}).map(function(a){return a.label+"#"+a.index}));var e=Z.transition().duration(b.animationDuration),g=function(a,b){return H?50*b:0};e.selectAll(".gd").delay(g).attr("transform",function(a){return"translate("+xa(a.label+"#"+a.index)+",0)"}),e.selectAll(".gd-text").delay(g).attr("transform",function(a){return"translate("+xa(a.label+"#"+a.index)+",0)"});var i=h(G);Z.selectAll(".area").data(i).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-area"==b?E?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("d",function(a){return 0===a?Ya:Ya.interpolate(a[0].prop.lineStyle)(a)}),Z.selectAll(".line").data(i).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"line-area"==b||"line"==b?E?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("d",function(a){return 0===a?$a:$a.interpolate(a[0].prop.lineStyle)(a)}),Z.selectAll(".circle-group").data(i).selectAll(".circle").data(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"dot"==b?E?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("stroke",function(a,b){var c=[a],d=d3.select(this.parentNode).datum().label,e=G[b].series.map(function(a){return a.label}),g=G[b].series.map(function(a){return a.data});f(c,g,e),a=c[0];var h=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(a,b){$.each(b,function(a,b){if(d!=b.firstField)return!0;switch(+b.operand){case 1:h=b.secondFieldColor}})}),h}).attr("cx",function(a){return $a.interpolate(a.prop.lineStyle).x()(a)}).attr("cy",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}),Z.selectAll(".text-vals").data(i).selectAll(".text-value").data(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"dot"==b?E?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("x",function(a){var b=d3.select(this).node().getBBox().width;return $a.interpolate(a.prop.lineStyle).x()(a)-b/2}).text(function(a){return persian(d3.format(z(a.prop.font,a.prop))(a.valueLabel),u)}).attr("dy","-10").attr("y",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}),Z.selectAll(".colorStepGroup").data(i).selectAll("stop").data(function(a){var b=[],c=1/(2*(a.values.length-1)),d=-1*c;return a.values.map(function(e,g){var h={value:e.value,label:a.label,color:a.prop.seriesColor},i=[h],j=G[g].series.map(function(a){return a.label}),k=G[g].series.map(function(a){return a.data});f(i,k,j),h=i[0],h.offset=0>d?0:d,b.push(h),h=$.extend({},h),d+=2*c,h.offset=d>1?d-c:d,b.push(h)}),b}).transition().attr("stop-color",function(a,b){var c=a.color;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("offset",function(a){return a.offset}),e.select(".x.axis").call(fa).selectAll("g").delay(g),e.select(".x.axis").selectAll("g text").attr("transform",function(){return Ea?"rotate(-90)":"rotate(0)"}).attr("class","axes-x-label").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal").attr("x","-1em").attr("dy","0.1em").attr("y","0").delay(g),Z.select(".x.axis").selectAll("g text").attr("transform",function(){return Ea?"rotate(-90)":"rotate(0)"}).style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal").style("text-anchor","end").attr("x","-1em").attr("dy","0.1em").attr("y","0").append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),u)})}b.input=a;a.title,a.chartInfo;app.chartCommons.calculateFields(a.series,b.calculatedFields);var j="undefined"!=typeof a.series?a.series.labels:[],k="undefined"!=typeof a.kpis?a.kpis.labels:[],l=a.seriesLablesCaptions,m=a.kpisLablesCaptions,n="#"+b.id,o=$(n).hasClass("fromCommentDialog"),p={top:0,right:20,bottom:0,left:20},q=$(n).width(),r="small"==b.chartProp.info.chartSize?80:"medium"==b.chartProp.info.chartSize?130:"large"==b.chartProp.info.chartSize?160:"veryLarge"==b.chartProp.info.chartSize?200:130,s=!app.mobileMode,t=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked,u="undefined"==typeof a.lang?!0:0==+a.lang,v=r+p.top+p.bottom,w=d3.scale.category10();b.width=q;var x=d.isProgress,y=d.showProgress,z=(d.title,function(a,b){if(!a)return",.2f";var c=a;if(!a.formatString){if(!b)return",.2f";c=b}return"custom"!=c.formatString?c.formatString:c.formatStringCustom}),A=+b.chartProp.info.stackedBar,B=3==A||2==A,C=3==A,D=+b.chartProp.info.stackedLine,E=3==D||2==D,F=3==D;if(app.chartCommons.setDefault(b.chartProp,k.concat(j),"bar"),b.editMode&&$(n).trigger("chartproperty",[k.concat(j)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));for(var G=prepareData(a,b.chartProp),H=G.length<25,I=d3.scale.category10(),J=[],K=0;K<j.length;K++){var L=b.chartProp.series[j[K]];if("undefined"==typeof L){L=0==b.chartProp.series.length?{seriesColor:"#1F77B4",seriesType:"bar",formatStringCustom:",.2f",formatString:",.2f",numberFactor:"1",showValues:!1,hidden:!1,cumulative:!1,lineFace:"5,0",lineWeight:"2",lineStyle:"linear",lineType:"line-dot-area",showValueColor:"#333333"}:$.extend({},b.chartProp.series[Object.keys(b.chartProp.series)[0]]);for(var M="#1F77B4",K=0;10>K&&(M=I(K)||"#1f77b4",-1!=J.indexOf(M.toLowerCase()));K++);L.seriesColor=M,L.name=null,b.chartProp.series[j[K]]=L}L.font&&!L.datasourceType||(L.font={bold:!1,color:L.showValueColor||"#333333",italic:!1,fontSize:L.showValueFontSize||"12px",fontName:"Droid"}),J.push(L.seriesColor.toLowerCase())}d3Utils.prepareDataForBarChart(G,b,j,k,l,m);for(var N=null,K=0;K<G.length;K++){N||(N=new Array(G.length));for(var O=0;O<G[K].series.length;O++)N[K]||(N[K]=new Array(G[K].series.length)),N[K][O]=N[K][O]||{sum:null,avg:null,"var":null},G[K].series[O].prop&&G[K].series[O].prop.cumulative&&("undefined"!=typeof G[K].series[O].prop.cumulative_formula&&"sum"!=G[K].series[O].prop.cumulative_formula||(N[K][O].sum=d3.sum(G.filter(function(a,b){return K>=b}),function(a,b){return a.series[O].data})),"avg"==G[K].series[O].prop.cumulative_formula&&(N[K][O].avg=d3.mean(G.filter(function(a,b){return K>=b}),function(a,b){return a.series[O].data})),"var"==G[K].series[O].prop.cumulative_formula&&(N[K][O]["var"]=d3.variance(G.filter(function(a,b){return K>=b}),function(a,b){return a.series[O].data})))}for(var K=0;K<G.length;K++)for(var O=0;O<G[K].series.length;O++)G[K].series[O].prop&&G[K].series[O].prop.cumulative&&(G[K].series[O].data=N[K][O]["var"]||N[K][O].sum||N[K][O].avg);C&&G.forEach(function(a){var b=a.series.filter(function(a,b){return!a.prop.hidden&&"bar"==a.prop.seriesType}),c=d3.sum(b.map(function(a){return Math.abs(a.data)}));b.forEach(function(a){a.data=a.data/c*100})}),$(n).addClass("bar-line-chart");var P,Q,R=d3.select(n).append("div").attr("class","legend-bar temporal");if(P=d3.select(n).select("#sort_checkbox_btn"),Q=d3.select(n).select("#sort_checkbox select"),!P[0][0]&&G.length>0){var S=R.append("div").attr("id","sort_checkbox").attr("class","sort-checkbox");P=S.append("label").append("input").attr("type","checkbox").attr("id","sort_checkbox_btn"),S.select("label").append("span"),app.lang.translateAsync("sort",function(a){var b=$(S[0][0]).find("span");b.html(" "+a)});var Q=S.append("select").on("change",function(){var a=P.property("checked");b.isSort=a,P.property("checked")&&i()}).style("margin","0 7px");k.length+j.length==1&&Q.style("visibility","hidden").style("width","1px"),Q.selectAll("nothings").data(G[0].series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return{name:(a.prop.name||a.label).replace(/^\[measure\]/,""),value:a.label}})).enter().append("option").text(function(a){return persian(a.name,u)}).attr("value",function(a){return a.value})}if("undefined"==typeof b.chartProp.info.showSortBox||b.chartProp.info.showSortBox||$(n+" #sort_checkbox").hide(),R.breadcrumb(a.levels,b,d,u),!a.matrix||0==a.matrix.length)return void R.append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");R.legend({width:q,selector:n,data:G[0].series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return{label:(a.prop.name||a.label).replace(/^\[measure\]/,""),color:a.prop.seriesColor,key:a.key}})},u);var T=d3.max(G,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?+a.data||0:void 0})}),U=d3.min(G,function(a){return d3.min(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?+a.data||0:void 0})});if(B){var V=d3.max(G,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden&&"bar"==a.prop.seriesType}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?a.data>0?a.data:0:void 0})});T=V>T?V:T;var W=d3.min(G,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?a.data<0?a.data:0:void 0})});U=U>W?W:U}if(E){var V=d3.max(G,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden&&"line"==a.prop.seriesType}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?a.data>0?a.data:0:void 0})});T=V>T?V:T;var W=d3.min(G,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?a.data<0?a.data:0:void 0})});U=U>W?W:U}T=Math.max(T||0,0),U=Math.min(U||0,0),U-=Math.abs(.1*U),T+=Math.abs(.1*T);var X=G[0].series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}).length,Y=G[0].series.filter(function(a){return"series"==a.type&&"line"==a.prop.seriesType&&!a.prop.hidden}).length;(F&&Y>0||C&&X>0)&&(T=100,U=0>U?-100:0),b.chartProp.info.yAxisMax&&(T=+b.chartProp.info.yAxisMax),b.chartProp.info.yAxisMin&&(U=+b.chartProp.info.yAxisMin);var Z=d3.select(n).append("svg").attr("class","temporal line-chart"),_=+b.chartProp.info.xAxisLen||20;b.chartProp.info.font||(b.chartProp.info.font={bold:!1,color:"#333333",italic:!1,fontSize:"12px",fontName:"Droid"});var aa=50,ba=G.length/aa,ca=function(a,b){return G.length<=aa?!0:(0==b&&(this.meter=0),b>=this.meter?(this.meter+=ba,!0):!1)},da=30;if(app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,2==app.dashboardLayoutVersion&&!b.editMode){var ea=d3.scale.ordinal().rangeRoundBands([q-400,q],.1);ea.domain(G.map(function(a){return a.label+"#"+a.index}).filter(ca));var fa=d3.svg.axis().scale(ea).orient("bottom").tickFormat(function(a){var b=a.replace(new RegExp("#\\d+$"),"");return(b.length>_?"...":"")+persian(b.substring(0,_),u)}),ga=d3.select(n).append("svg");ga.append("g").attr("class","x axis").call(fa),ga.selectAll("g text").attr("transform","rotate(-90)").attr("x","-1em").attr("dy","0.1em").attr("y","0").attr("fill",b.chartProp.info.font.color).attr("class","axes-x-label").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal").append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),u)});var ha=ga.node(),ia=ha.getBBox();try{da=ga.selectAll("text")[0][1].getBBox().height}catch(ja){}var ka=$(n+" .title").outerHeight(),la=$(n+" .legend-bar"),ma="undefined"==typeof la?0:la.height()+ +la.css("margin-top").replace("px","");ga.remove(),r=$(n).height()-ka-ma-ia.height-15,!app.mobile,Z.attr("width",q).attr("height",r+ia.height+15)}var oa=d3.scale.linear().range([r+p.top,p.top]).domain([U,T]),pa=d3.svg.axis().scale(oa).orient("left").tickFormat(function(a){var c=d3.format(b.chartProp.info.formatString);return persian(c(a),u)+""});pa.ticks(Math.floor(r/22)+1);var qa=Z.append("g").attr("class","y axis").attr("transform","translate(-10,0)");qa.call(pa);var ra=qa[0][0].getBBox(),sa=q-ra.width-p.left;G=G.filter(function(a,b){return sa-2-.1*sa>b});var ta=[q-sa+10,q-10],ua=.1,va=G.length<10?1:0;qa.attr("transform","translate("+(ra.width+p.left)+",0)");var wa=$.grep(G[0].series,function(a,b){return"bar"==a.prop.seriesType&&!a.prop.hidden}),xa=($.grep(G[0].series,function(a,b){return"line"==a.prop.seriesType&&!a.prop.hidden}),d3.scale.ordinal().rangeBands(ta,ua,va));xa.domain(G.map(function(a){return a.label+"#"+a.index}));var ya=d3.scale.ordinal().rangeBands([0,xa.rangeBand()]).domain($.map(wa,function(a){return a.label})),za=d3.scale.ordinal().rangeBands(ta,ua,va);aa=Math.abs(ta[0]-ta[1])/da,ba=G.length/aa,za.domain(G.map(function(a){return a.label+"#"+a.index}).filter(ca));var fa=d3.svg.axis().scale(za).orient("bottom").tickFormat(function(a){var b=a.replace(new RegExp("#\\d+$"),"");return(b.length>_?"...":"")+persian(b.substring(0,_),u)});Z.append("svg:rect").attr("class","background").style("fill","white").style("opacity","0").attr("width",sa).attr("height",+Z.attr("height")).attr("transform","translate("+(q-sa)+",0)").on("click",function(c,d){o||""!=a.levels&&(x()||(y(!0),b.isSort=P.property("checked"),app.chartCommons.drillDown.up(b.ChartInPageId),b.parameters={isUp:!0,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},$(n).charts(chartTypes.BAR,"refreshWithData",b)))}),b.chartProp.info.horizontalLines&&Z.select(".y.axis").selectAll("g line").attr("x2",sa).attr("x1","-6").style("opacity","0.1"),Z.select(".y.axis").append("text").attr("transform","translate(0,"+p.top+") rotate(-90)").attr("y",6).attr("dy",".71em").attr("class","axes-x-label").text("");var Aa=(d3.scale.ordinal().domain([0,1,2]).range(["#eee","#ddd","#ccc"]),b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0);Z.append("g").attr("class","x axis").attr("transform","translate(0,"+(r+p.top)+")").call(fa);var Ba=Z.select(".x.axis").selectAll("g text").attr("class","axes-x-label").attr("x","-1em").attr("dy","0.1em").attr("y","0").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal"),Ca=d3.max(Ba[0],function(a){return a.getBBox().width}),Da=Ba[0].length*Ca,Ea=Da>sa;Ea=!0,Ea&&Ba.attr("transform","rotate(-90)"),Ba.append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),u)});var Fa=function(c,d){if(!o){if(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.value],b.chartProp.globalvariable),$(n+" .gd.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(n+" .circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.onClickVal)return void(t&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard));if(!x()){y(!0);var e=P.property("checked");b.isSort=e,app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},$(n).charts(chartTypes.BAR,"refreshWithData",b)}}},Ga=Z.append("g").attr("class","charts"),Ha=Ga.selectAll(".gd").data(G).enter().append("g").attr("transform","translate("+xa(G[0].label+"#"+G[0].index)+",0)").attr("class",function(a){return"gd "+(""!=a.onClickVal||Aa||t?" pointer":"")}).on("click",Fa),Ia={lastTexts:[],clear:function(){this.lastTexts=[]},noConfilict:function(a,b,c,d){for(var e=!0,f=0;f<this.lastTexts.length;f++){var g=this.lastTexts[f];if(e=c+xa.rangeBand()/2-a/2>g.x+3||g.y-g.h-3>d||g.y<d-b-3,!e)break}return e&&(this.lastTexts.length>=5&&this.lastTexts.shift(),this.lastTexts.push({x:c+a/2,y:d,h:b})),e}};if(B){var Ja=G.map(function(a){return a.label+"#"+a.index}),Ka=Ha.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}),c=a.series.map(function(a){return a.label}),d=a.series.map(function(a){return a.data});return f(b,d,c),b}).enter().append("g").attr("class","series").attr("transform",function(a,b){return"translate(0,0)"});oa(U)-oa(0);Ka.append("rect").attr("width",xa.rangeBand()).attr("fill",function(a,b){var c=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("y",function(a){return oa(a.data>=0?a.data>T?T:a.data:0)}).attr("height",function(a){return a.data>0?oa(Math.max(0,U))-oa(a.data>T?T:a.data):oa(a.data<U?U:a.data)-oa(0)}).on("click",function(a){o&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)});var La=[[]],Ma=Z.selectAll(".gd-text").data(G).enter().append("g").attr("transform","translate("+xa(G[0].label+"#"+G[0].index)+",0)").attr("class",function(a){return"gd-text"+(""!=a.onClickVal||Aa?" pointer":"")}).on("click",Fa),Na=Ma.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden});return b}).enter(),La=Na.append("text").text(function(a){return a.prop.showValues?0==a.data?"":persian(d3.format(z(a.prop.font,a.prop))(a.data),u):""}).attr("x","1em").attr("dy","0.3em").style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).attr("y",function(a){return oa(a.data>=0?a.data>T?T:a.data:0)+(a.data>0?oa(Math.max(0,U))-oa(a.data>T?T:a.data):oa(a.data<U?U:a.data)-oa(0))/2});app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,Ka,function(a){return xa.rangeBand()/2+5},function(a){var b=a.data>0?oa(Math.max(0,U))-oa(a.data>T?T:a.data):oa(a.data<U?U:a.data)-oa(0),c=oa(a.data>=0?a.data>T?T:a.data:0);return c+b/2-24}),o&&app.chartCommons.commentUtils.setOnHighlightListener(Ha.selectAll(".series"),b.ChartInPageId);var Oa=Ma.selectAll(".comment"),Pa=-999999;Ka.forEach(function(a,b){var c=La[b]||[],d=0,e=0,f=0;a.forEach(function(a,g){var h=c[g]||null;if(null!=h){var i=h.getBBox().width,j=xa.rangeBand();f=j/2-i/2,xa(Ja[b])+f>Pa+5?Pa=xa(Ja[b])+i/2:h.remove()}var k=a.__data__.data,l=d3.select(a).select("rect").attr("height");k>=0?(d3.select(a).attr("transform",function(a,b){return"translate(0,"+d+")"}),d3.select(Oa[0][g]).attr("transform",function(a,b){return"translate(0,"+d+")"}),null!=h&&d3.select(h).attr("transform",function(a,b){return"translate(0,"+d+")"}).attr("x",f),d-=+l):(d3.select(a).attr("transform",function(a,b){return"translate(0,"+e+")"}),null!=h&&d3.select(h).attr("transform",function(a,b){return"translate(0,"+e+")"}).attr("x",f),e+=+l)})})}else{var Ka=Ha.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}),c=a.series.map(function(a){return a.label}),d=a.series.map(function(a){return a.data});return f(b,d,c),b}).enter().append("g").attr("class","series").attr("transform",function(a,b){return"translate("+ya(a.label)+",0)"});oa(U)-oa(0);Ka.append("rect").attr("width",ya.rangeBand()).attr("fill",function(a,b){var c=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("y",function(a){return oa(a.data>=0?a.data>T?T:a.data:0)}).attr("height",function(a){return a.data>0?oa(Math.max(0,U))-oa(a.data>T?T:a.data):oa(a.data<U?U:a.data)-oa(0)}).on("click",function(a){o&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,Ka,function(a){return ya.rangeBand()/2-5},function(a){return oa(a.data>=0?a.data>T?T:a.data:0)-24}),o&&app.chartCommons.commentUtils.setOnHighlightListener(Ha.selectAll(".series"),b.ChartInPageId);var Ma=Ga.selectAll(".gd-text").data(G).enter().append("g").attr("transform","translate("+xa(G[0].label+"#"+G[0].index)+",0)").attr("class",function(a){return"gd-text"+(""!=a.onClickVal||Aa?" pointer":"")}).on("click",Fa),La=Ma.selectAll("nothings").data(function(a){return a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden})}).enter().append("text").text(function(a){return a.prop.showValues?persian(d3.format(z(a.prop.font,a.prop))(a.data),u):""}).style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).style("text-anchor",app.lang.isRtl()?"start":"end").attr("x","0.3em").attr("dy","-0.3em").attr("transform",function(a,b){return"translate("+ya(a.label)+",0)"}).attr("y",function(a){return oa(a.data>=0?a.data>T?T:a.data:0)}).attr("y",function(a){return oa(a.data>=0?a.data>T?T:a.data:0)}).on("click",function(a){o&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)}),Ja=G.map(function(a){return a.label+"#"+a.index});La.forEach(function(a,b){a.forEach(function(a,c){var d=a.getBBox().width,e=a.getBBox().height,f=ya.rangeBand(),g=f/2-d/2;d3.select(a).attr("x",g),Ia.noConfilict(d,e,xa(Ja[b]),d3.select(a).attr("y"))||$(a).remove()})}),Ia.clear()}if(1==app.dashboardLayoutVersion||b.editMode){var Ba=Z.select(".x.axis").selectAll("g text").attr("class","axes-x-label").attr("x","-1em").attr("transform",function(){return Ea?"rotate(-90)":"rotate(0)"}).attr("dy","0.1em").attr("y","0").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal"),ha=$(n).find(".x").first().get(0),ia=ha.getBBox();ia.height-p.bottom;Z.attr("width",q).attr("height",v+ia.height)}var Ka=Ha.selectAll("nothing").data(function(a){return a.series.filter(function(a){return"kpi"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden})}).enter().append("g").attr("class","kpi").attr("transform",function(a,b){return"translate("+ya(a.label)+",0)"});Ka.append("rect").attr("width",ya.rangeBand()).attr("y",function(a){return oa(1.1*a.data[1])}).attr("height",function(a){return r+p.top-oa(1.1*a.data[1])}).attr("fill","#eee"),Ka.append("rect").attr("width",ya.rangeBand()).attr("y",function(a){return oa(a.data[0])}).attr("height",function(a){return r+p.top-oa(a.data[0])}).attr("fill",function(a,b){return w(b)}),Ka.append("rect").attr("width",ya.rangeBand()).attr("y",function(a){return oa(1*a.data[1])}).attr("height",function(a){return 0==a.data[1]?0:2}).attr("fill","#333");var Qa=function(a){return a>0?"#71b37c":0==a?"#8d8d8d":"#e14d57"};Ka.append("circle").attr("r",function(a){return 0==a.data[1]?0:ya.rangeBand()/2<5?ya.rangeBand()/2:5}).attr("fill",function(a){return Qa(a.data[1])}).attr("cx",ya.rangeBand()/2).attr("cy",function(a){return oa(1.1*a.data[1])-(ya.rangeBand()/2<5?ya.rangeBand()/2:5)}),$(n+" .kpi").tipsy({gravity:"w",html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c=G.map(function(a){
return a.index}).indexOf($(this).parent(".gd").get(0).__data__.index);return g(c,a,"bar",$(this).index())}}),$(n+" .series").tipsy({gravity:"w",html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c=G.map(function(a){return a.index}).indexOf($(this).parent(".gd").get(0).__data__.index),d=g(c,a,"bar",$(this).index());return d}}),$(n+" .gd-text text").tipsy({gravity:"w",html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c=G.map(function(a){return a.index}).indexOf($(this).parent(".gd-text").get(0).__data__.index);return g(c,a,"bar",$(this).index())}});var Ra=Ga.append("g"),Sa=Ga.append("g"),Ta=Ga.append("g"),Ua=Ga.append("g"),Va=h(G),Wa="linear",Xa=d3.svg.area().x(function(a){return xa(a.label)+xa.rangeBand()/2}).y0(r+p.top).y1(oa(U)).interpolate(Wa),Ya=d3.svg.area().x(function(a){return xa(a.label)+xa.rangeBand()/2}).y0(r+p.top).y1(function(a){return oa(a.value>T?T:a.value<U?U:a.value)}).interpolate(Wa),Za=d3.svg.line().x(function(a){return xa(a.label)+xa.rangeBand()/2}).y(function(a){return oa(U)}).interpolate(Wa),$a=d3.svg.line().x(function(a){return xa(a.label)+xa.rangeBand()/2}).y(function(a){return oa(a.value>T?T:a.value<U?U:a.value)}).interpolate(Wa),_a=Sa.selectAll("nothings").data(Va).enter().append("path").attr("class","area").attr("id",function(a,b){return"area"+b}).attr("fill",function(a,c){return b.chartProp.indicator&&b.chartProp.indicator.length?"url(#"+b.id+"-"+c+")":a.prop.seriesColor}).attr("z-index","-1").style("opacity",function(a){return a.prop.areaOpacity||.1}).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-area"==b?E?a.valueStacked:a.values:0});s?_a.attr("d",function(a){return 0===a?Xa:Xa.interpolate(a[0].prop.lineStyle)(a)}).transition().duration(b.animationDuration).attr("d",function(a){return 0===a?Ya:Ya.interpolate(a[0].prop.lineStyle)(a)}):_a.attr("d",function(a){return 0===a?Ya:Ya.interpolate(a[0].prop.lineStyle)(a)}),_a=Ta.selectAll("nothings").data(Va).enter().append("path").attr("class","line").attr("id",function(a,b){return"line"+b}).attr("stroke",function(a,c){return b.chartProp.indicator&&b.chartProp.indicator.length?"url(#"+b.id+"-"+c+")":a.prop.seriesColor}).attr("stroke-width",function(a,b){return a.prop.lineWeight}).attr("stroke-dasharray",function(a,b){return a.prop.lineFace}).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"line-area"==b||"line"==b?E?a.valueStacked:a.values:0}),s?_a.attr("d",function(a){return 0===a?Za:Za.interpolate(a[0].prop.lineStyle)(a)}).transition().duration(b.animationDuration).attr("d",function(a){return 0===a?$a:$a.interpolate(a[0].prop.lineStyle)(a)}):_a.attr("d",function(a){return 0===a?$a:$a.interpolate(a[0].prop.lineStyle)(a)});var Aa=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0,ab=function(c,d){if(o)return void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId);if(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.primv],b.chartProp.globalvariable),$(n+" .circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(n+" .gd.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.onClickVal)return void(t&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard));if(!x()){y(!0),b.isSort=e,app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},$(n).charts(chartTypes.BAR,"refreshWithData",b);var e=P.property("checked")}};tempG=Ua.selectAll("nothings").data(Va).enter().append("g").attr("class",function(a){return"circle-group "+(""!=a.onClickVal||Aa?" pointer":"")});var bb=tempG.selectAll(".entry").data(function(a){return E?a.valueStacked:a.values}).enter().append("g").attr("class","entry"),_a=bb.append("circle").attr("class","circle").attr("stroke",function(a,b){var c=[a],d=d3.select(this.parentNode).datum().label,e=G[b].series.map(function(a){return a.label}),g=G[b].series.map(function(a){return a.data});f(c,g,e),a=c[0];var h=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(a,b){$.each(b,function(a,b){if(d!=b.firstField)return!0;switch(+b.operand){case 1:h=b.secondFieldColor}})}),h}).attr("stroke-width",function(a,b){return a.prop.lineWeight}).on("click",ab).on("mouseover",function(a){d3.select(this).attr("stroke-width",parseInt(a.prop.lineWeight)+3)}).on("mouseout",function(a){d3.select(this).attr("stroke-width",a.prop.lineWeight)}).attr("cx",function(a){return $a.interpolate(a.prop.lineStyle).x()(a)}).style("opacity",function(){var a=d3.select(this.parentNode).datum().prop.lineType;return"line-area"==a||"line"==a?0:1}).attr("r","4");if(s?_a.attr("cy",oa(U)).transition().duration(b.animationDuration).attr("cy",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}):_a.attr("cy",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,bb,function(a){return $a.interpolate(a.prop.lineStyle).x()(a)-5},function(a){return $a.interpolate(a.prop.lineStyle).y()(a)-24}),o){var Ba=tempG.selectAll(".entry");app.chartCommons.commentUtils.setOnHighlightListener(tempG.selectAll(".entry"),b.ChartInPageId)}Ra.attr("class","colorStepGroups").selectAll(".colorStepGroup").data(Va).enter().append("linearGradient").attr("id",function(a,c){return b.id+"-"+c}).attr("class","colorStepGroup").selectAll("stop-color").data(function(a){var b=[],c=1/(2*(a.values.length-1)),d=-1*c;return a.values.map(function(e,g){var h={value:e.value,label:a.label,color:a.prop.seriesColor},i=[h],j=G[g].series.map(function(a){return a.label}),k=G[g].series.map(function(a){return a.data});f(i,k,j),h=i[0],h.offset=0>d?0:d,b.push(h),h=$.extend({},h),d+=2*c,h.offset=d>1?d-c:d,b.push(h)}),b}).enter().append("stop").attr("stop-color",function(a,b){var c=a.color;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("offset",function(a){return a.offset}),_a=Ua.selectAll("nothings").data(Va).enter().append("g").attr("class",function(a){return"text-vals"}).selectAll("text").data(function(a){return a.prop.showValues?E?a.valueStacked:a.values:0}).enter().append("text").text(function(a){return persian(d3.format(z(a.prop.font,a.prop))(a.valueLabel),u)}).attr("class","text-value pointer xxx").style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).style("text-anchor",app.lang.isRtl()?"start":"end").attr("dy","-10").attr("dy","-10").attr("x",function(a,b){var c=d3.select(this).node().getBBox().width,d=d3.select(this).node().getBBox().height,e=(xa(Ja[b]),$a.interpolate(a.prop.lineStyle).y()(a));return Ia.noConfilict(c,d,xa(Ja[b]),e)||d3.select(this).style("display","none"),$a.interpolate(a.prop.lineStyle).x()(a)-c/2}).on("click",ab),s?_a.attr("y",oa(U)).transition().duration(b.animationDuration).attr("y",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}):_a.attr("y",function(a){return $a.interpolate(a.prop.lineStyle).y()(a)}),$(n+" .circle").tipsy({gravity:"w",html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c="",d=$(this).index(),e=$(this).parent("g.circle-group").index();return c=g(d,a,"line",e)}}),$(n+" .text-value").tipsy({gravity:"w",html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c="",d=$(this).index(),e=$(this).parent("g.text-vals").index()-$(this).parent("g.text-vals").parent().children().length/2;return c=g(d,a,"line",e)}}),P.on("change",i),Q.on("change",i);var cb=!0,db=setTimeout(function(){b.isSort?P.property("checked",!0).each(i):P.each(i),cb=!1},0);$(n).trigger("heightChange")};var chartTypes={BAR:1,PIE:2,LINE:3,GAUGE:4,TABLE:5,MAP:6,UserControl:7,Radar:8,Tree:9,Text:10,CE_MAP:{1:"barLine",2:"pie",4:"gauge",5:"table",6:"map",7:"userControl",8:"radar",9:"tree",10:"text"},NAMES:{1:"نمودار خطی-میله‌ای",2:"نمودار دایره‌ای",4:"نمودار عقربه‌ای",5:"جدول",7:"کنترل کاربری",8:"نمودار رادار",9:"نمودار درختی",10:"متن"}};!function(a){function b(b,c,d){var e=a(this).data("settings");if("undefined"!=typeof e)return e.isRefresh=!0,e=a.extend(e,c),setTimeout(function(){g(b,e.input,e,!0,d),e.parameters.selectedItem=null,e.parameters.isUp=!1},0),this}function c(b){var c=a(this).data("ajaxRequest");return null!=c&&c.abort(),this}function d(b,c,d){d=a.extend({refreshRelatedDatasources:!0},d);var e=(a(this),a(this).data("settings"));if(e=a.extend(e,c),e.isRefresh=!1,"undefined"!=typeof e.chartProp){app.chartCommons.setFilterParameter(e),e.parameters.filterHierarchy=app.chartCommons.getFilterHierarchy(e.ChartInPageId),e.editMode&&(e.parameters.ChartInfo=a("#divChart").data("chartInfo"));var h=[];if(b==chartTypes.TABLE)for(var i in e.chartProp.series)e.chartProp.series.hasOwnProperty(i)&&h.push({Name:i,Type:e.chartProp.series[i].rowResult});e.dataUrl=f(b);var j=app.mobileMode?proxy.ajax:a.ajax,k=a.extend(e.parameters,{resultRows:h,type:e.dataType}),l=app.mobileMode&&!app.mobileModeTest?k:JSON.stringify(k);d.refreshRelatedDatasources&&e.ChartInPageId&&(app.moderation.dashboadpage.refreshRelatedDatasources(e.input.RefreshDatasource,[+e.ChartInPageId]),app.filterBox&&app.filterBox.refresh&&app.filterBox.refresh());var m=j({url:e.dataUrl,type:"POST",dataType:"json",contentType:"application/json",data:l,async:e.async,requestId:e.requestId,success:function(a){g(b,a,e,!0),e.parameters.selectedItem=null,e.parameters.isUp=!1}});return a(this).data("ajaxRequest",m),this}}function e(b,c){var d=a.extend({},h,c),e=a(this);d.id=e.attr("id"),d.type=b,e.data("isChart",!0),e.data("settings",d),app.chartCommons.setFilterParameter(d);var i=[];if(b==chartTypes.TABLE)for(var j in d.chartProp.series)d.chartProp.series.hasOwnProperty(j)&&i.push({Name:j,Type:d.chartProp.series[j].rowResult});d.dataUrl=f(b);var k=app.mobileMode?proxy.ajax:a.ajax;app.mobileMode&&(a.ajax=proxy.ajax);var l=a.extend(d.parameters,{resultRows:i,type:d.dataType}),m=app.mobileMode&&!app.mobileModeTest?l:JSON.stringify(l),n=k({url:d.dataUrl,type:"POST",dataType:"json",data:m,success:function(c,e,f){d.mobileModeData={isOnline:e,date:f},"undefined"==typeof d.chartProp&&c.detail&&(d=a.extend(d,JSON.parse(c.detail))),g(b,c,d,!1),d.parameters.selectedItem=null,d.parameters.isUp=!1},cache:!1,contentType:"application/json",error:function(b){b&&b.responseJSON&&b.responseJSON.forceSignout&&(alert("شما از برنامه خارج شده‌اید. ممکن است کاربر دیگری با نام کاربری شما وارد سیستم شده باشد."),window.location.href=app.urlPrefix);var c="#"+d.id;a(c).addClass("bar-chart").empty(),b&&b.responseJSON&&b.responseJSON.desc?a(c).addClass("bar-chart").html("<b>"+b.responseJSON.title+' </b>  <span class="glyphicon glyphicon-info-sign"> </span> <br/ > <p style="direction:ltr;">'+b.responseJSON.desc+"</p>"):a(c).addClass("bar-chart").html('خطا در دریافت اطلاعات <span class="glyphicon glyphicon-info-sign"> </span>')},requestId:d.requestId});return a(this).data("ajaxRequest",n),e}function f(a){switch(parseInt(a)){case chartTypes.UserControl:return app.urlPrefix+"api/chartdata/GetColumnMembers";case chartTypes.Tree:return app.urlPrefix+"Charts/BarChart/getTreeData";default:return app.urlPrefix+"api/chartdata/getdata"}}function g(b,c,d,e,f){if(d.editMode||dashboard.setLastRefresh(d.ChartInPageId,c.LastRefresh),d.input=c,arguments.length<4)return void a.error("تعداد پارامترها باید حداقل چهار تا باشد");if("undefined"!=typeof d.chartProp){if(d.chartProp.info.refreshPeriod&&+d.chartProp.info.refreshPeriod>0){var g=a("#"+d.id).data("timeout");g&&clearTimeout(g);var h=setTimeout(function(){a("#"+d.id).charts(b,"refreshWithData")},1e3*+d.chartProp.info.refreshPeriod);a("#"+d.id).data("timeout",h)}a("#dashboard-chart-panel").trigger("chartComplete",[d,c]);var i="#"+d.id;e&&!f?a(i).find(".temporal").remove():a(i).addClass("bar-chart").empty(),d.fromCommentDialog&&a(i).addClass("fromCommentDialog"),c=a.extend({EditPermission:!1,Description:"",LastRefresh:0,isFresh:!0,title:""},c);var j={title:null,showProgress:function(){},isProgress:function(){}};switch(j=d3.select(i).titlebar({EditPermission:c.EditPermission,editLink:d.editLink,RemoveFromPage:d.RemoveFromPage,deleteLink:d.removeLink,desc:c.Description,LastRefresh:c.LastRefresh,isFresh:c.isFresh,title:c.title,chartId:d.chartId,ChartInPageId:d.ChartInPageId,type:b,editMode:d.editMode,refreshWithData:e,redrowAll:f,settings:d,showFilterIcon:"undefined"==typeof d.chartProp.info.showFilterIcon?1:+d.chartProp.info.showFilterIcon}),d.titlebar=j,j.showProgress(!1),parseInt(b)){case chartTypes.BAR:app.charts.bar.draw(c,d,e,j);break;case chartTypes.GAUGE:app.charts.gauge.draw(c,d,e,j);break;case chartTypes.PIE:app.charts.pie.draw(c,d,e,j);break;case chartTypes.TABLE:app.charts.table.draw(c,d,e,j);break;case chartTypes.MAP:app.charts.map.draw(c,d,e,j);break;case chartTypes.UserControl:app.charts.userControl.draw(c,d,e,j);break;case chartTypes.Radar:app.charts.radar.draw(c,d,e,j);break;case chartTypes.Tree:app.charts.tree.draw(c,d,e,j);break;case chartTypes.Text:app.charts.text.draw(c,d,e,j)}app.lang.setLang({selector:i}),d.finishDraw&&d.finishDraw(d),app.chartCommons.renderComments(d,c)}}var h={isSort:!1,fadeSpeed:200,fadeinEasing:"easeInOutCubic",chartId:-1,animationDuration:1e3,animationEase:"cubic-out"};jQuery.fn.charts=function(f,g){var h={init:e,refresh:b,refreshWithData:d,abort:c};if(h[g]){var i=Array.prototype.slice.call(arguments,0),g=i.splice(1,1);return h[g].apply(this,i)}return"object"!=typeof method&&"undefined"!=typeof method&&g?void a.Error("Method "+g+" does not exist on jQuery.sitBarChart: you must specify type"):h.init.apply(this,arguments)},app.chartCommons.draw=g}(jQuery);var app=app||{};app.charts=app.charts||{},app.charts.gauge={},app.charts.gauge.draw=function(a,b,c,d){function e(a,b){return"undefined"==typeof a?null:a[b]}function f(a,c,d){var e=5,f=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").append("div");if(b.chartProp.info.showLabels){f.append("div").text(function(a,b){var d=m[b];return persian(c.label+(d?" - "+d:""),k)})}var g=f.append("div"),h=g.append("div").style("text-align","left").style("position","relative");va=$(g[0][0]).width();var i=g.append("svg").attr("width",va).attr("class","line-svg").attr("height",s+2*e),j=0,l=0;if(fa>=0&&ea>=0)j=0,l=1.2*ea;else{var n=Math.max(Math.abs(ea),Math.abs(fa));j=-1.2*n,l=1.2*n}var o=d3.scale.linear().range([0,va]).domain([j,l]);i.append("rect").attr("height",s).attr("y",e).attr("fill",ga(0)).attr("width",va),i.append("rect").attr("height",s).attr("y",e).attr("fill",function(a,b){return ka(a[2])}).attr("width",0).transition().duration(b.animationDuration).attr("width",function(a){return o(a[0])}),i.append("rect").attr("width","5").attr("x","0").attr("y","0").attr("height",s+e).attr("fill","#333").transition().duration(b.animationDuration).attr("x",function(a){return o(a[0])-5<j?j:o(a[0])-5}),i.append("path").attr("transform",function(a){return"translate("+(o(a[1])-5<j?j:o(a[1])-5)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none");var p=g.append("div").style("text-align","left").style("position","relative");h.append("div").attr("class","gauge-value").style("color",D.color).style("font-family",D.fontName).style("font-size",D.fontSize).style("font-weight",D.bold?"bold":"normal").style("font-style",D.italic?"italic":"normal").text(function(a){return persian(d3.format(D.formatString)(a[0]),k)}).style("left","0").transition().duration(b.animationDuration).style("left",function(a){var b=$(this).outerWidth(),c=o(a[0])-5-b/2;return 0>c&&(c=0),c+b>va&&(c=va-b),c+"px"}).tween("text",function(a){var b=la("0",a[0]);return function(a){this.textContent=b(a)}});var q=(p.append("div").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[1]),k)}).style("left",function(a){var b=$(this).outerWidth(),c=o(a[1])-5-b/2;return 0>c&&(c=0),c+b>va&&(c=va-b),c+"px"}),$(h[0][0]).find(".gauge-value").outerHeight()),r=$(p[0][0]).find(".gauge-target").outerHeight();h.style("height",q+"px"),$(h[0][0]).find(".gauge-value").css("height",q+"px"),$(h[0][0]).find(".gauge-value").css("position","absolute"),p.style("height",r+"px"),$(p[0][0]).find(".gauge-target").css("height",r+"px"),$(p[0][0]).find(".gauge-target").css("position","absolute")}function g(a,c,d){var e=5,f=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").style("padding","0 10px").style("margin-top","25px").style("margin-bottom","10px").attr("class","container-fluid").append("div").attr("class","row"),g="12";if(b.chartProp.info.showLabels){f.append("div").style("margin-top","40px").style("margin-bottom","7px").style("padding","0 10px").attr("class","col-md-3").text(function(a,b){var d=m[b];return persian(c.label+(d?" - "+d:""),k)});var g="9"}var h=f.append("div").style("padding","0 10px").attr("class","col-md-"+g),i=h.append("div").style("text-align","left").style("position","relative");va=$(h[0][0]).width();var j=h.append("svg").attr("width",va).attr("height",s+2*e),l=[];j.forEach(function(a,b){var c=a[0].__data__;l.push(d3.scale.linear().range([0,va]).domain([c[3],c[6]]))}),j.append("rect").attr("height",s).attr("y",e).attr("fill",ja).attr("width",va),j.append("rect").attr("height",s).attr("y",e).attr("fill",ia).attr("width",function(a,b){return l[b](a[5])}),j.append("rect").attr("height",s).attr("y",e).attr("fill",ha).attr("width",function(a,b){return l[b](a[4])}),j.append("path").attr("transform",function(a,b){var c=l[b](a[3]<a[6]?a[3]:a[6]);return"translate("+(c<l[b](a[3])?l[b](a[3]):c)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),j.append("path").attr("transform",function(a,b){var c=l[b](a[6]<a[6]?a[6]:a[6]);return"translate("+(c<l[b](a[3])?l[b](a[3]):c)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),j.append("path").attr("transform",function(a,b){var c=l[b](a[5]<a[6]?a[5]:a[6]);return"translate("+(c<l[b](a[3])?l[b](a[3]):c)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),j.append("path").attr("transform",function(a,b){var c=l[b](a[4]<a[6]?a[4]:a[6]);return"translate("+(c<l[b](a[3])?l[b](a[3]):c)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none"),j.append("rect").attr("width","5").attr("x","0").attr("y","0").attr("height",s+e).attr("fill","#333").transition().duration(b.animationDuration).attr("x",function(a,b){var c=l[b](a[0]<a[6]?a[0]:a[6])-5;return c<l[b](a[3])?l[b](a[3]):c}),j.append("path").attr("transform",function(a,b){var c=l[b](a[1]<a[6]?a[1]:a[6])-5;return"translate("+(c<l[b](a[3])?l[b](a[3]):c)+",0)"}).attr("d","M0 "+e+" 0 "+(s+2*e)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none");var n=h.append("div").style("text-align","left").style("position","relative").style("margin-top","-10px");i.append("span").attr("class","gauge-value").style("color",D.color).style("font-family",D.fontName).style("font-size",D.fontSize).style("font-weight",D.bold?"bold":"normal").style("font-style",D.italic?"italic":"normal").text(function(a){return persian(d3.format(D.formatString)(a[0]),k)}).style("left","0").transition().duration(b.animationDuration).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[0])-5-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"}).tween("text",function(a){var b=la(a[3],a[0]);return function(a){this.textContent=b(a)}}),n.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[1]),k)}).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[1])-5-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"}),n.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[3]),k)}).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[3])-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"}),n.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[6]),k)}).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[6])-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"}),n.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[4]),k)}).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[4])-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"}),n.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(D.formatString+"s")(a[5]),k)}).style("left",function(a,b){var c=$(this).outerWidth(),d=l[b](a[5])-c/2;return 0>d&&(d=0),d+c>va&&(d=va-c),d+"px"});var o=$(i[0][0]).find(".gauge-value").outerHeight();i.style("height",o+"px"),$(i[0][0]).find(".gauge-value").css("height",o+"px"),$(i[0][0]).find(".gauge-value").css("position","absolute");var p=$(n[0][0]).find(".gauge-target").outerHeight();n.style("height",p+"px"),$(n[0][0]).find(".gauge-target").css("height",p+"px"),$(n[0][0]).find(".gauge-target").css("position","absolute")}function h(a,c,d,e,f){i(a,c,d,e,f,function(a,d,e,f,g,h,i,j,l,o,p,q){var r=0,t=0;if(fa>=0&&ea>=0)r=0,t=1.2*ea;else{var u=Math.max(Math.abs(ea),Math.abs(fa));r=-1.2*u,t=1.2*u}var v=d3.scale.linear().range([f,g]).domain([r,t]),w=d3.svg.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),x=d3.svg.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(function(a){return v(a)}),y=a.append("div").style("margin-bottom","0").append("svg").attr("width",2*h+2*d).attr("height",q).append("g").attr("transform","translate("+h+","+h+")");b.chartProp.info.showLabels&&a.append("div").style("margin-bottom","10px").text(function(a,b){var d=m[b];return persian(c.label+(d?" - "+d:""),k)});var z=y.append("path").attr("d",w).attr("transform","translate("+d+","+d+")").attr("fill",ga(0)),A=(z.node().getBBox().height,y.append("path").attr("fill",function(a,b){return ka(a[2])}).attr("transform","translate("+d+","+d+")").transition().duration(b.animationDuration).attrTween("d",function(a){var b=d3.interpolate(r,a[0]);return function(a){return x(b(a))}}),y.append("g"));A.append("rect").attr("width","5").attr("transform","translate("+(d-2.5)+","+d+")").attr("height",h+e).attr("fill","#333"),A.attr("transform","rotate("+(f*(180/Math.PI)+180)+" "+d+" "+d+" )"),A.append("circle").attr("r","5").attr("cx",d).attr("cy",d),A.transition().duration(b.animationDuration).attrTween("transform",function(a){var b=v(a[0]),c=f*(180/Math.PI)+180;if(isNaN(b))e=c;else var e=v(a[0])*(180/Math.PI)+180;var g=d3.interpolate(c,e);return function(a){return"rotate("+g(a)+" "+d+" "+d+" )"}}),y.append("path").attr("d","M"+d+" "+d+" "+d+" "+(s+d+e)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none").attr("transform",function(a){return"rotate("+v(a[1])*(180/Math.PI)+" "+d+" "+d+")translate(0,"+(-h-e)+")"}),y.append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(D.formatString)(a[1]),k)}).attr("transform",function(a){return"rotate("+v(a[1])*(180/Math.PI)+" "+d+" "+d+" )translate("+d+","+(-h+d-e)+")"});$(n+" svg > g").get(0).getBBox(),y.append("text").attr("class","gauge-value").attr("text-anchor","middle").style("fill",D.color).style("font-family",D.fontName).attr("dy","1em").style("font-size",D.fontSize).style("font-weight",D.bold?"bold":"normal").style("font-style",D.italic?"italic":"normal").text(function(a){return persian(d3.format(D.formatString)(a[0]),k)}).attr("transform","translate("+d+","+p+")").transition().duration(b.animationDuration).tween("text",function(a){var b=la(a[3],a[0]);return function(a){this.textContent=b(a)}})})}function i(a,c,d,e,f,g){var h=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").style("text-align","center"),i=35,j=10,l="small"==b.chartProp.info.chartSize?2*-Math.PI/5:"medium"==b.chartProp.info.chartSize?2*-Math.PI/4:2*-Math.PI/3,m=-1*l,n=Math.cos(l);n=-1*(n-1);var o=h.append("div").attr("class","gauge-value").style("color",D.color).style("font-family",D.fontName).style("font-size",D.fontSize).style("font-weight",D.bold?"bold":"normal").style("font-style",D.italic?"italic":"normal").text(function(a){return persian(d3.format(D.formatString)(a[0]),k)}),p=h.append("svg").append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(D.formatString)("80"),k)}),q=$(o.node()).width(),r={width:$(o.node()).width(),height:$(o.node()).height()};o.remove();p.node().getBBox().height,p.node().getBBox();h.select("svg").remove();var t=b.chartProp.info.showLabels?45:0,u=(e-t-(1>n?q:q/2))/(1>n?1:n)-i,v=f/2-i;u=Math.min(u,v);var w=u,x=w-s,y=(1>n?1:n)*w,z=(1>n?1:n)*x,A=Math.cos(2*Math.PI-Math.abs(l)-Math.abs(m));A=-1*(A-1),A*=x;var B=(w+i)*(1>n?1:n),C=n>1&&A>r.width,E=i+(1>n?0:z-x);C||(E=i+(1>n?0:y-w));var F=E+r.height+w;F=Math.max(F,B),g&&g(h,i,j,l,m,w,x,n,y,z,E,F)}function j(a,c,d,e,f){i(a,c,d,e,f,function(a,d,e,f,g,h,i,j,l,n,o,p){function q(a,b,c,d){w.append("path").attr("d",function(c,d){var e=c.map(function(a,b){return u[d](a)});return v({start:e[a],end:e[b]})}).attr("fill",c).attr("transform","translate("+d+","+d+")")}function r(a){w.append("path").attr("d","M"+d+" "+d+" "+d+" "+(s+e+d)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none").attr("transform",function(b,c){return"rotate("+a(b,c)+" "+d+" "+d+")translate(0,"+(-h-e)+")"})}function t(a,b){w.append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(D.formatString)(a[b]),k)}).attr("transform",function(b,c){return"rotate("+u[c](a(b))*(180/Math.PI)+" "+d+" "+d+")translate("+d+","+(-h+d-e)+")"})}var u=[];a.forEach(function(a,b){var c=a[0].__data__;u.push(d3.scale.linear().range([f,g]).domain([c[3],c[6]]))});var v=(d3.svg.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),d3.svg.arc().innerRadius(h).outerRadius(i).startAngle(function(a){return a.start}).endAngle(function(a){return a.end})),w=(d3.svg.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),a.append("div").style("margin-bottom","0").append("svg").attr("width",2*h+2*d).attr("height",p).append("g").attr("transform","translate("+h+","+h+")"));b.chartProp.info.showLabels&&a.append("div").style("margin-bottom","10px").text(function(a,b){var d=m[b];return persian(c.label+(d?" - "+d:""),k)}),q(3,4,ha,d),q(4,5,ia,d),q(5,6,ja,d);var x=w.append("g");x.append("rect").attr("width","5").attr("transform","translate("+(d-2.5)+","+d+")").attr("height",h+e).attr("fill","#333"),x.attr("transform","rotate("+(f*(180/Math.PI)+180)+" "+d+" "+d+")"),x.append("circle").attr("r","5").attr("cx",d).attr("cy",d),x.transition().duration(b.animationDuration).attrTween("transform",function(a,b){var c=u[b](a[0]<a[6]?a[0]:a[6]),e=f*(180/Math.PI)+180;if(isNaN(c))g=e;else var g=u[0](a[0]<a[6]?a[0]:a[6])*(180/Math.PI)+180;var b=d3.interpolate(e,g);return function(a){return"rotate("+b(a)+" "+d+" "+d+")"}}),r(function(a,b){return u[b](a[3])*(180/Math.PI)}),r(function(a,b){return u[b](a[6])*(180/Math.PI)}),r(function(a,b){return u[b](a[4])*(180/Math.PI)}),r(function(a,b){return u[b](a[5])*(180/Math.PI)}),t(function(a){return a[3]},3),t(function(a){return a[6]},6),t(function(a){return a[4]},4),t(function(a){return a[5]},5);w.append("text").attr("class","gauge-value").attr("text-anchor","middle").style("fill",D.color).style("font-family",D.fontName).attr("dy","1em").style("font-size",D.fontSize).style("font-weight",D.bold?"bold":"normal").style("font-style",D.italic?"italic":"normal").text(function(a){return persian(d3.format(D.formatString)(a[0]),k)}).attr("transform","translate("+d+","+o+")").transition().duration(b.animationDuration).tween("text",function(a){var b=la(a[3],a[0]);return function(a){this.textContent=b(a)}});d3.select(w.node().parentNode).attr("height",p)})}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var k=(a.title,a.chartInfo,"undefined"==typeof a.lang?!0:0==+a.lang),l="undefined"!=typeof a.series?a.series.labels:[],m="undefined"!=typeof a.kpis?a.kpis.labels:[],n=(a.seriesLablesCaptions,a.kpisLablesCaptions,b.LabelY,"#"+b.id),o={top:95,right:20,bottom:0,left:20},p=$(n).width(),q=$(n).hasClass("fromCommentDialog"),r="small"==b.chartProp.info.chartSize?220:"medium"==b.chartProp.info.chartSize?250:"large"==b.chartProp.info.chartSize?280:"veryLarge"==b.chartProp.info.chartSize?330:250,s="small"==b.chartProp.info.height?20:"medium"==b.chartProp.info.height?30:"large"==b.chartProp.info.height?40:"veryLarge"==b.chartProp.info.height?50:30,t=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked;r+o.top+o.bottom,d3.scale.category10();b.width=p;var u=d.isProgress,v=d.showProgress,w=(d.title,e(b.chartProp.info.font,"formatString")||b.chartProp.info.formatString||",.2f"),x=e(b.chartProp.info.font,"formatStringCustom")||b.chartProp.info.formatString||",.2f",y=e(b.chartProp.info.font,"fontName")||"Droid",z=e(b.chartProp.info.font,"fontSize")||b.chartProp.info.fontSize||"46px",A=null!=e(b.chartProp.info.font,"italic")?e(b.chartProp.info.font,"italic"):b.chartProp.info.textItalic||!1,B=e(b.chartProp.info.font,"color")||b.chartProp.info.color||"#333333",C=null!=e(b.chartProp.info.font,"bold")?e(b.chartProp.info.font,"bold"):b.chartProp.info.textBold||!1,D={};if(D.formatString=w,D.formatStringCustom=x,D.fontName=y,D.fontSize=z,D.italic=A,D.color=B,D.bold=C,D.formatString="custom"!=D.formatString?D.formatString:D.formatStringCustom,app.chartCommons.setDefault(b.chartProp,m.concat(l),"gauge"),b.editMode&&$(n).trigger("chartproperty",[l.concat(m)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var E=prepareData(a);b.chartProp.info.segmentType=b.chartProp.info.segmentType||"singleSegment";var F="singleSegment"==b.chartProp.info.segmentType,G=b.chartProp.info.value,H=b.chartProp.info.target,I=b.chartProp.info.trend,J=b.chartProp.info.status,K=b.chartProp.info.min,L=b.chartProp.info.max,M=b.chartProp.info.yellow,N=b.chartProp.info.green,O=!isNaN(G||"nan"),P=!isNaN(H||"nan"),Q=!isNaN(J||"nan"),R=!isNaN(I||"nan"),S=!isNaN(K||"nan"),T=!isNaN(L||"nan"),U=!isNaN(M||"nan"),V=!isNaN(N||"nan");$(n).css({overflow:"auto",margin:"0 -14px",padding:"0 24px"}),_.isArray(a.levels)&&0!=a.levels.length||b.editMode||$(n).css({overflow:"hidden"});for(var W=0;W<E.length;W++){var X=E[W],Y=[];Y=F?[+G,+H,+J,+I]:[+G,+H,+I,+K,+M,+N,+L];for(var Z=!1,aa=0;aa<X.series.length;aa++){var ba=b.chartProp.series[l[aa]],ca=-1;ca=F?"value"!=ba.type||O?"target"!=ba.type||P?"status"!=ba.type||Q?"trend"!=ba.type||R?-1:3:2:1:0:"value"!=ba.typeMs||O?"target"!=ba.typeMs||P?"trend"!=ba.typeMs||R?"min"!=ba.typeMs||S?"yellow"!=ba.typeMs||U?"green"!=ba.typeMs||V?"max"!=ba.typeMs||T?-1:6:5:4:3:2:1:0,-1!=ca&&(Y[ca]=X.series[aa]*+ba.numberFactor,Z=!0)}(Z||0==X.kpis.length)&&X.kpis.push(Y),F?(("undefined"==typeof Y[0]||isNaN(Y[0]))&&(Y[0]=0),("undefined"==typeof Y[1]||isNaN(Y[1]))&&(Y[1]=70),("undefined"==typeof Y[2]||isNaN(Y[2]))&&(Y[2]=1),("undefined"==typeof Y[3]||isNaN(Y[3]))&&(Y[3]=1)):(("undefined"==typeof Y[0]||isNaN(Y[0]))&&(Y[0]=0),
("undefined"==typeof Y[1]||isNaN(Y[1]))&&(Y[1]=70),("undefined"==typeof Y[2]||isNaN(Y[2]))&&(Y[2]=1),("undefined"==typeof Y[3]||isNaN(Y[3]))&&(Y[3]=0),("undefined"==typeof Y[4]||isNaN(Y[4]))&&(Y[4]=Y[0]>0?.3*Y[0]:30),("undefined"==typeof Y[5]||isNaN(Y[5]))&&(Y[5]=Y[0]>0?.7*Y[0]:70),("undefined"==typeof Y[6]||isNaN(Y[6]))&&(Y[6]=Y[0]>0?1.2*Y[0]:100))}var da=d3.select(n).append("div").attr("class","legend-bar temporal");if(da.breadcrumb(a.levels,b,d,k),!a.matrix||0==a.matrix.length)return void d3.select(n).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var ea=d3.max(E,function(a){return d3.max(a.kpis,function(a){return Math.max(parseFloat(a[0]),parseFloat(a[1]))})}),fa=d3.min(E,function(a){return d3.min(a.kpis,function(a){return Math.min(parseFloat(a[0]),parseFloat(a[1]))})}),ga=d3.scale.ordinal().domain([0,1,2]).range(["#eee","#ddd","#ccc"]),ha=b.chartProp.info.colorAriaOne||"#e14d57",ia=b.chartProp.info.colorAriaTwo||"#FBEE58",ja=b.chartProp.info.colorAriaThree||"#71b37c",ka=function(a){return a>0?ja:0==a?ia:ha},la=function(a,b){var c,d,e=/^([0-9,.-]+)$/,f=d3.format(D.formatString);return c=e.exec(a),d=e.exec(b),c&&d?(a=parseFloat(c[1]),b=parseFloat(d[1])-a,function(c){var d=a+b*c;return persian(f(d),k)}):function(b){return a}},ma=r;if(2==app.dashboardLayoutVersion){var na=$(n+" .title").outerHeight(),oa=$(n+" .legend-bar"),pa="undefined"==typeof oa?0:oa.height()+ +oa.css("margin-top").replace("px",""),qa=$(n).height()-na-pa,ra="arc"==b.chartProp.info.style?180:85+s-(app.lang.isRtl()?30:20)+35*(E.length-1)/E.length,sa=qa/E.length,ta=ra>sa?ra:sa;ma=b.isDashboardResize?ta:b.gaugeHeight||ta,b.gaugeHeight=ma,b.drill=null,b.isDashboardResize=!1}var ua=d3.select(n).append("div").attr("class","temporal gauge-container").selectAll("nothings").data(E).enter().append("div").attr("class",function(a,b){return""!=a.onClickVal||t?"temporal pointer":"temporal"}).style("margin-top","14px").on("click",function(a,c){return q?void app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId):""==a.onClickVal?void(t&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard)):void(u()||(v(!0),b.drill="down",app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,a.onClickVal),b.parameters={selectedItem:a.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId},$(n).charts(chartTypes.GAUGE,"refreshWithData",b)))}),p=$(ua[0][0]).width(),va=p;ua.each(function(a,c){switch(b.chartProp.info.style){case"arc":F?h(this,a,c,ma,p):j(this,a,c,ma,p);break;case"horizontal":F?f(this,a,c,ma,p):g(this,a,c,ma,p);break;case"circle":F?h(this,a,c,ma,p):j(this,a,c,ma,p);break;case"semiCircle":F?h(this,a,c,ma,p):j(this,a,c,ma,p);break;case"verical":F?f(this,a,c,ma,p):g(this,a,c,ma,p)}})};var app=app||{};app.charts=app.charts||{},app.charts.map={},app.charts.map.draw=function(a,b,c,d){function e(c){function d(a,b){var c=D.indexOf(a.properties.Code);coordinates=d3.mouse(d3.select(l).select(".map-container").node());var d=coordinates[0]+7,e=coordinates[1]+7;d3.select(l+" #map-tooltip ").transition().duration(200).style("opacity",.9),d3.select(l+" #map-tooltip ").html(h(c,m,a.properties.Name)).style("left",d+"px").style("top",e+"px")}function e(){d3.select(l+" #map-tooltip ").transition().duration(500).style("opacity",0)}function i(a){if(n&&!b.editMode)return void app.chartCommons.openLink(b.chartProp.info.openDashboard);var c,d,e;if(a&&F!==a){var f=z.centroid(a);c=f[0],d=f[1],e=4,F=a}else c=w/2,d=v/2,e=1,F=null;E.selectAll("path").classed("active",F&&function(a){return a===F}),E.transition().duration(750).attr("transform","translate("+w/2+","+v/2+")scale("+e+")translate("+-c+","+-d+")").style("stroke-width",1.5/e+"px")}var c=JSON.parse(c);$(l+" .temporal").remove();for(var j={},k=0,o=0;o<a.matrix.length;o++){var p=+a.series.data[o][0];j[a.matrix[o][1]]=p,k+=p}var q=$.extend({formatString:",.0f",colorStart:"#31a354",colorEnd:"#c7e9c0"},b.chartProp.series[a.series.labels[0]]),r=d3.max(a.series.data,function(a){return+a[0]}),s=d3.min(a.series.data,function(a){return+a[0]}),t=d3.interpolate(q.colorEnd,q.colorStart),u=g(l,q.colorStart,q.colorEnd,s,r,q),v=$(l).height()-$(l+" .title").outerHeight()-$(u.node()).height(),w=$(l).width();150>v&&(v=150);var x=topojson.feature(c,c.objects.map),y=d3.geo.mercator().scale(1).translate([0,0]),z=d3.geo.path().projection(y),A=z.bounds(x),B=.95/Math.max((A[1][0]-A[0][0])/w,(A[1][1]-A[0][1])/v),C=[(w-B*(A[1][0]+A[0][0]))/2,(v-B*(A[1][1]+A[0][1]))/2];y.scale(B).translate(C),z=z.projection(y);var D=a.matrix.map(function(a){return a[1]}),E=d3.select(l).append("div").style("overflow","hidden").style("position","relative").attr("class","map-container temporal").append("svg").attr("class","temporal").attr("width",w).attr("height",v).append("g");d3.select(l).append("div").attr("id","map-tooltip").attr("class","temporal"),E.selectAll("path").data(x.features).enter().append("path").attr("d",z).style("fill",function(c,d){var e=a.series.labels,g=a.series.labels.map(function(){return j[c.properties.Code]}),h=[];if(b.chartProp.indicator&&b.chartProp.indicator.forEach(function(a){var b=!0;$.each(a.ifRow,function(a,c){return f(c,g,e)?void 0:(b=!1,!1)}),b&&h.push(a.thenRow)}),h.length>0)return h[0][0].secondFieldColor;var i=j[c.properties.Code];return"undefined"==typeof i?"#eee":t(i/r)}).on("click",i).on("mousemove",d).on("mouseout",e),E.append("path").datum(topojson.mesh(c,c.objects.map,function(a,b){return!0})).attr("id","state-borders").attr("stroke",b.chartProp.info.borderColor||"#666").attr("d",z),b.chartProp.info.showName&&E.selectAll("text").data(x.features).enter().append("svg:text").text(function(a){return a.properties.Name}).attr("x",function(a){return z.centroid(a)[0]}).attr("y",function(a){return z.centroid(a)[1]}).attr("text-anchor","middle").attr("fill",b.chartProp.info.nameEditor.color||"#333").style("font-size",b.chartProp.info.nameEditor.fontSize||"9px").style("font-family",b.chartProp.info.nameEditor.fontName||"Droid").style("font-weight",b.chartProp.info.nameEditor.bold?"bold":"normal").style("font-style",b.chartProp.info.nameEditor.italic?"italic":"inherit").on("click",i).on("mousemove",d).on("mouseout",e);var F}function f(a,b,c){var d=c.indexOf(a.firstField),e=b[d],f=a.secondFieldIsText?a.secondFieldInput:b[c.indexOf(a.secondFieldSelect)];switch(e=depersian(e),f=depersian(f),isNaN(f)||(f=+f),isNaN(e)||(e=+e),+a.operand){case 1:return e==f;case 2:return e!=f;case 3:return e>f;case 4:return e>=f;case 5:return f>e;case 6:return f>=e;case 7:return e.indexOf(f)>-1;case 8:return e.indexOf(f)<=-1}}function g(c,d,e,f,g,h){if(!b.chartProp.info.showLegend)return d3.select(c).append("div");var j=d3.select(c).append("div").attr("class","legend temporal").style("text-align","left");return j.append("span").text(h.name||a.series.labels[0]).style("margin","0 7px"),j.append("span").text(persian(d3.format(h.formatString)(f||0),i)),j.append("div").style("background","-webkit-linear-gradient(to right, "+d+", "+e+")").style("background","-o-linear-gradient(to right, "+d+", "+e+")").style("background","-moz-linear-gradient(to right, "+d+", "+e+")").style("background","linear-gradient(to right, "+d+", "+e+")").style("display","inline-block").style("height","10px").style("width","100px").style("margin","0 7px"),j.append("span").text(persian(d3.format(h.formatString)(g||100),i)),j}function h(c,d,e){function f(c){return b.chartProp.series[a.series.labels[c]]}if(-1==c)return app.chartCommons.tooltip.tooltipFormatter({points:a.series.labels.map(function(b,c){return{data:"NaN",label:f(c).name||a.series.labels[c],format:f(c).formatString}}),key:e,sum:"NaN",avg:"NaN",format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,i);var g=a.series.data[c];if(1==d)g=[g[0]];else if(2==d)var g=g.filter(function(a,b){return!f(b).hidden});return g=g.map(function(b,c){return{data:b,label:f(c).name||a.series.labels[c],format:f(c).formatString}}),app.chartCommons.tooltip.tooltipFormatter({points:g,key:e,sum:d3.sum(g,function(a){return a.data}),avg:d3.sum(g,function(a){return a.data})/g.length,format:g.length>0?g[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat)}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var i=(a.title,a.chartInfo,"undefined"==typeof a.lang?!0:0==+a.lang),j="undefined"!=typeof a.series?a.series.labels:[],k="undefined"!=typeof a.kpis?a.kpis.labels:[],l="#"+b.id,m=+b.chartProp.info.tooltip||1,n=(d3.scale.category10(),d.isProgress,d.showProgress,d.title,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked);if(app.chartCommons.setDefault(b.chartProp,k.concat(j),"map"),b.editMode&&$(l).trigger("chartproperty",[k.concat(j)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));if(!a.matrix||0==a.matrix.length)return void d3.select(l).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var o=b.chartProp.info.map.selectedMap;"undefined"!=typeof b.map&&o==b.map.id?e(b.map.data):(d3.select(l+"").append("div").style("padding","15px").attr("class","temporal info").text("در حال بارگذاری نقشه ..."),$.get(app.urlPrefix+"Moderation/Map/Get?Id="+o,null,function(a){a.result?(b.map=a.map,b.map.id=o,e(a.map.data)):d3.select(l+" .info").text("نقشه انتخاب شده معتبر نیست. در منوی تنظیمات یک نقشه را انتخاب کنید یا نقشه‌ی مورد نظر خود را بارگذاری نمایید.")}))};var app=app||{};app.charts=app.charts||{},app.charts.pie={},app.charts.pie.draw=function(a,b,c,d){function e(){var a=Math.min(o,B)/2,c=+b.chartProp.info.hole/100*a,d=d3.svg.arc().innerRadius(c).outerRadius(a),e=d3.svg.arc().innerRadius(1.1*a).outerRadius(1.1*a);return{radius:a,arc:d,arcText:e}}function f(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function g(c,d){return U?void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId):(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.data.value],b.chartProp.globalvariable),$(n+" path.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.data.onClickVal?void(t&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard)):void(r()||(s(!0),app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.data.onClickVal),b.parameters={selectedItem:c.data.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},$(n).charts(chartTypes.PIE,"refreshWithData",b))))}function h(a){var b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform",a);var c,d,e,f=b.transform.baseVal.consolidate().matrix,g=f.a,h=f.b,i=f.c,j=f.d,k=f.e,l=f.f;return(c=Math.sqrt(g*g+h*h))&&(g/=c,h/=c),(e=g*i+h*j)&&(i-=g*e,j-=h*e),(d=Math.sqrt(i*i+j*j))&&(i/=d,j/=d,e/=d),h*i>g*j&&(g=-g,h=-h,e=-e,c=-c),{translateX:k,translateY:l,rotate:Math.atan2(h,g)*Math.PI/180,skewX:Math.atan(e)*Math.PI/180,scaleX:c,scaleY:d}}function i(a){var c=[0,0];c=d3.mouse(F.node());var d=c[0]+7,e=c[1]+7,f=(J.centroid(a),a.data.series),g=+b.chartProp.info.tooltip||1;1==g&&(f=[f[0]]),2==g&&(f=f.filter(function(a){return!a.prop.hidden})),f=f.map(function(a,c){return{data:a.data,label:a.prop.name||a.label,format:b.chartProp.info.formatString,color:a.prop.seriesColor,percentage:100*a.data/x[c]}});var h=app.chartCommons.tooltip.tooltipFormatter({points:f,key:a.data.label,sum:d3.sum(a,function(a){return a.data}),avg:d3.sum(a,function(a){return a.data})/a.length,format:a.length>0?a[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,q);W.html(h),W.style("opacity",1).style("left",d+"px").style("top",e+"px")}function j(a){W.transition().duration(500).style("opacity",1e-6).each("end",function(){W.style("left","0px").style("top","0px")})}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var k=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),l="undefined"!=typeof a.kpis?a.kpis.labels:[],m=b.chartProp.info.showLabels,n=(b.LabelY,"#"+b.id),o=$(n).width(),p=($(n).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130);b.width=o;var q="undefined"==typeof a.lang?!0:0==+a.lang,r=d.isProgress,s=d.showProgress,t=(d.title,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked);if(app.chartCommons.setDefault(b.chartProp,l.concat(k),"pie"),b.editMode&&$(n).trigger("chartproperty",[l.concat(k)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(n).addClass("pie-chart");var u=prepareData(a),v=a.seriesLablesCaptions,w=a.kpisLablesCaptions;d3Utils.prepareDataForBarChart(u,b,k,l,v,w);var x=0==u.length?[1]:u[0].series.map(function(a,b){return d3.sum(u.map(function(a){return a.series[b].data}))}),y=d3.scale.category10();switch(+b.chartProp.info.colorType){case 2:y=d3.scale.category20();break;case 3:y=d3.scale.category20b();break;case 4:y=d3.scale.category20c()}var z=function(a){var b=a.series.filter(function(a){return"series"==a.type&&a.prop.main});return b.length>0?b[0].data:a.series.filter(function(a){return"series"==a.type})[0].data},A=d3.select(n).append("div").attr("class","legend-bar temporal");A.breadcrumb(a.levels,b,d,q),m?A.append("div").attr("class","legendBar"):A.legend({width:o,selector:n,data:u.map(function(a,b){var c=a.series.filter(function(a){return"series"==a.type&&a.prop.main}),d=null;d=c.length>0?c[0]:a.series.filter(function(a){return"series"==a.type})[0];var e={label:a.label.replace(/^\[measure\]/,""),color:y(b)};return e})},q);var B=0;if(app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,2==app.dashboardLayoutVersion){var C=$(n+" .title").outerHeight(),D=$(n+" .legend-bar"),E="undefined"==typeof D?0:D.height()+ +D.css("margin-top").replace("px","");B=$(n).height()-C-E}else 1==app.dashboardLayoutVersion&&(o=p,o>300&&(o=300));var F=d3.select(n).append("div").attr("class","temporal").style("position","relative"),G=F.append("svg").attr("class","temporal").attr("width",o).attr("height",B),H=e(),I=H.radius,J=H.arc,K=H.arcText;G.append("svg:rect").attr("class","background").style("fill","white").style("opacity","0").attr("width",o).attr("height",B).on("click",function(c,d){""!=a.levels&&(r()||(s(!0),b.parameters={isUp:!0,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.drillDown.up(b.ChartInPageId),$(n).charts(chartTypes.PIE,"refreshWithData",b)))}).on("mouseout",j);var L=G.append("g").attr("transform","translate("+o/2+","+B/2+")"),M=d3.layout.pie().value(z).sort(null),N=L.datum(u).selectAll("path").data(M).enter();if(_.each(N[0],function(a){a.__data__.category=a.__data__.data.series[0].category,a.__data__.seriesLable=a.__data__.data.series[0].seriesLable,a.__data__.commentCount=a.__data__.data.series[0].commentCount}),m){var O,P=0,Q=0;L.append("g").attr("class","labels");var R=L.select(".labels").selectAll("text").data(M);R.enter().append("text").attr("class",function(a,b){return""!=a.data.onClickVal||S||t?"label pointer":" label"}).attr("id",function(a,b){return"l-"+b}).attr("dy",".35em").text(function(a,c){return b.chartProp.info.showValues?persian(a.data.label,q)+" "+persian(d3.format(",.2f")(100*a.value/x),q)+"%":a.data.label}).style({"font-size":"11px",direction:"rtl"}).on("click",g).on("mouseover",i).on("mousemove",i).each(function(a){var b=f(a)>=Math.PI?"left":"right",c=this.getBBox();O=c.height,"left"==b?P<c.width&&(P=c.width):Q<c.width&&(Q=c.width)}),o=o-Q-P-20,70>o&&(o=70),B-=2*O,H=e(),I=H.radius,J=H.arc,K=H.arcText}var S=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0,T=N.append("g").classed("part",!0);T.append("path").attr("class",function(a,b){return""!=a.data.onClickVal||S||t?"arc pointer":" arc"}).attr("title","").attr("fill",function(a,b){return y(b)}).attr("d",J).each(function(a){this._current=a.data.series[0].data}).on("click",g).on("mouseover",i).on("mousemove",i);var U=$(n).hasClass("fromCommentDialog");if(app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,T,function(a){return J.centroid(a)[0]},function(a){return J.centroid(a)[1]}),U&&app.chartCommons.commentUtils.setOnHighlightListener(T,b.ChartInPageId),m){R.attr("transform",function(a){var b=K.centroid(a);return b[0]=1.1*I*(f(a)<Math.PI?1:-1),"translate("+b+")"}).style("text-anchor",function(a){return f(a)>=Math.PI?"start":"end"}).style("display",function(a){var b=d3.select(this),c=(h(b.attr("transform")),"start"==b.style("text-anchor")?1:-1,this.getBBox(),"auto");return c}),L.append("g").attr("class","lines");var V=L.select(".lines").selectAll("polyline").data(M);V.enter().append("polyline"),V.attr("points",function(a,b){this._current=this._current||a;var c=d3.interpolate(this._current,a);this._current=c(0);var d=K.centroid(a);return d[0]=1*I*(f(a)<Math.PI?1:-1),[J.centroid(a),K.centroid(a),d]}).style("display",function(a,b){return $(n+" #l-"+b).css("display")})}var W=F.append("div").style("position","absolute").style("color","#fff").style("-moz-border-radius","5px").style("-webkit-border-radius","5px").style("border-radius","5px").style("padding","7px 15px").style("text-align","right").style("z-index","10").style("opacity","0").style("background-color","#000");$(n).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.radar={},app.charts.radar.draw=function(a,b,c,d){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var e=(a.title,a.chartInfo,"undefined"==typeof a.lang?!0:0==+a.lang),f="undefined"!=typeof a.series?a.series.labels:[],g="undefined"!=typeof a.kpis?a.kpis.labels:[],h="#"+b.id,i={top:10,right:20,bottom:0,left:20},j=("small"==b.chartProp.info.chartSize?180:"medium"==b.chartProp.info.chartSize?250:"large"==b.chartProp.info.chartSize?400:"veryLarge"==b.chartProp.info.chartSize?600:130,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked),k=$(h).width(),l=$(h).height()-i.top-i.bottom;d3.scale.category10();b.width=k;var m=d.isProgress,n=d.showProgress;d.title;if($(h).addClass("radar-chart"),app.chartCommons.setDefault(b.chartProp,g.concat(f),"radar"),b.editMode&&$(h).trigger("chartproperty",[g.concat(f)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));for(var o=prepareData(a),p=0;p<o.length;p++)for(var q=0;q<o[p].series.length;q++)b.chartProp.series[f[q]].cumulative&&(o[p].series[q]+=o[p-1]?o[p-1].series[q]:0);var r=d3.select(h).append("div").attr("class","legend-bar temporal");if(r.breadcrumb(a.levels,b,d,e),!a.matrix||0==a.matrix.length)return void d3.select(h).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var s=a.seriesLablesCaptions,t=a.kpisLablesCaptions;d3Utils.prepareDataForBarChart(o,b,f,g,s,t),r.legend({width:k,selector:h,data:o[0].series.filter(function(a){return!a.prop.hidden}).map(function(a){return{label:(a.prop.name||a.label).replace(/^\[measure\]/,""),color:a.prop.seriesColor,key:a.key}})},e);var u=$(h+" .title").outerHeight(),v=$(h+" .legend-bar"),w="undefined"==typeof v?0:v.height()+ +v.css("margin-top").replace("px","");l=$(h).height()-u-w,150>l&&(l=150);var x=function(){var c={radius:4,w:600,h:600,factor:1,factorLegend:.85,levels:6,maxValue:0,radians:2*Math.PI,opacityArea:.5,ToRight:5,TranslateX:0,TranslateY:0,ExtraWidthX:0,ExtraWidthY:0,color:d3.scale.category10()},d=d3.select(h).append("div").attr("class","temporal").style("position","relative").style("margin","0 auto").style("text-align","left"),f=o.map(function(a,b){return a.label}),g=f.length,i=0,p=d.selectAll(".axis-label").data(f).enter().append("div").text(function(a){return persian(a,e)}).attr("class","axis-label").style("width","100px").style("font-size","11px").style("padding","5px").style("text-overflow","ellipsis").style("white-space","nowrap").style("text-align",function(a,b){return i=$(this).outerHeight(),"right"});p.remove(),c.h=Math.min(l-2*i,k-200),c.w=c.h,c.maxValue=Math.max(c.maxValue,d3.max(o,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return a.data}))}));var q=c.factor*Math.min(c.w/2,c.h/2);d3.format("%");d.style("height",c.h+2*i+"px"),d.style("width",c.w+200+"px");var r=d.append("svg"),s=d.selectAll(".axis-label").data(f).enter().append("div").text(function(a){return persian(a,e)}).attr("title",function(a){return a}).attr("class","axis-label").style("position","absolute").style("width","100px").style("font-size","11px").style("padding","5px").style("text-overflow","ellipsis").style("white-space","nowrap").style("overflow","hidden").style("text-align",function(a,b){var d=c.w/2*(1-c.factor*Math.sin(b*c.radians/g)),e="right";return d>=c.w/2&&(e="left"),e}),i=0;s.style("left",function(a,b){var d=c.w/2*(1-c.factor*Math.sin(b*c.radians/g));return d>=c.w/2&&(d+=100),d+"px"}).style("top",function(a,b){var d=$(d3.select(this).node()).outerHeight();i=d;var e=c.h/2*(1-c.factor*Math.cos(b*c.radians/g));return e+=d/2,0==b&&(e=0),e+"px"});for(var t,u=i,v=r.attr("width",c.w).attr("height",c.h).style("position","absolute").style("left","100px").style("top",u+"px").append("g").attr("transform","translate("+c.TranslateX+","+c.TranslateY+")"),w=0;w<c.levels-1;w++){var x=c.factor*q*((w+1)/c.levels);v.selectAll(".levels").data(f).enter().append("svg:line").attr("x1",function(a,b){return x*(1-c.factor*Math.sin(b*c.radians/g))}).attr("y1",function(a,b){return x*(1-c.factor*Math.cos(b*c.radians/g))}).attr("x2",function(a,b){return x*(1-c.factor*Math.sin((b+1)*c.radians/g))}).attr("y2",function(a,b){return x*(1-c.factor*Math.cos((b+1)*c.radians/g))}).attr("class","line").style("stroke","grey").style("stroke-opacity","0.75").style("stroke-width","0.3px").attr("transform","translate("+(c.w/2-x)+", "+(c.h/2-x)+")")}for(var w=0;w<c.levels;w++){var x=c.factor*q*((w+1)/c.levels);v.selectAll(".levels").data([1]).enter().append("svg:text").attr("x",function(a){return x*(1-c.factor*Math.sin(0))}).attr("y",function(a){return x*(1-c.factor*Math.cos(0))}).attr("class","legend").style("font-size","10px").attr("dy","1em").attr("transform","translate("+(c.w/2-x+c.ToRight)+", "+(c.h/2-x)+")").attr("fill","#737373").text(persian(d3.format(b.chartProp.info.formatString)((w+1)*c.maxValue/c.levels),e))}var y=v.selectAll(".axis").data(f).enter().append("g").attr("class","axis");y.append("line").attr("x1",c.w/2).attr("y1",c.h/2).attr("x2",function(a,b){return c.w/2*(1-c.factor*Math.sin(b*c.radians/g))}).attr("y2",function(a,b){return c.h/2*(1-c.factor*Math.cos(b*c.radians/g))}).attr("class","line").style("stroke","grey").style("stroke-width","1px"),series=0,o[0].series.forEach(function(a,b){a.prop.hidden||(dataValues=[],v.selectAll(".nodes").data(o,function(a,d){dataValues.push([c.w/2*(1-parseFloat(Math.max(a.series[b].data,0))/c.maxValue*c.factor*Math.sin(d*c.radians/g)),c.h/2*(1-parseFloat(Math.max(a.series[b].data,0))/c.maxValue*c.factor*Math.cos(d*c.radians/g))])}),dataValues.push(dataValues[0]),v.selectAll(".area").data([dataValues]).enter().append("polygon").attr("class","radar-chart-serie"+series).style("stroke-width","2px").style("stroke",o[0].series[b].prop.seriesColor).attr("points",function(a){for(var b="",d=0;d<a.length;d++)b=b+c.w/2+","+c.h/2+" ";return b}).style("fill",function(a,c){return o[0].series[b].prop.seriesColor}).style("fill-opacity",c.opacityArea).on("mouseover",function(a){z="polygon."+d3.select(this).attr("class"),v.selectAll("polygon").transition(200).style("fill-opacity",.1),v.selectAll(z).transition(200).style("fill-opacity",.7)}).on("mouseout",function(){v.selectAll("polygon").transition(200).style("fill-opacity",c.opacityArea)}).transition(500).attr("points",function(a){for(var b="",c=0;c<a.length;c++)b=b+a[c][0]+","+a[c][1]+" ";return b}),series++)}),series=0;var A=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0;_.each(o,function(a){});var B=o[0].series.map(function(a,b){return o.map(function(a){var c=a.series[b];return c.onClickVal=a.onClickVal,c})}),C=v.selectAll(".entry-group").data(B).enter().append("g").classed("entry-group",!0),D=C.selectAll(".entry-group").data(function(a){return a}).enter().append("g").classed("entry",!0),E=$(h).hasClass("fromCommentDialog");D.append("svg:circle").attr("class",function(a,b){return"radar-chart-serie"+b+" "+(""!=a.onClickVal||A||j?" pointer":"")}).classed("circle",!0).attr("r",c.radius).attr("alt",function(a){return d3.format(b.chartProp.info.formatString)(a.data)}).attr("cx",function(a,b){return c.w/2}).attr("cy",function(a,b){return c.h/2}).attr("data-id",function(a){return a.axis}).style("fill","#fff").style("stroke",function(a){return a.prop.seriesColor}).style("stroke-width","2px").on("click",function(c,d){return E?void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId):(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.value],b.chartProp.globalvariable),$(h+" circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.onClickVal?void(j&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard)):void(m()||(n(!0),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal),$(h).charts(chartTypes.Radar,"refreshWithData",b))))}).on("mouseover",function(a){newX=parseFloat(d3.select(this).attr("cx")),newY=parseFloat(d3.select(this).attr("cy")),t.style("left",newX+105+"px").style("top",newY-5+"px").html(a.label+"<br/><b>"+a.label+": </b>"+persian(d3.format(b.chartProp.info.formatString)(a.data),e)).transition(200).style("opacity",1);var c=($(t[0][0]).width(),$(t[0][0]).height());t.style("top",newY+c/2+"px"),z="polygon."+d3.select(this).attr("class"),v.selectAll("polygon").transition(200).style("fill-opacity",.1),v.selectAll(z).transition(200).style("fill-opacity",.7)}).on("mouseout",function(){t.transition(200).style("opacity",0).each("end",function(){t.style("left",0).style("top",0)}),v.selectAll("polygon").transition(200).style("fill-opacity",c.opacityArea)}).transition(500).attr("cx",function(a,b){return c.w/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.sin(b*c.radians/g))}).attr("cy",function(a,b){return c.h/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.cos(b*c.radians/g))}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,D,function(a,b){return c.w/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.sin(b*c.radians/g))-5},function(a,b){return c.h/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.cos(b*c.radians/g))-24}),E&&app.chartCommons.commentUtils.setOnHighlightListener(D,b.ChartInPageId),t=d.append("div").attr("class","tooltip").style("position","absolute").style("color","#fff").style("-moz-border-radius","5px").style("-webkit-border-radius","5px").style("border-radius","5px").style("padding","7px 15px").style("text-align","right").style("z-index","1000").style("opacity","0").style("background-color","#000").style("max-width","200px").style("opacity",0).style("font-size","13px")};x(),$(h).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.table={},app.charts.table.draw=function(a,b,c,d){function e(b){var c=Math.ceil(a.nonPivotMatrixLength/a.TableInfo.Limit),d=5;if(1!=c){d>c&&(d=c);for(var e=b-Math.ceil(d/2)>0,f=b+Math.ceil(d/2)<c,h=e?f?b-Math.ceil(d/2)+1:c-d+1:1,i="",j=0;d>j;j++)i+="<a  "+(h+j==b?'class="active item"':'class="item"')+' value="'+(h+j)+'">'+(h+j)+"</a>";""!=i&&$(u+" .table-body").append('<div  class="ui borderless pagination menu attached  " style="">                        <a  '+(e?'class="item"':'class="disabled item"')+' value="1" style="border-right:1px solid #d4d4d5; border-radius:0;">&laquo;</a>                        '+i+"                        <a  "+(f?'class="item"':'class="disabled item"')+' value="'+c+'">&raquo;</a>                    </ul>'),$(u+" .table-body .pagination a").on("click",function(){var a=$(this).attr("value");g(parseInt(a))})}}function f(c,d,f){$(c+" .table-body").empty();var g=d3.select(c+" .table-body").style({overflow:"hidden"}).append("div").attr("id","tablescroll").append("table").attr("class"," ui celled table unstackable small table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")),i=g.append("thead").style("background-color","white").append("tr"),k=g.append("tbody").selectAll("nothing").data(d).enter().append("tr").attr("class","pointer");b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&k.on("click",function(a){$(c+" .selected-item").removeClass("selected-item"),$(this).addClass("selected-item")});var m=a.Dimentions.Hierarchies.concat(a.Dimentions.SeriesLevel||[]),o=k.selectAll("nothing").data(function(a){return a}).enter().append("td").style("font-weight",function(a,b){return Y[b].prop.textBold?"bold":"normal"}).style("font-style",function(a,b){return Y[b].prop.textItalic?"italic":"normal"}).style("font-size",function(a,b){return Y[b].prop.fontSize}).style("text-align",function(a,b){return Y[b].prop.textAlign}).style("color",function(a,b){return Y[b].prop.color}).style("display",function(a,b){return Y[b].prop.isHidden?"none":"auto"}).attr("data-value",function(a){return a}).on("click",function(b,c){h.call(this,b,c,m,a.nonPivotMatrix)});o.each(function(a,b){var c=isNaN(a);c||(a*=+Y[b].prop.numberFactor);var d=a;c||(d=d3.format(Y[b].prop.formatString)(a));var e=Y[b].prop.isHtml,f=persian(d,A&&!e);e?d3.select(this).html(f):d3.select(this).text(f)});var r=!1,t=Y.map(function(a){return a.key});a.resultRows.sort(function(a,b){var c=t.indexOf(a.Name),d=t.indexOf(b.Name);return d>c?-1:c>d?1:0});var u=g.select("tbody").append("tr").selectAll("nothing").data(a.resultRows).enter().append("td").style("font-weight","bold").style("display",function(a,b){return Y[b].prop.isHidden?"none":"auto"}).text(function(a,b){if(""==a.Value||null==a.Value)return"";var c=isNaN(a.Value),d=a.Value,e=p(a.Name);return c||3==+a.Type||(d=+a.Value*+e.numberFactor),c||(d=d3.format(e.formatString)(d)),persian(d,A)}),v=d3.select(c+" .table-body").append("div").attr("class","table-footer").append("table").attr("class"," ui celled table unstackable small table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")).append("thead").append("tr").selectAll("nothing").data(a.resultRows).enter().append("th").style("width","1px").style("display",function(a,b){return Y[b].prop.isHidden?"none":"auto"}).style("font-weight",function(a,b){return Y[b].prop.textBold?"bold":"normal"}).style("font-style",function(a,b){return Y[b].prop.textItalic?"italic":"normal"}).style("font-size",function(a,b){return Y[b].prop.fontSize}).style("text-align",function(a,b){return Y[b].prop.textAlign}).style("color",function(a,b){return Y[b].prop.color}).text(function(a,b){if(""==a.Value||null==a.Value)return"";r=!0;var c=isNaN(a.Value),d=a.Value,e=p(a.Name);return c||3==+a.Type||(d=+a.Value*+e.numberFactor),c||(d=d3.format(e.formatString)(d)),persian(d,A)}),w=d3.select(c+" .table-body").insert("div","#tablescroll").attr("class","header-table").append("table").attr("class"," ui celled table unstackable small table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")),x=w.append("thead").style("background-color","white").append("tr");
n(Y,x,w,{sort:function(a,d,e){if(!y()){if(z(!0),null==D.Order)D.Order=[{Index:a,DescType:1}];else{for(var f=!1,g=0;g<D.Order.length;g++){var h=D.Order[g];if(h.Index==a){var i={Index:a,DescType:0==h.DescType?1:1==h.DescType?2:1};D.Order.splice(g,1);D.Order.push(i),f=!0;break}}f||D.Order.push({Index:a,DescType:1})}$.extend(b.parameters,{TableInfo:D,notEditMode:!b.editMode}),b.editMode&&$(c).trigger("tableInfo",[{TableInfo:D}]),$(c).charts(chartTypes.TABLE,"refreshWithData",b,{refreshRelatedDatasources:!1})}},filter:function(){var a=q();y()||(z(!0),D.Filter=a.map(function(a,b){return a.value=depersian(a.value,A),RegExp(/^[\d,]+$/).test(a.value)&&(a.value=a.value.replace(/,/g,"")),{Index:b,FilterType:a.type,FilterParameter:a.value}}),D.Page=1,b.TableInfo=D,$.extend(b.parameters,{TableInfo:D,notEditMode:!b.editMode}),$(c).charts(chartTypes.TABLE,"refreshWithData",b,{refreshRelatedDatasources:!1}))},filterclear:function(a){$(c+" #filterbox-"+a+" input").val("");var d=q();y()||(z(!0),D.Filter=d.map(function(a,b){return{Index:b,FilterType:a.type,FilterParameter:a.value}}),D.Page=1,b.TableInfo=D,$.extend(b.parameters,{TableInfo:D}),$(c).charts(chartTypes.TABLE,"refreshWithData",b,{refreshRelatedDatasources:!1}))}}),d3.select(x[0][0]).selectAll("th").style("width","1px"),ka&&0!=ka.length||g.select("tbody").append("tr").append("td").attr("colspan",Y.length).append("div").style("font-size","0.8em").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var B=k[0];if(B.forEach(function(a,b){l(a.__data__,Y,a)}),n(Y,i,g,{sort:function(){},filter:function(){},filterclear:function(){}}),e(f),$(c).trigger("heightChange"),b.chartProp.info.showRowNumber&&E){var C=(a.TableInfo.Page-1)*a.TableInfo.Limit+1;k.insert("td","td").text(function(a,b){return persian(C+b,A)}).style("text-align","right"),d3.select(u.node().parentNode).insert("td","td"),x.insert("th","th").text("ردیف"),i.insert("th","th").text("ردیف"),d3.select(c+" .table-body .table-footer tr").insert("th","th").style("width","1px"),v=d3.selectAll(c+" .table-body .table-footer tr th"),u=d3.select(u.node().parentNode).selectAll("td")}j(k,i,x,v,r,u),$(c).trigger("heightChange");var F=$(c).data("filterbox");s(F)}function g(a){y()||(z(!0),D.Page=a,D.IsPageValid=!0,$.extend(b.parameters,{TableInfo:D,notEditMode:!b.editMode}),$(u).charts(chartTypes.TABLE,"refreshWithData",b,{refreshRelatedDatasources:!1}),b.parameters.TableInfo.IsPageValid=!1)}function h(c,d,e,f){var g=[],h="",i=$(this).hasClass("selected-item"),j=$(this).parents("tr").index();if("undefined"==typeof b.chartProp.info.selectable&&(b.chartProp.info.selectable="multi"),"none"!=b.chartProp.info.selectable){if("edit"==b.chartProp.info.selectable)return void $("body").trigger("open-form",[a.form,a.formIds[j],u]);if(b.chartProp.info.rowAsKey&&b.chartProp.info.rowKey){if(d=e.indexOf(b.chartProp.info.rowKey),-1==d)return;"one"==b.chartProp.info.selectable&&$(u+" .selected-item").removeClass("selected-item"),i?$(this).parents("tr").find("td").removeClass("selected-item"):$(this).parents("tr").find("td").addClass("selected-item")}else"one"==b.chartProp.info.selectable&&$(u+" td:nth-child("+(d+1)+").selected-item").removeClass("selected-item"),i?$(this).removeClass("selected-item"):$(this).addClass("selected-item");var k=d+1+(b.chartProp.info.showRowNumber?1:0),g=$(u+" td:nth-child("+k+").selected-item").map(function(){return f[j][d]}).toArray();if(h=e[d],g=g.filter(function(a,b){return g.indexOf(a)==b}),!b.editMode){var f={Id:-1,Values:g,VariableType:0,dimensionName:h,datasourceId:a.DataSourceId,chartInPageId:b.ChartInPageId,chartId:a.chartId};app.moderation.dashboadpage.selectValueOnChart(f,a.RefreshDatasource)}}}function i(a){return $(a).get(0).scrollHeight>$(a).height()}function j(a,c,d,e,f,g){function h(){var a=document.createElement("div");a.style.visibility="hidden",a.style.width="100px",a.style.msOverflowStyle="scrollbar",document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var c=document.createElement("div");c.style.width="100%",a.appendChild(c);var d=c.offsetWidth;return a.parentNode.removeChild(a),b-d}function j(){$(u+" .header-table").css("-ms-transform","translate3d("+(-o+$(u+" #tablescroll").scrollLeft())+"px,0px,0px)"),$(u+" .table-footer").css("-ms-transform","translate3d("+(-o+$(u+" #tablescroll").scrollLeft())+"px,0px,0px)"),$(u+" .header-table").css("-webkit-transform","translate3d("+(o-$(u+" #tablescroll").scrollLeft())+"px,0px,0px)"),$(u+" .table-footer").css("-webkit-transform","translate3d("+(o-$(u+" #tablescroll").scrollLeft())+"px,0px,0px)"),$(u+" .header-table").css("-moz-transform","translate3d("+-$(u+" #tablescroll").scrollLeft()+"px,0px,0px)"),$(u+" .table-footer").css("-moz-transform","translate3d("+-$(u+" #tablescroll").scrollLeft()+"px,0px,0px)")}var k=a[0][0];$(u).parents(".ui.card").width();$(k).find("td").each(function(b,f){var g=e[0][b],h=d3.select(d[0][0]).selectAll("th"),i=h[0][b],j=d3.select(c[0][0]).selectAll("th"),k=(j[0][b],$(f).outerWidth()),l=($(f).width(),$(f).css("padding-top")),m=$(f).css("padding-left"),n=$(f).css("padding-right"),o=$(f).css("padding-bottom"),p=function(a){a.css("width",k+"px"),a.css("max-width",k+"px"),a.css("min-width",k+"px"),a.css("padding-top",l),a.css("padding-left",m),a.css("padding-right",n),a.css("padding-bottom",o)};p($(g)),p($(a[0]).map(function(a,c){return $(c).find("td")[b]})),p($(i))}),c.remove(),f||$(u+" .table-footer").remove(),g.remove();var l=$(k).outerWidth();if($(u+" table").css("width",l+"px"),$(u+" table").css("max-width",l+"px"),i($(u+" #tablescroll"))){var m=0;m=h();var n=m+$(u+" .header-table table th:last-child").outerWidth();$(u+" .header-table table th:last-child").css({"min-width":n+"px","max-width":n+"px",width:n+"px"}),n=m+$(u+" .table-footer table th:last-child").outerWidth(),$(u+" .table-footer table th:last-child").css({"min-width":n+"px","max-width":n+"px",width:n+"px"})}var o=$(u+" #tablescroll").scrollLeft();if($(u+" #tablescroll").on("scroll",j),j(),2==app.dashboardLayoutVersion&&!b.editMode){var p=$(u+" .table-body").get(0).scrollWidth>$(u+" .table-body").innerWidth()?15:0;p=0;var q=0;try{q=$(u+" .pagination").height()+ +$(u+" .pagination").css("margin-top").replace("px","")}catch(r){}}}function k(a,b,c){var d=c.indexOf(a.firstField),e=b[d],f=a.secondFieldIsText?a.secondFieldInput:b[c.indexOf(a.secondFieldSelect)];switch(e=depersian(e),f=depersian(f),isNaN(f)||(f=+f),isNaN(e)||(e=+e),+a.operand){case 1:return e==f;case 2:return e!=f;case 3:return e>f;case 4:return e>=f;case 5:return f>e;case 6:return f>=e;case 7:return e.indexOf(f)>-1;case 8:return e.indexOf(f)<=-1}}function l(a,c,d){var e=c.map(function(a){return a.key});b.chartProp.indicator&&b.chartProp.indicator.forEach(function(b){var c=!0;if($.each(b.ifRow,function(b,d){return k(d,a,e)?void 0:(c=!1,!1)}),c){var f=$(d).find("td");$.each(b.thenRow,function(a,b){var c=e.indexOf(b.firstField),d=$(f[c]);switch(+b.operand){case 1:d.css("color",b.secondFieldColor);break;case 2:d.append(' <span class="'+b.secondFieldIcon+'"> </span> ');break;case 3:d.css("background-color",b.secondFieldBackColor);break;case 4:var g=+b.secondFieldStyle;1==g&&(d.css("font-weight","normal"),d.css("font-style","normal")),2!=g&&4!=g||d.css("font-weight","bold"),3!=g&&4!=g||d.css("font-style","italic"),5==g&&d.css("text-decoration","underline");break;case 5:d.text(b.secondFieldReplace)}})}})}function m(a,b,c){$(b);if(isDesc=!1,D&&D.Order)for(var d=0;d<D.Order.length;d++){var e=D.Order[d];if(e.Index==a){isDesc=2==e.DescType;break}}c.sort(function(b,c){return"undefined"!=typeof b.label&&(b=[b.label].concat(b.series),c=[c.label].concat(c.series)),"undefined"!=typeof isDesc&&isDesc?/^[0-9.]+$/.test(b[a])?d3.descending(+b[a],+c[a]):d3.descending(b[a],c[a]):/^[0-9.]+$/.test(b[a])?d3.ascending(+b[a],+c[a]):d3.ascending(b[a],c[a])})}function n(a,c,d,e){if(E){var f=c.selectAll("nothing").data(a).enter().append("th").html(function(a,b){var c="";c='<div class="ui  dropdown " id="filterbox-'+b+'"><i class="table-filter-icon filter icon"></i><div class="menu"><div class="ui left icon input mini"><i class="search icon"></i><input type="text" name="search" placeholder="جستجو"></div><div class="item"></div>';return'<div class="inline header-text pointer" style="white-space:initial;">'+persian(a.prop.name||a.value,A).replace(/^\[measure\]/,"")+"</div>"+c}).attr("class","pointer hover-show-glyph").style("white-space","nowrap").style("text-align",function(a,b){return a.prop.textAlign}).style("display",function(a,b){return a.prop.isHidden?"none":"auto"}),g=0;f[0].forEach(function(a,b){if(g+=+$(a).width(),130>g||0==b){var c=$(a).find(".dropdown-menu-right");c.removeClass("dropdown-menu-right"),c.addClass("dropdown-menu-left")}}),d.selectAll("thead th").each(function(a,c){d3.select(this).select(".header-text").on("click",function(){e.sort(c,this,W),b.editMode&&u&&$(u).trigger("legendClick",[a.label,c,a])})}),d.selectAll("thead th").each(function(a,b){$(this).find("input").keyup(function(a){13==a.keyCode&&e.filter()})}),d.selectAll("thead th").each(function(a,b){$(this).find(".btn-default").on("click",function(){e.filterclear(b)})}),d.selectAll("thead th").each(function(a,b){$(this).find(".dropdown").on("shown.bs.dropdown",function(){$(this).find("input").focus()})});for(var h=0;h<a.length;h++)d3.select(u+" #filterbox-"+h+" select").on("click",function(a){d3.event.stopPropagation()}),d3.select(u+" #filterbox-"+h+" input").on("click",function(a){d3.event.stopPropagation()}),$(u+" #filterbox-"+h+" input").mousedown(function(a){3==a.which&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation())}),$(u+" #filterbox-"+h).on("keypress",function(a){13===a.keyCode&&(a.preventDefault(),$(this).find(".btn-primary").click())});b.editMode||$(u).find(".ui.dropdown").lazyDropdown()}}function o(a){return a>=Y.length&&(a=Y.length-1),Y[a].prop}function p(a){var c={numberFactor:"1",textAlign:"right",formatString:",.2f",fontSize:"1em",textItalic:!1,textBold:!1,color:"#000000",rowResult:"0",isHidden:!1};try{return b.chartProp.series[a]||b.chartProp.series["default"]||c}catch(d){return c}}function q(){for(var a=[],b=$(u+" table thead th input"),c=0;c<b.length;c++){if(value=$(u+" #filterbox-"+c+" input").val(),type=$(u+" #filterbox-"+c+" select").val()||1,null==type)return;"undefined"!=typeof value&&null!=value&&""!=value&&($(u+" #filterbox-"+c+" .glyphicon-filter").addClass("show"),d3.select(u+" #filterbox-"+c+" select").on("click",function(a){d3.event.stopPropagation()}),d3.select(u+" #filterbox-"+c+" input").on("click",function(a){d3.event.stopPropagation()}),$(u+" #filterbox-"+c+" input").mousedown(function(a){3==a.which&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation())})),a.push({value:value,type:type})}return $(u).data("filterbox",a),a}function r(){var a=q();"undefined"!=typeof W&&W.style("display",function(b){"undefined"!=typeof b.label&&(b=[b.label].concat(b.series));var c=t(b,a);return c?null:"none"}),b.editMode&&$(u).trigger("tableInfo",[{TableInfo:D}])}function s(a,b){if("undefined"!=typeof a){for(var c=!1,d=0;d<a.length;d++)"undefined"!=typeof a[d].value&&""!=a[d].value&&(c=!0),$(u+" #filterbox-"+d+" input").val(a[d].value),_.isEmpty(a[d].value)||$(u+" #filterbox-"+d+" .table-filter-icon").addClass("fill"),$(u+" #filterbox-"+d+" select").val(a[d].type);c&&!b&&r()}}function t(a,b){for(var c=!0,d=0;d<b.length;d++)if(parameter=b[d].value,parameter=depersian(parameter),parameter=RegExp(/^[\d,\s]+$/).test(parameter)?+parameter.replace(/,/g,""):parameter,type=b[d].type,"undefined"!=typeof parameter&&""!=parameter)switch(+type){case 1:a[d];c=c&&-1!=a[d].indexOf(parameter);break;case 6:a[d];c=c&&-1==a[d].indexOf(parameter);break;case 2:c=c&&(parseFloat(a[d])||0)==parameter;break;case 3:c=c&&(parseFloat(a[d])||0)>parameter;break;case 4:c=c&&(parseFloat(a[d])||0)<parameter;break;case 5:var e=parameter.split(",");"undefined"!=e&&(c=c&&(parseFloat(a[d])||0)>e[0]&&(parseFloat(a[d])||0)<e[1])}return c}var u="#"+b.id,v={top:10,right:20,bottom:0,left:20},w=$(u).width(),x="small"==b.chartProp.info.chartSize?170:"medium"==b.chartProp.info.chartSize?300:"large"==b.chartProp.info.chartSize?400:"veryLarge"==b.chartProp.info.chartSize?500:250;x+v.top+v.bottom;b.width=w;var y=d.isProgress,z=d.showProgress,A=(d.title,"undefined"==typeof a.lang?!0:0==+a.lang),B=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked,C=$(u).data("table-info"),D=C||b.tableInfo||{};$(u).data("table-info",D),console.log("### set table info");var E="undefined"!=typeof b.chartProp.info.showHeader?b.chartProp.info.showHeader:!0;if($(u).addClass("table-chart-container"),$(u).parents(".content").addClass("hidden-overflow"),b.editMode&&$(u).addClass("edit-mode"),2==app.dashboardLayoutVersion&&!b.editMode){var F=$(u+" .title").outerHeight(),G=$(u).height()-F;x=G}"undefined"==typeof b.chartProp.info.stripped&&(b.chartProp.info.stripped=!0),"undefined"==typeof b.chartProp.info.hover&&(b.chartProp.info.hover=!0);var H=(b.chartProp.info.bordered?" table-bordered":"")+(b.chartProp.info.stripped?" table-striped":"")+(b.chartProp.info.hover?" table-hover":"")+" ";if(+a.isPivot>-1){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var I=a.chartInfo,J="undefined"!=typeof a.series?a.series.labels:[],K="undefined"!=typeof a.kpis?a.kpis.labels:[],L=d3Utils.convertToKeyValue(a);L.seriesLabels=L.seriesLabels.map(function(a){return a.prop=p(a.key),a});var M=L.seriesLabels.map(function(a){return a.key});L.seriesLabels.map(function(a){return a.value}),b.LabelY,d3.scale.category10();if(app.chartCommons.setDefault(b.chartProp,M.concat(I.hierarchyLabels),"table"),b.editMode&&$(u).trigger("chartproperty",[M.concat(I.hierarchyLabels)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var N=prepareData(a,null,!0),O=a.seriesLablesCaptions,P=a.kpisLablesCaptions;if(d3Utils.prepareDataForBarChart(N,b,J,K,O,P),a.levels&&a.levels.length>0){var Q=d3.select(u).append("div").attr("class","legend-bar temporal");Q.breadcrumb(a.levels,b,d,A)}if(2==app.dashboardLayoutVersion&&!b.editMode){var R=$(u+" .legend-bar"),S=R.css("margin-top"),T=(S?+R.css("margin-top").replace("px",""):0,"undefined"==typeof R?0:R.height()+0);x-=T}if(!a.matrix||0==a.matrix.length)return void d3.select(u).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var U=d3.select(u).append("div").attr("class","temporal table-body").style(app.mobileMode?{overflow:"hidden"}:{overflow:"hidden"}).append("div").attr("id","tablescroll").append("table").attr("class"," ui celled table unstackable unstackable small table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")),V=U.append("thead").style("background-color","white").append("tr"),W=U.append("tbody").selectAll("nothing").data(N).enter().append("tr").attr("class",function(a){return"none"!=b.chartProp.info.selectable||""!=a.onClickVal||B||b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode?"pointer":""}).attr("data-index",function(a,b){return b}).on("click",function(c,d){if(!Z){if(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode){var e=a.series.labels.concat([a.CurrentDimName]),f=c.series.concat(c.label);app.globalVariableHelper.updateGlobalVariables(e,f,b.chartProp.globalvariable),$(u+" .selected-item").removeClass("selected-item"),$(this).addClass("selected-item")}return""==c.onClickVal?void(B&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard)):void(y()||(z(!0),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal),$(u).charts(chartTypes.TABLE,"refreshWithData",b)))}}),X=N.map(function(a){return[a.label]});W.append("td").style("font-weight",function(b,c){return p(a.CurrentDimName).textBold?"bold":"normal"}).style("font-style",function(b,c){return p(a.CurrentDimName).textItalic?"italic":"normal"}).style("font-size",function(b,c){return p(a.CurrentDimName).fontSize}).style("text-align",function(b,c){return p(a.CurrentDimName).textAlign}).style("color",function(b,c){return p(a.CurrentDimName).color}).style("display",function(b,c){return p(a.CurrentDimName).isHidden?"none":"auto"}).attr("data-index",function(a,b){return b}).text(function(a,b){return persian(a.label,A)}).on("click",function(c,d){if(!Z){b.chartProp.info.rowAsKey=!0,b.chartProp.info.rowKey=a.CurrentDimName;var e=d3.select(this.parentNode).datum();""==e.onClickVal&&h.call(this,c,d,[a.CurrentDimName],X)}});var Y=L.seriesLabels.map(function(a){return{key:a.key,value:a.value,prop:p(a.key)}});Y.unshift({key:a.CurrentDimName,value:a.CurrentDimName,prop:p(a.CurrentDimName)});var Z=$(u).hasClass("fromCommentDialog"),aa=W.selectAll("nothing").data(function(a){return _.each(a.series,function(b){return b.onClickVal=a.onClickVal,b}),a.series}).enter().append("td").style("font-weight",function(a,b){return Y[b+1].prop.textBold?"bold":"normal"}).style("font-style",function(a,b){return Y[b+1].prop.textItalic?"italic":"normal"}).style("font-size",function(a,b){return Y[b+1].prop.fontSize}).style("text-align",function(a,b){return Y[b+1].prop.textAlign}).style("color",function(a,b){return Y[b+1].prop.color}).style("display",function(a,b){return Y[b+1].prop.isHidden?"none":"auto"}).style("position","relative").text(function(a,b){var c=a.data,d=Y[b+1].prop,e=isNaN(c);return e||(c*=+d.numberFactor),e?persian(c,A):persian(d3.format(d.formatString)(c),A)}).classed("entry",!0).on("click",function(c,d){if(Z)return void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId);b.chartProp.info.rowAsKey=!0,b.chartProp.info.rowKey=a.CurrentDimName;var e=d3.select(this.parentNode).datum();""==e.onClickVal&&h.call(this,c,d,[a.CurrentDimName],X)}),ba=aa.append("svg").attr({width:50,height:24}).style({position:"absolute",left:"6px","fill-opacity":"0.5"});app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,ba,function(a,b){return 0},function(a,b){return 0}),Z&&app.chartCommons.commentUtils.setOnHighlightListener(aa,b.ChartInPageId),b.isRefresh||(_.each(Y,function(b){var c=_.some(a.resultRows,{Name:b.key});c||(a.resultRows=[{Name:b.key,Type:0,Value:""}].concat(a.resultRows))}),a.resultRows=a.resultRows.sort(function(a,b){var c=M.indexOf(a.Name),d=M.indexOf(b.Name);return c>d?1:d>c?-1:0}));var ca=U.select("tbody").append("tr").selectAll("nothing").data(a.resultRows).enter().append("td").style("font-weight","bold").style("display",function(a,b){return Y.length-1<b?"auto":Y[b].prop.isHidden?"none":"auto"}).text(function(a,b){if("undefined"==typeof a||""==a.value)return"";var c=a.Value,d=p(a.Name);if("undefined"==typeof d)return"";var e=isNaN(a.Value);return e||3==+a.Type||(c=+a.Value*+d.numberFactor),e||(c=d3.format(d.formatString)(c)),persian(c,A)}),da=!1,ea=d3.select(u+" .table-body").append("div").attr("class","table-footer").append("table").attr("class","table  table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")).append("thead").append("tr").selectAll("nothing").data(a.resultRows).enter().append("th").style("width","1px").style("display",function(a,b){return o(b).isHidden?"none":"auto"}).style("font-weight",function(a,b){return o(b).textBold?"bold":"normal"}).style("font-style",function(a,b){return o(b).textItalic?"italic":"normal"}).style("font-size",function(a,b){return o(b).fontSize}).style("text-align",function(a,b){return o(b).textAlign}).style("color",function(a,b){return o(b).color}).text(function(a,b){if("undefined"==typeof a||""==a.Value||null==a.Value)return"";var c=a.Value,d=p(a.Name),e=isNaN(a.Value);return e||3==+a.Type||(c=+a.Value*+d.numberFactor),da=!0,e||(c=d3.format(d.formatString)(c)),persian(c,A)}),fa=d3.select(u+" .table-body").insert("div","#tablescroll").attr("class","header-table").append("table").attr("class"," ui celled table unstackable small table-chart"+H+(b.chartProp.info.condensed?"table-condensed":"")),ga=fa.append("thead").style("background-color","white").append("tr");n(Y,ga,fa,{sort:function(a,c,d){if(X=d.data().map(function(a){return[a.label]}),null==D.Order)D.Order=[{Index:a,DescType:1}];else{for(var e=!1,f=0;f<D.Order.length;f++){var g=D.Order[f];if(g.Index==a){var h={Index:a,DescType:0==g.DescType||1==g.DescType?2:1};D.Order.splice(f,1);D.Order.push(h),e=!0;break}}e||D.Order.push({Index:a,DescType:1})}console.log("TableInfo.Order",D.Order),m(a,c,d),b.editMode&&$(u).trigger("tableInfo",[{TableInfo:D}])},filter:function(){r()},filterclear:function(a){$(u+" #filterbox-"+a+" input").val(""),r()}});var ha=W[0];if(ha.forEach(function(a,b){l([0].concat(a.__data__.series),Y,a)}),n(Y,V,U,{sort:function(){},filter:function(){},filterclear:function(a){}}),b.chartProp.info.showRowNumber&&E&&(W.insert("td","td").text(function(a,b){return persian(1+b,A)}).style("text-align","right"),d3.select(ca.node().parentNode).insert("td","td"),ga.insert("th","th").text("ردیف"),V.insert("th","th").text("ردیف"),d3.select(u+" .table-body .table-footer tr").insert("th","th").style("width","1px"),ea=d3.selectAll(u+" .table-body .table-footer tr th"),ca=d3.select(ca.node().parentNode).selectAll("td")),j(W,V,ga,ea,da,ca),$(u).trigger("heightChange"),b.tableInfo&&b.tableInfo.Order&&b.tableInfo.Order.length>0)for(var ia=0;ia<b.tableInfo.Order.length;ia++){var ja=$(ga[0][0]).find("th").get(b.tableInfo.Order[ia].Index);m(b.tableInfo.Order[ia].Index,ja,W)}}else{if(b.input=a,app.chartCommons.calculateFields({data:a.nonPivotMatrix,labels:a.headers},b.calculatedFields,a.ColumnIsNumeric),app.chartCommons.setDefault(b.chartProp,a.headers,"table"),b.editMode&&$(u).trigger("chartproperty",[a.headers]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var ka=a.nonPivotMatrix,Y=a.headers.map(function(a){return{key:a,value:a,prop:p(a)}});d3.select(u).append("div").attr("class","temporal table-body");a.TableInfo.Page;f(u,a.nonPivotMatrix,a.TableInfo.Page)}if(a.TableInfo&&a.TableInfo.Filter){var la=a.TableInfo.Filter.map(function(a){return{value:a.FilterParameter,type:a.FilterType}});s(la)}var la=$(u).data("filterbox");s(la)};var app=app||{};app.charts=app.charts||{},app.charts.tree={},app.charts.tree.draw=function(a,b,c,d){function e(c){return c.dimensionName=a.dimensionName,c.datasourceId=a.DataSourceId,c.chartId=b.editMode?-1:a.chartId,b.editMode||-1!=c.Id||app.chartCommons.userFilter.setFilter({id:c.Id,values:c.Values,variableType:c.VariableType,dimensionName:c.dimensionName,chartInPageId:b.ChartInPageId,datasourceId:c.datasourceId}),-1==+c.Id?(app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),void app.filterBox.refresh()):void $.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(c),success:function(a){a.result?(app.moderation.dashboadpage.refreshRelatedDatasources(a.relatedDatasource,[+b.ChartInPageId]),app.filterBox.refresh()):alert(a.Message)}})}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var f=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),g="undefined"!=typeof a.kpis?a.kpis.labels:[],h=(b.LabelY,"#"+b.id),i=$(h).width();$(h).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130;b.width=i;"undefined"==typeof a.lang?!0:0==+a.lang,d.isProgress,d.showProgress,d.title;if(b.editMode&&$(h).trigger("chartproperty",[g.concat(f)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(h).addClass("tree-chart").css("text-align","right");var j=$(h+" .title").outerHeight(),k=$(h).outerHeight()-j-2,l=d3.select(h).append("ul").attr("class","root-node temporal tree").text("");l.style("height",k+"px");var m=function(a,c){a.select(".loading").remove(),$(a.node()).data("vals",c.vals);var d=$(a.node()).find(".tree-caret"),f=0==d.length||d.hasClass("rotate"),g=d3.select($("<ul></ul>").get(0)).attr("class","tree-element collapse fade "+(f?"in":""));c.data=c.data.map(function(a){return{id:a[0],parent:a[1],name:a[2]||a[0],type:c.hasType?a[3]:null,childs:a[a.length-1]}});var i=g.selectAll("li").data(c.data).enter().append("li").attr("class","node tree-element");i.append("span").text(function(a,b){return a.name}).attr("class","value pointer").on("click",function(a){var d=b.chartProp.info.selectable;if("undefined"!=typeof d&&"none"!=d){"one"==d&&$(this).closest(".tree-chart").find(".value.active").removeClass("active"),$(this).toggleClass("active");var f=d3.select(h).selectAll(".active").data().map(function(a){return a.id}),g=_.filter(c.vals,function(a){return a[0]==f}).map(function(a){return a[1]});e({Id:-1,Values:g,VariableType:0})}}),i.each(function(a){0!=+a.childs&&d3.select(this).append(b.editMode?"span":"i").attr("class",function(){return b.editMode?"glyphicon-chevron-left glyphicon tree-caret pointer":"icon angle down icon-animate large  tree-caret pointer"}).text(" ").on("click",function(a,c){if(0!=+a.childs){var d=$(this),e=d.hasClass("rotate");e?d.removeClass("rotate"):d.addClass("rotate");var f=$(this).data("loaded");if(f){var g=$(this).parent().find(" > ul");return void(b.editMode?g.collapse(d.hasClass("rotate")?"hide":"show"):g.transition(e?"out scale right":"in  scale left"))}$(this).data("loaded",!0);var h=app.urlPrefix+"Charts/BarChart/getTreeData",i={parent:a.id,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode};b.editMode&&(i.ChartInfo=$("#divChart").data("chartInfo"));var j=d3.select(this).node().parentElement;d3.select(j).append("ul").attr("class","loading collapse fade in").html('<div class="ui active inline loader mini"></div>');var k=app.mobileMode?proxy.ajax:$.ajax,l=app.mobileMode&&!app.mobileModeTest?i:JSON.stringify(i);k({url:h,type:"POST",dataType:"json",data:l,success:function(a,c,d){b.mobileModeData={isOnline:c,date:d},m(d3.select(j),a)},contentType:"application/json",error:function(){}})}})}),b.editMode||g.style("display","none"),$(a[0][0]).append($(g[0][0])),b.editMode||$(a[0][0]).find("> ul").transition("in scale ")};m(l,a),$(h).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.text={},app.charts.text.draw=function(a,b,c,d){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var e=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),f="undefined"!=typeof a.kpis?a.kpis.labels:[],g=(b.LabelY,"#"+b.id),h=$(g).width();$(g).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130;b.width=h;"undefined"==typeof a.lang?!0:0==+a.lang,d.isProgress,d.showProgress,d.title;if(b.editMode&&$(g).trigger("chartproperty",[f.concat(e)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(g).addClass("tree-chart").css("text-align","right");var i=$(g+" .title").outerHeight(),j=$(g).outerHeight()-i-2,k=d3.select(g).append("ul").attr("class","root-node temporal tree").text("");k.style("height",j+"px"),$(g).append(b.chartProp.info.html)};var app=app||{};app.charts=app.charts||{},app.charts.userControl={},String.prototype.deentitize=function(){var a=this.replace(/&gt;/g,">");return a=a.replace(/&lt;/g,"<"),a=a.replace(/&quot;/g,'"'),a=a.replace(/&apos;/g,"'"),a=a.replace(/&amp;/g,"&")},String.prototype.entitize=function(){var a=this.replace(/>/g,"&gt;");return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/"/g,"&quot;"),a=a.replace(/'/g,"&apos;")},app.charts.userControl.draw=function(a,b,c,d){function e(){function c(a){var c=[a],d=b.chartProp.info.textOperand||"or";c.push(d);var e=b.chartProp.info.dimensions.map(function(a){return a.Name}).join(", ");if(c.push(e),b.chartProp.info.dimensions.forEach(function(a){c.push(a.formula)}),b.editMode)$(l).trigger("default-value",[!0,c,5]);else{var f={Id:b.chartProp.info.variableId||-1,Values:c,VariableType:5};k(f)}}var d='<div class="input-group temporal" style="margin-top:10px">                   <span class="input-group-btn">                     <button type="button" class="btn btn-default">                     <span style="font-size:13px" class="glyphicon glyphicon-search"> </span>                     </button>                   </span>                   <input type="text" placeholder="جستجو..." class="form-control">                 </div>';d='<div class="ui form temporal"><div class=" field"><div class="ui icon input">  <input type="text" placeholder="جستجو...">  <i class="search icon"></i></div></div></div>',$(l).append(d),$(l+" input").on("keydown",function(a){if(13==a.keyCode){var b=$(this).val();c(b)}}),$(l+" button").on("click",function(){var a=$(l+" input").val();c(a)});var e=[];e=a.GloablFilterDefaultValue?a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&-1!=b.chartProp.info.variableId?a.DefaultValue:b.chartProp.info.variableDefault&&b.chartProp.info.variableDefault.values&&"NONE"==b.chartProp.info.variableDefaultFunction&&-1!=b.chartProp.info.variableId?b.chartProp.info.variableDefault.values:["",""],$(l+" input").val(e[0])}function f(){if(!b.editMode){var c=app.chartCommons.userFilter.getFilterValue(b.ChartInPageId);_.isNull(c)||(a.GloablFilterDefaultValue=a.GloablFilterDefaultValue||{},a.GloablFilterDefaultValue.ValuesType=c.variableType,a.GloablFilterDefaultValue.Value=3==+c.variableType?c.defaultValue:c.values)}}function g(){var d=a.fields.map(function(a){return a.Value}),e=a.fields.map(function(a){return a.Key});e.length!=d.length&&$("#"+b.id).append(app.chartCommons.getError(a));for(var f=[],g=0;g<d.length;g++)f.push({Caption:e[g],Uniquename:d[g],IsChecked:!1});var h=function(c){var d=c.filter(function(a){return a.IsChecked}).map(function(a){return a.Uniquename}),e=c.filter(function(a){return a.IsChecked}).map(function(a){return a.Caption}),f='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+e.map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(f),a.DefaultValue=d,b.editMode?$(l).trigger("default-value",[!0,d,0]):k({Id:b.chartProp.info.variableId||-1,Values:d})};if(select='<div class="container-fluid temporal" style="margin: 15px 0px 10px;"><div class="row"><a  class=" btn btn-primary pointer filter-member btn-block"> '+(b.chartProp.info.label||"انتخاب")+' <span class="glyphicon glyphicon-list-alt"></span></a></div><div class="row selected-item col-sm-12"></div></div>',$(l).append(select),$(l+" .filter-member").on("click",function(){app.helper.filterMemberDialog(f,h)}),null!=a.DefaultValue&&a.DefaultValue.length>0){f.filter(function(b){return-1!=a.DefaultValue.indexOf(b.Uniquename)}).forEach(function(a,b){a.IsChecked=!0});var i='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+f.filter(function(a){return a.IsChecked}).map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a.Caption+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(i)}else if(b.chartProp.info.variableDefault&&b.chartProp.info.variableDefault.values){var j=b.chartProp.info.variableDefault.values;f.filter(function(a){return-1!=j.indexOf(a.Uniquename)}).forEach(function(a,b){a.IsChecked=!0});var i='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+f.filter(function(a){return a.IsChecked}).map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a.Caption+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(i)}if(b.editMode){$(l).find("select");$(l).trigger("default-value",[!1,[f[0].UniqueName],0])}
c&&h(f)}function h(c){function d(a){return jd_to_persian(gregorian_to_jd(a[0],a[1]+1,a[2]))}function e(a,b){var c="000000000"+a;return c.substr(c.length-b)}function f(a,c,d,e,f){if((!c||d&&e)&&(c||d)&&(b.editMode||!(c&&h==d&&i==e||!c&&h==d))){h=d,i=e;var g=c?[d,e]:[d,b.chartProp.info.dateOp];if(b.input.DefaultValue=g,!b.editMode&&f){var j={Id:b.chartProp.info.variableId||-1,Values:g,VariableType:c?2:4};k(j)}else{$(l).find("select");$(l).trigger("default-value",[!0,g,c?2:4])}$(l).data("user-value",g)}}var g='<div class="ui form temporal"><div class=" field"><div class="ui input">                        <input type="text" id=""  class="form-control from" placeholder="تاریخ" /><input id="from-value" type="hidden"/>                      </div></div></div>';c&&(g='<div class="ui grid temporal form-content" ><div class="row">                        <div class="five wide column ui input">                            <input id="" type="text" class="datepicker form-control from" placeholder="تاریخ شروع" />                            <input id="from-value" type="hidden"/>                        </div>                        <div class="two wide column">تا</div>                        <div class="five wide column ui input">                            <input id="" type="text" class="datepicker form-control to" placeholder="تاریخ پایان"/>                            <input id="to-value" type="hidden"/>                        </div>                      </div></div>'),g=$(g),$(l).append(g),c?(g.find(".from").datepicker({defaultDate:"+1w",changeYear:!0,changeMonth:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#from-value"),onClose:function(a){a&&(g.find(".to").datepicker("option","minDate",a),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!0))}}),g.find(".to").datepicker({defaultDate:"+1w",changeYear:!0,changeMonth:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#to-value"),onClose:function(a){a&&(g.find(".from").datepicker("option","maxDate",a),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!0))}})):g.find(" .from").datepicker({changeMonth:!0,changeYear:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#from-value"),onClose:function(a){a&&f(g,c,g.find("#from-value").val(),null,!0)}});var h,i,j=!1;if("undefined"==typeof a.DefaultValue||!a.DefaultValue){var m=new Date,n=d([m.getFullYear(),m.getMonth(),m.getDate()]),o=n[0]+"/"+e(n[1],2)+"/"+e(n[2],2);g.find(".from").datepicker("option","dateFormat","yy/mm/dd"),g.find(".from").datepicker("setDate",o),g.find(".from").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue),o=g.find(".from").val(),a.DefaultValue=[o,o],j=!0}var p=[];a.GloablFilterDefaultValue?p=a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&-1!=b.chartProp.info.variableId&&(p=a.DefaultValue),p=p.map(function(a){return a.replace(/\[[^\]]+\]/,"")}),g.find(".from").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue+""),g.find(".to").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue+""),h=j?"":p[0],g.find(".from").datepicker("setDate",p[0]),c&&(g.find(".to").datepicker("setDate",p[1]),i=j?"":p[1]),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!1)}function i(c){function d(a,c){if(a||c.push(b.chartProp.info.sliderRange),b.input.DefaultValue=c,b.editMode)$(l).trigger("default-value",[!0,c,1]);else{var d={Id:b.chartProp.info.variableId||-1,Values:c,VariableType:1};$(l).data("user-value",c),k(d)}}var e=a.fields.map(function(a){return a.Value}),f=(a.fields.map(function(a){return a.Key}),""!=b.chartProp.info.sliderMax&&"undefined"!=typeof b.chartProp.info.sliderMax?+b.chartProp.info.sliderMax:d3.max(e,function(a){return+a.replace(/\[[^\]]+\]/,"")})||100),g=""!=b.chartProp.info.sliderMin&&"undefined"!=typeof b.chartProp.info.sliderMin?+b.chartProp.info.sliderMin:d3.min(e,function(a){return+a.replace(/\[[^\]]+\]/,"")})||0,h='<div class="temporal" style="padding-left: 15px; padding-right: 15px; padding-top:5px">                        <div class="slider"></div>                        <div class="slider-value ltr" style="margin-top:5px"> </div>                        <input id="from-value" type="hidden"/>                      </div>';h=$(h),$(l).append(h);var i="min-max"==b.chartProp.info.sliderRange,j=function(a){var c=b.chartProp.info.sliderFormat||",.2f";return Array.isArray(a)?'<div class="inline">'+persian(d3.format(c)(a[0]),n)+'</div> <div class="inline"> تا </div> <div class="inline">'+persian(d3.format(c)(a[1]),n)+"</div>":persian(d3.format(c)(a),n)};h.find(".slider").slider({range:i?!0:b.chartProp.info.sliderRange,min:g,max:f,slide:function(a,b){h.find(".slider-value").html(j(i?b.values:b.value))},stop:function(a,b){d(i,i?b.values:[b.value])}}),h.find(".slider .ui-slider-range").css("background-color","#ddd"),h.find(".slider.ui-widget-content").css("box-shadow","none"),h.find(".slider .ui-slider-handle").css("background-color","#337ab7");var m=[];m=a.GloablFilterDefaultValue?a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&-1!=b.chartProp.info.variableId?a.DefaultValue:[g,f],m=m.map(function(a){return+a.toString().replace(/\[[^\]]+\]/,"")||0}),1==m.length&&m.splice(0,0,0),m[1]<m[0]&&(m[1]=m[0]),h.find(".slider-value").html(j(i?m:m[0])),i?h.find(".slider").slider("values",m):h.find(".slider").slider("value",m[0]),$(l).data("user-value",m)}function j(c){function d(){p||(clearTimeout(o),o=setTimeout(function(){var a=$(l+" .ui.dropdown").dropdown("get value");_.isArray(a)||(a=[a]),a=_.filter(a,null),m(a)},200))}var e=b.chartProp.info.comboStyle;(app.mobile||b.editMode)&&(e="default");var f=a.fields.map(function(a){return a.Value.entitize()}),g=a.fields.map(function(a){return a.Key.entitize()});g.length!=f.length&&$("#"+b.id).append(app.chartCommons.getError(a));var h='<select class="temporal ui fluid '+(c?"multiple":"")+' search selection dropdown" '+(c?"multiple":"")+" >";h+='  <option value="">'+b.chartProp.info.label+"</option>";for(var i=0;i<g.length;i++)h+='  <option value="'+f[i]+'">'+g[i]+"</option>";h+="</select>",$(l).append(h);var j=$(l).find("select");j.on("change",function(){app.lang.setLang({selector:l})});var m=null;m=b.editMode?function(b){a.DefaultValue=b,$(l).trigger("default-value",[!0,a.DefaultValue,0])}:function(c){return!b.chartProp.info.disableClear||c&&c.length?(a.DefaultValue=c,void k({Id:b.chartProp.info.variableId||-1,Values:a.DefaultValue,VariableType:0,disableClear:b.chartProp.info.disableClear})):void $(l+" .ui.dropdown").dropdown("set selected",a.DefaultValue)};var n=[];a.GloablFilterDefaultValue&&-1==b.chartProp.info.variableId?n=a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&(n=a.DefaultValue),a.DefaultValue=n;var o,p=!0;$(l+" .ui.dropdown").dropdown({onChange:function(a,b,e){c||d()},onRemove:function(a,b,c){d()},onAdd:function(a,b,c){d()},apiSettings:{url:app.urlPrefix+"api/chartdata/GetColumnMembers",cache:!1,method:"post",beforeSend:function(a){var c=_.filter(app.chartCommons.drillDown.filters,function(a){if(!b.input||!b.input.RefreshDatasource)return!1;var c=-1!=b.input.RefreshDatasource.indexOf(a.datasourceId);return c&&a.chartInPageId!=b.ChartInPageId}),d=$.extend([],_.filter(app.chartCommons.userFilter.filters,function(a){if(!b.input||!b.input.RefreshDatasource)return!1;var c=-1!=b.input.RefreshDatasource.indexOf(a.datasourceId);return c}));_.remove(d,{chartInPageId:b.ChartInPageId});var e=JSON.parse(localStorage.getItem("userVariable"))||[];return a.data={chartId:b.chartId,userVariable:e,userControlFilter:d,otherFilters:c,query:a.urlData.query,chartInfo:$("#divChart").data("chartInfo")},a},onResponse:function(a){a.fields=a.fields.map(function(a){return{Key:a.Key.entitize(),Value:a.Value.entitize()}});var b=$(l+" .ui.dropdown").dropdown("get value");return b||(b=[]),_.isArray(b)||(b=[b]),a.fields=a.fields.filter(function(a){return-1==b.indexOf(a.Value)}),a},dataType:"json"},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"Key",value:"Value"},saveRemoteData:!1,forceSelection:!1}),$(l+" .ui.dropdown").dropdown("set selected",n),p=!1}function k(c){if(b.editMode||o||app.chartCommons.userFilter.setFilter({id:c.Id,values:c.Values,variableType:c.VariableType,dimensionName:a.dimensionName,chartInPageId:b.ChartInPageId,datasourceId:a.DataSourceId,disableClear:c.disableClear}),-1==+c.Id)return app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),void app.filterBox.refresh();c.dimensionName=a.dimensionName,c.datasourceId=a.DataSourceId,c.chartId=a.chartId;var d=app.mobileMode?proxy.ajax:$.ajax,e=app.mobileMode?c:JSON.stringify(c);console.log("### user control ajaxCall init *****************"),d({type:"POST",url:app.urlPrefix+"api/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:e,success:function(a){console.log("### user control ajaxCall *****************"),a.result?"undefined"!=typeof b.chartProp.info.variableId&&-1!=b.chartProp.info.variableId?$(".bar-chart").each(function(){var a=$(this).data("settings");"undefined"!=typeof a.input.GlobalVariables&&-1!=a.input.GlobalVariables.indexOf(b.chartProp.info.variableId)&&(a.titlebar.showProgress(!0),$(this).charts(a.type,"refreshWithData",a,{refreshRelatedDatasources:!1}))}):app.mobileMode?app.mobile.filterChanged(a.RefreshDatasource,[+b.ChartInPageId]):(app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),app.filterBox.refresh()):alert(a.Message)},error:function(a){app.mobileMode&&app.mobile.showToastMessage(a)}})}app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var l="#"+b.id,m=$(l).width();b.width=m;var n="undefined"==typeof a.lang?!0:0==+a.lang;d.isProgress,d.showProgress,d.title;if(!a.result&&"datepicker"!=b.chartProp.info.type&&"datepicker-range"!=b.chartProp.info.type)return void $("#"+b.id).append(app.chartCommons.getError(a));var o=-1!=b.chartProp.info.variableId;switch(f(),b.chartProp.info.type){case"combo":j();break;case"multi":j(!0);break;case"datepicker":h(!1);break;case"datepicker-range":h(!0);break;case"multi-filter":g();break;case"slider":i();break;case"text":e()}$(l).trigger("heightChange")};
//# sourceMappingURL=charts-theme2.js.map
// داشبورد مدیریتی صدف info@sadafdashboard.ir

var manageApp=angular.module("services",["ngMaterial","ngAnimate","ui.sortable","uibCollapseCat"]),ngApp=angular.module("services");ngApp.service("datasources",["$http","$mdMedia","$mdDialog",function(a,b,c){function d(){return h||(h=a.get(app.urlPrefix+"api/menus/get")),h}function e(){j={name:"همه",open:!0},k={name:"همه",open:!0}}function f(d,e){var f={type:["charts"],search:["content"],selectableDir:!1,justDir:!1,multipleChart:!0,multipleDatasource:!1};return e=angular.extend({},f,e),c.show({controller:["$scope","$mdDialog","$timeout",function(b,c,d){function f(c){return c?(b.searchProgressChart=!0,a.get(app.urlPrefix+"api/charts/getlist?q="+c).then(function(a){b.searchProgressChart=!1,n&&o?b.searchResultChart=a.data.list:n?b.searchResultChart=_.filter(a.data.list,{type:2}):b.searchResultChart=_.filter(a.data.list,{type:1})}),b.searchProgressDatasource=!0,void a.get(app.urlPrefix+"api/datasources/get?q="+c).then(function(a){b.searchProgressDatasource=!1,n&&o?b.searchResultDatasource=a.data.list:n?b.searchResultDatasource=_.filter(a.data.list,{type:2}):searchResultDatasource=_.filter(a.data.list,{type:1})})):(b.searchResultDatasource=null,void(b.searchResultChart=null))}function g(a,b){b(a),a.nodes&&(_.forEach(a.nodes,function(a){g(a,b)}),_.forEach(a.contents,function(a){g(a,b)}))}b.showCharts=-1!=e.type.indexOf("charts"),b.showDatasources=-1!=e.type.indexOf("datasources"),b.cancel=function(){c.cancel()},b.select=function(){var a,d;b.showCharts&&b.showDatasources?(a=0==b.selectedIndex?b.datasources:b.charts,d=0==b.selectedIndex?"datasources":"charts"):b.showDatasources?(a=b.datasources,d="datasources"):(a=b.charts,d="charts");var e=[];b.searchResultDatasource?(e=_.filter("charts"==d?b.searchResultChart:b.searchResultDatasource,{check:!0}),i.charts=e):(g(a,function(a){a.active&&e.push(a)}),i.charts=e),c.hide({selected:e,type:d})};var h=function(b){if(!b.nodes){var c=app.urlPrefix+"api/charts/getlist?packageId="+b.id;a.get(c).then(function(a){b.loaded=!0,b.nodes=_.filter(a.data.list,{type:1}),b.contents=_.filter(a.data.list,{type:2})})}},l=function(b){if(!b.nodes){var c=app.urlPrefix+"api/datasources/get?packageId="+b.id;a.get(c).then(function(a){b.loaded=!0,b.nodes=_.filter(a.data.list,{type:1}),b.contents=_.filter(a.data.list,{type:2})})}};b.optDatasource={urlPrefix:app.urlPrefix+"api/datasources/get?packageId=",multiple:e.multipleDatasource,selectableDir:e.selectableDir,url:l,justDir:e.justDir},b.optChart={urlPrefix:app.urlPrefix+"api/charts/getlist?packageId=",multiple:e.multipleChart,selectableDir:e.selectableDir,url:h,justDir:e.justDir},b.datasources=j,b.charts=k,g(b.datasources,function(a){a.active=!1}),g(b.charts,function(a){a.active=!1}),h(b.charts),l(b.datasources);var m;b.$watch("query",function(a,b){d.cancel(m),m=d(function(){f(a)},400)});var n=-1!=e.search.indexOf("content"),o=-1!=e.search.indexOf("dir")}],parent:angular.element(document.body),targetEvent:d,clickOutsideToClose:!0,fullscreen:b("sm")||b("xs"),template:'<md-dialog aria-label="{{\'choose\' | translate}}" >                                                                                                                                 <md-toolbar md-theme="default">                                                                                                                                                                              <div class ="md-toolbar-tools">                                                                                                                                                           <h2>{{\'choose\' | translate}}</h2>                                                                                                                                                   <span flex></span>                                                                                                                                                                    <input class ="toolbar-input" ng-model="query" placeholder="{{\'جستجو\' | translate}}" md-autofocus />                                                                                             <span class ="material-icons small" ng-click="query=null" ng-show="query" title="{{\'clear\' | translate}}">close</span>                                                              <span class ="material-icons">search</span>                                                                                                                                       </div>                                                                                                                                                                            </md-toolbar>                                                                                                                                                                         <md-dialog-content>                                                                                                                                                                       <div class ="xmd-dialog-content" flex>                                                                                                                                                    <md-tabs md-border-bottom md-dynamic-height md-selected="selectedIndex" >                                                                                                                 <md-tab label="{{ \'datasources\' | translate }}" ng-if="showDatasources">                                                                                                                                         <div layout="row" layout-align="center center" ng-show="searchProgressDatasource"style="padding:0 18px; font-size:0.8em">                                                                 <md-progress-circular  md-mode=\'indeterminate\' md-diameter="20" ></md-progress-circular>                                                                                              {{\'searching\' | translate}}                                                                                                                                                   </div>                                                                                                                                                                                <div class ="md-caption" layout-padding ng-show="searchResultDatasource && !searchResultDatasource.length">{{\'search_no_result\' | translate}}</div>                                 <tree ng-show="!searchResultDatasource" ng-model="datasources" option="optDatasource" class ="block"></tree>                                                                          <div ng-show="searchResultDatasource" layout-margin >                                                                                                                                     <div ng-repeat="i in searchResultDatasource">                                                                                                                                             <md-checkbox ng-model="i.check">{{i.name}}</md-checkbox>                                                                                                                          </div>                                                                                                                                                                            </div>                                                                                                                                                                                                                                                                                                                                                                  </md-tab>                                                                                                                                                                                                                                                                                                                                                                   <md-tab label="{{ \'charts\' | translate }}" ng-if="showCharts">                                                                                                                                                <div layout="row" layout-align="center center" ng-show="searchProgressChart"style="padding:0 18px; font-size:0.8em">                                                                      <md-progress-circular  md-mode=\'indeterminate\' md-diameter="20" ></md-progress-circular>                                                                                             {{\'searching\' | translate}}                                                                                                                                                    </div>                                                                                                                                                                                <div class ="md-caption" layout-padding ng-show="searchResultChart && !searchResultChart.length">{{\'search_no_result\' | translate}}</div>                                           <tree ng-show="!searchResultChart" ng-model="charts" option="optChart" class ="block"></tree>                                                                                         <div ng-show="searchResultChart" layout-margin >                                                                                                                                          <div ng-repeat="i in searchResultChart">                                                                                                                                                  <md-checkbox ng-model="i.check">{{i.name}}</md-checkbox>                                                                                                                          </div>                                                                                                                                                                            </div>                                                                                                                                                                            </md-tab>                                                                                                                                                                         </md-tabs>                                                                                                                                                                        </div>                                                                                                                                                                            </md-dialog-content>                                                                                                                                                                  <md-dialog-actions layout="row">                                                                                                                                                          <md-button ng-click="select()">                                                                                                                                                           {{\'choose\' | translate}}                                                                                                                                                        </md-button>                                                                                                                                                                          <md-button ng-click="cancel()">                                                                                                                                                           {{\'cancel\' | translate}}                                                                                                                                                        </md-button>                                                                                                                                                                      </md-dialog-actions>                                                                                                                                                          </md-dialog>'})}function g(b){var c=app.urlPrefix+"Moderation/OlapChartDesign/CubeInformation?DataSourceId="+b;return a.get(c).then(function(a){return a.data})}var h,i={},j={name:"همه",open:!0},k={name:"همه",open:!0};return{get:d,select:f,lastSelected:i,reset:e,getColumns:g}}]),ngApp.service("chartComments",["$http",function(a){function b(b,c){return a.post(app.urlPrefix+"api/ChartComments/save/"+b,c).then(function(a){return a.data})}return{save:b}}]);
//# sourceMappingURL=services.js.map
// داشبورد مدیریتی صدف info@sadafdashboard.ir

var cal=angular.module("calendar",[]);cal.directive("sadafCalendar",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel"},template:'<div><input type="text" id=""  class="form-control from" placeholder="تاریخ" /><input id="from-value" type="hidden"/></div>',link:function(a,b,c){b.find(" .from").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy/mm/dd",altFormat:"yy/mm/dd",altField:b.find("#from-value"),onClose:function(b){a.model=b,a.$apply()}}),a.$watch("model",function(c){null==c&&b.find(".from").datepicker("setDate",a.model)}),b.find(".from").datepicker("setDate",a.model)}}});var ngApp=angular.module("sadafForms",["ng-sortable","services","calendar","semantic-ui","ngRoute","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/forms/list",{templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-list.html?v="+app.version,controller:"fromsCtrl",controllerAs:"c"}).when("/forms/:id?",{templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-editor.html?v="+app.version,controller:"fromGeneratorCtrl",controllerAs:"c"}).otherwise({redirectTo:"datasources"})}]);var ngApp=angular.module("sadafForms");ngApp.directive("sadafForm",function(){return{scope:{id:"@",rowId:"@?",onCancel:"&?",onFinish:"&?"},controller:["$scope","$http","$sce","$routeParams","$timeout","$q","formsService","formsSubmitService","$attrs",function($scope,$http,$sce,$routeParams,$timeout,$q,formsService,formsSubmitService,$attrs){function getFormData(){c.clearForm(),c.rowId&&0!=+c.id&&(c.formLoading=!0,formsSubmitService.get(c.id,c.rowId).then(function(a){function b(a,c){_.each(a,function(a){c(a),13==a.type&&_.each(a.multiRowForm.rows,function(a){b(a,c)})})}c.formLoading=!1,_.each(a.model.pages,function(a){b(a.controls,function(a){12==a.type,2==a.type&&(a.value=+a.value)})}),c.data=a.model,c.editPermission=a.editPermission,c.deletePermission=a.deletePermission,c.allControl=[],runOnAllControll(c.data,function(a){c.allControl.push(a)})},function(){c.formLoading=!1}))}function getFormEmptyData(){c.clearForm(),c.formLoading=!0,formsService.get(c.id).then(function(a){c.formLoading=!1,c.data=a.model,c.editPermission=a.editPermission,c.deletePermission=a.deletePermission,c.allControl=[],runOnAllControll(c.data,function(a){c.allControl.push(a)})},function(){c.formLoading=!1})}function clearIfFilterHasControl(a,b){if(b.useFilter&&b.filters&&b.filters.length){var c=_.some(b.filters,{control:a,type:2});c&&(b.value=null)}}function findControl(a,b){var c=null;return runOnAllControll(b,function(b){return b.name===a?(c=b,!1):void 0}),c}function runOnAllControll(a,b,c){if(a){var d=[];_.each(a.pages,function(a){c&&c(a),a&&_.isArray(a.controls)&&(d=d.concat(a.controls))}),_.each(d,function(a){13==a.type&&_.each(a.multiRowForm.rows,function(a){_.each(a,function(c){var d=b(c,a);return d===!1?!1:void 0})});var c=b(a,d);return c===!1?!1:void 0})}}function GetMultiRowControlBaseOnChildName(a){var b;return runOnAllControll(c.data,function(c){if(13==c.type){var d=_.findIndex(c.multiRowForm.rows[0],{name:a});-1!=d&&(b={control:c,index:d})}}),b}function calcFlatFormula(f,rowControls){var params=[],r=f.replace(/\[(field-\d+)\]/gi,function(a,b,c){var d=_.find(rowControls,{name:b});if(8==d.type){var e="00:00";d.value&&(e=d.value.substring(0,5)),params.push({type:"millisecond",value:moment.duration(e).asMilliseconds()})}if(9==d.type){var e="1300/0/01";d.value&&(e=d.value),params.push({type:"millisecond",value:1e3*moment(e,"jYYYY/jMM/jDD").utc().unix()})}return(2==d.type||5==d.type&&"digit"==d.calcType||16==d.type&&"digit"==d.calcType)&&params.push({type:"digit",value:+d.value||0}),(5==d.type&&"millisecond"==d.calcType||16==d.type&&"millisecond"==d.calcType)&&params.push({type:"millisecond",value:d.calculate.calculatedValue}),"{"+(params.length-1)+"}"}),newR=r.replace(/\{(\d+)\}/gi,function(a,b,c){return params[+b].value}),haveDate=_.filter(params,function(a){return"millisecond"==a.type||"millisecond"==a.type||"millisecond"==a.type}).length>0,haveDigit=_.some(params,{type:"digit"});if(haveDate){var v=moment.duration(+eval(newR)).format("d روز و h ساعت و m دقیقه");return{value:v,calculatedValue:+eval(newR),type:"millisecond"}}var v=+eval(newR);return{value:v,calculatedValue:+eval(newR),type:"digit"}}function updateCalculated(newVal,oldVal){var filteredBaseOnField=[];runOnAllControll(c.data,function(a){a.useFilter&&_.each(a.filters,function(b){2==b.type&&b.control&&filteredBaseOnField.push({name:a.name,source:a,filter:b.control})})}),runOnAllControll(c.data,function(control,rowControls){if(5==control.type){var o=calcFlatFormula(control.calculate.expression,rowControls);control.value=o.value,control.formula=o.formula,control.calcType=o.type,control.calculate.calculatedValue=o.calculatedValue}if(16==control.type){var regex=/\s*(sum|avg|var)\s*\(([^\)]+)\)\s*/gi,hasDurationFormat=!1,r=control.calculate.expression.replace(regex,function(a,b,c){var d=[],e=c.replace(/.*\[(field-\d+)\].*/gi,"$1"),f=GetMultiRowControlBaseOnChildName(e);if(!f)return"از فیلدهای مربوط به فرم چند ردیفه باید استفاده شود";_.each(f.control.multiRowForm.rows,function(a){var b=calcFlatFormula(c,a);"digit"!=b.type?(hasDurationFormat=!0,d.push(b.calculatedValue||0)):d.push(b.value||0)});var g=0;return"sum"===b&&(g=d3.sum(d)),"avg"===b&&(g=d3.mean(d)),"var"===b&&(g=d3.variance(d))," "+g+" "});if(hasDurationFormat){var v=moment.duration(+eval(r)).format("d روز و h ساعت و m دقیقه");control.value=v,control.calculate.calculatedValue=+eval(r),control.calcType="millisecond"}else try{control.value=+eval(r).toFixed(5),control.calculate.calculatedValue=+eval(r)}catch(e){control.value=r}}if(control.useFilter&&control.filters&&control.filters.length){var controlValue=null;_.map(control.filters,function(a){if(2==a.type){var b=_.find(rowControls,{name:a.control});a.controlValue=b.value}})}})}var c=this,id=c.id;c.submittedStatus=0,c.isValid=function(){var a=!1;if(c.data&&c.data.pages)a:for(var b=0;b<c.data.pages.length;b++)for(var d=0;d<c.data.pages[b].controls.length;d++){var e=c.data.pages[b].controls[d];if(12==e.type&&!e.isValid){a=!0;break a}}return a},c.submit=function(){c.loading=!0,c.clearAllErrors(),formsSubmitService.submit(c.id,c.data).then(function(a){c.loading=!1,c.submittedStatus=1,!a.result&&a.messages&&(c.pagesContainError=c.pagesContainError||[],c.submittedStatus=0,_.each(c.data.pages,function(b){_.each(a.messages,function(a){var d=_.find(b.controls,{name:a.name});d&&(d.error=a.error,-1==_.findIndex(c.pagesContainError,b)&&c.pagesContainError.push(b))})})),!a.result&&a.pageMessages&&(c.submittedStatus=0,_.each(a.pageMessages,function(a){var b=_.find(c.data.pages,{name:a.name});b&&(b.error=a.error)})),a.result&&(c.onFinish&&c.onFinish(),c.clearForm())},function(a){a.data.title&&a.data.desc?c.error={title:a.data.title,desc:a.data.desc}:c.error=null,c.loading=!1,c.submittedStatus=2})},c.clearAllErrors=function(){c.pagesContainError=[],runOnAllControll(c.data,function(a){a.error=null},function(a){a.error=null})},c.clearForm=function(){c.submittedStatus=0,c.activePage=0,runOnAllControll(c.data,function(a){a.value=null,a.dropdown&&(a.dropdown.listValue=null),13==a.type&&a.multiRowForm.rows.splice(0,a.multiRowForm.rows.length-1)})};var timer,observe=function(a){$timeout.cancel(timer),timer=$timeout(function(){0!=+c.id&&(c.allControl=null,c.rowId?getFormData():getFormEmptyData())},100)};$attrs.$observe("rowId",observe),$attrs.$observe("id",observe),c.cancel=function(){c.onCancel()},c.remove=function(){var a=confirm("آیا برای حذف اطلاعات جاری فرم اطمینان دارید؟");a&&formsSubmitService.remove(c.id,c.rowId).then(function(){c.onCancel()},function(a){a.data.title&&a.data.desc&&alert(a.data.desc)})},$scope.$watch(angular.bind(this,function(){return this.allControl}),function(a,b){a&&b&&_.each(a,function(a){var d=_.find(b,{name:a.name});a.value!=d.value&&12==a.type&&_.each(c.allControl,function(b){a.name!=b.name&&clearIfFilterHasControl(a.name,b)})})},!0),$scope.$watch(angular.bind(this,function(){return this.data}),function(a,b){updateCalculated(a,b)},!0)}],restrict:"AE",controllerAs:"c",bindToController:!0,templateUrl:app.urlPrefix+"dist/partial/forms/form-render.html?v="+app.version}}),ngApp.service("formsSubmitService",["$http","updateModel",function(a,b){var c=function(c,d){return a.get(app.urlPrefix+"api/formsSubmit/getData/"+c+"?rowId="+d).then(function(a){var c=a.data;return b.updateValuesForGet(c.model.pages),c})},d=function(c,d){return b.updateValuesForSave(d.pages),a.post(app.urlPrefix+"api/formssubmit/submit/"+c,d).then(function(a){return app.moderation.dashboadpage.refreshRelatedDatasources(a.data.RefreshDatasource),a.data})},e=function(b,c){return a.post(app.urlPrefix+"api/formssubmit/delete/"+b,c).then(function(a){return app.moderation.dashboadpage.refreshRelatedDatasources(a.data.RefreshDatasource),a.data})};return{submit:d,remove:e,get:c}}]),ngApp.directive("selectForm",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{onSelect:"&",settings:"=?"},controller:["$scope","$http","formsService",function(a,b,c){a.model=a.model||[],a.settings=a.settings||{},c.get().then(function(b){a.forms=b}),a.opt={closable:!1,onApprove:function(){return a.model&&a.model.length?(a.onSelect({forms:a.model,settings:a.settings}),!1):(alert("حداقل یک مورد باید انتخاب شود"),!1)}}}],template:'<div>                   <sm-modal visible="settings.visible" settings="opt">                        <div class="header">انتخاب فرم</div>                        <div class="content">                            <p>لطفا فرم‌های مورد نظر خود را انتخاب کنید</p>                            <div class="ui form">                                <div class="field">                                    <label>انتخاب فرم</label>                                    <sm-dropdown class="selection search multiple"  settings="{fullTextSearch: true}" model="model" items="forms" label="item.name" value="item" ></sm-dropdown>                                </div>                            </div>                        </div>                        <div class="actions">                            <div class="ui black deny button">لغو</div>                            <div class="ui positive button" ng-class="{loading: settings.loaging}" >اضافه کردن</div>                        </div>                    </sm-modal>                    </div>',link:function(a,b,c){}}}),function(){function a(a,b){b.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}function b(a,b,c){var d=[];_.each(a,function(a){c&&c(a),a&&_.isArray(a.controls)&&(d=d.concat(a.controls))}),_.each(d,function(a){13==a.type&&a.multiRowForm&&_.each(a.multiRowForm.rows,function(a){_.each(a,function(c){b(c,a)})}),b(a,d)})}var c=angular.module("sadafForms");c.controller("fromGeneratorCtrl",["$scope","$http","$sce","$timeout","$mdToast","$routeParams","formsService","controlPropertyService",function(c,d,e,f,g,h,i,j){c.saveProgress=!1;var k=this;k.id=h.id||0;var l=k.id>0;k.app=app,k.items=[{columnClass:"three",key:"متن کوتاه",label:"نام",icon:"text cursor",type:0,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"متن بلند",label:"متن بلند",icon:"text cursor",type:1,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"عدد",label:"عدد",icon:"hashtag",type:2,showUniqueProp:!0,"default":!0,require:!0,format:"#,#",accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"برچسب",label:"برچسب",icon:"font",type:3,showUniqueProp:!1,"default":!1,require:!1,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"چند گزینه",icon:"caret down",label:"چند گزینه",type:4,showUniqueProp:!0,"default":!0,require:!0,dropdown:{useRemoteData:!1},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"چند گزینه ریموت",icon:"caret down",label:"چند گزینه ریموت",type:4,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,dropdown:{useRemoteData:!0},accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"تایید",icon:"checkmark box",type:6,label:"انتخاب مقدار",showUniqueProp:!1,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"زمان",icon:"wait",label:"زمان",type:8,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"تاریخ",label:"تاریخ",icon:"calendar",type:9,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"ارجاع به فرم",label:"ارجاع به فرم",icon:"pointing right",type:12,formLookup:{form:-1,keyControls:[]},showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"twelve",key:"گروه تکرار شونده",label:"لیست",icon:"table",type:13,showUniqueProp:!1,"default":!1,require:!1,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],multiRowForm:{addKeyText:"ردیف جدید",rows:[[]],controlSize:"mini"}},{columnClass:"three",key:"کلید",label:"کلید",icon:"square",type:15,showUniqueProp:!1,"default":!1,require:!1,button:{type:1,openLinkType:0,colorClass:"black",size:"tiny"},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"محاسباتی",icon:"calculator",label:"فیلد محاسباتی",type:5,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",calculate:{expression:""},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"three",key:"محاسباتی - جمع",label:"محاسباتی - جمع",icon:"calculator",type:16,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",calculate:{expression:"",func:"sum"},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]}],k.controlProperty=function(a){return a?_.find(k.items,{type:a.type}):{showUniqueProp:!1,"default":!1,require:!1}},k.sortableOptions={"ui-floating":!0},k.compConf={sort:!1,group:{name:"form",pull:"clone",put:!1},animation:150,onEnd:function(a){a.model.name=k.pages.naming.getName(),a.model.canView=!0,a.model.canEdit=!0}},k.drags=k.items.map(function(a){return[a]});var m=!1;k.draggableOptions={connectWith:".drop-target",placeholder:"form-control-highlight",helper:"clone",stop:function(a,b){if(b.item.sortable.source.hasClass("draggable-element")&&b.item.sortable.droptarget&&b.item.sortable.droptarget!=b.item.sortable.source&&b.item.sortable.droptarget.hasClass("drop-target")){var c=b.item.sortable.droptargetModel[b.item.sortable.dropindex];c.name=k.pages.naming.getName(),c.columnClass=c.columnClass||"twelve",c.formLookup=_.extend({},b.item.sortable.model.formLookup),c.dropdown=_.extend({},b.item.sortable.model.dropdown),c.canView=!0,c.canEdit=!0;var d=JSON.parse(JSON.stringify(b.item.sortable.model));b.item.sortable.sourceModel.push(d)}}},k.control=j.get(),k.formLookupSourceFields=[],console.log("niit c.formLookupSourceFields",k.formLookupSourceFields),c.$watch("c.control.active.formLookup",function(a){a&&a.form&&i.get(a.form).then(function(a){for(;k.formLookupSourceFields.length;)k.formLookupSourceFields.splice(0,k.formLookupSourceFields.length);_.each(a.model.pages,function(a){_.each(a.controls,function(a){k.formLookupSourceFields.push(a)})}),console.log("change c.formLookupSourceFields",k.formLookupSourceFields)})}),k.pages={data:[],add:function(a){var b={name:"صفحه "+(k.pages.data.length+1),type:0,controls:[],rowValidation:{uniqueMultiField:!1,uniques:[]},size:"tiny"};k.pages.data.push(b),k.pages.setActive(b)},removeControl:function(a,b){var c=confirm("در صورت پاک کردن این کنترل تمامی داده‌هایی که قبلا در فرم برای این کنترل ذخیره شده است نیز پاک خواهد شد. آیا برای حذف این کنترل اطمینان دارید؟");c&&(m=!0,k.pages.activePage.controls.splice(a,1))},copy:function(a,b){m=!0;var c=_.extend({},b);k.pages.activePage.controls.splice(a,0,c)},remove:function(a){if(k.pages){var b=!0;if(k.pages.data[a].controls.length&&(b=confirm(" در صورت پاک کردن صفحه تمام کنترل‌های موجود در آن به همراه داده‌هایی که قبلا در فرم ذخیره شده است پاک خواهد شد. آیا برای حذف این صفحه اطمینان دارید؟")),b){k.pages.data[a].controls.length&&(m=!0);var c=k.pages.data.splice(a,1);c[0]===k.pages.activePage&&k.pages.setActive()}}},setActive:function(a){_.each(k.pages.data,function(a){a.active=!1}),!a&&k.pages.data.length&&(a=k.pages.data[0]),k.pages.activePage=a,k.pages.activePage.active=!0,k.control.active&&(k.control.active.isActive=!1,k.control.active=null)},getControlForRowValidation:function(){var a=k.pages.activePage.controls;return a},naming:{getName:function(){return"field-"+k.pages.naming.getMaxId()},exist:function(a){if("_id"==a)return!0;var b=!1;return _.each(k.pages.data,function(c){_.each(c.controls,function(c){var d=c.name||"";return d==a?(b=!0,!1):void 0})}),b},getMaxId:function(){return k.maxFieldNumber=+k.maxFieldNumber||0,k.maxFieldNumber++,k.maxFieldNumber}}},k.controlList=[],c.$watch("c.pages",function(){k.controlList=[],b(k.pages.data,function(a){13!=a.type&&k.controlList.push(a)})},!0),k.saveProgress=!1,k.save=function(){var b=!1;b=m?confirm("در صورت ذخیره به دلیل اینکه تغییراتی در فرم ایجاد شده است در صورت حذف یک کنترل داده‌های مربوط به آن نیز حذف می‌شود. آیا برای ذخیره اطمینان دارید؟‌"):!0,b&&(m=!1,k.saveProgress=!0,i.save(k.id,{pages:k.pages.data,name:k.name,maxFieldNumber:k.maxFieldNumber}).then(function(a){k.saveProgress=!1,k.id=a,location.replace(app.hashUrlPrefix+"#/forms/"+a);var b=g.simple().textContent("فرم شما با موفقیت ذخیره شد");g.show(b)},function(b){k.saveProgress=!1;var c="مشکلی در روند ذخیره‌سازی به وجود آمده است";b.data.desc&&(c=b.data.desc),a(c,g)}))},l||(k.name="فرم جدید",k.pages.add()),l&&i.get(k.id,!0).then(function(a){k.pages.data=a.model.pages,k.name=a.model.name,k.maxFieldNumber=a.model.maxFieldNumber,k.pages.setActive(),_.each(k.pages.data,function(a){_.each(a.controls,function(a){a.dropdown&&a.dropdown.items&&(a.dropdown.itemsTemp=a.dropdown.items.map(function(a){return a.label}).join("\n"))})})}),k.getSiblingControl=function(a){var c={};return b(k.pages.data,function(b,d){a===b.name&&(c.row=d,c.index=_.findIndex(d,{name:a}))}),c},c.$watch("c.control.active",function(a){a&&a.name&&(k.activeSibling=k.getSiblingControl(a.name))})}]),c.directive("formControl",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settingsClick:"&?",remove:"&?",id:"@",edit:"@",settings:"=?",copy:"&?"},controller:["$scope","$translate","$timeout",function(a,b,c){if(a.dropdownSettings={apiSettings:{url:app.urlPrefix+"api/forms/getdropdowndata",cache:!1,method:"get",dataType:"json",beforeSend:function(b){return b.data={id:a.id,name:a.model.name,query:b.urlData.query},a.edit&&(b.data={datasourceId:a.model.dropdown.remoteDatasource.value,remoteColumnKey:a.model.dropdown.remoteColumnKey,remoteColumnLabel:a.model.dropdown.remoteColumnLabel,query:b.urlData.query}),b},onResponse:function(a){return a.fields=a.fields.map(function(a){return{value:a.value.entitize(),label:a.label.entitize()}}),a}},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"label",value:"value"},saveRemoteData:!1,fullTextSearch:!0},a.onAdd=function(b){c(function(){a.model.dropdown.listValue=a.model.dropdown.listValue||[],-1==a.model.dropdown.listValue.indexOf(b)&&a.model.dropdown.listValue.push(b)},0)},a.onRemove=function(b){c(function(){a.model.dropdown.listValue=a.model.dropdown.listValue||[];var c=a.model.dropdown.listValue.indexOf(b);-1!=c&&a.model.dropdown.listValue.splice(c,1)},0)},a.change=function(b){c(function(){a.model.dropdown.multiSelectDropdown||(a.model.value=b)},0)},a.randomId=Math.floor(1e5*Math.random())+1,a.model.randomId=a.randomId,a.$watch("model.value",function(b){null==b&&$(".form-"+a.randomId+" .dropdown").dropdown("clear")}),a.simpleDropdownsettings={message:{noResults:app.lang.translate("No results found.")},fullTextSearch:!0,forceSelection:!1},a.$watch("model.dropdown.listValue",function(b){null==b&&$(".form-"+a.randomId+" .dropdown").dropdown("clear")}),a.model.dropdown&&a.model.dropdown.multiSelectDropdown&&a.model.dropdown.useRemoteData){try{a.model.dropdown.listValue=_.uniq(JSON.parse(a.model.value||"[]"))}catch(d){a.model.dropdown.listValue=[a.model.value]}a.model.value=null,a.model.items=a.model.dropdown.listValue}a.initDropdown=function(b){a.model.dropdown&&a.model.dropdown.multiSelectDropdown&&a.model.dropdown.useRemoteData&&c(function(){$(b).dropdown("set selected",a.model.dropdown.listValue)},100)},a.buttonClick=function(){if(!a.edit&&(1==a.model.button.type&&(a.model.button.showModal=!0),0==a.model.button.type)){if(!+a.model.button.dashboardId)return;var b=0==+a.model.button.openLinkType?"_blank":"_self";window.open(app.urlPrefix+"#/dashboard/"+a.model.button.dashboardId,b)}},a.getFilteredDropdonItems=function(b,c,d){if(!a.model.useFilter||!a.model.filters)return!1;var e=!1;return _.each(a.model.filters,function(a){return a&&a.staticValue&&b&&b.value?1==a.type?(e=-1!=a.staticValue.trim().indexOf(b.value.trim())||-1!=b.value.trim().indexOf(a.staticValue.trim()),!1):void 0:!1}),e}}],templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-control.directive.html?v="+app.version}}]),c.directive("multiRowForm",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settings:"=?",id:"@",edit:"@"},controller:["$scope","$http","formsService","controlPropertyService","$timeout",function(a,b,c,d,e){a.model=a.model||{},a.firstRow=a.model.multiRowForm.rows[0],a.$watch("firstRow",function(){_.each(a.firstRow,function(a){a.childOfMultiRow=!0})},!0),a.sortableOptions={placeholder:"form-control-highlight",handle:".drag-handle"},a.control=d.get(),a.setProp=function(b){a.control.setActive(b)},a.remove=function(b,c){var d=confirm("در صورت پاک کردن این کنترل تمامی داده‌هایی که قبلا در فرم برای این کنترل ذخیره شده است نیز پاک خواهد شد. آیا برای حذف این کنترل اطمینان دارید؟");d&&a.model.multiRowForm.rows[0].splice(c,1)},a.addRow=function(){if(!a.edit){var b=[];_.each(a.model.multiRowForm.rows[0],function(a){var c=JSON.parse(JSON.stringify(a));b.push(c)}),a.model.multiRowForm.rows.push(b),_.each(b,function(a){a.rowId=0,a.value=null,a.dropdown.listValue=null}),setTimeout(function(){$(".edit-form-modal").modal("refresh")},100)}},a.removeRow=function(b,c){var d=b.splice(c,1);a.model.multiRowForm.deletedIds=a.model.multiRowForm.deletedIds||[],a.model.multiRowForm.deletedIds.push(d[0][0].rowId)}}],template:' <div class="ui form field" ng-class="model.multiRowForm.controlSize">                        <div class="ui secondary pointing tiny menu">                            <div class="active item">{{model.label}}</div>                            <div class="ui right item" طng-show="!edit">                                <div class="pointer" ng-click="addRow()">{{model.multiRowForm.addKeyText}}<i class="icon plus square outline large"></i></div>                            </div>                        </div>                            <div ng-hide="model.multiRowForm.rows[0].length" class="gray center aligned twelve wide column"><small>یک کنترل را به اینجا بکشید</small></div>                        <div class="ui grid content-form " >                        </div>                    </div>',link:function(b,c,d){function e(){b.model.multiRowForm.columns=b.model.multiRowForm.columns||3;var a=1==b.model.multiRowForm.columns?"one":2==b.model.multiRowForm.columns?"two":3==b.model.multiRowForm.columns?"three":4==b.model.multiRowForm.columns?"four":5==b.model.multiRowForm.columns?"five":6==b.model.multiRowForm.columns?"six":"eight";return a}function f(){var d;d=b.edit?angular.element('<div class="drop-target doubling '+e()+' column row {{model.multiRowForm.separator? \'separator\':\'\'}}" xui-sortable="sortableOptions"  xng-model="model.multiRowForm.rows[0]"                                                         ng-sortable="{group: {name: \'form\', pull:true, put:true}, animation:150}" style="min-height:100px;">                                                                                                        <div class="column"                                                              ng-repeat="component in model.multiRowForm.rows[0] track by $index"                                                             ng-click="setProp(component);$event.stopPropagation();">                                                                <form-control ng-class="{active: component.isActive}" class="column" remove="remove(component, $index)" edit="true" ng-model="component" id="{{id}}" settings="{fromMultiRow:true}"></form-control>                                                    </div>                                                </div>'):angular.element('<div ng-repeat="row in model.multiRowForm.rows" class="doubling '+e()+' column row no-padding {{model.multiRowForm.separator? \'separator\':\'\'}}">                                                    <div class="column no-padding"                                                          ng-repeat="component in row track by $index">                                                            <div class="ui grid" ng-if="!edit && model.multiRowForm.rows.length > 1 && $last" style="margin:0;">                                                                <form-control class="ten wide column field" remove="remove(component, $index)" ng-model="component" id="{{id}}"  settings="{showLabel:$parent.$parent.$index == 0, fromMultiRow:true}"></form-control>                                                                <div class="two wide column field" >                                                                    <label ng-show="$parent.$parent.$index == 0">&nbsp;</label>                                                                    <div class="ui icon mini xbutton pointer gray" ng-click="removeRow(model.multiRowForm.rows, $parent.$parent.$index)"><i class="icon remove"></i></div>                                                                </div>                                                            </div>                                                            <form-control ng-if="edit || model.multiRowForm.rows.length == 1 || !$last" class="column" remove="remove(component, $index)" ng-model="component" id="{{id}}" settings="{showLabel:$parent.$parent.$index == 0, fromMultiRow:true}"></form-control>                                                    </div>                                                </div>'),a(d)(b),angular.element(c[0].querySelector(".content-form")).html(d)}b.$watch("model.multiRowForm.columns",function(a,b){f()})}}}]),c.directive("newFormModal",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",show:"=?"},template:' <div >                          <div class="xcontent" >                        </div>                    </div>',link:function(b,c,d){function e(){var d=angular.element('<sm-modal visible="model.showModal" settings="{closable: true}" xng-if="model.type==1">                                                <div class="content">                                                    <div sadaf-form id="{{model.formInfo.form}}" on-finish="hideModal()"></div>                                                </div>                                            </sm-modal>');a(d)(b),angular.element(c[0].querySelector(".xcontent")).html(d)}b.hideModal=function(){b.model.showModal=!1},e()}}}]),c.directive("formLookupProperty",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settings:"=?"},controller:["$scope","$http","formsService",function(a,b,c){a.model=a.model||{},a.settings=angular.merge({selectableColumns:!0},a.settings||{}),c.get().then(function(b){a.forms=b}),a.$watch("model.form",function(b){-1==b&&(a.model.form=a.forms[0].id),b&&c.get(b).then(function(b){a.formControls=[],_.each(b.model.pages,function(b){_.each(b.controls,function(b){a.formControls.push(b)})})})})}],template:' <div class="field">                        <div class="field">                            <label>انتخاب فرم</label>                            <sm-dropdown class="selection search fluid"  settings="{fullTextSearch: true, forceSelection: false}" model="model.form" items="forms" label="item.name" value="item.id" ></sm-dropdown>                        </div>                        <div class="field" ng-show=settings.selectableColumns>                            <label>انتخاب ستون‌های کلیدی</label>                            <sm-dropdown class="selection search multiple fluid" settings="{fullTextSearch: true, forceSelection: false}" model="model.keyControls" items="formControls" label="item.label" value="item.name" ></sm-dropdown>                        </div>                    </div>',link:function(a,b,c){}}}),c.directive("formLookupGetId",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",id:"@"},controller:["$scope","$http","formsService","$timeout",function(a,b,c,d){function e(){a.model.formLookup.keyControls=a.model.formLookup.keyControls||[],a.keys=a.model.formLookup.keyControls.map(function(b){var c={name:b,dropdownSettings:j(b),change:function(a){c.value!==a&&(c.value=a,i())},defaultText:a.model.label};return c})}function f(){if(a.model.formLookup.keyControlsBindedValue&&a.keys)for(var b=0;b<a.model.formLookup.keyControlsBindedValue.length;b++){var c=a.model.formLookup.keyControlsBindedValue[b];null!=a.model.value&&(a.keys[b].defaultText=c,a.keys[b].boldText=!0)}}function g(){a.model.useFilter&&a.model.filters.length&&_.map(a.model.filters,function(a){})}function h(){$(".form-"+a.model.randomId+" .dropdown").dropdown("clear")}function i(){var c=a.keys.map(function(a){return{label:a.name,value:a.value}}),d=_.some(c,function(a){return _.isUndefined(a.value)||null==a.value});d||(a.model.isValid=!1,b.post(app.urlPrefix+"api/forms/getFormLookupIds/"+a.model.formLookup.form,c).then(function(b){a.model.isValid=!0,_.isArray(b.data)&&b.data.length&&(a.model.value=b.data[0])}))}a.model.formLookup=a.model.formLookup||{};var j=function(b){return{apiSettings:{url:app.urlPrefix+"api/forms/getFormColumnData",cache:!1,method:"get",dataType:"json",beforeSend:function(c){return c.data={id:a.model.formLookup.form,name:b,query:c.urlData.query,others:a.keys.map(function(a){return{label:a.name,value:a.value}}),filters:a.model.useFilter?a.model.filters:[]},c},onResponse:function(a){return a.fields=a.fields.map(function(a){return{value:a.value.entitize(),label:a.label.entitize()}}),a}},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"label",value:"value"},saveRemoteData:!1,fullTextSearch:!0,forceSelection:!1}};a.$watch("model.formLookup.keyControlsBindedValue",function(a){f()},!0),a.$watch("model.filters",function(a){g()},!0),a.$watch("model.formLookup.keyControls",function(a){e(),f()},!0);var k=!1,l=!1;a.$watch("model.value",function(b){a.model;null==b&&(l=!0,h())}),a.init=function(a){k=!0,l&&h()},a.model.isValid=!0}],template:' <div class="">                        <div class="field" ng-repeat="f in keys">                            <sm-dropdown settings="f.dropdownSettings" on-init="init"ng-class="{\'bold-text\':f.boldText}" class="selection search {{f.name}} fluid" label="item.label" on-change="f.change" value="item.value" default-text="f.defaultText" ></sm-dropdown>                        </div>                    </div>'
}}),c.directive("selectMenu",function(){return{restrict:"E",replace:!0,transclude:!1,scope:{model:"=ngModel",multiple:"@?"},controller:["$scope","$http","$timeout",function(a,b,c){b.get(app.urlPrefix+"api/menus/get").then(function(b){a.menus=b.data})}],template:'<div><sm-dropdown items="menus" model="model" class="selection search fluid {{multiple}}" settings="{forceSelection: false}" label="item.name" value="item.id" ></sm-dropdown></div>'}}),c.directive("selectDatasourceColumns",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","datasources",function(a,b,c){function d(){c.getColumns(a.model.remoteDatasource.value).then(function(b){a.datasourceColumns=b.CubeInfo.Dimensions[0].Hierarchies,a.userProperties=b.UsersProperty})}a.select=function(){c.select(null,{type:["datasources"]}).then(function(b){b.selected&&b.selected.length&&(a.model.remoteDatasource={value:b.selected[0].id,label:b.selected[0].name},d(),a.model.remoteColumnKey=null,a.model.remoteColumnLabel=null)})},a.model=a.model||{},a.model.remoteDatasource&&d()}],template:' <div class="ui form">                        <div class="field">                            <label>انتخاب منبع داده</label>                            <button class="ui tiny button" ng-click="select()">                                <span ng-show="!model.remoteDatasource">انتخاب</span>                                <span ng-show="model.remoteDatasource">{{model.remoteDatasource.label}}</span>                            </button>                        </div>                        <div class="field" ng-show="datasourceColumns">                            <label>ستون مقدار</label>                            <sm-dropdown class="selection search fluid" settings="{fullTextSearch: true}" model="model.remoteColumnKey" items="datasourceColumns" label="item.Name" value="item.Name" ></sm-dropdown>                        </div>                        <div class="field" ng-show="datasourceColumns">                            <label>ستون برچسب</label>                            <sm-dropdown class="selection search fluid" settings="{fullTextSearch: true}" model="model.remoteColumnLabel" items="datasourceColumns" label="item.Name" value="item.Name" ></sm-dropdown>                        </div>                    </div>',link:function(a,b,c){}}}),c.service("updateModel",["$http",function(a){function b(a){}function c(a){}return{updateValuesForSave:c,updateValuesForGet:b}}]),c.service("formsService",["$http","updateModel",function(a,b){var c=0,d={},e=function(e,f){e||(e="");var g="";return f&&(g="?fromEditor=true"),d[e||"all"]||(d[e||"all"]=a.get(app.urlPrefix+"api/forms/get/"+e+g).then(function(a){return e?(b.updateValuesForGet(a.data.model.pages),a.data):(c=a.data.formsModule,a.data.list)})),d[e||"all"]},f=function(b,c){return d={},a.post(app.urlPrefix+"api/forms/save/"+b,c).then(function(a){return a.data})},g=function(b){return d={},a.get(app.urlPrefix+"api/forms/delete/"+b).then(function(a){return a.data})},h=function(b,c){return d={},a.post(app.urlPrefix+"api/forms/addFormToDashboard/"+b,c).then(function(a){return a.data})},i=function(b,c){return a.post(app.urlPrefix+"api/forms/deleteFormFromDashboard/"+b,c).then(function(a){return a.data})};return{save:f,get:e,remove:g,addFormToDashboard:h,deleteFormFromDashboard:i,getFormsModule:function(){return c}}}]),c.controller("fromsCtrl",["$scope","$http","$sce","$timeout","$mdToast","$routeParams","formsService","$mdDialog","utils",function(a,b,c,d,e,f,g,h,i){var j=this;j.progress=!0,j.app=app,j.utils=i,g.get().then(function(a){j.progress=!1,j.data=a,j.formsModule=g.getFormsModule()}),j["delete"]=function(a,b,c){var d=h.confirm().title("حذف برای همیشه؟").textContent("آیا فرم "+b.name+" حذف شود؟").ariaLabel("حذف").targetEvent(a).ok("حذف!").cancel("لغو");h.show(d).then(function(){g.remove(b.id).then(function(a){var b=j.data.splice(c,1),d=e.simple().textContent("فرم "+b[0].name+" با موفقیت حذف شد");e.show(d)})})}}]),c.service("controlPropertyService",function(){function a(){return b.control}var b={};return b.control={active:null,setActive:function(a){a&&(b.control.active&&(b.control.active.isActive=!1),b.control.active=a,b.control.active.isActive=!0)},remove:function(a,c){var d=confirm("در صورت پاک کردن این کنترل تمامی داده‌هایی که قبلا در فرم برای این کنترل ذخیره شده است نیز پاک خواهد شد. آیا برای حذف این کنترل اطمینان دارید؟");d&&(dangerChangeOccured=!0,b.pages.activePage.controls.splice(a,1))},createItems:function(a){if(a.dropdown.itemsTemp){var b=a.dropdown.itemsTemp.split(/[\r\n]/);a.dropdown.items=[],_.each(b,function(b){var c=b.trim();a&&""!=c&&a.dropdown.items.push({label:c,value:c})})}},resetListValue:function(){b.control.active.dropdown.listValue=[]}},{setActive:b.control.setActive,remove:b.control.remove,getActive:b.control.active,createItems:b.control.createItems,get:a}}),c.directive("sadafDropdwon",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",formId:"@",edit:"@?"},controller:["$scope","$http","formsService","controlPropertyService",function(a,b,c,d){}],template:"<div></div>",link:function(a,c,d){function e(){clearTimeout(j),j=setTimeout(function(){var c=$(".form-"+a.model.randomId+" .ui.dropdown").dropdown("get value");_.isArray(c)||(c=[c]),c=_.filter(c,null),b(function(){a.model.dropdown.listValue=c},0)},200)}for(var f=$(c).hasClass("multiple"),g=f?a.model.dropdown.listValue:[a.model.value||""],h='<select class="temporal ui fluid '+(f?"multiple":"")+' search selection dropdown" '+(f?"multiple":"")+" >",i=0;i<g.length;i++)h+='  <option value="'+g[i]+'">'+g[i]+"</option>";h+="</select>",h=$(h);var j,k={onChange:function(c,d,e){f||b(function(){a.model.value=c},0)},onRemove:function(a,b,c){e()},onAdd:function(a,b,c){e()},apiSettings:{url:app.urlPrefix+"api/forms/getdropdowndata",cache:!1,method:"get",dataType:"json",beforeSend:function(b){return b.data={id:a.formId,name:a.model.name,query:b.urlData.query},a.edit&&(b.data={datasourceId:a.model.dropdown.remoteDatasource.value,remoteColumnKey:a.model.dropdown.remoteColumnKey,remoteColumnLabel:a.model.dropdown.remoteColumnLabel,query:b.urlData.query}),b},onResponse:function(a){return a.fields=a.fields.map(function(a){return{value:a.value.entitize(),label:a.label.entitize()}}),a}},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"label",value:"value"},saveRemoteData:!1,fullTextSearch:!0,forceSelection:!1};if($(c).append(h),$(h).dropdown(k),a.model.dropdown.listValue){var l=a.model.dropdown.multiSelectDropdown?a.model.dropdown.listValue:a.model.value;null!=l&&$(h).dropdown("set selected",l)}}}}]),c.directive("controlSize",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},template:"<sm-dropdown items=\"[{label:'خیلی کوچک', value:'mini'}, {label:'کوچک', value:'tiny'}, {label:'معمولی', value:''}]\" model=\"model\" label=\"item.label\" value=\"item.value\"></sm-dropdown> "}}]),c.filter("formatNumber",function(){return function(a,b){var c="#,#"===b?",.0f":"#,#:00"===b?",.2f":"";return isNaN(a)?a:c?d3.format(c)(a):a}}),c.filter("persian",function(){return function(a){return app.lang&&0==+app.lang.langType?persian(a,!0):a}}),c.directive("sadafCheckbox",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="ui checkbox"><input type="checkbox" ng-model="model" /><label ng-transclude></label></div>',link:function(a,c,d){$(c).checkbox({onChange:function(d,e){b(function(){a.model=$(c).find("input").is(":checked"),a.change&&a.change()})}})}}}]),c.directive("filterProperty",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel",controls:"=",sourceFields:"=?"},controller:["$scope",function(a){var b={type:2};a.add=function(){a.model.push(_.extend({},b))},a.$watch("model",function(c){c||(a.model=a.model||[b])})}],template:'<div class="inner-section">                          <div class="field" ng-repeat="f in model track by $index">                            <div class="inline fields" >                                <label class="three wide field">نوع</label>                                <div class="six wide field">                                    <sm-dropdown model="f.type" class="" settings="{fullTextSearch: true, forceSelection: false}" items="[{type: 1, name:\'مقدار ثابت\'},{type: 2, name:\'مقدار کنترل\'}]" label="item.name" value="item.type"></sm-dropdown>                                </div>                                <div class="three wide field">                                    <i class="gray pointer icon plus" ng-click="add()"></i>                                    <i class="gray pointer icon delete" ng-click="model.splice($index, 1)" ng-hide="model.length==1"></i>                                </div>                            </div>                            <div class="inline fields" ng-show="f.type == 1">                                <label class="three wide field">مقدار</label>                                <input ng-model="f.staticValue" />                            </div>                            <div class="field" ng-show="f.type == 2">                                <div class="inline fields">                                    <label class="three wide field">کنترل</label>                                    <sm-dropdown model="f.control" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="controls.row" label="item.label" value="item.name"></sm-dropdown>                                </div>                            </div>                            <div class="inline fields" ng-show="sourceFields">                                <label class="three wide field">ستون</label>                                <sm-dropdown model="f.sourceField" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="sourceFields" label="item.label" value="item.name"></sm-dropdown>                            </div>                        </div>                   </div>',link:function(a,b,c){}}}]),c.directive("sadafDraggable",["$timeout",function(a){return function(a,b,c){function d(){$("[sadaf-draggable]").draggable({connectToSortable:"[sadaf-sortable]",helper:"clone",revert:"invalid",start:function(a,b){$(b.helper).css("width",$(b.helper).width()+"px")},stop:function(a,b){$(b.helper).css("width","100%")}}),$("[sadaf-draggable]").disableSelection()}a.$last&&d()}}]),c.directive("sadafSortable",["$timeout",function(a){return function(a,b,c){function d(){$("[sadaf-sortable]").sortable({revert:!0}),$("[sadaf-sortable]").disableSelection()}d()}}]),c.directive("sadafTime",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="">                        <input list="timeList" type="time" ng-model="model.timeValue" ng-change="change()"/>                        <datalist id="timeList">                            <option value="01:00">                            <option value="02:00">                            <option value="03:00">                            <option value="04:00">                            <option value="05:00">                            <option value="06:00">                            <option value="07:00">                            <option value="08:00">                            <option value="09:00">                            <option value="10:00">                            <option value="11:00">                            <option value="12:00">                            <option value="13:00">                            <option value="14:00">                            <option value="15:00">                            <option value="16:00">                            <option value="17:00">                            <option value="18:00">                            <option value="19:00">                            <option value="20:00">                            <option value="21:00">                            <option value="22:00">                            <option value="23:00">                            <option value="24:00">                        </datalist>                   </div>',link:function(a,b,c){a.$watch("model.timeValue",function(b,c){b&&(a.model.value=a.model.timeValue.toTimeString().split(" ")[0].substring(0,5))}),a.$watch("model.value",function(b,c){return b?void(a.model.timeValue=new Date("Thu Jan 01 1970 "+a.model.value.substring(0,5)+" GMT+0330 (Iran Standard Time)")):void(a.model.timeValue=null)})}}}])}();
//# sourceMappingURL=forms-app.js.map
// داشبورد مدیریتی صدف info@sadafdashboard.ir

function fixLayout(a){if(!a)return void dashboard.resize();dashboard.showEmptyMessageIfNeed();var b=function(){if("undefined"!=typeof Storage){var a=localStorage.getItem("lastEditedChartId");if(localStorage.removeItem("lastEditedChartId"),!_.isUndefined(a)&&a){var b=$("."+a.replace("ID","cid")).offset();b&&$("html, body").animate({scrollTop:b.top-20,scrollLeft:b.left-20})}}};dashboard.drow(b)}var ngApp=angular.module("navbarCat",["pascalprecht.translate","ngSanitize"]);ngApp.factory("navbar",["$rootScope",function(a){var b=null;return{getOption:function(){return b},setOption:function(c){b=c,a.$broadcast("navbarChange")}}}]),ngApp.factory("drawer",[function(a){var b={init:function(){if(!$("body #drawer-overlay").length){var a='<div class="drawer-overlay" id="drawer-overlay"></div>';$("body").append(a),$("body #drawer-overlay").on("click",this.close)}},toggle:function(){$("body").hasClass("drawer-open")?$("body").removeClass("drawer-open"):$("body").addClass("drawer-open")},close:function(){$("body").removeClass("drawer-open")}};return{init:b.init,toggle:b.toggle,close:b.close}}]),ngApp.controller("navbarCtrl",["$scope","$http","$rootScope","navbar","drawer","$translate",function(a,b,c,d,e,f){a.toggle=function(){e.toggle()},f.use(0==+$("#lang").val()?"fa":"en"),b.get(app.urlPrefix+"menu/MainMenu").then(function(b){a.menu=b.data,a.dashboardActions={fullScreenToggle:function(){},designToggle:function(){},printToggle:function(){},slideShowToggle:function(){},canDesign:!0},d.getOption()&&(a.dashboardActions=d.getOption()),c.$on("navbarChange",function(){d.getOption()&&(a.dashboardActions=d.getOption())})}),app.lang.setLang({selector:".navbar.navbar-inverse"})}]),angular.module("uibCollapseCat",[]).directive("uibCollapse",["$animate","$q","$parse","$injector",function(a,b,c,d){var e=d.has("$animateCss")?d.get("$animateCss"):null;return{link:function(d,f,g){function h(){f.hasClass("collapse")&&f.hasClass("in")||b.resolve(l(d)).then(function(){f.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),e?e(f,{addClass:"in",easing:"ease",to:{height:f[0].scrollHeight+"px"}}).start()["finally"](i):a.addClass(f,"in",{to:{height:f[0].scrollHeight+"px"}}).then(i)})}function i(){f.removeClass("collapsing").addClass("collapse").css({height:"auto"}),m(d)}function j(){return f.hasClass("collapse")||f.hasClass("in")?void b.resolve(n(d)).then(function(){f.css({height:f[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),e?e(f,{removeClass:"in",to:{height:"0"}}).start()["finally"](k):a.removeClass(f,"in",{to:{height:"0"}}).then(k)}):k()}function k(){f.css({height:"0"}),f.removeClass("collapsing").addClass("collapse"),o(d)}var l=c(g.expanding),m=c(g.expanded),n=c(g.collapsing),o=c(g.collapsed);d.$eval(g.uibCollapse)||f.addClass("in").addClass("collapse").attr("aria-expanded",!0).attr("aria-hidden",!1).css({height:"auto"}),d.$watch(g.uibCollapse,function(a){a?j():h()})}}}]);var ngApp=angular.module("sadaf",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]);var service=["$http","$interval",function(a,b){var c;return{start:function(){var d=function(){a.get(app.urlPrefix+"api/onlineusers/heartbeat").then(null,function(a){a&&a.data&&a.data.forceSignout&&(alert("شما از برنامه خارج شده‌اید. ممکن است کاربر دیگری با نام کاربری شما وارد سیستم شده باشد."),window.location.href=app.urlPrefix)})};d(),c=b(d,3e4)},stop:function(){b.cancel(c)}}}];try{var sadaf=angular.module("sadaf");sadaf.factory("heartBeat",service),sadaf.run(["heartBeat",function(a){a.start()}])}catch(e){}try{var management=angular.module("management");management.factory("heartBeat",service),management.run(["heartBeat",function(a){a.start()}])}catch(e){}var app=app||{};app.contentSegment=$("#content_segment"),app.contentSegmentModal=$("#content_segmentModal"),console||(console={},console.log=function(){}),app.chartLoadDelay=120,app.absoluteUrl="/",app.setAboluteUrl=function(a){app.absoluteUrl=a},app.loadContent=function(a){app.showLoadingProgress(),$("#content_segment").load(app.urlPrefix+a,function(){app.hideLoadingProgress(),app.lang.setLang()})},app.setContent=function(a){$("#content_segment").html(a),app.hideLoadingProgress(),app.lang.setLang()},app.setLocation=function(a){app.router.navigate(a,{trigger:!0})},app.urlPrefix="/",app.setUrlPrefix=function(a){app.urlPrefix=a.replace(/Moderation.*/g,"")},app.showInfo=function(a){$("#app-info-text").html(a),$("#app-info-text").fadeIn(),$("#app-loading-text").hide(),app.showInfoHolder.show(),setTimeout(function(){app.showInfoHolder.hide(),$("#app-info-text").fadeOut(400,function(){$("#app-loading-text").show()})},4e3)},app.showLoadingProgress=function(){app.showInfoHolder.show()},app.hideLoadingProgress=function(){app.showInfoHolder.hide()},app.showInfoHolder={holderCount:0,timeout:{},hide:function(){if(app.showInfoHolder.holderCount>0&&--app.showInfoHolder.holderCount,0==app.showInfoHolder.holderCount){var a=(new Date).getTime()-app.showInfoHolder.ticks;clearTimeout(app.showInfoHolder.timeout),setTimeout(function(){$("#app-loading").parent("div").animate({top:"0",opacity:0},400)},1e3>a?1e3:0)}},show:function(){var a=$("#app-loading").parent("div");a.css("left",$(window).width()/2-a.outerWidth()/2),++app.showInfoHolder.holderCount,app.showInfoHolder.ticks=(new Date).getTime(),app.showInfoHolder.timeout=setTimeout(function(){$("#app-loading").parent("div").animate({top:"50",opacity:1},400)},1e3)}},app.encodeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},app.convertOldPropObject=function(a,b){if(a){if(a.chartProp&&a.chartProp.info)return a;var c={};if(c.chartProp={},+b==chartTypes.TABLE){c.chartProp.info={chartSize:a.chartProp.chartSize,pivotTable:a.chartProp.pivotTable},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:a.seriesProp[""+d].table.headerName,numberFactor:"1",textAlign:a.seriesProp[""+d].table.textAlign,formatString:a.seriesProp[""+d].table.formatString,fontSize:a.seriesProp[""+d].table.fontSize,textBold:!1,textItalic:!1,color:a.seriesProp[""+d].table.fontColor}),c.chartProp.series["default"]={name:"",numberFactor:"1",textAlign:"right",formatString:"A",fontSize:"1m",textBold:!1,textItalic:!1,color:"#000000"}}if(+b==chartTypes.BAR){c.chartProp.info={chartSize:a.chartProp.chartSize,horizontalLines:a.chartProp.horizontalLine,formatString:a.chartProp.formatString},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:"",numberFactor:a.seriesProp[""+d].barlineChartProp.numberFactor,seriesType:a.seriesProp[""+d].barlineChartProp.barlineChartType,seriesColor:a.seriesProp[""+d].barlineChartProp.barlineChartColor,lineType:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartStyle,lineStyle:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineStyle,lineWeight:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineWeight,lineFace:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineDashes});c.chartProp.series["default"]={name:"",numberFactor:"1",seriesType:"bar",seriesColor:"#1f77b4",lineType:"line-dot-area",lineStyle:"linear",lineWeight:"2",lineFace:"5,0"}}return+b==chartTypes.PIE&&(c.chartProp.info={horizontalLines:a.chartProp.horizontalLine,chartSize:a.chartProp.chartSize,formatString:a.chartProp.formatString,pieStyle:a.chartProp.pieStyle,hole:"65"},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1"}),+b==chartTypes.GAUGE&&(c.chartProp.info={chartSize:a.chartProp.chartSize,style:a.chartProp.gaugeStyle,height:"medium",color:"#333333",fontSize:"3em",formatString:",.2f",status:"",target:"",textBold:!0,textItalic:!1,trend:"",value:"",segmentType:"singleSegment",min:"",yellow:"",green:"",max:""},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1",type:"value",typeMs:"value"}),c.dataUrl=a.chartProp.DataUrl,c.editMode=a.chartProp.editMode,c}},app.autoPlayTimer=app.autoPlayTimer||{counter:0},app.autoPlay=function(a,b){if(a&&"start"==a){var c=$("#side-navigation2 .simple-link");b=b||10,$(".sadaf-circular-preogress").progressbar(10,1e3*+b),app.autoPlayTimer.timer=setTimeout(function(){var a=$(c[app.autoPlayTimer.counter++%c.length]);document.location.href=a.attr("href"),a.parents(".panel-collapse").collapse("show"),$(".sadaf-circular-preogress").progressbar("stop"),app.autoPlay("start",b)},1e3*+b)}a&&"stop"==a&&($(".sadaf-circular-preogress").progressbar("stop"),clearTimeout(app.autoPlayTimer.timer))};var resizeTimer;app.lestenWindowResize=function(a){function b(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){a()},400)}var c=$(window).width();$(window).resize(function(){$(window).width();$(window).width()!=c&&(c=$(this).width(),b())})};var designMenuTimer,printMenuTimer;app.onMenusClick=function(a,b){return"showPrintMenu"==a||"hidePrintMenu"==a?(clearTimeout(printMenuTimer),void(printMenuTimer=setTimeout(function(){"showPrintMenu"==a?$(".navbar .print-toggle").fadeIn():"hidePrintMenu"==a&&$(".navbar .print-toggle").fadeOut()},800))):(clearTimeout(designMenuTimer),designMenuTimer=setTimeout(function(){"showDesignMenu"==a?$(".navbar .design-toggle").fadeIn():"hideDesignMenu"==a&&$(".navbar .design-toggle").fadeOut(),b&&"showfullScreenMenu"==b?$(".navbar .fullscreen-toggle").parents(".pull-right").fadeIn():$(".navbar .fullscreen-toggle").parents(".pull-right").fadeOut()},800),void $("html,body").animate({scrollTop:0},"slow",function(){$(".side-menu").hasClass("open")&&$("#side-menu-toggle").click()}))},app.print={printSingle:function(a,b){var c=this.getWidgetHtml(a);app.print.print(c,b)},getWidgetHtml:function(a){var b=$(a).height(),c=$(a).width(),d=$(a).clone();d.width(c),d.height(b);var e=d.find(".ui.dimmer .dimmer-info").html();d.find(".header").remove(),d.find(".ui.dimmer ").remove();var f=$("<div>").append(d).html(),g=$('<div style="margin-top:10px;">'+e+"</div>").width(c),h=$("<div>").html(f).append(g);h.css({"page-break-inside":"avoid",margin:"0 50px 50px 50px"}),h.addClass("pull-left");var i=$("<div>").append(h).html();return i},printPage:function(){var a="";$(".chart-widget").each(function(){var b=$(this).find(".chart-layout").attr("id");a+=app.print.getWidgetHtml("#"+b)});var b=$(".dashboard-page.active > a").text();app.print.print(a,b)},print:function(a,b){var c='<link href="'+app.absoluteUrl+'Content/custom-rtl.css" rel="stylesheet"  type="text/css"/>               <link href="'+app.absoluteUrl+'Areas/Charts/Content/barChart-rtl.css" rel="stylesheet"  type="text/css"/>               <link href="'+app.absoluteUrl+'Content/bootstrap-select.css" rel="stylesheet"  type="text/css"/>               <link href="'+app.absoluteUrl+'Content/bootstrap-rtl.css" rel="stylesheet"  type="text/css"/>               <link href="'+app.absoluteUrl+'Areas/Charts/Content/dashboardPage-rtl.css" rel="stylesheet"  type="text/css"/>               <style  type="text/css">@page {                            margin: 1.5cm;                            @top-center {                                    content: "sapam";                                }                            }                </style>',d=window.open();d.document.write('<html><head><meta charset="utf-8"><title>'+b+"</title>"+c),d.document.write("</head><body>"),d.document.write(a),d.document.write("</body></html>"),d.document.close(),d.focus(),setTimeout(function(){d.print()},400)}},app.post=function(a,b,c){$.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json; charset=utf-8",traditional:!0,success:c})},app.lang={langType:0,setLangTyle:function(a){this.langType=+(a||0)},isRtl:function(){return 0==app.lang.langType},translate:function(a){return app.lang.lang?app.lang.lang[a]||a:a},q:[],translateAsync:function(a,b){app.lang.lang?b&&b(app.lang.lang[a]||a):this.q.push({key:a,callback:b})},setLang:function(a){if(a&&a.data&&(this.lang=a.data),this.lang||!this.inProgress){if(!this.lang&&!this.inProgress){var b=0==app.lang.langType?"fa":"en";this.inProgress=!0;var c=app.urlPrefix+"dist/locales/locale-"+b+".js?v="+app.version;return void $.getJSON(c,null,function(a){for(app.lang.setLang({data:a});app.lang.q.length>0;){var b=q.pop();b.callback&&callback(app.lang.lang[b.key]||b.key)}})}var d;d=a&&a.selector?$(a.selector).find("*[data-trans-key]"):$("*[data-trans-key]"),d.each(function(){var a=$(this),b=a.data("translated");if(!b){var c=app.lang.lang[a.data("trans-key")],d=a.data("trans-attr");d?a.attr(d,c):a.text(c),a.data("translated",!0)}})}}};var app=app||{};app.filterBox=angular.module("filterBox",["ngAnimate"]),app.filterBox.config(["$httpProvider",function(a){a.defaults.headers.get||(a.defaults.headers.get={}),a.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",a.defaults.headers.get["Cache-Control"]="no-cache",a.defaults.headers.get.Pragma="no-cache"}]),app.filterBox.controller("filterBoxController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){e.$on("app-filterbox-refresh",function(){a.refresh()}),a.getCleanValue=function(a){var b=/.*&\[(.*)\]/gi;return a.match(b)&&(a=a.replace(b,"$1")),a},a.refresh=function(){d(function(){a.otherFilters=[],_.forEach(app.chartCommons.drillDown.filters,function(b){_.forEach(b.drillDown,function(c){a.otherFilters.push({key:c.key,value:c.value,chartInPageId:b.chartInPageId,datasourceId:b.datasourceId})})}),a.userControlFilter=[],app.chartCommons.userFilter.filters.forEach(function(b){function d(a){switch(a){case"GetDate":return"امروز";case"MonthToDate":return"از ابتدای ماه تا امروز";case"YearToDate":return"از ابتدای سال تا امروز";case"DaysAgo":return persian(b.values[2]||0)+" روز قبل تا "+persian(b.values[3]||0)+" روز قبل";case"MonthAgo":return persian(b.values[2]||0)+" ماه قبل تا "+persian(b.values[3]||0)+" ماه قبل"}return""}var e={};e.key=b.dimensionName,e.disableClear=b.disableClear,e.chartInPageId=b.chartInPageId,e.values=_.map(b.values,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a});var f=e.values.join(", ");if(f.length>30&&(f=f.substring(0,30)+"..."),e.Caption=c.trustAsHtml(f),3==+b.variableType)e.Caption=c.trustAsHtml(d(b.values[0]));else if(4==+b.variableType){var g={gr:"بزرگتر",eqgr:"بزرگتر مساوی",ls:"کوچکتر",eqls:"کوچکتر مساوی",eq:"برابر",nteq:"نابرابر"};e.Caption=c.trustAsHtml("<b>"+g[b.values[1]]+"</b> "+b.values[0])}else 5==+b.variableType&&(e.Caption=c.trustAsHtml("<b>"+b.values[0]+"</b>"+("or"==b.values[1]?" در یکی از ":" در همه ")+": "+b.values[2]));a.userControlFilter.push(e)})},0)},a.removeUserControl=function(b){var c=a.userControlFilter[b];a.userControlFilter.splice(b,1);var d=_.find(app.chartCommons.userFilter.filters,{chartInPageId:c.chartInPageId,dimensionName:c.key});_.isUndefined(d)||_.remove(app.chartCommons.userFilter.filters,d);var e=$("#ID"+c.chartInPageId).data("settings");app.moderation.dashboadpage.refreshRelatedDatasources(e.input.RefreshDatasource)},a.removeDrillDown=function(b){var c=a.otherFilters[b];a.otherFilters.splice(b,1);var d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:c.chartInPageId});_.isUndefined(d)||_.remove(d.drillDown,{key:c.key});var e=$("#ID"+c.chartInPageId).data("settings");app.moderation.dashboadpage.refreshRelatedDatasources(e.input.RefreshDatasource)},a.clearAll=function(){var b=[];_.each(a.otherFilters,function(a){var c=$("#ID"+a.chartInPageId).data("settings");c&&c.input&&_.isArray(c.input.RefreshDatasource)&&(b=_.concat(b,c.input.RefreshDatasource))}),_.each(a.userControlFilter,function(a){var c=$("#ID"+a.chartInPageId).data("settings");_.isArray(c&&c.input&&c.input.RefreshDatasource)&&(b=_.concat(b,c.input.RefreshDatasource))}),app.chartCommons.drillDown.clearAll(),app.chartCommons.userFilter.filters=[],a.refresh(),app.moderation.dashboadpage.refreshRelatedDatasources(_.uniq(b))}}]),app.filterBox.refresh=function(){console.log("call refresh"),angular.element("#filter-box-controller").scope().refresh(),angular.element("#filter-box-controller").scope().$apply()},app.moderation=app.moderation||{},app.moderation.dashboadpage=app.moderation.dashboadpage||{},app.moderation.dashboadpage.globalFilterList=[],app.moderation.dashboadpage.syncWithGlobalFilter=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=$.grep(app.moderation.dashboadpage.globalFilterList,function(c){return c.Uniquename==a[b].Uniquename&&c.DataSourceId==a[b].DataSourceId&&c.CubeName==a[b].CubeName});0!=c.length&&(a[b].Members=c[0].Members.slice())}},app.moderation.dashboadpage.isRelated=!1,app.moderation.dashboadpage.onRelatedChange=function(a){app.moderation.dashboadpage.isRelated=a;for(var b=app.moderation.dashboadpage.charts,c=0;c<b.length;c++){var d=$("#ID"+b[c].pageId),e=d.data("settings");e.link="bold"}app.moderation.dashboadpage.isRelated?$(".glyphicon-link").show():$(".glyphicon-link").hide()},app.moderation.dashboadpage.showDimentions=function(){var a=$("#corelate-filter-list .filter-content").html();if(""==a.trim()){$(".glyphicon-link").addClass("link");for(var b=app.moderation.dashboadpage.charts,c=[],d=!0,e=0;e<b.length;e++){var f=$("#ID"+b[e].pageId),g=f.data("settings"),h=g.input.Dimentions;if(g.input.EditPermission)for(var i in h)for(var j=0;j<h[i].length;j++){var f={Uniquename:h[i][j],DataSourceId:g.input.DataSourceId,CubeName:g.input.CubeName,ChartId:g.chartId},k=$.grep(c,function(a){return a.Uniquename==f.Uniquename&&a.DataSourceId==f.DataSourceId&&a.CubeName==f.CubeName});0==k.length&&c.push(f)}else d=!1}var l=$("#corelate-filter-list .filter-content");l.html('<div style="padding:3px"><img style="width: 1.3em" src="'+app.urlPrefix+'Images/progress.gif" /><span  data-trans-key="در حال بارگذاری..."></span></div>'),0==c.length?($("#corelate-filter-list .filter-content").empty(),$("#corelate-filter-list .filter-content").html(d?"":"شما مجوز استفاده از این امکان را ندارید.")):$.ajax({type:"post",url:app.urlPrefix+"Charts/DashboardPage/GetHierarchies",data:JSON.stringify(c),contentType:"application/json; charset=utf-8"}).done(function(a){function b(a,b){if(null!=a)for(var c='<div class="container-fluid form-horizontal " style="margin-bottom:-15px;"><div class="form-group">',d=0,e=0,f=0;f<a.length;f++){var g=a[f];null!=g.Members&&(f>0&&(3==e||d!=g.DataSourceId)&&(c+='</div><div class="form-group">',e=0),d!=g.DataSourceId&&f>0&&(c+='<hr style="margin-top: 5px;;"/>'),e++,d=g.DataSourceId,c+='<div class="col-md-4">                                    <div class="btn btn-default col-md-12 filter-member-dialog" style="overflow: hidden; text-overflow: ellipsis;"                                            CubeName="'+g.CubeName+'" DataSourceId="'+g.DataSourceId+'" Uniquename="'+g.Uniquename+'"                                             title="'+g.Caption+'">'+g.Caption+"</div></div>")}return c+="</div></div>"}if($("#corelate-filter-list .filter-content").empty(),!a.result)return void $("#corelate-filter-list .filter-content").html(a.message);var c=b(a.data,"");l.html(c),l.find(".filter-member-dialog").on("click",function(){var b=$(this),c=$(this).attr("Uniquename"),d=$(this).attr("DataSourceId"),e=$(this).attr("CubeName"),f=$.grep(a.data,function(a,b){return a.Uniquename==c&&a.DataSourceId==d&&a.CubeName==e})[0];app.helper.filterMemberDialog(f.Members,function(a){f.Members=a;var c=a.filter(function(a){return a.IsChecked}).map(function(a){return a.Caption}),d=f.Caption;c.length>3?d="انتخاب "+c.length+" از "+a.length:c.length>0&&(d=c.join(" و ")),b.text(d),app.moderation.dashboadpage.getWheres(f,f.DataSourceId)})})})}},app.moderation.dashboadpage.getWheres=function(a,b){if("undefined"!=typeof b){$.grep(a.Members,function(a){return a.IsChecked})}if(app.moderation.dashboadpage.isRelated){for(var c=app.moderation.dashboadpage.globalFilterList,d=app.moderation.dashboadpage.charts,e=!1,f=0;f<c.length;f++){var g=c[f];g.Uniquename==a.Uniquename&&g.DataSourceId==a.DataSourceId&&g.CubeName==a.CubeName&&(c[f]=$.extend({},a),e=!0)}e||c.push($.extend({},a));for(var f=0;f<d.length;f++){var h=$("#ID"+d[f].pageId),i=h.data("settings");if(i.input.DataSourceId==a.DataSourceId&&i.input.CubeName==a.CubeName&&$("#ID"+d[f].pageId+" .glyphicon-link").hasClass("link")){var j=(-1!=$.inArray(a.Uniquename,i.input.Dimentions.Where),-1!=$.inArray(a.Uniquename,i.input.Dimentions.Hierarchies),-1!=$.inArray(a.Uniquename,i.input.Dimentions.SeriesLevel),h.find("#filter").data("data"));"undefined"!=typeof j&&(app.moderation.dashboadpage.syncWithGlobalFilter(j.Where),app.moderation.dashboadpage.syncWithGlobalFilter(j.Hierarchies),app.moderation.dashboadpage.syncWithGlobalFilter(j.SeriesLevel)),i.titlebar.showProgress(!0);var k=$.extend({},a);k.Members=$.grep(a.Members,function(a){return a.IsChecked}),i.parameters={ChartInPageId:i.ChartInPageId,Filter:[k]},h.charts(i.type,"refreshWithData",i)}}}},app.moderation.dashboadpage.refreshRelatedDatasources=function(a,b){var b=b||[],a=a||[];b=b.map(function(a){return+a});var c=0;$(".bar-chart").each(function(d){$el=$(this);var e=$el.data("settings");if("undefined"!=typeof e&&"undefined"!=typeof e.input){if(-1!=b.indexOf(+e.ChartInPageId))return;if(-1==a.indexOf(e.input.DataSourceId))return;7!=+e.type&&c++,setTimeout(function(a){e.titlebar.showProgress(!0),a.charts(e.type,"refreshWithData",e,{refreshRelatedDatasources:!1})},7==+e.type?0:c*app.chartLoadDelay,$el)}})},app.moderation.dashboadpage.selectValueOnChart=function(a,b){var c=a.chartInPageId;return-1==+a.Id?(app.chartCommons.userFilter.setFilter({id:a.Id,values:a.Values,variableType:a.VariableType,dimensionName:a.dimensionName,chartInPageId:a.chartInPageId,datasourceId:a.datasourceId}),app.moderation.dashboadpage.refreshRelatedDatasources(b,[+c]),void app.filterBox.refresh()):void $.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(a),success:function(a){a.result?(app.moderation.dashboadpage.refreshRelatedDatasources(a.relatedDatasource,[+c]),app.filterBox.refresh()):alert(a.Message)}})};var app=app||{};app.dashboardLayoutVersion=2;var dashboard={defuals:{maxCols:12},charts:[],pageInfo:{},pageId:-1,arrangePer:!1,minChartSize:{1:[500,250],2:[350,350],3:[300,200],4:[300,300],5:[500,300],6:[300,200],7:[350,50],8:[300,300],9:[300,300]},padding:10,maxCols:12,baseDimantion:{y:30},serialize:function(){dashboard.gs.serialize()},drillDownResize:function(a,b){},setMaxCols:function(){var a=dashboard.getPagePosition();dashboard.maxCols=a?a.maxCol||12:12,$("#dashboard-col").val(dashboard.maxCols)},setInfo:function(a,b,c,d,e){this.arrangePer=d||!1,this.charts=a||[],this.pageInfo=b||{chartsOrder:[],layout:[],pageLayout:"30_30_30"},this.pageId=c||-1,this.forms=e,this.charts=this.charts.concat(this.forms),this.setMaxCols()},disable:function(){dashboard.gs.disable(),dashboard.gs.disable_resize()},enable:function(){dashboard.gs.enable(),dashboard.gs.enable_resize()},saveSerialize:function(){dashboard.serializeData=dashboard.gs.serialize();var a=dashboard.serializeData.map(function(a){var b;return b="form"===a.type?a.id:a.data.ChartInPageId,{type:a.type,chartIdPageId:b,col:a.wgd.col,row:a.wgd.row,size_x:a.wgd.size_x,size_y:a.wgd.size_y}}),b={pageId:this.pageId,chartsPosition:a,media:dashboard.media,maxCol:dashboard.maxCols};try{"undefined"==typeof dashboard.pageInfo.layout&&(dashboard.pageInfo.layout=[]);var c=dashboard.pageInfo.layout.filter(function(a){return a.media==dashboard.media});c.length>0?c[0].chartsPosition=a:dashboard.pageInfo.layout.push({media:dashboard.media,chartsPosition:a,maxCol:dashboard.maxCols})}catch(d){}$.ajax({type:"POST",url:app.urlPrefix+"Charts/DashboardPage/SetChartsOrder",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(a){}})},add:function(a,b,c,d,e){b=b>dashboard.maxCols?dashboard.maxCols:b,d=d>dashboard.maxCols?dashboard.maxCols:d,dashboard.gs.add_widget(a,b,c,d,e)},initGs:function(a){return dashboard.baseDimantion={x:$(".gridster").width()/dashboard.maxCols,y:50},dashboard.gs=$(".gridster>div").gridster({widget_margins:[0,0],widget_base_dimensions:[dashboard.baseDimantion.x,dashboard.baseDimantion.y],max_cols:dashboard.maxCols,min_cols:dashboard.maxCols,resize:{enabled:!0,stop:function(a,b,c){dashboard.saveSerialize();var d=$(c).data("type");if("form"!==d){var e=$(c).find(".chart-data").data("settings");e.isDashboardResize=!0,$(c).find(".chart-data").charts(e.type,"refresh",e),e.widgetSize.size_y=+$(c).attr("data-sizey"),e.widgetSize.size_x=+$(c).attr("data-sizex")}}},serialize_params:function(a,b){var c=a.data("type"),d=a.data("id");return{type:c,id:d,data:a.find(".chart-data").data("settings"),wgd:b}},draggable:{handle:".header, .header b",cancel:".desc",start:function(a,b){},drag:function(a,b){},stop:function(a,b){$(b.$helper).removeClass("player-revert"),dashboard.saveSerialize()}}}).data("gridster"),a||(dashboard.gs.disable(),dashboard.gs.disable_resize()),dashboard.gs},deleteAll:function(){$("#ID0").data("settings");dashboard.gs.remove_widget($("#ID0"))},deleteChartFromGs:function(a,b){var c=$(a).parents(".chart-widget");dashboard.gs.remove_widget(c),b&&b()},getPagePosition:function(){var a=dashboard.pageInfo.layout.filter(function(a){return a.media<=dashboard.media}).sort(function(a,b){return+b.media-+a.media});if(0==a.length){var b=_.map(dashboard.pageInfo.layout,function(a){return a.media}),c=-1,d=1e3;_.each(dashboard.pageInfo.layout,function(a,b){var e=Math.abs(a.media-dashboard.media);d>e&&(d=e,c=b)}),-1!=c&&(a=[dashboard.pageInfo.layout[c]],a[0].media=b,a[0].maxCols=dashboard.maxCols)}return a[0]},getChartPosition:function(a,b,c){var d,e=null,f=1e3;"form"===a.type?(e="form",d=a.id):(d=a.pageId,f=+a.type);var g=dashboard.minChartSize[+f]||[300,300],h={col:1,row:1e3,size_x:Math.floor(g[0]/dashboard.baseDimantion.x)+1,size_y:Math.floor(g[1]/dashboard.baseDimantion.y)+1},i=[];try{var j=dashboard.getPagePosition();i=j.chartsPosition.filter(function(a){return a.chartIdPageId==d&&a.type===e})}catch(k){}return i[0]||h},sortCharts:function(){try{this.charts.sort(function(a,b){try{var c=dashboard.getChartPosition(a),d=dashboard.getChartPosition(b);return c.row==d.row?c.col-d.col:c.row-d.row}catch(e){return-1e3}})}catch(a){Error(a)}},addTasks:[],drow:function(a){dashboard.initGs(this.arrangePer),dashboard.sortCharts();var b=0;this.charts.forEach(function(c,d){7!=+c.type&&b++;var e=b,f=setTimeout(function(){dashboard.addChart(c,null,!1,e*app.chartLoadDelay),d==dashboard.charts.length-1&&a&&a()},50*d);dashboard.addTasks.push(f)})},resize:function(){this.setMaxCols();var a=$(".chart-data").map(function(a,b){return $(b).data("settings")}).toArray();$(".gridster").remove(),$("#dashboard-chart-panel").html('<div class="gridster"><div></div></div>'),dashboard.initGs(this.arrangePer),a.forEach(function(a){dashboard.addChart(null,a,!0)}),dashboard.forms&&_.each(dashboard.forms,function(a){dashboard.addChart(a)})},addChart:function(a,b,c,d){var e;if(a&&"form"===a.type){var f=dashboard.getChartPosition(a),g=app.absoluteUrl+"sadaf/management/#/forms/"+a.id,h=!1,i="javascript:dashboard.deleteForm("+a.id+")",j=!1,k="asdasd";e=$('<div data-type="form" data-id="'+a.id+'" class="chart-widget"></div>');var l=dashboard.getFormTemplate(this.arrangePer,a.permissions.EditPermission,g,i,h,a.name,n,a.lastRefresh,k,j);e.append(l),dashboard.add(e,f.size_x,f.size_y,f.col,f.row),$("body").trigger("form-widget-add",[a.id]),app.lang.setLang({selector:"div[data-type=form][data-id="+a.id+"]"})}else{performance.now();"undefined"==typeof d&&(d=0),b&&(a={id:b.chartId,pageId:b.ChartInPageId,title:b.input.title,type:b.type,permissions:b.permissions,lastRefresh:b.lastRefresh,desc:b.desc});var m={chartId:a.id,ChartInPageId:a.pageId},n="ID"+a.pageId;e=$("<div class='chart-widget cid"+a.pageId+"'></div>");var j=7!=a.type,h=7!=a.type,g=app.absoluteUrl+"sadaf/management/#/charts/edit/0/"+m.chartId,i="javascript:dashboard.deleteChart("+m.ChartInPageId+", "+m.chartId+", "+a.permissions.DeletePermission+")",k=_.isEmpty(a.desc)?"":"<p><br/><b>"+app.lang.translate("desc")+":</b> "+a.desc.replace(/(\r\n|\n|\r)/gm,"<br/>")+"</p>",l=dashboard.getChartTemplate(this.arrangePer,a.permissions.EditPermission,g,i,h,a.title,n,a.lastRefresh,k,j);e.append(l);var o=b;b||(o=JSON.parse(a.detail));var b=b||$.extend({permissions:a.permissions,parameters:m,chartId:m.chartId,editLink:g,removeLink:i,RemoveFromPage:this.arrangePer,ChartInPageId:a.pageId,input:{RefreshDatasource:a.RefreshDatasource},lastRefresh:a.lastRefresh,desc:a.desc,type:a.type},o);if(f=dashboard.getChartPosition(a),b.widgetSize=f,dashboard.add(e,f.size_x,f.size_y,f.col,f.row),c)e.find(".bar-chart").data("settings",b),e.find(".chart-data").charts(a.type,"refresh",b,!0);else{var p=setTimeout(function(){e.find(".chart-data").charts(a.type,b)},7==+a.type?0:d);dashboard.addTasks.push(p)}app.lang.setLang({selector:".chart-widget.cid"+a.pageId})}e.find(".show-extra-info").on("click",function(){e.find(".ui.card .ui.dimmer.overflow-auto").dimmer("show")}),e.find(".dimmer-info").on("click",function(){e.find(".ui.card .ui.dimmer").dimmer("hide")}),e.find(".refresh-chart").on("click",function(){e.find(".chart-data").charts(a.type,"refreshWithData",b,!0),e.find(".bar-chart").data("settings").titlebar.showProgress(!0)}),e.find(".export-excel").on("click",function(){var a=e.find(".chart-data").data("settings");app.chartCommons.setFilterParameter(a),$.ajax({type:"POST",url:app.urlPrefix+"Charts/BarChart/ExportToExcel",data:JSON.stringify({ChartId:b.chartId,ChartInPageId:b.ChartInPageId,TableInfo:o.TableInfo,IsPivot:1==+o.chartProp.info.aggregation,drillDown:a.parameters.drillDown,userControlFilter:a.parameters.userControlFilter,userVariable:a.parameters.userVariable,otherFilters:a.parameters.otherFilters,filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId)}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){window.location=app.urlPrefix+"Charts/BarChart/Download?name="+a.name}})}),e.find(".export-print").on("click",function(){app.print.printSingle(".cid"+a.pageId,a.title)}),e.find(".clone-chart").on("click",function(){app.post(app.urlPrefix+"Moderation/Charts/CloneChart",{Id:b.chartId,PageId:dashboard.pageId},function(a){if(a.result&&a.insertedId){var b=a.insertedId,c=app.urlPrefix+"api/dashboards/getSingleChartInfo?chartId="+b+"&chartInPageId="+a.chartInPageId;$.get(c,function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1),$("html, body").animate({scrollTop:$(document).height()-$(window).height()},1e3)})}})}),e.find(".chart-dimentions").on("click",function(){e.find(".chart-dimentions-content").transition("fade up"),e.find(".chart-dimentions").transition("fade")}),e.find(".show-chart-dimensions").on("click",function(){var a=e.find(".chart-dimentions-content");e.find(".chart-dimentions-content").transition("fade up"),e.find(".chart-dimentions").transition("fade"),""==a.html()&&(a.html('<div class="ui text active loader">در حال بارگذاری</div>'),$.ajax(app.urlPrefix+"api/chartdata/GetChart?Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId).done(function(c){function d(a,b){return null!=a?"<ul class='sortable list-unstyled pointer' index='"+b+"'>"+a.map(function(a,b){return a.ShowFilter?'<li value="'+a.Uniquename+'">  '+a.Caption+'<i class="icon filter filter-member-dialog" style="float:left; margin-right:5px;"></i></li>':'<li value="'+a.Uniquename+'"> '+a.Caption+"</li>"}).join("")+"</ul>":""}function e(){function d(b,c){var d=b[c],e=[];a.find("ul[index="+c+"] li").each(function(a,b){var c=$(this).attr("value"),f=$.grep(d,function(a){return a.Uniquename==c;
})[0];f.Members=$(this).data("members"),e.push(f)}),b[c]=e}d(c,"Hierarchies"),d(c,"Where"),d(c,"SeriesLevel");var e=function(a){b.parameters={filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId),chartId:b.chartId,ChartInPageId:b.ChartInPageId},$("#ID"+b.ChartInPageId).charts(b.type,"refreshWithData",b,{refreshRelatedDatasources:!1})};e(c)}a.data("data",c);var f=null,g=null,h=null;f=d(c.Hierarchies,"Hierarchies"),g=d(c.Where,"Where"),h=d(c.SeriesLevel,"SeriesLevel");var i='<table class="ui single line unstackable table chart-design" xstyle="display:none" xstyle="position:absolute;margin-bottom:0px; background-color:#fff;display:none; border-bottom:1px solid silver">                                           <thead><tr class="">                                             <th style="'+(""==h?"display:none":"")+'"><span data-trans-key="شاخص‌ها (ستون‌های عددی)" > </span> </th>                                             <th style="'+(""==f?"display:none":"")+'"><span data-trans-key="ابعاد (ستون‌های رشته‌ای)" > </span> </th>                                             <th style="'+(""==g?"display:none":"")+'"><span data-trans-key="شرط" > </span></th>                                         </tr></thead>                                         <tr>                                             <td  style="'+(""==h?"display:none":"")+'"id="div-x" class="myc">'+h+'</td>                                             <td  style="'+(""==f?"display:none":"")+'"id="div-y" class="myc">'+f+'</td>                                             <td  style="'+(""==g?"display:none":"")+'"id="div-where" class="myc">'+g+"</td>                                         </tr>                                     </table>";a.html(i),a.find(".filter-member-dialog").on("click",function(){function a(a,b){app.helper.filterMemberDialog(a,b,function(a){d.data("members",a),e()})}var d=$(this).parent(),f=$(this).parent().attr("value"),g=c[$(this).closest("ul").attr("index")],h=($.grep(g,function(a,b){return a.Uniquename==f})[0],$(this).parent().data("members")),i=app.urlPrefix+"api/chartdata/GetMemberOfFilterHierarchy?Uniquename="+f+"&Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId;"undefined"==typeof h?$.ajax(i).done(function(b){$(this).parent().data("members",b),a(b,i)}):a(h,i)}),a.find(".sortable").sortable({start:function(a,b){b.placeholder.addClass("filter-placeholder"),b.placeholder.height(b.item.height()),b.placeholder.width(b.item.width()),b.placeholder.parent().width(b.item.width()),b.placeholder.parent().parent().width(b.item.width())},stop:function(a,b){e()}}),app.lang.setLang({selector:a.selector})}))}),e.find(".dropdown").lazyDropdown({onShow:function(a,b){e.find(".menu-bar").addClass("show-dropdown")},onHide:function(a,b){e.find(".menu-bar").removeClass("show-dropdown")}}),this.showEmptyMessageIfNeed()},showEmptyMessageIfNeed:function(){0==dashboard.charts.length?$("#chart-empty-message").hasClass("hidden")&&$("#chart-empty-message").transition("scale in"):$("#chart-empty-message").hasClass("hidden")||$("#chart-empty-message").transition("scale out")},deleteChart:function(a,b,c){if(a)c?$("#deleteChart .checkbox").show():$("#deleteChart .checkbox").hide(),$("#deleteChart").data("cId",a),$("#deleteChart").data("chartId",b),$("#deleteChart").modal("show");else{var a=$("#deleteChart").data("cId"),b=$("#deleteChart").data("chartId"),d=app.urlPrefix+"charts/dashboardPage/removeChartFromPage";$("#deleteChart .action-btn").addClass("loading"),$.post(d,{ChartInPageId:a,pageId:dashboard.pageId},function(b){if(0==b)return void alert("شما مجوز پاک کردن این نمودار را ندارید");for(var c,d=0;d<dashboard.charts.length;d++)if(dashboard.charts[d].pageId==a){c=dashboard.charts[d].pageId,dashboard.charts.splice(d,1)}dashboard.deleteChartFromGs("#ID"+c,function(){$(this).remove(),dashboard.showEmptyMessageIfNeed()}),$("#deleteChart").modal("hide"),$("#deleteChart .action-btn").removeClass("loading")});var e=$("#delete-from-dash").prop("checked");e&&$.post(app.urlPrefix+"Moderation/Charts/DeleteCharts",{Ids:["ChartId-"+b]},function(a){})}},deleteForm:function(a){$("body").trigger("delete-form",[a,dashboard.pageId])},setReturnUrl:function(a){localStorage.setItem("returnUrl",window.location.href),localStorage.setItem("lastEditedChartId",a)},getChartTemplate:function(a,b,c,d,e,f,g,h,i,j){return'<div class="ui card">  <div class="content" style="">    <div class="header '+(a?"move":"")+'">            <div class="menu-bar ">                <i class="icon titlebar-icon" style="background: #fff;width: 100%;position: absolute;display: block;top: 0;height: 100%;"></i>                <div class="ui dropdown" >                        <i class="setting icon chart-setting-icon titlebar-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit icon"></i></a>':"")+"                          "+(b?' <a class="item clone-chart"><span data-trans-key="تکرار" > </span> <i class="copy icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف نمودار از صفحه" > </span> <i class="trash outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-excel"><span data-trans-key="خروجی اکسل" > </span> <i class="file excel outline icon"></i></a>':"")+"                          "+(e?'<a class="item refresh-chart"><span data-trans-key="رفرش داده‌ها" >رفرش داده‌ها </span> <i class="refresh icon"></i></a>':"")+'                           <a class="item export-print"><span data-trans-key="print" > </span> <i class="print icon"></i></a>                        </div>                </div>                <div class=" ">                    '+(e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"")+"                    "+(e?'<i class="filter icon chart-setting-icon show-chart-dimensions pointer titlebar-icon"></i>':"")+"                    "+(e?'<i class="comments icon chart-setting-icon show-chart-comments pointer titlebar-icon"></i>':"")+"                </div>            </div>        "+f+'    </div>    <div class="description chart-data bar-chart" id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader tiny">در حال بارگذاری</div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: 4px !important;"><div class="content"><div class="center"><div class="dimmer-info"><b>'+app.lang.translate("lastUpdate")+':</b> <span class="last-refresh">'+app.chartCommons.lastRefreshDateFormat(h)+"</span>"+i+"</div></div></div></div></div>"},getFormTemplate:function(a,b,c,d,e,f,g,h,i,j){return'<div class="ui card ">  <div class="content" style="">    <div class="header '+(a?"move":"")+'">            <div class="menu-bar ">                '+(a||b?'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف" > </span> <i class="trash outline icon"></i></a>':"")+"                                                   </div>                </div>":"")+'                <div class="">                   <i class="info icon chart-setting-icon show-extra-info pointer"></i>                </div>            </div>        '+f+'    </div>    <div class="description form-content " id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader tiny">در حال بارگذاری</div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: 4px !important;"><div class="content"><div class="center"><div class="dimmer-info">'+i+"</div></div></div></div></div>"},setLastRefresh:function(a,b){var c=$(".cid"+a+" .last-refresh");c.html(app.chartCommons.lastRefreshDateFormat(b))}},ngApp=angular.module("sadaf");ngApp.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit(d.onFinishRender)})}}}]),ngApp.directive("sglclick",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.sglclick),f=200,g=0,h=null;c.on("click",function(a){g++,1===g?h=setTimeout(function(){b.$apply(function(){e(b,{$event:a})}),g=0},f):(clearTimeout(h),g=0)})}}}]),ngApp.controller("dashboardPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","drawer","$translate","$rootScope","$compile","formsService","dashboardContainerService","chartComments",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b){a.menuCategories=b.data;var c=b.data.defaultId;a.reorderPermission=b.data.reorderPermission;var f=d.id||s||c;d.id||e.path("/dashboard/"+f),a.menuCategories&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.open=!0,a.active=!0,b.active=!0)})})}function o(){a.routeChangeSuccess&&a.getMenusData&&(console.log("##### dashboard data"),n(a.getMenusData),l.render())}function p(){$(".ui.modal#edit-menus").modal("show"),$(".ui.modal#edit-menus input[type=text]").off("keyup"),$(".ui.modal#edit-menus input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#edit-menus .ui.button.btn-primary").click()})}function q(){$(".ui.modal#edit-menus").modal("hide")}function r(){var b=$(window).width()<=723,c=$(".side-menu");b||a.isFullscreen?($(".toc-toggle").show(),c.removeClass("my-fix no-padd no-margin"),c.addClass("sidebar right  menu fixed vertical"),$(".main-container").addClass("mobile")):($(".toc-toggle").hide(),c.addClass("my-fix no-padd no-margin"),c.removeClass("sidebar right  menu fixed vertical"),$(".main-container").removeClass("mobile")),b?$(".full-screen-toggle").hide():$(".full-screen-toggle").show()}a.mainMenuType=2,h.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),g.init(),a.$watch("visible",function(b){b||(a.formId=0,a.rowId=0)}),a.hideForm=function(){a.visible=!1},a.formInfo={modalSettings:{closable:!1,onVisible:function(){}}},$("body").on("open-form",function(b,c,d,e){f(function(){a.formId=c,a.rowId=d,f(function(){a.visible=!0},400)},0)}),$("body").on("form-widget-add",function(b,c){f(function(){var b=$("div[data-type=form][data-id="+c+"] .form-content");b.html('<div class="" sadaf-form id="'+c+'" ></div>'),j(b)(a)},0)}),$("body").on("delete-form",function(b,d,e){console.log("on ","delete-form",d),f(function(){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("آیا فرم از صفحه حذف شود؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف..."),k.deleteFormFromDashboard(e,[d]).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),q();var c=$("div[data-type=form][data-id="+d+"]");dashboard.gs.remove_widget(c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},0)}),$("body").on("show-chart-comments",function(b,c){console.log("show-chart-comments",c),f(function(){a.comment={value:null,ok:function(){var b=app.chartCommons.getFilterParameter(c.chartInPageId,c.input.RefreshDatasource);m.save(0,{chartId:c.chartId,dashboardId:c.dashboardId,datasourceId:c.datasourceId,dimention:c.dimention,input:JSON.stringify(c.input),drillDown:b.drillDown,otherFilters:b.otherFilters,userControlFilter:b.userControlFilter,userVariable:b.userVariable,where:c.where,comment:a.comment.value}).then(function(a){console.log(a)}),$(".ui.modal#input-comments").modal("hide")}},$(".ui.modal#input-comments").modal("show"),$(".ui.modal#input-comments input[type=text]").off("keyup"),$(".ui.modal#input-comments input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#input-comments .ui.button.btn-primary").click()})},0)}),i.$on("permission-change",function(b,c){a.hasEditPermission=c;var d="visible"==$(".dashboard-edit-panel").css("visibility");c&&!d&&$(".dashboard-edit-panel").transition("fade left in"),!c&&d&&$(".dashboard-edit-panel").transition("fade right out")}),a.$on("ngRepeatFinished",function(){$(".side-menu .ui.dropdown").lazyDropdown({onShow:function(){$(this).parents(".side-menu-item").addClass("show-dropdown")},onHide:function(){$(this).parents(".side-menu-item").removeClass("show-dropdown")}})});var s=+localStorage.getItem("defaultDashboard");app.mobileMode||(a.$on("$routeChangeSuccess",function(){a.routeChangeSuccess=!0,o()}),b.get(app.urlPrefix+"menu/MenuCategories/1").then(function(b){a.getMenusData=b,o()},function(a){a&&a.data&&a.data.forceSignout&&(alert("مجوز برنامه مشکل دارد."),window.location.href=app.urlPrefix+"account/logoff")})),a.sortableOptions={disabled:!a.editMode,stop:function(c,d){f(function(){a.isDrag=!1;var c=$(d.item).parents(".menu-category").data("id"),e=$(d.item).data("id"),f=$(d.item).parents(".menu-category").find(".dashboard-menu").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"menu/ChangeMenuOrder",{list:f,menuId:e,parentCategoryId:c}).then(null,function(a){alert(a.data.title+" - "+a.data.desc)})},0)},connectWith:".connected-sortable"},a.sortableCatOptions={disabled:!a.editMode,stop:function(a,c){f(function(){var a=$(".menu-category").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"menu/ChangeMenuCategoryOrder",{list:a})},0)}},a.clearActive=function(){a.menuCategories&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1,_.each(a.menus,function(a){a.active=!1})})},a.closeAll=function(b){var c=b.open;a.menuCategories&&!a.editMode&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1}),b.open=!c,b.active=!c},a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode,$("div[ui-sortable=sortableOptions]").sortable("option","disabled",!a.editMode),$("div[ui-sortable=sortableCatOptions]").sortable("option","disabled",!a.editMode),a.editMode?$(".icon.sort").transition("set looping").transition("pulse"):$(".icon.sort").transition("remove looping")},a.isFullscreen=$("#isFullscreen").val(),a.fullscreenToggle=function(){a.isFullscreen=!a.isFullscreen,r(),dashboard.resize(),b.get(app.urlPrefix+"api/users/toogleFullscreen?isFullScreen="+a.isFullscreen)},a.$on("$locationChangeStart",function(b,c,d){if(/\/dashboard\/\d+/.test(e.path())){var f=+e.path().replace(/\/dashboard\/(\d+)/gi,"$1");a.clearActive(),a.menuCategories&&a.menuCategories.data&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.active=!0,a.open=!0,b.active=!0)})})}}),a.modal={body:c.trustAsHtml(""),btnClass:"btn-primary",btnText:"ذخیره",inProgress:!1},a.addFormSettings={},a.onFormSelect=function(b){a.addFormSettings.loaging=!0,k.addFormToDashboard(dashboard.pageId,b.map(function(a){return a.id})).then(function(c){a.addFormSettings.loaging=!1,a.addFormSettings.visible=!1,_.each(b,function(a){var b=_.extend({},a);b.type="form",console.log(b),dashboard.charts.push(b),dashboard.addChart(b)})})},a.hideModal=function(){q()},a.addMenuToCategory=function(d){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var f=app.urlPrefix+"Charts/DashboardPage/addMenu";b.post(f,{menuName:a.modal.val,menuCategory:d.category.Id,mainMenu:1,menulink:""}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),$("#dashboard-page-modal").modal("hide"),d.menus=d.menus||[],d.menus.push(b.data),e.path("/dashboard/"+b.data.menu.Id),q()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.editCategory=function(d){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,label:app.lang.translate("نام جدید را وارد کنید"),val:d.category.Name,ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var e=app.urlPrefix+"Charts/DashboardPage/editMenu";b.post(e,{menuName:a.modal.val,menuCategory:d.category.Id,mainMenu:1}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),d.category.Name=b.data.Name,q()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.deleteCategory=function(d,e){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، گروه <b>"+d.category.Name+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال حذف...");var f=app.urlPrefix+"Charts/DashboardPage/deleteMenu";b.post(f,{menuCategory:d.category.Id}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),a.menuCategories.data.splice(e,1),q()},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.editMenu=function(d,e){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,val:d.menu.Name,label:app.lang.translate("نام جدید را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var e=app.urlPrefix+"Charts/DashboardPage/editMenu";b.post(e,{menuName:a.modal.val,menuId:d.menu.Id}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),d.menu.Name=b.data.Name,q()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.deleteMenu=function(d,f,g){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، منوی <b>"+d.menu.Name+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف...");var h=app.urlPrefix+"Charts/DashboardPage/deleteMenu";b.post(h,{menuId:d.menu.Id}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),f.menus.splice(g,1),q();var c=$(".side-menu-item-child").data("id");e.path("/dashboard/"+c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.duplicateMenu=function(a,c){b.post(app.urlPrefix+"menu/DuplicateMenu",{Id:a.menu.Id}).then(function(a){c.menus=c.menus||[],c.menus.push(a.data.item),q()},function(a){alert(a.data)})},a.addCat=function(){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var d=app.urlPrefix+"Charts/DashboardPage/addMenu";b.post(d,{menuName:a.modal.val,mainMenu:1}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,$("#dashboard-page-modal").modal("hide"),a.menuCategories=a.menuCategories||{},a.menuCategories.data=a.menuCategories.data||[];var c={category:{Id:b.data.menu.Id,MainMenuId:b.data.menu.MainMenuId,Name:b.data.menu.Name,Type:b.data.menu.Type},hasAddPer:!0,hasDeletePer:!0,hasEditPer:!0,open:!0,menus:[]};a.menuCategories.data.push(c),q()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},p()},a.closeSidebar=function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("hide")},a.cancelRequests=function(){for($(".chart-data").each(function(){var a=$(this).data("ajaxRequest");a&&a.abort()});dashboard.addTasks.length;){var a=dashboard.addTasks.pop();clearTimeout(a)}},$(".toc-toggle").on("click",function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("toggle")}),$(window).resize(function(){r()}),r()}]),ngApp.service("dashboardContainerService",function(){function a(){$(window).width()<768?(dashboard.media=1,dashboard.maxCols=1):$(window).width()<992?(dashboard.media=2,dashboard.maxCols=1):$(window).width()<1200?(dashboard.media=3,dashboard.maxCols=12):(dashboard.media=4,dashboard.maxCols=12);try{var a=dashboard.getPagePosition();dashboard.maxCols=a&&a.length&&a[0].maxCol||12}catch(b){Error(b)}$("#dashboard-col").val(dashboard.maxCols),$("#device-selector .icon").removeClass("active"),$($("#device-selector .icon").get(4-dashboard.media)).addClass("active")}function b(){function b(a,b){if(dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.pageInfo.layout.filter(function(b){return+b.media==+a});c.length>0&&(c[0].maxCol=b)}}e=!0,a(),app.lestenWindowResize(function(){0!=$("#dashboard-chart-panel").length&&(a(),fixLayout(!1))}),$(".dashboard-page-header .add-chart-btn").on("click",function(){app.packages.view.selectPackage(app.packages.controller.scopes.CHARTS,function(a,b){var a=a||[];a.forEach(function(a){var c=app.urlPrefix+"api/dashboards/addChartToPage";b.setLoading(),$.get(c,{chartId:a,pageId:dashboard.pageId},function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1),b.hide()})})},!0)}),$("#dashboard-col").on("change",function(){dashboard.maxCols=+$(this).val()||dashboard.maxCols,dashboard.resize(dashboard.arrangePer),dashboard.saveSerialize(),b(dashboard.media,dashboard.maxCols)});$("#device-selector .icon").on("click",function(a){console.log("#### on click device-selector .icon");var b=$(this);if($("#device-selector .icon").removeClass("active"),b.addClass("active"),dashboard.media=4-b.index(),dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.getPagePosition();dashboard.maxCols=c.length>0&&c[0].maxCol?c[0].maxCol:4==dashboard.media||3==dashboard.media?12:1,$("#dashboard-col").val(dashboard.maxCols),dashboard.resize(dashboard.arrangePer)}});var f=null,g=$('<div class="copy-handler"></div>').css("position","fixed").css("display","none");$("body").append(g),$("#device-selector .icon").mousedown(function(a){var b=a.currentTarget;f=$(b).attr("id"),g.show(),setTimeout(function(){f=null},3e3)}),$("#device-selector .icon").mouseup(function(a){var b=a.currentTarget;if(target=$(b).attr("id"),null!=f&&f!=target){var c=function(a){return"laptop"==a?4:"tablet"==a?3:"smartphone-land"==a?2:1},d=dashboard.pageInfo.layout.indexOf(dashboard.pageInfo.layout.filter(function(a){return a.media==+c(target)})[0]),e=$.extend({},dashboard.pageInfo.layout.filter(function(a){return a.media==+c(f)})[0]);e.media=+c(target),dashboard.pageInfo.layout.splice(d,1,e);var g=dashboard.media;dashboard.media=e.media,dashboard.saveSerialize(),dashboard.media=g,f=null,alert("cope done!")}}),$(".freeze-menu").on("hide.bs.collapse",function(){$(".freeze-menu").addClass("hide-aff")}).on("show.bs.collapse",function(){$(".freeze-menu").removeClass("hide-aff")}),$(".freeze-menu").on("affixed.bs.affix",function(){$(".freeze-menu.affix").css("width",$("#content_segment").width()+"px")}),d&&c(d)}function c(a){return e?void a():void(d=a)}var d,e=!1;return{renderBody:c,render:b,setScreen:a}}),ngApp.controller("dashboardPageBodyCtrl",["$scope","$http","$sce","$routeParams","navbar","$rootScope","$timeout","drawer","$q","$rootScope","dashboardContainerService",function(a,b,c,d,e,f,g,h,i,f,j){function k(){console.log("##### renderBody"),a.progress=!0,b({method:"GET",url:m,timeout:dashboard.canceler.promise}).then(function(b){a.progress=!1,f.$broadcast("app-filterbox-refresh");var c=$(window).width()<=723,d=!c&&b.data.arrangePer;l(b.data,d);var g=e.getOption();g||(g={onDesignClick:function(){$(".dashboard-page-header").collapse("toggle")},onFullScreenClick:function(){var a=e.getOption();a.isFullscreen=!a.isFullscreen,a.isFullscreen?($(".side-menu").hide(),$(".contain-body").removeClass("col-md-10"),$(".contain-body").addClass("col-md-12")):($(".side-menu").show(),$(".contain-body").removeClass("col-md-12"),$(".contain-body").addClass("col-md-10"),a.sliding&&(a.sliding=!a.sliding,app.autoPlay("stop"))),"undefined"!=typeof fixLayout&&fixLayout()},onSlideShowClick:function(){var a=e.getOption();a.sliding=!a.sliding,a.sliding?app.autoPlay("start",10):app.autoPlay("stop")},onPrintClick:function(){app.print.printPage()}}),g.canDesign=d,e.setOption(g),f.$broadcast("permission-change",d),b.data.ForceChangePass&&$(".ui.modal#change-pass").modal("setting","closable",!1).modal("show")},function(){a.progress=!1,$("#no-page-message").transition("in scale")})}function l(a,b){$("body").removeClass("full-height-container"),$(".main-container").addClass("full-height-container"),app.chartCommons.userFilter.setUserControlFilters(a.userControlFilters),app.chartCommons.drillDown.clearAll(),dashboard.setInfo(a.charts,a.pageInfo,a.pageId,b,a.forms),app.dashboardLayoutVersion=2;app.urlPrefix+"charts/dashboardpage/setchartsorder";app.moderation.dashboadpage.isRelated=!1,fixLayout(!0)}h.close(),a.model="param: "+d.id;var m=app.urlPrefix+"api/dashboards/get/"+d.id;dashboard.canceler&&dashboard.canceler.resolve("http call aborted"),dashboard.canceler=i.defer(),j.renderBody(k)}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/dashboard/:id",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardBody.html",controller:"dashboardPageBodyCtrl"})}]),jQuery.fn.createModal=function(a){$el=$(this),0==$el.length&&($el=$("#content_segmentModal")),$el.find("#"+a.id).remove();var b="undefined"!=typeof a.okId?' id="'+a.okId+'" ':"",c="undefined"!=typeof a.okFun?' onclick="'+a.okFun+'" ':"";"undefined"!=typeof a.okFunObj&&(c="");var d=' <div class="modal '+("undefined"==typeof a.Fade||a.Fade?"fade":"")+'" id="'+a.id+'" tabindex="-1" role="dialog" aria-labelledby="'+a.id+'Label" aria-hidden="true">          <div class="modal-dialog">                                                                                                       <div class="modal-content">                                                                                                      <div class="modal-header">                                                                                                       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                                 <h4 class="modal-title">'+a.title+'</h4>                                                                       </div>                                                                                                                       <div class="modal-body">                                                                                                         '+a.body+'                                                                                                     </div>                                                                                                                       <div class="modal-footer">                                                                                                      '+("undefined"!=typeof a.cancelText?' <button type="button" class="btn btn-default" data-dismiss="modal" >'+a.cancelText+"</button>":"")+"                        "+("undefined"!=typeof a.okText?'<button type="button" class="btn '+a.okClass+' okbtn" data-dismiss="modal" '+c+b+">"+a.okText+"</button>":"")+"</div>                                                                                                                   </div>                                                                                                                       <!-- /.modal-content -->                                                                                                 </div>                                                                                                                       <!-- /.modal-dialog -->                                                                                                  </div>                                                                                                                       <!-- /.modal -->                                                                                                                     ",e=$(d);e.appendTo($el),"undefined"!=typeof a.okFunObj&&e.find(".okbtn").on("click",function(){a.okFunObj()}),"undefined"==typeof a.id||"undefined"!=typeof a.onKey&&!a.onKey||($("#"+a.id).on("keypress",function(b){13===b.keyCode&&(b.preventDefault(),$("#"+a.id+" .okbtn").click())}),$("#"+a.id).on("shown.bs.modal",function(){$("#"+a.id+" input").first().focus()}))},app=app||{},app.globalVariableHelper={},app.globalVariableHelper.updateGlobalVariables=function(a,b,c){return},app.globalVariableHelper.createModalRow=function(a){var b=$(app.globalVariableHelper.addModalRow);return a&&b.find(".default-value").val(a),b.find(".btn-plus").on("click",function(){var a=app.globalVariableHelper.createModalRow(this);$(this).parents(".form-group").after(a)}),b.find(".btn-minus").on("click",function(){$(this).parents(".form-group").remove()}),b},app.globalVariableHelper.AddGlobalVariables=function(a){var b=$(app.globalVariableHelper.addModal);$("#gb-modal").remove(),b.find(".row-container").append(app.globalVariableHelper.createModalRow()),app.contentSegmentModal.append(b),$("#gb-modal .btn-primary").on("click",function(){var b={Name:$("#gb-modal input.name").val(),Scope:$("#gb-modal select.scope").val(),DefaultValue:$("#gb-modal input.default-value").map(function(){return $(this).val()}).toArray()};$.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/Add",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(b){b.result?a(b):alert(b.Message)}})}),$("#gb-modal").modal("show")},app.globalVariableHelper.EditGlobalVariables=function(a,b){var c=$(app.globalVariableHelper.addModal);$("#gb-modal").remove(),c.find("input.name").val(a.Name),c.find("select.scope").val(a.Scope),c.find(".btn-primary").text("تغییر");var d=JSON.parse(a.DefaultValue||'[""]');d&&0!=d.length||(d=[""]),d.forEach(function(a){var b=app.globalVariableHelper.createModalRow(a);c.find(".row-container").append(b)}),app.contentSegmentModal.append(c),$("#gb-modal .btn-primary").on("click",function(){var c={Id:a.Id,Name:$("#gb-modal input.name").val(),Scope:$("#gb-modal select.scope").val(),DefaultValue:$("#gb-modal input.default-value").map(function(){return $(this).val()}).toArray()};$.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/Add",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(c),success:function(a){a.result?b(a):alert(a.Message)}})}),$("#gb-modal").modal("show")},app.globalVariableHelper.addModal='<div class="modal fade" id="gb-modal" tabindex="-1" role="dialog" aria-labelledby="gb-modal-label" aria-hidden="true                style="font-size: 14px; text-align: justify;">                <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">                            <span aria-hidden="true">&times;</span><span class="sr-only">بستن</span></button>                        <h4 class="modal-title" id="gb-modal-label">ساخت متغیر سراسری</h4>                    </div>                <div class="modal-body">                    <p>                        این متغیر برای تمامی کاربران قابل اعمال است.                                        .نام متغیر نباید شامل علامت باشد و باید ترکیبی از حروف و اعداد باشد                    </p>                    <div class="form-horizontal">                        <div class="form-group">                            <label class="col-sm-4" style="font-weight: bold;">نام متغیر: </label>                            <div class="col-sm-8">                                <input type="text" class="form-control name" placeholder="نام متغیر" />                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-4" style="font-weight: bold;">حوزه اعتبار: </label>                            <div class="col-sm-8">                                <select class="form-control scope" >                                <option value="0">تمام صفحات</option>                                <option value="1" selected="selected">صفحه جاری</option>                                </select>                            </div>                        </div>                        <div class="row-container"></div>                    </div>                                          </div>                                                                                                                                                   <div class="modal-footer">                    <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>                    <button type="button" class="btn btn-primary" data-dismiss="modal">ساختن</button>                </div>            </div>        </div>    </div>',
app.globalVariableHelper.addModalRow='            <div class="form-group modal-row">                <label class="col-sm-4" style="font-weight: bold;">مقدار پیش‌فرض: </label>                <div class="col-sm-5">                    <input type="text" class="form-control default-value" placeholder="مقدار پیش‌فرض" />                </div>                <div class="col-md-3">                    <div class="btn-group btn-group-justified">                        <a type="button" class="btn btn-default btn-plus"><span class="glyphicon glyphicon-plus"></span></a>                        <a type="button" class="btn btn-default btn-minus"><span class="glyphicon glyphicon-minus"></span></a>                    </div>                </div>            </div>';var app=app||{};app.packages={},app.packages.controller={scopes:{CHARTS:1,DATASOURCES:2},add:function(a,b,c,d,e){$.ajax({url:app.urlPrefix+"Moderation/Package/Create",data:JSON.stringify({name:a,scope:b,parentId:d,permissions:c,isEdit:isEdit}),type:"POST",dataType:"json",contentType:"application/json",traditional:!0,success:function(a){a.result?e&&e():alert(a.message)}})},getRoles:function(a){app.post(app.urlPrefix+"Moderation/Package/GetRoles",null,a)}},app.packages.view={createPackage:function(a,b,c){var d=$(app.packages.view.createModal);app.contentSegmentModal.append(d),d.modal("show"),d.on("shown.bs.modal",function(){d.find("#name").focus()}),d.find("#name").keyup(function(a){13==a.keyCode&&d.find(".btn-primary").click()}),d.find(".btn-primary").addClass("disabled"),app.packages.controller.getRoles(function(e){var f=e.roles||[];d.find(".btn-primary").removeClass("disabled");var g="<h3>نقش‌ها</h3><form id='packages-permission' style='height: 180px; overflow-y: scroll;'> <table class='table table-hover '>";f.forEach(function(a){g+="<tr>           <td>                                                                                                                                     <label style='font-weight: normal; font-size: 1em;'>                                                                                     <input type='checkbox' name='Roles' value='"+a.Id+"' >                                                                          "+a.RoleName+"                                                                                                              </label>                                                                                                                         </td>                                                                                                                                <td>                                                                                                                                     <select class='form-control' name='ChartActions'>                                                                                        <option value='1-"+a.Id+"' >مشاهده</option>                                        <option value='2-"+a.Id+"'>مشاهده و ویرایش</option>                               <option value='4-"+a.Id+"' >مشاهده، ویرایش و حذف</option>                   </select>                                                                                                                        </td>                                                                                                                            </tr>"}),g+="</form>",d.find("#progress").hide(),d.find(".modal-body").append(g),app.packages.view.showPermissionChoise("#package-modal .modal-body"),d.find(".btn-primary").on("click",function(){var e=d.find("#packages-permission").serializeArray();e&&(e=e.filter(function(a){return"ChartActions"==a.name}).map(function(a){return a.value})),$(this).button("loading");var f=d.find("#name").val();app.post(app.urlPrefix+"Moderation/Package/Create",{name:f,scope:a,parentId:b,permissions:e},function(a){d.find(".btn-primary").button("reset"),d.modal("hide"),c(a)})})})},editPackage:function(a,b){var c=$(app.packages.view.createModal);app.contentSegmentModal.append(c),c.modal("show"),c.on("shown.bs.modal",function(){c.find("#name").focus();var a=c.find("#name").val().length;c.find("#name").get(0).setSelectionRange(a,a)}),c.find("#name").keyup(function(a){13==a.keyCode&&c.find(".btn-primary").click()}),c.find(".btn-primary").addClass("disabled"),c.find(".btn-primary").html("ویرایش"),app.post(app.urlPrefix+"Moderation/Package/GetInfo",{id:a},function(d){var e=d.roles||[];c.find(".btn-primary").removeClass("disabled");var f="<h3>نقش‌ها</h3><form id='packages-permission' style='height: 180px; overflow-y: scroll;'> <table class='table table-hover '>";if(e.forEach(function(a){f+="<tr>           <td>                                                                                                                                     <label style='font-weight: normal; font-size: 1em;'>                                                                                     <input type='checkbox' name='Roles' value='"+a.Id+"' >                                                                          "+a.RoleName+"                                                                                                              </label>                                                                                                                         </td>                                                                                                                                <td>                                                                                                                                     <select class='form-control' name='ChartActions'>                                                                                        <option value='1-"+a.Id+"' >مشاهده</option>                                        <option value='2-"+a.Id+"'>مشاهده و ویرایش</option>                               <option value='4-"+a.Id+"' >مشاهده، ویرایش و حذف</option>                   </select>                                                                                                                        </td>                                                                                                                            </tr>"}),f+="</form>",c.find("#progress").hide(),c.find(".modal-body").append(f),app.packages.view.showPermissionChoise("#package-modal .modal-body"),d.info&&d.info.actions){var g=d.info.actions||[];g.forEach(function(a){c.find("option[value="+a.Action+"-"+a.RoleId+"]").attr("selected","selected").parents("tr").find("input").click()})}c.find("#name").val(d.info.Name),c.find(".btn-primary").on("click",function(){var d=c.find("#packages-permission").serializeArray();d&&(d=d.filter(function(a){return"ChartActions"==a.name}).map(function(a){return a.value}));var e=c.find("#name").val();c.find(".btn-primary").data("loading-text","در حال تغییر"),c.find(".btn-primary").button("loading"),app.post(app.urlPrefix+"Moderation/Package/Edit",{id:a,name:e,permissions:d},function(a){c.find(".btn-primary").button("reset"),c.modal("hide"),b(a)})})})},showPermissionChoise:function(a){function b(a,b){a?b.find("select").css("visibility","visible").attr("disabled",null):b.find("select").css("visibility","hidden").attr("disabled","")}$(a+" tr input").each(function(){b($(this).prop("checked"),$(this).closest("tr"))}),$(a+" tr input").change(function(){b(this.checked,$(this).closest("tr"))}),$(a+" table thead input").change(function(){var a=this.checked;$(this).closest("table").find("tr input").each(function(){$(this).prop("checked",a),b(this.checked,$(this).closest("tr"))})})},selectPackage:function(a,b,c){var d=$(app.packages.view.selectPackageModal);$("body #package-modal").remove(),$("body").append(d),d.modal("show"),app.post(app.urlPrefix+"Moderation/Package/GetPackages",{scope:a,withContent:c},function(a){d.find("#progress").hide(),d.find(".content").html(a.packages),d.find(".content>ul").css("direction","ltr"),d.find(".content>ul").selectable({filter:".select-package",selecting:function(a,b){!c&&d.find(".ui-selected, .ui-selecting").length>1&&$(b.selecting).removeClass("ui-selecting")}}),d.find(".content>ul").treeview({animated:"fast",collapsed:!0,toggle:function(){}}),d.find(".btn-primary").on("click",function(){var a=d.find(".ui-selected"),c=a.map(function(a){return $(this).data("id")}).toArray();b&&b(c,{hide:function(){d.modal("hide")},setLoading:function(){d.find(".btn-primary").addClass("loading")}})})})},createModal:'<div class="modal fade" id="package-modal" tabindex="-1" role="dialog" aria-labelledby="gb-modal-label" aria-hidden="true                style="font-size: 14px; text-align: justify;">                <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">                            <span aria-hidden="true">&times;</span><span class="sr-only">بستن</span></button>                        <h4 class="modal-title" id="gb-modal-label">ساخت پوشه جدید</h4>                    </div>                <div class="modal-body" >                    <div class="form-group">                        <label for="chartTitleFarsi" class="col-md-4 control-label">نام پوشه:</label>                        <div class="col-md-8" style="margin-bottom: 30px;"><input id="name" class="form-control"placeholder="نام پوشه" /></div>                    </div>                    <div id="progress" >                        <img style="width: 1.3em" src="'+app.urlPrefix+'Images/progress.gif" />                        در حال بارگذاری . . .                    </div>                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-default" data-dismiss="modal">انصراف</button>                    <button type="button" class="btn btn-primary" data-loading-text="در حال ساختن...">ساختن</button>                </div>            </div>        </div>    </div>',selectPackageModal:'<div class="ui modal small" id="package-modal">    <i class="close icon"></i>    <div class="header">فیلتر کردن مقادیر</div>    <div class="content" style="height: 180px; overflow-y: scroll;">        <div class="ui active inverted dimmer"><div class="ui text loader">در حال بارگذاری</div></div></div>    <div class="actions">        <button type="button" class="ui button deny black" >انصراف</button>        <button type="button" class="ui button green btn-primary" >انتخاب</button>    </div></div>'},$.fn.tableSortable=function(a){var b=$(this);b.find("th").addClass("pointer").on("click",function(c,d){var d=$(this).index()+1,e=b.find("tbody tr");a&&(e=e.not(a));var f=$(this).data("isdesc");"undefined"==typeof f&&(f=!0),$(this).data("isdesc",!f),e.sort(function(a,b){var c=depersian($(a).find("td:nth-child("+d+")").text()),e=depersian($(b).find("td:nth-child("+d+")").text());return f?/^[0-9.]+$/.test(c)?d3.descending(+c,+e):d3.descending(c,e):/^[0-9.]+$/.test(c)?d3.ascending(+c,+e):d3.ascending(c,e)}),e.remove(),b.append(e)})},$.fn.tableBindSearchbox=function(a,b){var c=$(this),a=a instanceof $?a:$(a);a.keyup(function(){var a=$(this).val(),d=c.find("tbody tr");b&&(d=d.not(b)),d.each(function(){-1==$(this).text().toLocaleLowerCase().indexOf(a.toLocaleLowerCase())?$(this).hide():$(this).show()})})},jQuery.fn.progressbar=function(a,b){function c(){var a=d3.interpolate(0,h);return function(b){return j.endAngle(a(b))()}}if("stop"==a)return void d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var d=+a||25,e=d/5,f=2*d,g=2*d,h=2*Math.PI,i=+b||1e4,j=d3.svg.arc().startAngle(0).innerRadius(d-e).outerRadius(d);d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var k=d3.select($(this).get(0)).append("svg").attr("width",f).attr("height",g).attr("class","sadaf-circular-timeout").append("g").attr("transform","translate("+f/2+","+g/2+")"),l=k.append("g").attr("class","progress-meter");l.append("path").attr("class","background").style("fill","#eee").style("opacity","0.2").attr("d",j.endAngle(h));var m=l.append("path").style("fill","#ccc").attr("class","foreground");m.attr("d",j.endAngle(0*h)),m.transition().duration(i).attrTween("d",c)},$.extend($.datepicker,{_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+(c?0:$(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:$(document).scrollTop());return b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0),b.top<50&&(b.top=55),b}});var app=app||{};app.escapeBraket=function(a){return a.replace("[","\\\\[").replace("]","\\\\]")};
//# sourceMappingURL=dashboard-app-theme2.js.map