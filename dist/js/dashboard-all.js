/* داشبورد مدیریت صدف 
 sadafdashboard.ir 


*/
// داشبورد مدیریتی صدف info@sadafdashboard.ir 

function prepareData(a,b){for(var c=[],d=(a.matrix||[],0);d<a.matrix.length;d++){var e={};e.index=d,e.label=a.matrix[d].captions,e.onClickVal=a.matrix[d].canDrill?a.matrix[d].values:"",e.canDrill=a.matrix[d].canDrill,e.value=a.matrix[d].values,e.kpis=a.kpis.data[d],e.series=a.series.data[d];var f=[];if(e.kpis)for(var g=0;g<e.kpis.length;g++){for(var h=[],i=0;i<e.kpis[g].length;i++)""===e.kpis[g][i]?h.push(e.kpis[g][i]):h.push(parseFloat(e.kpis[g][i])||0);f.push(h)}e.kpis=f,f=[];for(var g=0;g<e.series.length;g++)""===e.series[g]||null===e.series[g]||isNaN(e.series[g])?f.push(e.series[g]):f.push(parseFloat(e.series[g])||0);e.series=f,c.push(e)}return c}function persian(a,b){if(null==a)return a;if("undefined"==typeof b&&(b=app.lang.isRtl()),!b)return a;var c={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"};return a+="",a.replace(/(\d)/g,function(a,b){return c[b]||a})}function depersian(a){var b={"۰":0,"۱":1,"۲":2,"۳":3,"۴":4,"۵":5,"۶":6,"۷":7,"۸":8,"۹":9};return a+="",a.replace(/([۰۱۲۳۴۵۶۷۸۹])/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function normilize(a){var b={"ي":"ی","إ":"ا","ؤ":"و","أ":"ا","آ":"ا","ک":"ك"};return a+="",a.replace(/(.)/g,function(a,c){return b[c]||a})}var app=app||{};app.chartCommons={},app.chartCommons.tooltip={tooltipFormatter:function(set,fh,f,showPersain){var body=set.points.map(function(point){var bodyFormat=f||'{{point.label}}: <p class="ltr inline" style="padding:0; margin:0;" ><b>{{point.data}}</b></p>';return bodyFormat.replace(/{{([^(}})]+)}}/gm,function(i,p1){if(!p1.match(/point\.(data|label|color|format|percentage)/))return p1;var e=eval(p1);return"NaN"===e&&(e="تعریف نشده"),isNaN(e)?e:persian(d3.format(point.format)(e),showPersain)})}).join("<br/>"),headerFormat=fh||"",header=headerFormat.replace(/{{([^(}})]+)}}/gm,function(i,p1){var e=eval(p1);return isNaN(e)||"set.key"==p1?e:persian(d3.format(set.format)(e),showPersain)});return header&&body.trim()&&(header+="<BR/>"),r='<div style="margin:0;text-align: right; padding:0;direction: rtl;">'+header+body+"</div>",r}},app.chartCommons.levelTypeUtils={getParam:function(a){if(!a.editMode&&a.chartProp.levelTypes&&a.chartProp.levelTypes.enable){var b=app.chartCommons.drillDown.get(a.ChartInPageId),c=b&&_.isArray(b.drillDown)?b.drillDown.length:0,d=Math.min(c,Object.keys(a.chartProp.levelTypes.props).length-1),e=a.chartProp.levelTypes.props[d];e.prop.levelTypes=_.merge({},a.chartProp.levelTypes),a.chartProp=e.prop,a.type=e.type}}},app.chartCommons.highchartSetTheme=function(){var a=d3.scale.category10();Highcharts.setOptions({lang:{loading:"در حال بارگذاری...",months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalPoint:".",numericSymbols:["k","M","G","T","P","E"],resetZoom:"حالت اولیه",resetZoomTitle:"حالت اولیه 1:1",thousandsSep:","},global:{useUTC:!0,canvasToolsURL:"http://code.highcharts.com/4.1.4/modules/canvas-tools.js",VMLRadialGradientURL:"http://code.highcharts.com/4.1.4/gfx/vml-radial-gradient.png"}}),Highcharts.theme={chart:{},xAxis:{title:{text:null,align:"middle"}},yAxis:{endOnTick:!1,title:{text:null,align:"middle"},labels:{formatter:function(){return persian(d3.format(",")(this.value))}},lineWidth:2,lineColor:"#D8D8D8",tickWidth:1},tooltip:{valueSuffix:"",useHTML:!0,formatter:function(){return"<b>"+this.x+"</b>: <b>"+this.series.tooltipOptions.pointFormatter(this)+"</b>"},headerFormat:"",style:{"text-align":"right"}},plotOptions:{bar:{dataLabels:{enabled:!0}},series:{animation:{duration:800,easing:"easeInCubic"},allowPointSelect:!0,fillOpacity:.1,marker:{fillColor:"#FFFFFF",lineWidth:2,lineColor:null}}},credits:{enabled:!1},colors:[1,2,3,4,5,6,7,8,9,10].map(function(b,c){return a(c)}),chart:{animation:{duration:400,easing:"linear"},panning:!0,panKey:"shift"},title:{text:null,style:{color:"#000",font:"bold 16px Droid, Tahoma, Arial"}},subtitle:{style:{color:"#666666",font:"bold 12px Droid, Tahoma, Arial"}},legend:{itemStyle:{font:"9pt Droid, Tahoma, Arial",color:"black"},itemHoverStyle:{color:"gray"}}},Highcharts.setOptions(Highcharts.theme)},app.chartCommons.getError=function(a){if(!a.result){var b=0==+a.errorType?"منبع داده غیر فعال است":"اشکال در پرس و جو";return"<div class='temporal error'> <h4>"+b+"</h4><p>"+a.errorMessage+"</p></div>"}return"<div class='temporal error'> مشکلی در روند برنام ایجاد شده است</div>"},app.chartCommons.clearFilterParamsCache=function(a){a||(a=JSON.parse(localStorage.getItem("filter-params")||"[]"));var b=(new Date).getTime()-864e5;_.remove(a,function(a){return a.time<b}),localStorage.setItem("filter-params",JSON.stringify(a))},app.chartCommons.openLink=function(a,b){if(a&&a.checked){if(a.type||(a.type="dashboard",a.dashboardId==-1&&(a.type="link")),app.mobileMode)return void JavaListener.post("open-dashboard",JSON.stringify(a));if("dashboard"==a.type){var c="";if("value-with-other"==a.passFilterType||"value"==a.passFilterType){if("value"==a.passFilterType&&(app.chartCommons.userFilter.clearAll(),app.chartCommons.drillDown.clearAll()),b){var d={id:-1,values:b.value,variableType:0,dimensionName:b.dimensionName,chartInPageId:b.ChartInPageId,datasourceId:b.DataSourceId,disableClear:!1,refreshDatasource:b.refreshDatasource};app.chartCommons.userFilter.setFilter(d)}b={drillDown:app.chartCommons.drillDown.filters,userFilter:app.chartCommons.userFilter.filters};var e=JSON.parse(localStorage.getItem("filter-params")||"[]");c="filter-"+md5(JSON.stringify(b)),_.remove(e,{key:c}),e.push({dash:a.dashboardId,key:c,data:b,time:(new Date).getTime()}),localStorage.setItem("filter-params",JSON.stringify(e))}var f=location.hash.replace(/.*app\/(\d+)\/dashboard.*/,"$1");location.hash="#/app/"+f+"/dashboard/"+a.dashboardId+(c?"/"+c:"")}if("back"==a.type&&window.history.back(),"link"==a.type){var g=window.open(a.link,"_blank");g?g.focus():alert("Please allow popups for this site")}}},app.chartCommons.calculateFields=function(series,calcFormulas,columnIsNumeric){function calc(item,series,columnIsNumeric){function getCell(a,b,c){return b=b<0?0:b>=a.length?a.length-1:b,c=c<0?0:c>=a[0].length?a[0].length-1:c,a[b][c]}if(series.labels.indexOf(item.name)==-1&&series.data instanceof Array){var isValid=/^({\s*r?([+-]?\d*)\s*,?\s*c?(\d*)}|[\d\s\+-\/\)\(\*]*|'[^']*')*$/gim.test(item.formula);if(!isValid)return void alert("### Not valid "+item.formula);for(var indexes=[],repFormula=item.formula.replace(/{\s*r?([\+-]?\d*)\s*,?\s*c?(\d*)}/gim,function(a,b,c){return indexes.push({row:+b,col:+c}),"$"+(indexes.length-1)}),i=0;i<series.data.length;i++){var rowFormula=repFormula.replace(/\$(\d+)/gim,function(a,b){var c=indexes[+b],d=getCell(series.data,c.row+i,c.col);return columnIsNumeric&&!columnIsNumeric[c.col]?"'"+d+"'":d||0});series.data[i].push(eval(rowFormula))}series.labels.push(item.name)}}return;var formulas},app.chartCommons.drillDown={filters:[],add:function(a,b,c,d,e){_.isArray(d)||(d=[d]),_.isArray(c)||(c=[c]),_.isArray(d)&&(d=JSON.stringify(d),c=JSON.stringify(c));var f=_.find(this.filters,{chartInPageId:a});if(_.isUndefined(f)){var g={chartInPageId:a,datasourceId:b,refreshDatasource:e,drillDown:[{key:c,value:d}]};return this.filters.push(g),g.drillDown}var h=_.find(f.drillDown,{key:c});return _.isUndefined(h)||_.remove(f.drillDown,{key:c}),f.drillDown.push({key:c,value:d}),f.drillDown},up:function(a,b){var c=_.find(this.filters,{chartInPageId:a});if(_.isUndefined(c))return[];_.isUndefined(b)&&(b=1);for(var d=0;d<b;d++)c.drillDown.length>0&&c.drillDown.pop();return c.drillDown},get:function(a){return _.find(this.filters,{chartInPageId:a})},clear:function(a){return _.remove(this.filters,{chartInPageId:a})},clearAll:function(){this.filters=[]}},app.chartCommons.getFilterHierarchy=function(a,b){function c(a){if(_.isArray(a)){for(var b=0;b<a.length;b++){var c=a[b];"undefined"!=typeof c.Members&&c.Members&&(c.Members=c.Members.filter(function(a,b){return a.IsChecked}),c.FilteredMemberByUser=!0)}return a}}var b=$(".cid"+a+" .chart-dimentions-content").data("data");return _.isUndefined(b)?null:{Hierarchies:c(b.Hierarchies),Where:c(b.Where),SeriesLevel:c(b.SeriesLevel)}},app.chartCommons.userFilter={filters:[],clearAll:function(){this.filters=[]},setUserControlFilters:function(a){this.filters=[],_.isArray(a)&&(this.filters=a)},setFilter:function(a){if(0==this.filters.length)return void this.filters.push(a);var b=_.find(this.filters,{chartInPageId:a.chartInPageId,dimensionName:a.dimensionName});_.isUndefined(b)||_.remove(this.filters,{chartInPageId:a.chartInPageId,dimensionName:a.dimensionName}),this.filters.push(a)},setFilterIfNotExist:function(a){if(!(_.isEmpty(a.values)||_.isArray(a.values)&&0==a.values.length)){if(0==this.filters.length)return void this.filters.push(a);var b=_.find(this.filters,{chartInPageId:a.chartInPageId});_.isUndefined(b)&&this.filters.push(a)}},getFilterValue:function(a){var b=_.find(this.filters,{chartInPageId:a});return _.isUndefined(b)?null:b}},app.chartCommons.lastRefreshDateFormat=function(a){if(!a)return"";if(0!=app.lang.langType)return a.D+"/"+a.M+"/"+a.Y+" - "+a.h+":"+a.m+":"+a.s+" ";var b="";a.Diff&&a.Diff<86400&&(b+=" - <b>",b+=a.Diff<60?Math.floor(a.Diff)+" ثانیه پیش":a.Diff<3600?Math.floor(a.Diff/60)+" دقیقه پیش":Math.floor(a.Diff/3600)+" ساعت پیش",b+="</b>");var c=1==+a.M?"فروردین":2==+a.M?"اردیبهشت":3==+a.M?"خرداد":4==+a.M?"تیر":5==+a.M?"مرداد":6==+a.M?"شهریور":7==+a.M?"مهر":8==+a.M?"آبان":9==+a.M?"آذر":10==+a.M?"دی":11==+a.M?"بهمن":"اسفند";return persian(a.D+" "+c+" ماه "+a.Y+" ساعت "+a.h+":"+a.m+":"+a.s+" "+b,!0)},app.chartCommons.setFilterParameter=function(a){var b=a.input&&a.input.RefreshDatasource?a.input.RefreshDatasource:null,c=app.chartCommons.getFilterParameter(a.ChartInPageId,b);a.parameters.drillDown=c.drillDown,a.editMode||(a.parameters.otherFilters=c.otherFilters,a.parameters.userControlFilter=c.userControlFilter,a.parameters.userVariable=c.userVariable)},app.chartCommons.getFilterParameter=function(a,b){var c={drillDown:null},d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:a});_.isUndefined(d)||(c.drillDown=d.drillDown),c.otherFilters=_.filter(app.chartCommons.drillDown.filters,function(c){if(!b)return!1;var d=b.indexOf(c.datasourceId)!=-1;return d&&c.chartInPageId!=a}),c.userControlFilter=$.extend([],_.filter(app.chartCommons.userFilter.filters,function(a){if(!b)return!1;var c=b.indexOf(a.datasourceId)!=-1;return c}));var e=JSON.parse(localStorage.getItem("userVariable"));return c.userVariable=e,c},app.chartCommons.expandedType=1,app.chartCommons.clicked=!1,app.chartCommons.changeSeriesPropertyBaseOnExpandedType=function(a,b){var c=app.chartCommons.expandedType;1===c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="1",a.info.stackedLine="1",a.info.isBox=!1),28===c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar")}),a.info.stackedBar="1",a.info.stackedLine="1",a.info.isBox=!0),2==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="2",a.info.isBox=!1,a.info.stackedLine="1"),21==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="bar",a.areaOpacity=.1)}),a.info.stackedBar="3",a.info.stackedLine="1",a.info.isBox=!1),3==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-dot-area",a.areaOpacity=.1)}),a.info.stackedBar="1",a.info.stackedLine="1",a.info.isBox=!1),4==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.areaOpacity=.1,a.lineType="line-dot-area",a.seriesType="line")}),a.info.stackedBar="1",a.info.stackedLine="2",a.info.isBox=!1),22==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.areaOpacity=.1,a.seriesType="line",a.lineType="line-dot-area")}),a.info.stackedBar="1",a.info.stackedLine="3",a.info.isBox=!1),5==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="1",a.info.isBox=!1),6==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="2",a.info.isBox=!1),23==c&&(_.each(a.series,function(a,c){b&&c!=b||(a.seriesType="line",a.lineType="line-area",a.areaOpacity=.4)}),a.info.stackedBar="1",a.info.stackedLine="3",a.info.isBox=!1),7==c&&(a.info.hole="0"),8==c&&(a.info.hole="50"),14==c&&(a.info.aggregation="-1"),13==c&&(a.info.aggregation="1"),15==c&&(a.info.type="combo"),16==c&&(a.info.type="multi"),17==c&&(a.info.type="datepicker"),18==c&&(a.info.type="datepicker-range"),19==c&&(a.info.type="slider"),20==c&&(a.info.type="text"),9==c&&(a.info.segmentType="singleSegment",a.info.style="arc"),24==c&&(a.info.segmentType="multiSegment",a.info.style="arc"),25==c&&(a.info.segmentType="singleSegment",a.info.style="horizontal"),26==c&&(a.info.segmentType="multiSegment",a.info.style="horizontal"),27==c&&(a.info.style="number",a.info.icons=a.info.icons||[{name:"icon warning"}],a.info.showLabels=!0)},app.chartCommons.setDefault=function(a,b,c){var d=d3.scaleOrdinal(d3.schemeCategory10);_.isUndefined(b)||_.each(b,function(b,e){var f=d(e),g=c;a.series=a.series||{};var h={bar:{seriesColor:f,seriesType:"bar",formatString:",.0f",numberFactor:"1",showValues:!1,hidden:!1,cumulative:!1,cumulative_formula:"sum",lineFace:"5,0",lineWeight:"2",lineStyle:"linear",lineType:"line-dot-area",showValueColor:"#333333",areaOpacity:.1,formatStringCustom:",.0f",font:{bold:!1,color:"#333333",italic:!1,fontSize:"11px",fontName:"IRANSans",formatString:",.3s",formatStringCustom:",.0f"},top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},map:{hidden:!1,formatString:",.0f",colorStart:"#31a354",colorEnd:"#c7e9c0",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},pie:{main:!0,numberFactor:"1",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},gauge:{type:"value",typeMs:"value",numberFactor:"1",top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},radar:{numberFactor:"1",seriesColor:f,top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},table:{numberFactor:"1",textAlign:"right",formatString:",.0f",fontSize:"1em",textItalic:!1,textBold:!1,color:"#000000",rowResult:"0",isHidden:!1,top:{IsTop:!1,Top:10,IsPercent:!1,TopOrder:"DESC"}},userControl:{numberFactor:"1",type:"value"},text:{}},i=!1;_.isUndefined(a.series[b])&&app.chartCommons.clicked===!0&&(i=!0,app.chartCommons.clicked=!1),a.series[b]=$.extend({},h[g],a.series[b]),i&&app.chartCommons.changeSeriesPropertyBaseOnExpandedType(a,b)})},app.chartCommons.commentUtils={getLabelsMeasures:function(a){var b=[],c=[],d=[];return a.matrix?(_.each(a.matrix,function(a){b.push(a.captions)}),_.each(a.series.labels,function(a){d.push(a)}),_.each(a.seriesLablesCaptions||a.series.labels,function(a){c.push(a)})):b=a.headers,{labels:b,measures:c,measuresKey:d}},getCommentCount:function(a,b,c){var d=b;return _.isArray(b)&&(d=_.sortBy(b).join(", ")),a.filter(function(a){return d==a.label&&a.measure==c}).length},getChartSelector:function(a){return".cid"+a},clickOnCommentIcon:function(a,b){$(app.chartCommons.commentUtils.getChartSelector(b)).trigger("new-comment",a);try{d3.event.preventDefault(),d3.event.stopPropagation()}catch(c){}},highlight:function(a,b){var c=!1;_.each(a,function(a){a instanceof jQuery?a.removeClass("selected"):a.classed("selected",!1)}),_.each(a,function(a){if(c)return!1;if(a instanceof jQuery){var d=$(a[0]).data("table-data");return void a.each(function(a,e){var f=$(e).data("xrow"),g=$(e).data("xcol"),a=d.rows[f][g];if(b.category==a.category&&b.seriesLable==a.seriesLable)return d3.select(this).classed("selected",!0),c=!0,!1})}a.each(function(a){if(b.category==a.category&&b.seriesLable==a.seriesLable)return d3.select(this).classed("selected",!0),c=!0,!1})})},setOnHighlightListener:function(a,b){var c=$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections")||[];c.push(a),$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections",c),$(app.chartCommons.commentUtils.getChartSelector(b)).off("highlight-element"),$(app.chartCommons.commentUtils.getChartSelector(b)).on("highlight-element",function(a,c){if(c){var d=$(app.chartCommons.commentUtils.getChartSelector(b)).data("collections")||[];app.chartCommons.commentUtils.highlight(d,c)}})},destroyListener:function(a){$(app.chartCommons.commentUtils.getChartSelector(a)).data("collections",null)},addCommentIcon:function(a,b,c,d){if(app.commentOnChart){var e=$(app.chartCommons.commentUtils.getChartSelector(a)).find(".chart-data").data("settings");if(e.permissions.Comment){var f=b.append("g").attr("transform",function(a,b){return"translate("+c(a,b)+","+d(a,b)+")scale(0.38)"}).attr("class",function(a){return"comment"+(a.commentCount?" show":"")}).on("click",function(b){app.chartCommons.commentUtils.clickOnCommentIcon(b,a)}),g=f.append("rect");g.attrs({width:50,height:24,"class":"comment-background"}),f.append("path").attr("d","M10.718,18.561l6.78,5.311C17.609,23.957,17.677,24,17.743,24  c0.188,0,0.244-0.127,0.244-0.338v-5.023c0-0.355,0.233-0.637,0.548-0.637L21,18c2.219,0,3-1.094,3-2s0-13,0-14s-0.748-2-3.014-2  H2.989C0.802,0,0,0.969,0,2s0,13.031,0,14s0.828,2,3,2h6C9,18,10.255,18.035,10.718,18.561z"),f.append("text").text(function(a){return a.commentCount?persian(a.commentCount,!0):""}).attrs({x:34,y:"0.7em"}).styles({"font-size":"20px"})}}},updateIconCommentCount:function(a,b,c){function d(a){a.each(function(a){var d=_.sortBy(a.category).join(", ");a.seriesLable==b.measure&&d==b.label&&(d3.select(this).select("text").text(c?persian(c,!0):""),d3.select(this).classed("show",c>0))})}var e=$(app.chartCommons.commentUtils.getChartSelector(a)).data("collections")[0];if(e instanceof jQuery){var f=$(e[0]).data("table-data");return void e.each(function(){var d=$(this).data("xrow"),e=$(this).data("xcol"),g=f.rows[d][e],h=_.sortBy(g.category).join(", ");if(g.seriesLable==b.measure&&h==b.label){var i=$(app.chartCommons.commentUtils.getChartSelector(a)+" td[data-xcol="+e+"][data-xrow="+d+"]"),j=$(this).find(".comment"),k=i.find("svg:not(.td-comment) .comment");if(0==j.length){var l=$(app.chartCommons.commentUtils.getChartSelector(a)+" svg");j=l.clone().removeClass("td-comment"),k=l.clone().removeClass("td-comment"),$(this).append(j),i.append(k)}j.find(".comment").attr("class","comment show"),j.find("text").text(c?persian(c,!0):""),k.find(".comment").attr("class","comment show"),k.find("text").text(c?persian(c,!0):"")}})}var g=d3.selectAll(app.chartCommons.commentUtils.getChartSelector(a)+" .comment"),h=d3.selectAll("#"+app.chartCommons.commentUtils.getChartInModalSelector(a)+" .comment");d(h),d(g)},getChartInModalSelector:function(a){return"modal-chart-container-"+a},showLastVersionChart:function(){}},app.chartCommons.renderComments=function(a,b){function c(){var a='<div class="ui fuild modal '+v.substring(1,1e3)+' rtl"  style="cursor: initial;">     <i class="close icon"></i>     <div class="header">نسخه قبلی نمودار</div>     <div class="content" id="'+v.substring(1,1e3)+'" style="height:350px">         <div class="ui active inverted dimmer"><div class="ui text loader">آماده‌سازی نمودار</div></div>     </div></div>';if(0==$(v).length){var b=$(a);$("body").append(b),b.modal({allowMultiple:!0,onVisible:function(){app.chartCommons.commentUtils.showLastVersionChart()},onHidden:function(){$(v+" .content").html('<div class="ui active inverted dimmer"><div class="ui text loader">آماده‌سازی نمودار</div></div>')}})}}function d(a){return'<div class="ui mini label value comment-value" data-label="'+a.label+'" data-measure="'+a.measure+'" data-value="'+a.value+'" style="">  '+a.measure+" در "+a.label+": "+persian(d3.format(",.2f")(a.value),!0)+"</div>"}function e(a){var c="";return+a.chartVersion!=+b.version&&(c=persian(" نسخه "+a.chartVersion+" نمودار ",!0),c='            <span class="version pointer" style="color:red;" data-version="'+a.chartVersion+'">'+c+"</span>"),'<div class="comment" data-id="'+a.id+'">    <div class="content">        <span class="author">'+a.username+'</span>        <span class="value-string">'+d(a)+'</span>        <div class="metadata">            <span class="date">'+moment(a.time).fromNow()+"</span>"+c+'        </div>        <div class="text">            <span class="comment-text">'+a.comment+'            </span>            <span class="auto-hide animated ">            <a class="reply pointer metadata"> پاسخ </a>'+(a.userId==app.userId?'            <a class="edit pointer metadata"> ویرایش </a>':"")+(a.userId==app.userId?'            <a class="remove pointer metadata"> حذف </a>':"")+'            </span>        </div>        <div class="actions">        </div>    </div>'+(a.childs&&a.childs.length?f(a.childs):"")+"</div>"}function f(a,b){var c=(a||[]).map(e,b).join("");return'<div class="ui tiny relaxed threaded comments '+(b?" root":"")+'" '+(b?'style=" '+(w?"":"min-height:"+t+"px; overflow:auto;")+'   flex-grow: 1;flex-shrink: 1;flex-basis: 0px;"':"")+">"+c+"</div>"}function g(c){var d=b.FinalWhereList.map(function(a){var b='<div class="ui orange mini label"><span>'+a.Key.replace(/\[id\d+\].\[(.*)\]/,"$1")+': </span><span style="font-weight:200;">'+a.Value.join(",")+"</span></div>";return b}).join(""),e=f(c,!0),g='<form class="ui tiny form">  <div class="final-where">'+d+'</div>  <div class="comment-modal-value"><span class="measure-value"></span> در <span class="label-value"></span>  <span class="value-value"></span></div>  <div class="field">    <textarea type="text"  rows="1" placeholder="'+app.lang.translate("new comment")+'"></textarea>  </div></form>';return'<div class="ui modal comment-modal comment-section rtl modal'+a.ChartInPageId+'" style="cursor: initial;">     <i class="close icon"></i>     <div class="header">'+app.lang.translate("commenting")+'</div>     <div class="content '+(w?"scrolling":"")+'" style="padding:0">         <div class="ui mobile reversed stackable padded grid">             <div class="six wide column" '+(w?"":'style="border-left: 1px solid #dcddde;display: flex;flex-direction: column;justify-content: flex-end;"')+">"+e+'     <div class="header" style="flex"></div>'+g+'             </div>             <div class="six wide column chart-container" id="'+r+'" >                   <div class="ui active inverted dimmer"><div class="ui text loader">'+app.lang.translate("preparing chart")+"</div></div>             </div>         </div>     </div></div>"}function h(){B.find(".selected-comment").remove(),B.find(".selected-comment-edit").remove(),C.val(null)}function i(a,c){if(!a||!c)return"";var d=y.indexOf(a),e=z.indexOf(c),f=b.series.data[d][e];return f}function j(a){C.val(a.comment),!a.seriesLable;var b=i(a.seriesLable,a.measure);G.data("v",a.seriesLable),console.log("### set series label",a.seriesLable),F.data("v",a.measure),C.focus(),E.hide(),a.seriesLable&&(E.show(),G.text(a.seriesLable),F.text(a.measure),H.text(persian(d3.format(",.2f")(b),!0)))}function k(c){c.find(".version").on("click",function(){var b=$(this).data("version");app.chartCommons.commentUtils.showLastVersionChart=function(){$(v+" .content").charts(a.type,{id:v.substring(1,1e3),parameters:{type:a.dataType,fromCommentDialog:!0,lastVersionInfo:{version:b,lastVersionChartId:a.chartId}}})},$(v).modal("show")}),c.find(".reply").on("click",function(){var a=$(this).parents(".comment").data("id");h(),$selectedComment=$('<div class="ui mini label selected-comment field" data-id="'+a+'">پاسخ به '+a+' <i class="icon close" style="margin:0;"/>  </div>'),B.find(".ui.form").prepend($selectedComment),$selectedComment.find(".icon").on("click",h),C.focus()}),c.find(".edit").on("click",function(){var a=$(this).parents(".comment").data("id"),b=$(this).parents(".comment").first();h(),$selectedComment=$('<div class="ui mini label selected-comment-edit field" data-id="'+a+'"> ویرایش '+a+' <i class="icon close" style="margin:0;"/>  </div>'),B.find(".ui.form").prepend($selectedComment),$selectedComment.find(".icon").on("click",h),j({comment:b.find(".comment-text").first().text().trim(),label:b.find(".value").first().data("label"),measure:b.find(".value").first().data("measure")})}),c.find(".remove").on("click",function(){var c=$(this).parents(".comment").data("id"),d=$(this).parents(".comment").first(),e=confirm("در صورت حذف کامنت تمام پاسخ‌ها نیز حذف می‌شوند. آیا برای حذف اطمینان دارید؟");if(e){var f=app.urlPrefix+"api/chartComments/Delete?id="+c;$.post(f).done(function(e){d.transition("scale");var f=null;if(_.each(u,function(a){a.id==c&&(f=a)}),l(b.comment,c,function(a,b,d){b.id==c&&a.splice(d,1)}),f){var g=app.chartCommons.commentUtils.getCommentCount(u,e.label,e.measure);app.chartCommons.commentUtils.updateIconCommentCount(a.ChartInPageId,e,g)}})}})}function l(a,b,c){var d=null,e=0;return _.each(a,function(f){if(c&&c(a,f,e),f.id==b)return d=f,!1;var g=l(f.childs,b);return g?(d=g,!1):void e++}),d}function m(a){B.find(" .root.comments > .comment").hide(),_.each(a,function(a){B.find(" .root.comments > .comment[data-id="+a.id+"]").show()})}function n(a){var b=_.sortBy(a.category).join(", ");return u.filter(function(c){return b==c.label&&a.seriesLable==c.measure})}function o(){var c=_.extend({},a);c.id=r,c.fromCommentDialog=!0,$("#"+c.id).empty(),app.chartCommons.commentUtils.destroyListener(c.ChartInPageId),app.chartCommons.draw(c.type,b,c,!1),$("#"+r).on("select-series",function(a,b){j({comment:"",label:b.category,measure:b.seriesLable,measureKey:b.seriesKey}),m(n(b))})}function p(){function b(b){D.removeClass("loading"),C.val(null),h(),u=u||[];var c=l(u,o);if(c)c.childs=c.childs||[],c.childs.push(b);else{u.push(b);var d=app.chartCommons.commentUtils.getCommentCount(u,b.label,b.measure);app.chartCommons.commentUtils.updateIconCommentCount(a.ChartInPageId,b,d)}var g=B.find(".comments.root");if(o){if($parentComment=B.find(".comment[data-id="+o+"] .comments"),0==$parentComment.length){$parentComment=B.find(".comment[data-id="+o+"]");var i=$(f());$parentComment.append(i),$parentComment=i}g=$parentComment}var j=$(e(b));g.append(j),k(j),setTimeout(function(){var a=B.find(".root.comments [data-id="+b.id+"]"),c=B.find(".root.comments");c.animate({scrollTop:c.scrollTop()+a.offset().top-c.height()+a.height()},400),setTimeout(function(){a.transition("pulse")},400)},400)}var c=G.data("v");console.log("### get series label",c);var g=F.data("v");if(_.isArray(c)||(c=[c]),_.isArray(g)&&(g=g[0]),_.isEmpty(C.val()))return void alert("کامنت خود را بنویسید");if(_.isEmpty(c))return void alert("یکی از ردیف‌های اطلاعاتی را انتخاب کنید");if(_.isEmpty(g))return void alert("یکی از داده‌ها را انتخاب کنید");var j=i(c,g),m=$(q+" .chart-data").data("settings"),n=app.chartCommons.getFilterParameter(m.ChartInPageId,m.input.RefreshDatasource),o=B.find(".selected-comment").data("id"),p=B.find(".selected-comment-edit").data("id"),r=_.sortBy(c).join(", "),s={where:m.input.FinalWhereList,chartId:m.chartId,dashboardId:dashboard.pageId,datasourceId:m.input.DataSourceId,dimention:m.input.CurrentDimName,input:JSON.stringify(m.input),drillDown:n.drillDown,otherFilters:n.otherFilters,userControlFilter:n.userControlFilter,userVariable:n.userVariable,comment:C.val().trim(),parentId:o,label:r,measure:g,value:j};return D.addClass("loading"),p?void $.post(app.urlPrefix+"api/ChartComments/edit?id="+p+"&text="+C.val().trim()+"&label="+c+"&measure="+g+"&value="+j).done(function(a){D.removeClass("loading"),h(),C.val(null);var b=B.find(".comment[data-id="+p+"]").first(),c=B.find(".comment[data-id="+p+"] .comment-text").first(),e=B.find(".comment[data-id="+p+"] .value-string").first();c.text(a.comment),e.html(d(a)),setTimeout(function(){b.transition("pulse")},400)}).fail(function(a){D.removeClass("loading")}):void $.ajax({type:"POST",url:app.urlPrefix+"api/ChartComments/save/0",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",dataType:"json",success:b,error:function(a){D.removeClass("loading")}})}if(app.commentOnChart&&a.permissions.Comment&&b.FinalWhereList){var q=app.chartCommons.commentUtils.getChartSelector(a.ChartInPageId),r=app.chartCommons.commentUtils.getChartInModalSelector(a.ChartInPageId),s=$(q+" .show-chart-comments"),t=300;$(q+" .comment-section").remove();var u=b.comment;if(!a.fromCommentDialog){var v=".last-version-modal";$(".comment-modal.modal"+a.ChartInPageId).remove(),$(q).off("new-comment"),s.off("click"),c();var w=$(window).width()<768;if(u){moment.locale("fa"),$(q).data("init-befor",!0);var x=app.chartCommons.commentUtils.getLabelsMeasures(b),y=x.labels,z=x.measures,A=x.measuresKey,B=$(g(u)),C=B.find("textarea"),D=B.find(".button"),E=(B.find(".chart-container"),B.find(".comment-modal-value")),F=B.find(".measure-value"),G=B.find(".label-value"),H=B.find(".value-value"),I={type:"modal",render:function(){$(q).append(B),k(B),C.on("keyup",function(a){return 13==a.keyCode&&a.ctrlKey?void C.val(C.val()+"\n"):void(13==a.keyCode&&p())}),"modal"==this.type&&(B.modal({allowMultiple:!0,onVisible:function(){o(),$(app.chartCommons.commentUtils.getChartSelector(a.ChartInPageId)).trigger("highlight-element",[I.highlightedValue])}}),s.on("click",function(){var a={category:y[0],seriesLable:z[1],seriesLablekey:A[1]};$(q).trigger("new-comment",a)})),"popup"==this.type&&s.popup({popup:$(q+" .popup.ui"),target:$(q+" .ui.card .content"),title:"کامنت‌ها",position:"top right",boundary:$(".main-container"),on:"click",lastResort:!0,prefer:"opposite",onShow:function(a,b){$(q+" .menu-bar").addClass("show-dropdown")},onVisible:function(){$parentDiv=$(".main-container.full-height-container"),$innerListItem=B,$parentDiv.animate({scrollTop:$parentDiv.scrollTop()-$parentDiv.height()+$innerListItem.offset().top+$innerListItem.height()+40},400)},onHide:function(a,b){$(q+" .menu-bar").removeClass("show-dropdown")}})},show:function(){"modal"==this.type&&B.modal("show"),"popup"==this.type&&s.popup("show")}};I.render(),$(q).on("new-comment",function(a,b){j({comment:"",seriesLable:b.category,measure:b.seriesLable,measureKey:b.seriesKey}),m(n(b)),I.highlightedValue=b,I.show(),$(q).trigger("highlight-element",[I.highlightedValue])})}}}},jQuery.fn.extend({lazyDropdown:function(a){return this.each(function(){var b=$(this);b.on("click",function(c){b.data("init-dd")||(c.stopPropagation(),c.preventDefault(),b.data("init-dd",!0),b.dropdown(a),b.click())})})}}),app.chartCommons.indicator={checkRow:function(a,b,c){var d=c.indexOf(a.firstField);if(d==-1)return!1;try{b[d]}catch(e){debugger}var f=b[d],g=0;if(a.secondFieldIsText)g=a.secondFieldInput;else{var h=c.indexOf(a.secondFieldSelect);if(h===-1)return!1;g=b[h]}switch(f=depersian(f),g=depersian(g),isNaN(g)||(g=+g),isNaN(f)||(f=+f),+a.operand){case 1:return f==g;case 2:return f!=g;case 3:return f>g;case 4:return f>=g;case 5:return f<g;case 6:return f<=g;case 7:return f.indexOf(g)>-1;case 8:return f.indexOf(g)<=-1}},getIndicator:function(a,b,c){var d=[],e=b;return c&&c.forEach(function(b){var c=!0;$.each(b.ifRow,function(b,d){if(!app.chartCommons.indicator.checkRow(d,a,e))return c=!1,!1}),c&&d.push(JSON.parse(JSON.stringify(b.thenRow)))}),d}},function(){var a="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this||window;"undefined"!=typeof define&&define("save-svg-as-png",[],function(){return a});var b="http://www.w3.org/2000/xmlns/",c='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',d=/url\(["']?(.+?)["']?\)/,e={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},f=function(a){return a instanceof HTMLElement||a instanceof SVGElement},g=function(a){if(!f(a))throw new Error("an HTMLElement or SVGElement is required; got "+a)},h=function(a){return a&&0===a.lastIndexOf("http",0)&&a.lastIndexOf(window.location.host)===-1},i=function(a){var b=Object.keys(e).filter(function(b){return a.indexOf("."+b)>0}).map(function(a){return e[a]});return b?b[0]:(console.error("Unknown font format for "+a+". Fonts may not be working correctly."),
"application/octet-stream")},j=function(a){for(var b="",c=new Uint8Array(a),d=0;d<c.byteLength;d++)b+=String.fromCharCode(c[d]);return window.btoa(b)},k=function(a,b,c){var d=a.viewBox&&a.viewBox.baseVal&&a.viewBox.baseVal[c]||null!==b.getAttribute(c)&&!b.getAttribute(c).match(/%$/)&&parseInt(b.getAttribute(c))||a.getBoundingClientRect()[c]||parseInt(b.style[c])||parseInt(window.getComputedStyle(a).getPropertyValue(c));return"undefined"==typeof d||null===d||isNaN(parseFloat(d))?0:d},l=function(a,b,c,d){if("svg"===a.tagName)return{width:c||k(a,b,"width"),height:d||k(a,b,"height")};if(a.getBBox){var e=a.getBBox(),f=e.x,g=e.y,h=e.width,i=e.height;return{width:f+h,height:g+i}}},m=function(a){return decodeURIComponent(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){var c=String.fromCharCode("0x"+b);return"%"===c?"%25":c}))},n=function(a){for(var b=window.atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new ArrayBuffer(b.length),e=new Uint8Array(d),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);return new Blob([d],{type:c})},o=function(a,b){if(b)try{return a.querySelector(b)||a.parentNode&&a.parentNode.querySelector(b)}catch(c){console.warn('Invalid CSS selector "'+b+'"',c)}},p=function(a,b){var c=a.cssText.match(d),e=c&&c[1]||"";if(e&&!e.match(/^data:/)&&"about:blank"!==e){var f=e.startsWith("../")?b+"/../"+e:e.startsWith("./")?b+"/."+e:e;return{text:a.cssText,format:i(f),url:f}}},q=function(a){return Promise.all(Array.from(a.querySelectorAll("image")).map(function(a){var b=a.getAttributeNS("http://www.w3.org/1999/xlink","href")||a.getAttribute("href");return b?(h(b)&&(b+=(b.indexOf("?")===-1?"?":"&")+"t="+(new Date).valueOf()),new Promise(function(c,d){var e=document.createElement("canvas"),f=new Image;f.crossOrigin="anonymous",f.src=b,f.onerror=function(){return d(new Error("Could not load "+b))},f.onload=function(){e.width=f.width,e.height=f.height,e.getContext("2d").drawImage(f,0,0),a.setAttributeNS("http://www.w3.org/1999/xlink","href",e.toDataURL("image/png")),c(!0)}})):Promise.resolve(null)}))},r={},s=function(a){return Promise.all(a.map(function(a){return new Promise(function(b,c){if(r[a.url])return b(r[a.url]);var e=new XMLHttpRequest;e.addEventListener("load",function(){var c=j(e.response),f=a.text.replace(d,'url("data:'+a.format+";base64,"+c+'")')+"\n";r[a.url]=f,b(f)}),e.addEventListener("error",function(c){console.warn("Failed to load font from: "+a.url,c),r[a.url]=null,b(null)}),e.addEventListener("abort",function(c){console.warn("Aborted loading font from: "+a.url,c),b(null)}),e.open("GET",a.url),e.responseType="arraybuffer",e.send()})})).then(function(a){return a.filter(function(a){return a}).join("")})},t=null,u=function(){return t?t:t=Array.from(document.styleSheets).map(function(a){try{return{rules:a.cssRules,href:a.href}}catch(b){return console.warn("Stylesheet could not be loaded: "+a.href,b),{}}})},v=function(a,b){var c=b||{},d=c.selectorRemap,e=c.modifyStyle,f=c.modifyCss,g=c.fonts,h=f||function(a,b){var c=d?d(a):a,f=e?e(b):b;return c+"{"+f+"}\n"},i=[],j="undefined"==typeof g,k=g||[];return u().forEach(function(b){var c=b.rules,d=b.href;c&&Array.from(c).forEach(function(b){if("undefined"!=typeof b.style)if(o(a,b.selectorText))i.push(h(b.selectorText,b.style.cssText));else if(j&&b.cssText.match(/^@font-face/)){var c=p(b,d);c&&k.push(c)}else i.push(b.cssText)})}),s(k).then(function(a){return i.join("\n")+a})};a.prepareSvg=function(a,c,d){g(a);var e=c||{},f=e.left,h=void 0===f?0:f,i=e.top,j=void 0===i?0:i,k=e.width,m=e.height,n=e.scale,o=void 0===n?1:n,p=e.responsive,r=void 0!==p&&p;return q(a).then(function(){var e=a.cloneNode(!0),f=c||{},g=f.backgroundColor,i=void 0===g?"transparent":g;e.style.backgroundColor=i;var n=l(a,e,k,m),p=n.width,q=n.height;if("svg"!==a.tagName){if(!a.getBBox)return void console.error("Attempted to render non-SVG element",a);e.setAttribute("transform",e.getAttribute("transform").replace(/translate\(.*?\)/,""));var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.appendChild(e),e=s}return e.setAttribute("version","1.1"),e.setAttribute("viewBox",[h,j,p,q].join(" ")),e.getAttribute("xmlns")||e.setAttributeNS(b,"xmlns","http://www.w3.org/2000/svg"),e.getAttribute("xmlns:xlink")||e.setAttributeNS(b,"xmlns:xlink","http://www.w3.org/1999/xlink"),r?(e.removeAttribute("width"),e.removeAttribute("height"),e.setAttribute("preserveAspectRatio","xMinYMin meet")):(e.setAttribute("width",p*o),e.setAttribute("height",q*o)),Array.from(e.querySelectorAll("foreignObject > *")).forEach(function(a){a.getAttribute("xmlns")||a.setAttributeNS(b,"xmlns","http://www.w3.org/1999/xhtml")}),v(a,c).then(function(a){var b=document.createElement("style");b.setAttribute("type","text/css"),b.innerHTML="<![CDATA[\n"+a+"\n]]>";var c=document.createElement("defs");c.appendChild(b),e.insertBefore(c,e.firstChild);var f=document.createElement("div");f.appendChild(e);var g=f.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');return"function"!=typeof d?{src:g,width:p,height:q}:void d(g,p,q)})})},a.svgAsDataUri=function(b,d,e){g(b);var f=a.prepareSvg(b,d).then(function(a){var b=a.src,d=a.width,f=a.height,g="data:image/svg+xml;base64,"+window.btoa(m(c+b));return"function"==typeof e&&e(g,d,f),g});return f},a.svgAsPngUri=function(b,c,d){g(b);var e=c||{},f=e.encoderType,h=void 0===f?"image/png":f,i=e.encoderOptions,j=void 0===i?.8:i,k=e.canvg,l=function(a){var b=a.src,c=a.width,e=a.height,f=document.createElement("canvas"),g=f.getContext("2d"),i=window.devicePixelRatio||1;f.width=c*i,f.height=e*i,f.style.width=f.width+"px",f.style.height=f.height+"px",g.setTransform(i,0,0,i,0,0),k?k(f,b):g.drawImage(b,0,0);var l=void 0;try{l=f.toDataURL(h,j)}catch(m){if("undefined"!=typeof SecurityError&&m instanceof SecurityError||"SecurityError"===m.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw m}return"function"==typeof d&&d(l,f.width,f.height),Promise.resolve(l)};return k?a.prepareSvg(b,c).then(l):a.svgAsDataUri(b,c).then(function(a){return new Promise(function(b,c){var d=new Image;d.onload=function(){return b(l({src:d,width:d.width,height:d.height}))},d.onerror=function(){c("There was an error loading the data URI as an image on the following SVG\n"+window.atob(a.slice(26))+"Open the following link to see browser's diagnosis\n"+a)},d.src=a})})},a.download=function(a,b){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(n(b),a);else{var c=document.createElement("a");if("download"in c){c.download=a,c.style.display="none",document.body.appendChild(c);try{var d=n(b),e=URL.createObjectURL(d);c.href=e,c.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(e)})}}catch(f){console.warn("This browser does not support object URLs. Falling back to string URL."),c.href=b}c.click(),document.body.removeChild(c)}else window.open(b,"_temp","menubar=no,toolbar=no,status=no")}},a.saveSvg=function(b,c,d){g(b),a.svgAsDataUri(b,d||{},function(b){return a.download(c,b)})},a.saveSvgAsPng=function(b,c,d){g(b),a.svgAsPngUri(b,d||{},function(b){return a.download(c,b)})}}(),app.chartCommons.exportPng={svgString2Image:function(a,b,c,d,e){var f=document.createElement("canvas"),g=f.getContext("2d");f.width=b,f.height=c;var h=$('<div class="bar-chart"><img /></div>'),i=h.find("img").get(0);i.onload=function(){g.clearRect(0,0,b,c),g.drawImage(i,0,0,b,c),f.toBlob(function(a){var b=Math.round(a.length/1024)+" KB";e&&e(a,b)})},i.src=a},getSVGString:function(a){var b='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',c=(new XMLSerializer).serializeToString(a),d=new Blob([b+c],{type:"image/svg+xml;charset=utf-8"}),e=window.URL.createObjectURL(d);return e}},d3.selection.prototype.settingsIcon=function(a){return},d3.selection.prototype.legend=function(a,b){a.font=a.font||{},a.click=a.click||function(){};var c={"top right":"legend-top-right","top left":"legend-top-left","top center":"legend-top-center","bottom right":"legend-bottom-right","bottom left":"legend-bottom-left","bottom center":"legend-bottom-center","center right":"legend-center-right","center left":"legend-center-left"};a.position=a.position||"top left";var d={},e=this.append("div").attr("class","legend-div temporal ").append("div").attr("class","list-inline "+c[a.position]).styles(d);return e.selectAll("nothingd").data(a.data).enter().append("span").text(function(a){return persian(a.label,b)}).style("font-size",a.font.fontSize||"9px").style("font-family",a.font.fontName||"IRANSans").style("font-weight",a.font.bold?"bold":"300").style("font-style",a.font.italic?"italic":"inherit").style("color",a.font.color||"#333333").attr("class","pointer legend-item").on("click",function(b,c){a.selector&&$(a.selector).trigger("legendClick",[b.label,c,b]),a.click(b,c)}).append("span").attr("class","legend-color").style("background-color",function(a){return a.color}).style("-webkit-print-color-adjust","exact"),e},d3.selection.prototype.breadcrumb=function(a,b,c,d){var e=a.slice(0);"undefined"!=typeof e[0]&&null!==e[0]&&e.unshift(app.lang.translate("پاک کردن"));var f=e[e.length-1];if(e.splice(e.length-1,1),e.length>0){var g=function(a,d){var f=$("#"+b.id).hasClass("fromCommentDialog");if(!f){var g=c.isProgress,h=c.showProgress;if(!g()){h(!0);var i=app.chartCommons.drillDown.up(b.ChartInPageId,e.length-d);b.parameters={drillDown:i,isUp:!0,upLevel:e.length-d,chartId:b.chartId,ChartInPageId:b.ChartInPageId},b.drill="up",app.chartCommons.levelTypeUtils.getParam(b),$("#"+b.id).charts(b.type,"refreshWithData",b)}}},h='<div class="ui mini breadcrumb floated right temporal">'+e.map(function(a){return'<a class="section clickable">'+a+"</a>"}).join('<i class="'+(app.lang.isRtl()?"left":"right")+' arrow icon divider"></i>')+'<i class="'+(app.lang.isRtl()?"left":"right")+' arrow icon divider"></i><div class="section active">'+f+"</div></div>";return $(this._groups[0][0]).append(h),void $(this._groups[0][0]).find(".breadcrumb .clickable").each(function(a,b){$(this).on("click",function(){g(0,a)})})}},d3.selection.prototype.titlebar=function(a){var b,c=this,d=$(c._groups[0][0]),e=function(){return"visible"==d.find(".myprogress").css("visibility")},f=d.parents(".ui.card").find(".progress-overall"),g=function(a){a?(d.find("*").attr("disabled",!0),d.find(".myprogress").css("visibility","visible"),f.fadeIn()):(d.find("*").attr("disabled",!1),d.find(".myprogress").css("visibility","hidden"),f.fadeOut())};return{title:b,showProgress:g,isProgress:e}};var d3Utils={prepareDataForBarChart:function(a,b,c,d,e,f){var g=d3.scaleOrdinal(d3.schemeCategory10);$.each(a,function(a,h){if(!h.kpis)return!0;var i=[];return $.each(h.kpis,function(a,c){var e=b.chartProp.series[d[a]]||b.chartProp.series["default"];g(a);"undefined"==typeof e&&"undefined"!=typeof model&&(e=$.extend(!0,{},"undefined"!=typeof model.seriesProp[d[a]]?model.seriesProp[d[a]]:model.seriesProp["default"]),e.seriesColor=g(a)),i.push({data:c,prop:e,key:d[a],label:f&&f.length>a?f[a]:d[a],type:"kpi",seriesLable:f&&f.length>a?f[a]:d[a],type:"kpi",seriesKey:d[a],category:h.label})}),!h.series||($.each(h.series,function(a,d){var f=b.chartProp.series[c[a]],g=""===d||null===d||isNaN(d),j={type:"series",data:g?d:d*parseFloat(f.numberFactor),prop:f,key:c[a],label:e&&e.length>a?e[a]:c[a],seriesLable:e&&e.length>a?e[a]:c[a],seriesKey:c[a],category:h.label};j.commentCount=app.chartCommons.commentUtils.getCommentCount(b.input.comment,j.category,j.label),i.push(j)}),void(h.series=i))})},convertToKeyValue:function(a){var b=_.map(a.series.labels,function(b,c){var d=a.seriesLablesCaptions&&a.seriesLablesCaptions.length>c;return{key:b,value:d?a.seriesLablesCaptions[c]:b}}),c=_.map(a.kpis.labels,function(b,c){var d=a.kpisLablesCaptions&&a.kpisLablesCaptions.length>c;return{key:b,value:d?a.kpisLablesCaptions[c]:b}});return{seriesLabels:b,kpiLabels:c}}},app=app||{};app.helper=app.helper||{},function(){function a(a){for(var d=0;d<a.length;d++)for(var e=0;e<b.length;e++)a.charAt(d)===b[e]&&(a=a.replace(a.charAt(d),c[e]));return a}var b=["ي","إ","ؤ","أ","ي","ك"],c=["ی","ا","و","ا","ی","ک"];app.helper.filterMemberDialogOk=function(){var a=$("#filter-member-dialog").data("data");$("#filter-member-dialog .li ").each(function(b,c){var d=$(this).find("input"),e=$.grep(a.members,function(a){return a.Uniquename==d.attr("value")})[0];e.IsChecked=d.prop("checked")}),a.onfinish(a.members),$("#filter-member-dialog").modal("hide")},app.helper.filterMemberDialog=function(b,c,d){function e(a,b,c){var d='<div class=" " style="height:50vh; overflow:auto;"> '+b.map(function(a,b){return'<div class="li"><input value="'+a.Uniquename+'" type="checkbox" id="member-'+b+'" '+(a.IsChecked?" checked ":"")+' /> <label class="unstyled-lable" for="member-'+b+'">'+a.Caption+"</label></div>"}).join("")+"</div>";c.find(".member-list").html(d),$("#filter-member-dialog").modal("refresh")}var f=function(d){var f=window.innerHeight,g=$("#filter-member-dialog").outerHeight(),h=f-g-50;body='<div class="ui form"><input type="text" class="form-control" id="filter-member-search" placeholder="جستجو"></div>                    <input id="select-all-member-filter" type="checkbox" style="margin-top:10px"/><label style="margin-right:5px;" for="select-all-member-filter"> همه </label>                    <div class="member-list"></div>';var i=$("#filter-member-dialog #filter-member-dialog-content");i.html(body),$("#select-all-member-filter").change(function(){var a=this.checked;$("#filter-member-dialog .member-list .li input").filter(function(){return $(this).is(":visible")}).prop("checked",a)}),e(h,b,i);var j;$("#filter-member-dialog #filter-member-search").keyup(function(){var b=$(this).val().toLowerCase();if(b=a(b),c){if(b&&1==b.length)return;clearTimeout(j),j=setTimeout(function(){$.ajax(c+"&query="+b).done(function(a){var b=$("#filter-member-dialog").data("data");b.members=a,e(h,a,i)})},400)}else $("#filter-member-dialog li").show(),$("#filter-member-dialog li").filter(function(){var c=$(this).text().toLowerCase();return c=a(c),c.indexOf(b.toLowerCase())==-1}).hide()})};$("#filter-member-dialog").modal({onVisible:f}).modal("show"),$("#filter-member-dialog").data("data",{members:b,onfinish:d}),$("#filter-member-dialog").modal("show")}}($),function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function c(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}c.prototype={show:function(){var c=this.getTitle();if(c&&this.enabled){var d=this.tip();d.find(".tipsy-inner")[this.options.html?"html":"text"](c),d[0].className="tipsy",d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var e=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth||0,height:this.$element[0].offsetHeight||0});if("object"==typeof this.$element[0].nearestViewportElement){var f=this.$element[0],g=f.getBoundingClientRect();e.width=g.width,e.height=g.height}var h,i=d[0].offsetWidth,j=d[0].offsetHeight,k=b(this.options.gravity,this.$element[0]);switch(k.charAt(0)){case"n":h={top:e.top+e.height+this.options.offset,left:e.left+e.width/2-i/2};break;case"s":h={top:e.top-j-this.options.offset,left:e.left+e.width/2-i/2};break;case"e":h={top:e.top+e.height/2-j/2,left:e.left-i-this.options.offset};break;case"w":h={top:e.top+e.height/2-j/2,left:e.left+e.width+this.options.offset};break;case"c":h={top:e.top+e.height/2-j/2,left:e.left+e.width/2-i/2}}2==k.length&&("w"==k.charAt(1)?h.left=e.left+e.width/2-15:h.left=e.left+e.width/2-i+15),d.css(h).addClass("tipsy-"+k),d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+k.charAt(0),this.options.className&&d.addClass(b(this.options.className,this.$element[0])),this.options.fade?d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):d.css({visibility:"visible",opacity:this.options.opacity});var l=this,m=function(a){return function(){l.$tip.stop(),l.tipHovered=a,a||(0===l.options.delayOut?l.hide():setTimeout(function(){"out"==l.hoverState&&l.hide()},l.options.delayOut))}};d.hover(m(!0),m(!1))}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title"),"object"==typeof a.get(0).nearestViewportElement&&a.children("title").length&&a.append("<original-title>"+(a.children("title").text()||"")+"</original-title>").children("title").remove()},getTitle:function(){var a,b=this.$element,c=this.options;if(this.fixTitle(),"string"==typeof c.title){var d="title"==c.title?"original-title":c.title;a=b.children(d).length?b.children(d).html():b.attr(d)}else"function"==typeof c.title&&(a=c.title.call(b[0]));return a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){function d(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function e(){var a=d(this);a.hoverState="in",0===b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function f(){var a=d(this);if(a.hoverState="out",0===b.delayOut)a.hide();else{var c=function(){a.tipHovered&&b.hoverlock||"out"==a.hoverState&&a.hide()};setTimeout(c,b.delayOut)}}if(b===!0)return this.data("tipsy");if("string"==typeof b){var g=this.data("tipsy");return g&&g[b](),this}if(b=a.extend({},a.fn.tipsy.defaults,b),b.hoverlock&&0===b.delayOut&&(b.delayOut=100),"manual"!=b.trigger){var h=b.live?"live":"bind",i="hover"==b.trigger?"mouseenter":"focus",j="hover"==b.trigger?"click":"blur",k="hover"==b.trigger?"mouseleave":"blur";this[h](i,e)[h](k,f)[h](j,f)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover",hoverlock:!1},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1&&c[1]},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return g.offset().top<e&&(d.ns="n"),g.offset().left<f&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-g.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-g.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery);var app=app||{};app.charts=app.charts||{},app.charts.bar={},app.charts.bar.draw=function(a,b,c,d){function e(a,c){return b.chartProp.info.yAxisAuto||a>0&&(a=0),a==c&&(a<0&&(c=0),a>0&&(a=0)),a=0==a?0:a-Math.abs(.25*(c-a)),c+=Math.abs(.25*(c-a)),{min:a,max:c}}function f(){return app.lang.isRtl(),"rotate(-90)"}function g(a,b,c){var d=c.indexOf(a.firstField),e=b[d],f=a.secondFieldIsText?a.secondFieldInput:b[c.indexOf(a.secondFieldSelect)];switch(e=depersian(e),f=depersian(f),isNaN(f)||(f=+f),isNaN(e)||(e=+e),+a.operand){case 1:return e==f;case 2:return e!=f;case 3:return e>f;case 4:return e>=f;case 5:return e<f;case 6:return e<=f;case 7:return e.indexOf(f)>-1;case 8:return e.indexOf(f)<=-1}}function h(a,c,d){b.chartProp.indicator&&b.chartProp.indicator.forEach(function(b){var e=!0;$.each(b.ifRow,function(a,b){if(!g(b,c,d))return e=!1,!1}),e&&a.map(function(a){return a.thenRows=a.thenRows||[],a.thenRows.push(b.thenRow),a})})}function i(a,c,d,e){"line"==d&&(a=mb[e].values[a].dIndex);var f=K[a].series;if(1==c&&d&&"undefined"!=typeof e&&(f=f.filter(function(a){return a.prop.seriesType==d&&!a.prop.hidden}),f=[f[e]]),2==c&&(f=f.filter(function(a){return!a.prop.hidden})),b.chartProp.info.isBox){var g=[];_.each(f,function(a){_.each([a.box.q1,a.box.q2,a.box.q3,a.box.min,a.box.max,a.box.avg],function(a,b){var c=0==b?"Q1":1==b?"Q2":2==b?"Q3":3==b?"MIN":4==b?"MAX":5==b?"AVG":"";g.push({prop:a.prop,data:a.data,label:(a.prop.name||a.label)+" "+c,format:D(a.prop),color:a.prop.seriesColor})})}),f=g}return f=f.map(function(a){return{data:a.data,label:a.prop.name||a.label,format:D(a.prop),color:a.prop.seriesColor}}),app.chartCommons.tooltip.tooltipFormatter({points:f,key:K[a].label,sum:d3.sum(f,function(a){return a.data}),avg:d3.sum(f,function(a){return a.data})/f.length,format:f.length>0?f[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,y)}function j(a){return"linear"==a?d3.curveLinear:"cardinal"==a?d3.curveNatural:"step"==a?d3.curveStep:d3.curveLinear}function k(a){return window.innerWidth-a[0].getBoundingClientRect().left<300?"e":"w"}function l(a){var b=a[0].series.filter(function(a,b){return"line"==a.prop.seriesType&&!a.prop.hidden}),c=b.map(function(b,c){var d={sIndex:b.sIndex,label:b.label,prop:b.prop,values:a.map(function(a,c){var d={sIndex:b.sIndex,dIndex:a.index,label:a.label+"#"+a.index,value:a.series.filter(function(a,c){return a.label==b.label})[0].data,valueLabel:a.series.filter(function(a,c){return a.label==b.label})[0].data,prop:a.series.filter(function(a,c){return a.label==b.label})[0].prop,onClickVal:a.onClickVal,primv:a.value,category:a.label,commentCount:a.series.filter(function(a,c){return a.label==b.label})[0].commentCount,seriesLable:b.label,seriesKey:b.key};return d}),valueStacked:a.map(function(a,c){return{sIndex:b.sIndex,label:a.label+"#"+a.index,valueLabel:a.series.filter(function(a,c){return a.label==b.label})[0].data,value:a.series.filter(function(a,c){return a.label==b.label})[0].data,prop:a.series.filter(function(a,c){return a.label==b.label})[0].prop,onClickVal:a.onClickVal,primv:a.value}})};return d}),d=0==c.length?[]:c[0].valueStacked.map(function(a){return Math.abs(a.value)});return c.forEach(function(a,b){if(0!=b){var e=c[b-1];a.valueStacked.forEach(function(a,b){d[b]+=Math.abs(a.value),a.value+=e.valueStacked[b].value})}}),J&&c.forEach(function(a,b){a.valueStacked.forEach(function(a,b){a.value=a.value/d[b]*100})}),c.forEach(function(a,b){a.values=a.values.filter(function(a){return""!==a.value}),a.valueStacked=a.valueStacked.filter(function(a){return""!==a.value}),a.prop.dontShowZeroValue&&(a.values=a.values.filter(function(a){return null!=a.value&&0!=a.value}),a.valueStacked=a.valueStacked.filter(function(a){return null!=a.value&&0!=a.value}))}),c}function m(){clearTimeout(xb),bol=U.property("checked"),b.isSort=bol;var a=V._groups[0][0].selectedIndex,c=V._groups[0][0].value,d=(V._groups[0][0],!0);a>=o.length&&(d=!1),Oa.domain(b.isSort?K.sort(function(a,b){return na=a.series.filter(function(a){return a.label==c}),nb=b.series.filter(function(a){return a.label==c}),na instanceof Array?(na=na[0],nb=nb[0],"series"==na.type?nb.data-na.data:nb.data[0]-na.data[0]):0}).map(function(a){return a.label+"#"+a.index}):K.sort(function(a,b){return a.index-b.index}).map(function(a){return a.label+"#"+a.index})),Qa.domain(b.isSort?K.filter(ja).sort(function(a,b){return na=a.series.filter(function(a){return a.label==c}),nb=b.series.filter(function(a){return a.label==c}),na instanceof Array?(na=na[0],nb=nb[0],"series"==na.type?nb.data-na.data:nb.data[0]-na.data[0]):0}).map(function(a){return a.label+"#"+a.index}):K.filter(ja).sort(function(a,b){return a.index-b.index}).map(function(a){return a.label+"#"+a.index}));var e=Y.transition().duration(b.animationDuration),g=function(a,b){return L?50*b:0};e.on("end",function(){$(r+" .kpi").each(function(){var a=$(this);$(this).tipsy({gravity:k(a),html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c=K.map(function(a){return a.index}).indexOf($(this).parent(".gd").get(0).__data__.index);return i(c,a,"bar",$(this).index())}})}),$(r+" .series").each(function(){var a=$(this);$(this).tipsy({gravity:k(a),html:!0,title:function(){var a=K.map(function(a){return a.index}),c=$(this).parent(".gd").get(0)||$(this).parent(".gd-text").get(0),d=c.__data__.index,e=+b.chartProp.info.tooltip||1,f=a.indexOf(d),g=i(f,e,"bar",$(this).index());return g}})}),$(r+" .gd-text text").each(function(){var a=$(this);$(this).tipsy({gravity:k(a),html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c=K.map(function(a){return a.index}).indexOf($(this).parent(".gd-text").get(0).__data__.index);return i(c,a,"bar",$(this).index())}})})}),e.selectAll(".gd").delay(g).attr("transform",function(a){return"translate("+Oa(a.label+"#"+a.index)+",0)"}),e.selectAll(".gd-text").delay(g).attr("transform",function(a){return"translate("+Oa(a.label+"#"+a.index)+",0)"});var m=l(K);Y.selectAll(".area").data(m).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-area"==b?I?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("d",function(a){return _.isArray(a)&&0==a.length?"M0,0":0===a?"M0,0":qb.curve(j(a[0].prop.lineStyle))(a)}),Y.selectAll(".line").data(m).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"line-area"==b||"line"==b?I?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("d",function(a){return _.isArray(a)&&0==a.length?"M0,0":0===a?"M0,0":sb.curve(j(a[0].prop.lineStyle))(a)}),Y.selectAll(".circle-group").data(m).selectAll(".circle").data(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"dot"==b?I?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("stroke",function(a,b){var c=[a],d=d3.select(this.parentNode).datum().seriesLable,e=K[b].series.map(function(a){return a.label}),f=K[b].series.map(function(a){return a.data});h(c,f,e),a=c[0];var g=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(a,b){$.each(b,function(a,b){if(d!=b.firstField)return!0;switch(+b.operand){case 1:g=b.secondFieldColor}})}),g}).attr("cx",function(a){return sb.curve(j(a.prop.lineStyle)).x()(a)}).attr("cy",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}),Y.selectAll(".text-vals").data(m).selectAll(".text-value").data(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"dot"==b?I?a.valueStacked:a.values:0}).transition().duration(b.animationDuration).attr("x",function(a){try{var b=d3.select(this).node().getBBox().width;return sb.curve(j(a.prop.lineStyle)).x()(a)-b/2}catch(c){return 0}}).text(function(a){return persian(d3.format(D(a.prop.font,a.prop))(a.valueLabel),y)}).attr("dy","-10").attr("y",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}),Y.selectAll(".colorStepGroup").data(m).selectAll("stop").data(function(a){var b=[],c=1/(2*(a.values.length-1)),d=-1*c;return a.values.map(function(e,f){var g={value:e.value,label:a.label,color:a.prop.seriesColor},i=[g],j=K[f].series.map(function(a){return a.label}),k=K[f].series.map(function(a){return a.data});h(i,k,j),g=i[0],g.offset=d<0?0:d,b.push(g),g=$.extend({},g),d+=2*c,g.offset=d>1?d-c:d,b.push(g)}),b}).transition().attr("stop-color",function(a,b){var c=a.color;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("offset",function(a){return a.offset}),e.select(".x.axis").call(ma).selectAll("g").delay(g),e.select(".x.axis").selectAll("g text").attr("transform",function(){return Va?f():"rotate(0)"}).attr("class","axes-x-label").attr("x","-1em").attr("dy","0.1em").attr("y","0").delay(g),Y.select(".x.axis").selectAll("g text").attr("transform",function(){return Va?f():"rotate(0)"}).style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal").style("text-anchor","end").attr("x","-1em").attr("dy","0.1em").attr("y","0").append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),y)})}b.input=a;a.title,a.chartInfo;app.chartCommons.calculateFields(a.series,b.calculatedFields);var n="undefined"!=typeof a.series?a.series.labels:[],o="undefined"!=typeof a.kpis?a.kpis.labels:[],p=a.seriesLablesCaptions,q=a.kpisLablesCaptions,r="#"+b.id,s=$(r).hasClass("fromCommentDialog"),t={top:20,right:20,bottom:40,left:20},u=$(r).width(),v="small"==b.chartProp.info.chartSize?80:"medium"==b.chartProp.info.chartSize?130:"large"==b.chartProp.info.chartSize?160:"veryLarge"==b.chartProp.info.chartSize?200:130,w=!app.mobileMode,x=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked,y="undefined"==typeof a.lang||0==+a.lang,z=v+t.top+t.bottom,A=d3.scaleOrdinal(d3.schemeCategory10),B=d.isProgress,C=d.showProgress,D=(d.title,function(a,b){if(!a)return",.2f";var c=a;if(!a.formatString){if(!b)return",.2f";c=b}return"custom"!=c.formatString?c.formatString:c.formatStringCustom}),E=+b.chartProp.info.stackedBar,F=3==E||2==E,G=3==E,H=+b.chartProp.info.stackedLine,I=3==H||2==H,J=3==H;if(app.chartCommons.setDefault(b.chartProp,o.concat(n),"bar"),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));for(var K=prepareData(a,b.chartProp),L=K.length<25,M=d3.scaleOrdinal(d3.schemeCategory10),N=[],O=0;O<n.length;O++){var P=b.chartProp.series[n[O]];if("undefined"==typeof P){P=0==b.chartProp.series.length?{seriesColor:"#1F77B4",seriesType:"bar",formatStringCustom:",.2f",formatString:",.2f",numberFactor:"1",showValues:!1,hidden:!1,cumulative:!1,lineFace:"5,0",lineWeight:"2",lineStyle:"linear",lineType:"line-dot-area",showValueColor:"#333333"}:$.extend({},b.chartProp.series[Object.keys(b.chartProp.series)[0]]);for(var Q="#1F77B4",O=0;O<10&&(Q=M(O)||"#1f77b4",N.indexOf(Q.toLowerCase())!=-1);O++);P.seriesColor=Q,P.name=null,b.chartProp.series[n[O]]=P}P.font&&!P.datasourceType||(P.font={bold:!1,color:P.showValueColor||"#333333",italic:!1,fontSize:P.showValueFontSize||"12px",fontName:"Droid"}),N.push(P.seriesColor.toLowerCase())}d3Utils.prepareDataForBarChart(K,b,n,o,p,q),_.each(K,function(a){_.each(a.series,function(a,b){a.sIndex=b})});var R=n;b.chartProp.info.isBox&&(K=_.map(K,function(a){for(var b=[],c=0;c<a.series.length/6;c++){var d=a.series[6*c+0];d.box={q1:a.series[6*c+0],q2:a.series[6*c+1],q3:a.series[6*c+2],min:a.series[6*c+3],max:a.series[6*c+4],avg:a.series[6*c+5]},b.push(d)}return a.series=b,a}),R=_.filter(n,function(a,b){return b%6===0})),b.editMode&&$(r).trigger("chartproperty",[o.concat(R)]);for(var S=null,O=0;O<K.length;O++){S||(S=new Array(K.length));for(var T=0;T<K[O].series.length;T++)S[O]||(S[O]=new Array(K[O].series.length)),S[O][T]=S[O][T]||{sum:null,avg:null,"var":null},K[O].series[T].prop&&K[O].series[T].prop.cumulative&&("undefined"!=typeof K[O].series[T].prop.cumulative_formula&&"sum"!=K[O].series[T].prop.cumulative_formula||(S[O][T].sum=d3.sum(K.filter(function(a,b){return b<=O}),function(a,b){return a.series[T].data})),"avg"==K[O].series[T].prop.cumulative_formula&&(S[O][T].avg=d3.mean(K.filter(function(a,b){return b<=O}),function(a,b){return a.series[T].data})),"var"==K[O].series[T].prop.cumulative_formula&&(S[O][T]["var"]=d3.variance(K.filter(function(a,b){return b<=O}),function(a,b){return a.series[T].data})),null==K[O].series[T].data&&K[O].series[T].prop.dontShowZeroValue&&(S[O][T].sum=null,S[O][T].avg=null,S[O][T]["var"]=null))}for(var O=0;O<K.length;O++)for(var T=0;T<K[O].series.length;T++)K[O].series[T].prop&&K[O].series[T].prop.cumulative&&(K[O].series[T].data=S[O][T]["var"]||S[O][T].sum||S[O][T].avg);G&&K.forEach(function(a){var b=a.series.filter(function(a,b){return!a.prop.hidden&&"bar"==a.prop.seriesType}),c=d3.sum(b.map(function(a){return Math.abs(a.data)}));b.forEach(function(a){
a.data=a.data/c*100})}),$(r).addClass("bar-line-chart");var U,V,W=d3.select(r).append("div").attr("class","legend-bar temporal");if(U=d3.select(r).select("#sort_checkbox_btn"),V=d3.select(r).select("#sort_checkbox select"),!U._groups[0][0]&&K.length>0){var X=W.append("div").attr("id","sort_checkbox").attr("class","sort-checkbox");U=X.append("label").append("input").attr("type","checkbox").attr("id","sort_checkbox_btn"),X.select("label").append("span"),app.lang.translateAsync("sort",function(a){var b=$(X._groups[0][0]).find("span");b.html(" "+a)});var V=X.append("select").on("change",function(){var a=U.property("checked");b.isSort=a,U.property("checked")&&m()}).style("margin","0 7px");o.length+n.length==1&&V.style("visibility","hidden").style("width","1px"),V.selectAll("nothings").data(K[0].series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return{name:(a.prop.name||a.label).replace(/^\[measure\]/,""),value:a.label}})).enter().append("option").text(function(a){return persian(a.name,y)}).attr("value",function(a){return a.value})}if("undefined"==typeof b.chartProp.info.showSortBox||b.chartProp.info.showSortBox||$(r+" #sort_checkbox").hide(),W.breadcrumb(a.levels,b,d,y),!a.matrix||0==a.matrix.length)return void W.append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");(b.chartProp.info.showLegends||"undefined"==typeof b.chartProp.info.showLegends)&&W.legend({width:u,font:b.chartProp.info.legendFont,position:b.chartProp.info.legendPosition,selector:r,data:K[0].series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return{label:(a.prop.name||a.label).replace(/^\[measure\]/,""),color:a.prop.seriesColor,key:a.key,sIndex:a.sIndex}}),click:function(a){b.editMode||$(r+" .series-"+a.sIndex).fadeToggle()}},y);var Y=null;Y=_.indexOf(["bottom left","bottom right","bottom center"],b.chartProp.info.legendPosition)!=-1?d3.select(r).insert("svg",":first-child").attr("class","temporal line-chart"):d3.select(r).append("svg").attr("class","temporal line-chart");var Z=d3.max(K,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?+a.data||0:void 0})}),aa=d3.min(K,function(a){return d3.min(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?+a.data||0:void 0})});if(b.chartProp.info.isBox&&(Z=d3.max(K,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return d3.max([a.box.q1.data,a.box.q2.data,a.box.q3.data,a.box.min.data,a.box.max.data,a.box.avg.data])})}),aa=d3.min(K,function(a){return d3.min(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return d3.min([a.box.q1.data,a.box.q2.data,a.box.q3.data,a.box.min.data,a.box.max.data,a.box.avg.data])})})),F){var ba=d3.max(K,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden&&"bar"==a.prop.seriesType}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?a.data>0?a.data:0:void 0})});Z=ba>Z?ba:Z;var ca=d3.min(K,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?a.data<0?a.data:0:void 0})});aa=ca<aa?ca:aa}if(I){var ba=d3.max(K,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden&&"line"==a.prop.seriesType}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?a.data>0?a.data:0:void 0})});Z=ba>Z?ba:Z;var ca=d3.min(K,function(a){return d3.sum(a.series.filter(function(a,b){return!a.prop.hidden}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?a.data<0?a.data:0:void 0})});aa=ca<aa?ca:aa}var da=e(aa,Z);aa=da.min,Z=da.max;var ea=K[0].series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}).length,fa=K[0].series.filter(function(a){return"series"==a.type&&"line"==a.prop.seriesType&&!a.prop.hidden}).length;(J&&fa>0||G&&ea>0)&&(Z=100,aa=aa<0?-100:0),b.chartProp.info.yAxisMax&&(Z=+b.chartProp.info.yAxisMax),b.chartProp.info.yAxisMin&&(aa=+b.chartProp.info.yAxisMin);var ga=+b.chartProp.info.xAxisLen||20;b.chartProp.info.font||(b.chartProp.info.font={bold:!1,color:"#333333",italic:!1,fontSize:"12px",fontName:"Droid"});var ha=50,ia=K.length/ha,ja=function(a,b){return K.length<35||(K.length<=ha||(0===b&&(this.meter=0),b>=this.meter&&(this.meter+=ia,!0)))},ka=30;if(app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,2===app.dashboardLayoutVersion){var la=d3.scaleBand().range([u-400,u]).paddingInner(.1);la.domain(K.map(function(a){return a.label+"#"+a.index}).filter(ja));var ma=d3.axisBottom(la).tickFormat(function(a){var b=a.replace(new RegExp("#\\d+$"),"");return(b.length>ga?"...":"")+persian(b.substring(0,ga),y)}),oa=d3.select(r).append("svg");oa.append("g").attr("class","x axis").call(ma),oa.selectAll("g text").attr("transform",f()).attr("x","-1em").attr("dy","0.1em").attr("y","0").attr("fill",b.chartProp.info.font.color).attr("class","axes-x-label").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal").append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),y)});var pa=oa.node(),qa=pa.getBBox();try{ka=oa.selectAll("text")._groups[0][1].getBBox().height}catch(ra){}var sa=$(r+" .title").outerHeight()||0,ta=$(r+" .legend-bar"),ua="undefined"==typeof ta?0:ta.height()+ +ta.css("margin-top").replace("px","");oa.remove(),v=$(r).height()-sa-qa.height-t.bottom-ua,v<50&&(v=50),Y.attr("width",u).attr("height",v+qa.height+t.bottom)}var va=d3.scaleLinear().range([v+t.top,t.top]).domain([aa,Z]),wa=_.extend({enable:!1,ticksType:"auto",ticksCount:10,ticksSpace:20,measures:{},font:{bold:!1,color:"#333333",italic:!1,fontSize:"10px",fontName:"IRANSans",formatString:b.chartProp.info.formatString||",.2f",formatStringCustom:",.2f"}},b.chartProp.info.secondaryY);if((F||I)&&(wa.enable=!1),wa.enable){var xa=d3.max(K,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden&&wa.measures[a.seriesKey]===!0}),function(a){return"kpi"==a.type?d3.max(a.data):"series"==a.type?+a.data||0:void 0})}),ya=d3.min(K,function(a){return d3.min(a.series.filter(function(a,b){return!a.prop.hidden&&wa.measures[a.seriesKey]===!0}),function(a){return"kpi"==a.type?d3.min(a.data):"series"==a.type?+a.data||0:void 0})}),da=e(ya,xa);ya=da.min,xa=da.max;var za=d3.scaleLinear().range([v+t.top,t.top]).domain([ya,xa])}"%"==b.chartProp.info.formatString&&(b.chartProp.info.formatString=".0%"),b.chartProp.info.fontYaxe=_.extend({bold:!1,color:"#333333",italic:!1,fontSize:"10px",fontName:"IRANSans",formatString:b.chartProp.info.formatString||",.2f",formatStringCustom:",.2f"},b.chartProp.info.fontYaxe);var Aa=d3.axisLeft(va).tickFormat(function(a){var c=d3.format(b.chartProp.info.fontYaxe.formatString);return persian(c(a),y)+""}),Ba=_.extend({ticksType:"auto",ticksCount:10,ticksSpace:20},b.chartProp.info.AxeY),Ca=Math.floor(v/22)+1;"count"===Ba.ticksType&&(Ca=Ba.ticksCount),"space"===Ba.ticksType&&(Ca=Math.floor(v/Ba.ticksSpace)+1),Aa.ticks(Ca);var Da=Y.append("g").attr("class","y axis").attr("transform","translate(-10,0)");Da.call(Aa),Da.selectAll(".tick text").attr("fill",b.chartProp.info.fontYaxe.color).styles({"font-size":b.chartProp.info.fontYaxe.fontSize,"font-family":b.chartProp.info.fontYaxe.fontName,"font-weight":b.chartProp.info.fontYaxe.bold?"bold":"normal","font-style":b.chartProp.info.fontYaxe.italic?"italic":"normal"});var Ea=Da._groups[0][0].getBBox(),Fa={};if(wa.enable){var Ga=d3.axisRight(za).tickFormat(function(a){var b=d3.format(wa.font.formatString);return persian(b(a),y)+""}),Ca=Math.floor(v/22)+1;"count"===wa.ticksType&&(Ca=wa.ticksCount),"space"===wa.ticksType&&(Ca=Math.floor(v/wa.ticksSpace)+1),Ga.ticks(Ca);var Ha=Y.append("g").attr("class","y2 axis").attr("transform","translate(-10,0)");Ha.call(Ga),Ha.selectAll(".tick text").attr("fill",wa.font.color).styles({"font-size":wa.font.fontSize,"font-family":wa.font.fontName,"font-weight":wa.font.bold?"bold":"normal","font-style":wa.font.italic?"italic":"normal"}),Fa=Ha._groups[0][0].getBBox()}var Ia=u-Ea.width-(Fa.width||0)-t.left;K=K.filter(function(a,b){return b<Ia-2-.1*Ia});var Ja=[u-Ia-(Fa.width||0)+10,u-10-(Fa.width||0)],Ka=.1,La=1==K.length?1:K.length<5?.5:0,Ma=K[0].series.filter(function(a,b){return!a.prop.hidden&&"bar"==a.prop.seriesType});0==Ma.length&&(La=0),Da.attr("transform","translate("+(Ea.width+t.left)+",0)"),wa.enable&&Ha.attr("transform","translate("+(Ia+t.left+Ea.width)+",0)");var Na=$.grep(K[0].series,function(a,b){return"bar"==a.prop.seriesType&&!a.prop.hidden}),Oa=($.grep(K[0].series,function(a,b){return"line"==a.prop.seriesType&&!a.prop.hidden}),d3.scaleBand().range(Ja).paddingInner(Ka).paddingOuter(La));Oa.domain(K.map(function(a){return a.label+"#"+a.index}));var Pa=d3.scaleBand().range([0,Oa.bandwidth()]).domain($.map(Na,function(a){return a.label})),Qa=d3.scaleBand().range(Ja).paddingInner(Ka).paddingOuter(La);ha=Math.abs(Ja[0]-Ja[1])/ka,ia=K.length/ha,Qa.domain(K.map(function(a){return a.label+"#"+a.index}).filter(ja));var ma=d3.axisBottom(Qa).tickFormat(function(a){var b=a.replace(new RegExp("#\\d+$"),"");return(b.length>ga?"...":"")+persian(b.substring(0,ga),y)});Y.append("svg:rect").attr("class","background").style("fill","white").style("opacity","0").attr("width",Ia).attr("height",+Y.attr("height")).attr("transform","translate("+(u-Ia)+",0)").on("click",function(c,d){s||""!=a.levels&&(B()||(C(!0),b.isSort=U.property("checked"),app.chartCommons.drillDown.up(b.ChartInPageId),b.parameters={isUp:!0,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.levelTypeUtils.getParam(b),$(r).charts(b.type,"refreshWithData",b)))}),b.chartProp.info.horizontalLines&&Y.select(".y.axis").selectAll("g line").attr("x2",Ia).attr("x1","-6").style("opacity","0.1"),Y.select(".y.axis").append("text").attr("transform","translate(0,"+t.top+") "+f()).attr("y",6).attr("dy",".71em").attr("class","axes-x-label").text("");var Ra=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0;Y.append("g").attr("class","x axis").attr("transform","translate(0,"+(v+t.top)+")").call(ma);var Sa=Y.select(".x.axis").selectAll("g text").attr("class","axes-x-label").attr("x","-1em").attr("dy","0.1em").attr("y","0").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal");Y.select(".x.axis").selectAll("g").append("title").text(function(a){return persian(a.replace(new RegExp("#\\d+$"),""),y)});var Ta=d3.max(Sa._groups[0],function(a){return a.getBBox().width}),Ua=Sa._groups[0].length*Ta,Va=Ua>Ia;Va=!0,Va&&Sa.attr("transform",f());var Wa=function(c,d){if($(".tipsy").remove(),!s){if(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.value],b.chartProp.globalvariable),$(r+" .gd.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(r+" .circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),!c.canDrill)return void(x&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:c.value,refreshDatasource:b.input.RefreshDatasource}));if(!B()){C(!0);var e=U.property("checked");b.isSort=e,app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal,b.input.RefreshDatasource),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.levelTypeUtils.getParam(b),$(r).charts(b.type,"refreshWithData",b)}}},Xa=Y.append("g").attr("class","charts"),Ya=Xa.selectAll(".gd").data(K).enter().append("g").attr("transform","translate("+Oa(K[0].label+"#"+K[0].index)+",0)").attr("class",function(a){return"gd "+(""!=a.onClickVal||a.canDrill||Ra||x?" pointer":"")}).on("click",Wa),Za={lastTexts:[],clear:function(){this.lastTexts=[]},noConfilict:function(a,b,c,d){for(var e=!0,f=0;f<this.lastTexts.length;f++){var g=this.lastTexts[f];if(e=c+Oa.bandwidth()/2-a/2>g.x+3||g.y-g.h-3>d||g.y<d-b-3,!e)break}return e&&(this.lastTexts.length>=5&&this.lastTexts.shift(),this.lastTexts.push({x:c+a/2,y:d,h:b})),e}},$a=b.chartProp.info.overlapBars||!1,_a=b.chartProp.info.isBox;if(F||_a)if(_a){var ab=Ya.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}),c=a.series.map(function(a){return a.label}),d=a.series.map(function(a){return a.data});return h(b,d,c),b}).enter().append("g");ab.attr("class",function(a){return"series series-"+a.sIndex}).attr("transform",function(a,b){return"translate("+Pa(a.label)+",0)"});var bb=function(a){var b=va;return wa.enable&&wa.measures[a.seriesKey]===!0&&(b=za),b(a.data>=0?a.data>Z?Z:a.data:0)},cb=5,db=Pa.bandwidth()-2*cb;ab.append("line").attr("x1",cb).attr("x2",db+cb).attr("y1",function(a){return bb(a.box.q2)}).attr("y2",function(a){return bb(a.box.q2)}).attr("stroke",function(a){return a.prop.seriesColor}),ab.append("line").attr("x1",db/2+cb).attr("x2",db/2+cb).attr("y1",function(a){return bb(a.box.min)}).attr("y2",function(a){return bb(a.box.q1)}).attr("stroke",function(a){return a.prop.seriesColor}),ab.append("line").attr("x1",db/3+cb).attr("x2",2*db/3+cb).attr("y1",function(a){return bb(a.box.min)}).attr("y2",function(a){return bb(a.box.min)}).attr("stroke",function(a){return a.prop.seriesColor}),ab.append("line").attr("x1",db/3+cb).attr("x2",2*db/3+cb).attr("y1",function(a){return bb(a.box.max)}).attr("y2",function(a){return bb(a.box.max)}).attr("stroke",function(a){return a.prop.seriesColor}),ab.append("line").attr("x1",db/2+cb).attr("x2",db/2+cb).attr("y1",function(a){return bb(a.box.max)}).attr("y2",function(a){return bb(a.box.q3)}).attr("stroke",function(a){return a.prop.seriesColor}),ab.append("circle").attr("cx",db/2+cb).attr("cy",function(a){return bb(a.box.avg)}).attr("r","5px").attr("stroke",function(a){return a.prop.seriesColor}),ab.append("rect").attr("width",db).attr("x",cb).attr("stroke",function(a){return a.prop.seriesColor}).attr("fill",function(a){var b=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(c,d){$.each(d,function(c,d){if(a.label!==d.firstField)return!0;switch(+d.operand){case 1:b=d.secondFieldColor}})}),b+"99"}).attr("y",function(a){return bb(a.box.q3)}).attr("height",function(a){return bb(a.box.q1)-bb(a.box.q3)}).on("click",function(a){s&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)}),ab.append("g").selectAll("text").data(function(a){return[a.box.q1,a.box.q2,a.box.q3,a.box.min,a.box.max]}).enter().append("text").attr("y",function(a){return bb(a)}).attr("x",cb).text(function(a){return a.prop.showValues?persian(d3.format(D(a.prop.font,a.prop))(a.data),y):""}).styles(function(a){return{"font-family":a.prop.font.fontName,"font-size":a.prop.font.fontSize,fill:a.prop.font.color,"font-weight":a.prop.font.bold?"bold":"normal","font-style":a.prop.font.italic?"italic":"normal"}})}else{var eb=K.map(function(a){return a.label+"#"+a.index}),ab=Ya.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}),c=a.series.map(function(a){return a.label}),d=a.series.map(function(a){return a.data});return h(b,d,c),b}).enter().append("g");ab.attr("class",function(a){return"series series-"+a.sIndex}).attr("transform",function(a,b){return"translate(0,0)"}),ab.append("rect").attr("width",Oa.bandwidth()).attr("fill",function(a,b){var c=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("y",function(a){var b=va;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za),b(a.data>=0?a.data>Z?Z:a.data:0)}).attr("height",function(a){var b=va;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za),a.data>0?b(Math.max(0,aa))-b(a.data>Z?Z:a.data):b(a.data<aa?aa:a.data)-b(0)}).on("click",function(a){s&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)});var fb=[[]],fb=ab.append("text").attr("class",function(a){return"series-"+a.sIndex}).text(function(a,b){return a.prop.showValues?0==a.data?"":persian(d3.format(D(a.prop.font,a.prop))(a.data),y):""}).attr("dy","0.3em").style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).attr("x",function(a){var b=d3.select(this).node().getBBox().width;return Oa.bandwidth()/2-b/2}).attr("y",function(a){var b=va;wa.enable&&1==wa.measures[a.seriesKey]&&(b=za);var c=a.data>0?b(Math.max(0,aa))-b(a.data>Z?Z:a.data):b(a.data<aa?aa:a.data)-b(0),d=b(a.data>=0?a.data>Z?Z:a.data:0);return d+c/2});app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,ab,function(a){return Oa.bandwidth()/2-5},function(a){var b=va;wa.enable&&1==wa.measures[a.seriesKey]&&(b=za);var c=a.data>0?b(Math.max(0,aa))-b(a.data>Z?Z:a.data):b(a.data<aa?aa:a.data)-b(0),d=b(a.data>=0?a.data>Z?Z:a.data:0);return d+c/2-24}),s&&app.chartCommons.commentUtils.setOnHighlightListener(Ya.selectAll(".series"),b.ChartInPageId);ab.selectAll(".comment");ab._groups.forEach(function(a,b){var c=fb[b]||[],d=0,e=0;a=_.reverse(a),c=_.reverse(c),a.forEach(function(a,b){var f=(c[b]||null,a.__data__.data),g=d3.select(a).select("rect").attr("height");f>=0?(d3.select(a).attr("transform",function(a,b){return"translate(0,"+d+")"}),d-=+g):(d3.select(a).attr("transform",function(a,b){return"translate(0,"+e+")"}),e+=+g)})})}else{var ab=Ya.selectAll("nothings").data(function(a){var b=a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden}),c=a.series.map(function(a){return a.label}),d=a.series.map(function(a){return a.data});return h(b,d,c),b}).enter().append("g").attr("class",function(a){return"series series-"+a.sIndex}).attr("transform",function(a,b){return $a?"":"translate("+Pa(a.label)+",0)"});ab.append("rect").attr("sss","xxxs").attr("width",$a?Oa.bandwidth():Pa.bandwidth()).attr("fill",function(a,b){var c=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("y",function(a){var b=va;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za),b(a.data>=0?a.data>Z?Z:a.data:Math.min(0,Z))}).attr("height",function(a){var b=va;wa.enable&&1==wa.measures[a.seriesKey]&&(b=za);var c=a.data>0?b(Math.max(0,aa))-b(a.data>Z?Z:a.data):b(a.data<aa?aa:a.data)-b(Math.min(0,Z));return c}).on("click",function(a){s&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,ab,function(a){return $a?Oa.bandwidth()/2-5:Pa.bandwidth()/2-5},function(a){return va(a.data>=0?a.data>Z?Z:a.data:Math.min(0,Z))-24}),s&&app.chartCommons.commentUtils.setOnHighlightListener(Ya.selectAll(".series"),b.ChartInPageId);var gb=Xa.selectAll(".gd-text").data(K).enter().append("g").attr("transform","translate("+Oa(K[0].label+"#"+K[0].index)+",0)").attr("class",function(a){return"gd-text"+(""!=a.onClickVal||Ra?" pointer":"")}).on("click",Wa),fb=gb.selectAll("nothings").data(function(a){return a.series.filter(function(a){return"series"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden})}).enter().append("text").text(function(a){return a.prop.showValues?persian(d3.format(D(a.prop.font,a.prop))(a.data),y):""}).attr("class",function(a){return"series series-"+a.sIndex}).style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).attr("x","0.3em").attr("dy",function(a){return a.data>=0?"-0.3em":"1em"}).attr("transform",function(a,b){return $a?"":"translate("+Pa(a.label)+",0)"}).attr("y",function(a){var b=va;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za),b(a.data>=0?a.data>Z?Z:a.data:a.data)}).on("click",function(a){s&&app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId)}),eb=K.map(function(a){return a.label+"#"+a.index});fb._groups.forEach(function(a,b){a.forEach(function(a,c){var d=a.getBBox().width,e=a.getBBox().height,f=$a?Oa.bandwidth():Pa.bandwidth(),g=f/2-d/2;d3.select(a).attr("x",g),Za.noConfilict(d,e,Oa(eb[b]),d3.select(a).attr("y"))||$(a).remove()})}),Za.clear()}if(1==app.dashboardLayoutVersion||b.editMode){var Sa=Y.select(".x.axis").selectAll("g text").attr("class","axes-x-label").attr("x","-1em").attr("transform",function(){return Va?f():"rotate(0)"}).attr("dy","0.1em").attr("y","0").style("font-family",b.chartProp.info.font.fontName).style("font-size",b.chartProp.info.font.fontSize).attr("fill",b.chartProp.info.font.color).style("font-weight",b.chartProp.info.font.bold?"bold":"normal").style("font-style",b.chartProp.info.font.italic?"italic":"normal"),pa=$(r).find(".x").first().get(0),qa=pa.getBBox();qa.height-t.bottom;Y.attr("width",u).attr("height",z+qa.height)}var ab=Ya.selectAll("nothing").data(function(a){return a.series.filter(function(a){return"kpi"==a.type&&"bar"==a.prop.seriesType&&!a.prop.hidden})}).enter().append("g").attr("class","kpi").attr("transform",function(a,b){return"translate("+Pa(a.label)+",0)"});ab.append("rect").attr("width",Pa.bandwidth()).attr("y",function(a){return va(1.1*a.data[1])}).attr("height",function(a){return v+t.top-va(1.1*a.data[1])}).attr("fill","#eee"),ab.append("rect").attr("width",Pa.bandwidth()).attr("y",function(a){return va(a.data[0])}).attr("height",function(a){return v+t.top-va(a.data[0])}).attr("fill",function(a,b){return A(b)}),ab.append("rect").attr("width",Pa.bandwidth()).attr("y",function(a){return va(1*a.data[1])}).attr("height",function(a){return 0==a.data[1]?0:2}).attr("fill","#333");var hb=function(a){return a>0?"#71b37c":0==a?"#8d8d8d":"#e14d57"};ab.append("circle").attr("r",function(a){return 0==a.data[1]?0:Pa.bandwidth()/2<5?Pa.bandwidth()/2:5}).attr("fill",function(a){return hb(a.data[1])}).attr("cx",Pa.bandwidth()/2).attr("cy",function(a){return va(1.1*a.data[1])-(Pa.bandwidth()/2<5?Pa.bandwidth()/2:5)});var ib=Xa.append("g"),jb=Xa.append("g"),kb=Xa.append("g"),lb=Xa.append("g"),mb=l(K),ob=d3.curveLinear,pb=d3.area().x(function(a){return Oa(a.label)+Oa.bandwidth()/2}).y0(v+t.top).y1(va(aa)).curve(ob),qb=d3.area().x(function(a){return Oa(a.label)+Oa.bandwidth()/2}).y0(v+t.top).y1(function(a){var b=va;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za),b(a.value>Z?Z:a.value<aa?aa:a.value)}).curve(ob),rb=d3.line().x(function(a){return Oa(a.label)+Oa.bandwidth()/2}).y(function(a){var b=va,c=aa;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za,c=ya),b(c)}).curve(ob),sb=d3.line().x(function(a){return Oa(a.label)+Oa.bandwidth()/2}).y(function(a){var b=va,c=aa,d=Z;return wa.enable&&1==wa.measures[a.seriesKey]&&(b=za,c=ya,d=xa),b(a.value>d?d:a.value<c?c:a.value)}).curve(ob),tb=jb.selectAll("nothings").data(mb).enter().append("path").attr("class",function(a){return"area  series-"+a.sIndex}).attr("id",function(a,b){return"area"+b}).attr("fill",function(a,c){return b.chartProp.indicator&&b.chartProp.indicator.length?"url(#"+b.id+"-"+c+")":a.prop.seriesColor}).attr("z-index","-1").style("opacity",function(a){return a.prop.areaOpacity||.1}).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-area"==b?I?a.valueStacked:a.values:0});w?tb.attr("d",function(a){return _.isArray(a)&&0==a.length?"M0,0":0===a?"M0,0":pb.curve(j(a[0].prop.lineStyle))(a)}).transition().duration(b.animationDuration).attr("d",function(a){return _.isArray(a)&&0==a.length?"M0,0":0===a?"M0,0":qb.curve(j(a[0].prop.lineStyle))(a)}):tb.attr("d",function(a){return _.isArray(a)&&0==a.length?"M0,0":0===a?"M0,0":qb.curve(j(a[0].prop.lineStyle))(a)}),tb=kb.selectAll("nothings").data(mb).enter().append("path").attr("class",function(a){return"line  series-"+a.sIndex}).attr("id",function(a,b){return"line"+b}).attr("stroke",function(a,c){return b.chartProp.indicator&&b.chartProp.indicator.length?"url(#"+b.id+"-"+c+")":a.prop.seriesColor}).attr("stroke-width",function(a,b){return a.prop.lineWeight}).attr("stroke-dasharray",function(a,b){return a.prop.lineFace}).datum(function(a){var b=a.prop.lineType;return"line-dot-area"==b||"line-dot"==b||"line-area"==b||"line"==b?I?a.valueStacked:a.values:0}),w?tb.attr("d",function(a){return _.isArray(a)&&0==a.length?rb:0===a?rb:rb.curve(j(a[0].prop.lineStyle))(a)}).transition().duration(b.animationDuration).attr("d",function(a){return _.isArray(a)&&0==a.length?sb:0===a?sb:sb.curve(j(a[0].prop.lineStyle))(a)}):tb.attr("d",function(a){return _.isArray(a)&&0==a.length?sb:0===a?sb:sb.curve(j(a[0].prop.lineStyle))(a)});var Ra=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0,ub=function(c,d){if(s)return void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId);if(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.primv],b.chartProp.globalvariable),$(r+" .circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(r+" .gd.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.onClickVal)return void(x&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:c.value,refreshDatasource:b.input.RefreshDatasource}));if(!B()){C(!0),b.isSort=e,app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal,b.input.RefreshDatasource),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.levelTypeUtils.getParam(b),$(r).charts(b.type,"refreshWithData",b);var e=U.property("checked")}};tempG=lb.selectAll("nothings").data(mb).enter().append("g").attr("class",function(a){return"circle-group "+(""!=a.onClickVal||Ra?" pointer":"")});var vb=tempG.selectAll(".entry").data(function(a){return I?a.valueStacked:a.values}).enter().append("g").attr("class","entry"),tb=vb.append("circle").attr("class",function(a){return"circle series-"+a.sIndex}).attr("stroke",function(a,b){var c=[a],d=d3.select(this.parentNode).datum().seriesLable,e=K[b].series.map(function(a){return a.label}),f=K[b].series.map(function(a){return a.data});h(c,f,e),a=c[0];var g=a.prop.seriesColor;return a.thenRows&&$.each(a.thenRows,function(a,b){$.each(b,function(a,b){if(d!=b.firstField)return!0;switch(+b.operand){case 1:g=b.secondFieldColor}})}),g}).attr("stroke-width",function(a,b){return a.prop.lineWeight}).on("click",ub).on("mouseover",function(a){d3.select(this).attr("stroke-width",parseInt(a.prop.lineWeight)+3)}).on("mouseout",function(a){d3.select(this).attr("stroke-width",a.prop.lineWeight)}).attr("cx",function(a){return sb.curve(j(a.prop.lineStyle)).x()(a)}).style("opacity",function(){var a=d3.select(this.parentNode).datum().prop.lineType;return"line-area"==a||"line"==a?0:1}).attr("r","4");if(w?tb.attr("cy",va(aa)).transition().duration(b.animationDuration).attr("cy",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}):tb.attr("cy",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,vb,function(a){return sb.curve(j(a.prop.lineStyle)).x()(a)-5},function(a){return sb.curve(a.prop.lineStyle).y()(a)-24}),s){var Sa=tempG.selectAll(".entry");app.chartCommons.commentUtils.setOnHighlightListener(tempG.selectAll(".entry"),b.ChartInPageId)}ib.attr("class","colorStepGroups").selectAll(".colorStepGroup").data(mb).enter().append("linearGradient").attr("id",function(a,c){return b.id+"-"+c}).attr("class","colorStepGroup").selectAll("stop-color").data(function(a){var b=[],c=1/(2*(a.values.length-1)),d=-1*c;return a.values.map(function(e,f){var g={value:e.value,label:a.label,color:a.prop.seriesColor},i=[g],j=K[f].series.map(function(a){return a.label}),k=K[f].series.map(function(a){return a.data});h(i,k,j),g=i[0],g.offset=d<0?0:d,b.push(g),g=$.extend({},g),d+=2*c,g.offset=d>1?d-c:d,b.push(g)}),b}).enter().append("stop").attr("stop-color",function(a,b){var c=a.color;return a.thenRows&&$.each(a.thenRows,function(b,d){$.each(d,function(b,d){if(a.label!=d.firstField)return!0;switch(+d.operand){case 1:c=d.secondFieldColor}})}),c}).attr("offset",function(a){return a.offset}),tb=lb.selectAll("nothings").data(mb).enter().append("g").attr("class",function(a){return"text-vals"}).selectAll("text").data(function(a){return a.prop.showValues?I?a.valueStacked:a.values:0}).enter().append("text").text(function(a){return persian(d3.format(D(a.prop.font,a.prop))(a.valueLabel),y)}).attr("class",function(a){return"text-value pointer series-"+a.sIndex}).style("font-family",function(a){return a.prop.font.fontName}).style("font-size",function(a){return a.prop.font.fontSize}).attr("fill",function(a){return a.prop.font.color}).style("font-weight",function(a){return a.prop.font.bold?"bold":"normal"}).style("font-style",function(a){return a.prop.font.italic?"italic":"normal"}).style("text-anchor",app.lang.isRtl()?"start":"end").attr("dy","-10").attr("dy","-10").attr("x",function(a,b){var c=d3.select(this).node().getBBox().width;d3.select(this).node().getBBox().height,Oa(eb[b]),sb.curve(j(a.prop.lineStyle)).y()(a);return sb.curve(j(a.prop.lineStyle)).x()(a)-c/2}).on("click",ub),w?tb.attr("y",va(aa)).transition().duration(b.animationDuration).attr("y",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}):tb.attr("y",function(a){return sb.curve(j(a.prop.lineStyle)).y()(a)}),$(r+" .circle").each(function(){var a=$(this);$(this).tipsy({gravity:k(a),html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c="",d=$(this).parent("g.entry").index(),e=$(this).parents("g.circle-group").index();return c=i(d,a,"line",e)}})}),$(r+" .text-value").each(function(){var a=$(this);$(this).tipsy({gravity:k(a),html:!0,title:function(){var a=+b.chartProp.info.tooltip||1,c="",d=$(this).index(),e=$(this).parent("g.text-vals").index()-$(this).parent("g.text-vals").parent().children().length/2;return c=i(d,a,"line",e)}})}),U.on("change",m),V.on("change",m);var wb=!0,xb=setTimeout(function(){b.isSort?U.property("checked",!0).each(m):U.each(m),wb=!1},0);$(r).trigger("heightChange")};var chartTypes={BAR:1,PIE:2,LINE:3,GAUGE:4,TABLE:5,MAP:6,UserControl:7,Radar:8,Tree:9,Text:10,CE_MAP:{1:"barLine",2:"pie",4:"gauge",5:"table",6:"map",7:"userControl",8:"radar",9:"tree",10:"text"},NAMES:{1:"نمودار خطی-میله‌ای",2:"نمودار دایره‌ای",4:"نمودار عقربه‌ای",5:"جدول",7:"کنترل کاربری",8:"نمودار رادار",9:"نمودار درختی",10:"متن"}};!function(a){function b(b,c,d){var e=a(this).data("settings");if("undefined"!=typeof e)return e.isRefresh=!0,
e=a.extend(e,c),setTimeout(function(){g(b,e.input,e,!0,d),e.parameters.selectedItem=null,e.parameters.isUp=!1},0),this}function c(a){var b=a.data("ajaxRequest");return null!=b&&b.abort(),this}function d(b,d,e){c(a(this)),e=a.extend({refreshRelatedDatasources:!0},e);var h=(a(this),a(this).data("settings"));if(h=a.extend(h,d),h.isRefresh=!1,"undefined"!=typeof h.chartProp){"undefined"==typeof b.isCustom&&(b={id:+b,isCustom:!1}),app.chartCommons.setFilterParameter(h),h.parameters.filterHierarchy=app.chartCommons.getFilterHierarchy(h.ChartInPageId),h.editMode&&(h.parameters.ChartInfo=a("#divChart").data("chartInfo"));var i=[];if(b.id==chartTypes.TABLE)for(var j in h.chartProp.series)h.chartProp.series.hasOwnProperty(j)&&i.push({Name:j,Type:h.chartProp.series[j].rowResult});h.dataUrl=f(b);var k=app.mobileMode?proxy.ajax:a.ajax,l=a.extend(h.parameters,{resultRows:i,type:h.dataType}),m=JSON.stringify(l);e.refreshRelatedDatasources&&h.ChartInPageId&&(app.moderation.dashboadpage.refreshRelatedDatasources(h.input.RefreshDatasource,[+h.ChartInPageId]),app.filterBox&&app.filterBox.refresh&&app.filterBox.refresh());var n=k({url:h.dataUrl,type:"POST",dataType:"json",contentType:"application/json",data:m,async:h.async,requestId:h.requestId,success:function(a){g(b,a,h,!0),h.parameters.selectedItem=null,h.parameters.isUp=!1}});return a(this).data("ajaxRequest",n),this}}function e(b,c){var d=a.extend({},h,c),e=a(this);d.id=e.attr("id"),d.type=b,e.data("isChart",!0),e.data("settings",d),"undefined"==typeof b.isCustom&&(b={id:+b,isCustom:!1}),app.chartCommons.setFilterParameter(d),app.chartCommons.levelTypeUtils.getParam(d),b=d.type;var i=[];if(b.id==chartTypes.TABLE)for(var j in d.chartProp.series)d.chartProp.series.hasOwnProperty(j)&&i.push({Name:j,Type:d.chartProp.series[j].rowResult});d.dataUrl=f(b);var k=app.mobileMode?proxy.ajax:a.ajax,l=a.extend(d.parameters,{resultRows:i,type:d.dataType}),m=JSON.stringify(l),n=app.customChart.getConfig(b);if(n.needData===!1)g(b,{result:!0},d,!1);else{var o=k({url:d.dataUrl,type:"POST",dataType:"json",data:m,success:function(c,e,f){d.mobileModeData={isOnline:e,date:f},"undefined"==typeof d.chartProp&&c.detail&&(d=a.extend(d,JSON.parse(c.detail))),d.beforeDraw&&d.beforeDraw(d),g(b,c,d,!1),d.parameters.selectedItem=null,d.parameters.isUp=!1},cache:!1,contentType:"application/json",error:function(b){d.error&&d.error(d),!app.mobileMode&&b&&b.responseJSON&&b.responseJSON.forceSignout&&(console.log("شما از برنامه خارج شده‌اید. ممکن است کاربر دیگری با نام کاربری شما وارد سیستم شده باشد."),alert("شما از برنامه خارج شده‌اید. ممکن است کاربر دیگری با نام کاربری شما وارد سیستم شده باشد."),window.location.href=app.urlPrefix);var c="#"+d.id;a(c).addClass("bar-chart").empty(),b&&b.responseJSON&&b.responseJSON.desc?a(c).addClass("bar-chart").html("<b>"+b.responseJSON.title+' </b>  <span class="glyphicon glyphicon-info-sign"> </span> <br/ > <p style="direction:ltr;">'+b.responseJSON.desc+"</p>"):a(c).addClass("bar-chart").html('خطا در دریافت اطلاعات <span class="glyphicon glyphicon-info-sign"> </span>'),a(c).css({display:"flex",overflow:"auto",padding:"20px 14px","flex-flow":"column"})},requestId:d.requestId});a(this).data("ajaxRequest",o)}return e}function f(a){if(a.isCustom)return app.urlPrefix+"api/chartdata/getdata";switch(parseInt(a.id)){case chartTypes.UserControl:return app.urlPrefix+"api/chartdata/GetColumnMembers";case chartTypes.Tree:return app.urlPrefix+"Charts/BarChart/getTreeData";default:return app.urlPrefix+"api/chartdata/getdata"}}function g(b,c,d,e,f){if(d.editMode||dashboard.setLastRefresh(d.ChartInPageId,c.LastRefresh),d.input=c,arguments.length<4)return void a.error("تعداد پارامترها باید حداقل چهار تا باشد");if("undefined"!=typeof d.chartProp){if(d.chartProp=_.extend({info:{}},d.chartProp),d.chartProp.info.refreshPeriod&&+d.chartProp.info.refreshPeriod>0){var g=a("#"+d.id).data("timeout");g&&clearTimeout(g);var h=setTimeout(function(){a("#"+d.id).charts(b,"refreshWithData")},1e3*+d.chartProp.info.refreshPeriod);a("#"+d.id).data("timeout",h)}a("#dashboard-chart-panel").trigger("chartComplete",[d,c]);var i="#"+d.id;e&&!f?a(i).parents(".chart-widget").find(".temporal").remove():a(i).addClass("bar-chart").empty(),d.fromCommentDialog&&a(i).addClass("fromCommentDialog"),c=a.extend({EditPermission:!1,Description:"",LastRefresh:0,isFresh:!0,title:""},c);var j={title:null,showProgress:function(){},isProgress:function(){}};if(j=d3.select(i).titlebar({EditPermission:c.EditPermission,editLink:d.editLink,RemoveFromPage:d.RemoveFromPage,deleteLink:d.removeLink,desc:c.Description,LastRefresh:c.LastRefresh,isFresh:c.isFresh,title:c.title,chartId:d.chartId,ChartInPageId:d.ChartInPageId,type:b,editMode:d.editMode,refreshWithData:e,redrowAll:f,settings:d,showFilterIcon:"undefined"==typeof d.chartProp.info.showFilterIcon?1:+d.chartProp.info.showFilterIcon}),d.titlebar=j,j.showProgress(!1),!c.result)return a("#"+d.id).append(app.chartCommons.getError(c)),void a("#"+d.id).css({display:"flex",overflow:"auto",padding:"20px 14px","flex-flow":"column"});if("undefined"==typeof b.isCustom&&(b={id:+b,isCustom:!1}),b.isCustom){d.selector="#"+d.id;var k="undefined"!=typeof c.series?c.series.labels:[],l="undefined"!=typeof c.kpis?c.kpis.labels:[];return d.editMode&&a(d.selector).trigger("chartproperty",[l.concat(k)]),void app.customChart.charts[b.id](c,d,e,j)}switch(parseInt(b.id)){case chartTypes.BAR:app.charts.bar.draw(c,d,e,j);break;case chartTypes.GAUGE:app.charts.gauge.draw(c,d,e,j);break;case chartTypes.PIE:app.charts.pie.draw(c,d,e,j);break;case chartTypes.TABLE:app.charts.table.draw(c,d,e,j);break;case chartTypes.MAP:app.charts.map.draw(c,d,e,j);break;case chartTypes.UserControl:app.charts.userControl.draw(c,d,e,j);break;case chartTypes.Radar:app.charts.radar.draw(c,d,e,j);break;case chartTypes.Tree:app.charts.tree.draw(c,d,e,j);break;case chartTypes.Text:app.charts.text.draw(c,d,e,j)}app.lang.setLang({selector:i}),d.finishDraw&&d.finishDraw(d),app.chartCommons.renderComments(d,c)}}var h={isSort:!1,fadeSpeed:200,fadeinEasing:"easeInOutCubic",chartId:-1,animationDuration:1e3,animationEase:"cubic-out"};jQuery.fn.charts=function(f,g){var h={init:e,refresh:b,refreshWithData:d,abort:c};if(h[g]){var i=Array.prototype.slice.call(arguments,0),g=i.splice(1,1);return h[g].apply(this,i)}return"object"!=typeof method&&"undefined"!=typeof method&&g?void a.Error("Method "+g+" does not exist on jQuery.sitBarChart: you must specify type"):h.init.apply(this,arguments)},app.chartCommons.draw=g,app.customChart={cacheJs:{},charts:{},getJs:function(b,c,d){return"undefined"!=typeof app.customChart.cacheJs[b]?void c(app.customChart.cacheJs[b]):void a.ajax({url:app.urlPrefix+"api/customcharts/getjs/"+b,cache:!0}).done(function(d){app.customChart.cacheJs[b]=d;var e=a("head script#id-"+b);e.length||(a("head").append("<script id=id-"+b+"> app.customChart.charts["+b+"] = function(input, settings, refreshWithData, titlebar){\n"+d.code+"\n}</script>"),a("head").append('<style type="text/css">\n'+d.css+"\n</style>")),c(d)}).fail(function(a,b,c){d&&d()})},getConfig:function(a){var b={};return app.customChart.config&&app.customChart.config[a.id]&&a.isCustom&&(b=app.customChart.config[a.id]||{}),b}}}(jQuery);var app=app||{};app.charts=app.charts||{},app.charts.gauge={},app.charts.gauge.draw=function(a,b,c,d){function e(a,b){return"undefined"==typeof a?null:a[b]}function f(a,b){return isNaN(a)?b?-99999:99999:parseFloat(a)}function g(a,b,c,d){var e="arc"==d?200:150,f="arc"==d?200:"number"==d?100:60;if(a>=c*e)return{w:a/c,h:Math.max(b,f)};if(b>=c*f)return{w:Math.max(a,e),h:b/c};var g=Math.ceil(1*a/e),h=Math.ceil(1*c/g);return{w:Math.max(a/g,e),h:Math.max(b/h,f)}}function h(a,c,d,e,f){var g=5;f-=48;var h=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").styles({width:f+"px","margin-left":"10px","margin-right":"10px"}).append("div");if(b.chartProp.info.showLabels){h.append("div").text(function(a,b){var d=p[b];return persian(c.label+(d?" - "+d:""),n)})}var i=h.append("div"),j=i.append("div").style("text-align","left").style("position","relative");ta=$(i._groups[0][0]).width();var k=i.append("svg").attr("width",ta).attr("class","line-svg").attr("height",v+2*g),l=0,m=0;if(ia>=0&&ha>=0)l=0,m=1.2*ha;else{var o=Math.max(Math.abs(ha),Math.abs(ia));l=o*-1.2,m=1.2*o}var q=d3.scaleLinear().range([0,ta]).domain([l,m]);k.append("rect").attr("height",v).attr("y",g).attr("fill",ja[0]).attr("width",ta),k.append("rect").attr("height",v).attr("y",g).attr("fill",function(a,b){return na(a[2])}).attr("width",0).transition().duration(b.animationDuration).attr("width",function(a){return q(a[0])}),k.append("rect").attr("width","5").attr("x","0").attr("y","0").attr("height",v+g).attr("fill","#333").transition().duration(b.animationDuration).attr("x",function(a){return q(a[0])-5<l?l:q(a[0])-5}),k.filter(function(a){return!isNaN(a[1])}).append("path").attr("transform",function(a){return"translate("+(q(a[1])-5<l?l:q(a[1])-5)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none").attr("class","target-pointer").style("display",function(a){return isNaN(a[1])?"none":"auto"});var r=i.append("div").style("text-align","left").style("position","relative");j.append("div").attr("class","gauge-value").style("color",G.color).style("font-family",G.fontName).style("font-size",G.fontSize).style("font-weight",G.bold?"bold":"normal").style("font-style",G.italic?"italic":"normal").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}).style("left","0").transition().duration(b.animationDuration).style("left",function(a){var b=$(this).outerWidth(),c=q(a[0])-5-b/2;return c<0&&(c=0),c+b>ta&&(c=ta-b),c+"px"}).tween("text",function(a){var b=oa("0",a[0]),c=this;return function(a){c.textContent=b(a)}});var s=(r.filter(function(a){return!isNaN(a[1])}).append("div").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[1]),n)}).style("left",function(a){var b=$(this).outerWidth(),c=q(a[1])-5-b/2;return c<0&&(c=0),c+b>ta&&(c=ta-b),c+"px"}).style("display",function(a){return isNaN(a[1])?"none":"auto"}),$(j._groups[0][0]).find(".gauge-value").outerHeight()),t=$(r._groups[0][0]).find(".gauge-target").outerHeight();j.style("height",s+"px"),$(j._groups[0][0]).find(".gauge-value").css("height",s+"px"),$(j._groups[0][0]).find(".gauge-value").css("position","absolute"),r.style("height",t+"px"),$(r._groups[0][0]).find(".gauge-target").css("height",t+"px"),$(r._groups[0][0]).find(".gauge-target").css("position","absolute")}function i(a,c,d,e,f){var g=d3.select(a);g.style("display","none");var h=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div");if(b.chartProp.info.haveCustomText)return h.append("div").attr("class","custom-text-gauge").call(function(a){var e=_.reduce(app.chartCommons.indicator.getIndicator(H[d].series,o,b.chartProp.indicator),function(a,b){return a=a||[],a.push(b),a}),f=o[0];_.forOwn(b.chartProp.series,function(a,c){"value"==b.chartProp.series[c].type&&(f=c)});var g=_.filter(e,{firstField:f});a.html(function(a,e){var f=p[e],h=persian(c.label+(f?" - "+f:""),n),i=persian(d3.format(G.formatString)(a[0]),n),j=_.filter(g,{operand:"2"}),k="";b.chartProp.info.icons&&b.chartProp.info.icons.length&&(k=b.chartProp.info.icons[d%b.chartProp.info.icons.length],k="string"==typeof k?"":k.name),j.length&&(k=j[j.length-1].secondFieldIcon);var l=_.filter(g,{operand:"1"}),m=G.color;l.length&&(m=l.pop().secondFieldColor);var o=b.chartProp.info.customText.replace("@value",i).replace("@label",h).replace("@icon",'<i class="'+k+'"></i>');return o})}),void $(g.node()).transition("scale");var i="small"==b.chartProp.info.height?"mini":"medium"==b.chartProp.info.height?"tiny":"large"==b.chartProp.info.height?"":"large";h.append("div").attr("class","ui xstatistic "+i).call(function(a){var c=_.reduce(app.chartCommons.indicator.getIndicator(H[d].series,o,b.chartProp.indicator),function(a,b){return a=a||[],a.push(b),a}),e=o[0];_.forOwn(b.chartProp.series,function(a,c){"value"==b.chartProp.series[c].type&&(e=c)});var f=_.filter(c,{firstField:e});a.styles({color:G.color,"font-family":G.fontName,"font-size":G.fontSize,"font-weight":G.bold?"bold":"normal","font-style":G.italic?"italic":"normal"}),a.append("div").classed("value",!0).append("span").attr("class","text").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}),a.select(".value").append("i").attr("class",function(a,c){var e=_.filter(f,{operand:"2"}),g="";return b.chartProp.info.icons&&b.chartProp.info.icons.length&&(g=b.chartProp.info.icons[d%b.chartProp.info.icons.length],g="string"==typeof g?"":g.name),e.length&&(g=e[e.length-1].secondFieldIcon),g}).style("color",function(a){var b=_.filter(f,{operand:"1"}),c=G.color;return b.length&&(c=b.pop().secondFieldColor),c}).style("font-size",G.fontSize).style("margin","0 10px")}).call(function(a){var d=a.append("div").classed("xlabel",!0).styles({"font-family":G.fontName,"line-height":"1.7em","font-size":"40%","font-weight":"300"});b.chartProp.info.valueStaticTop&&d.append("div").text(b.chartProp.info.valueStaticTop),b.chartProp.info.showLabels&&d.append("div").text(function(a,b){var d=p[b];return persian(c.label+(d?" - "+d:""),n)}),b.chartProp.info.valueStaticDown&&d.append("div").text(b.chartProp.info.valueStaticDown)});$(g.node()).transition("scale")}function j(a,c,d,e,f){var g=5;f-=48;var h=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").styles({"margin-left":"10px","margin-right":"10px",width:f+"px"}).append("div"),i="12";if(b.chartProp.info.showLabels){h.append("div").text(function(a,b){var d=p[b];return persian(c.label+(d?" - "+d:""),n)});var i="9"}var j=h.append("div").attr("class","col-md-"+i),k=j.append("div").style("text-align","left").style("position","relative");ta=$(j._groups[0][0]).width();var l=j.append("svg").attr("width",ta).attr("height",v+2*g),m=[];l._groups.forEach(function(a,b){var c=a[0].__data__;m.push(d3.scaleLinear().range([0,ta]).domain([c[3],c[6]]))}),l.append("rect").attr("height",v).attr("y",g).attr("fill",ma).attr("width",ta),l.append("rect").attr("height",v).attr("y",g).attr("fill",la).attr("width",function(a,b){return m[b](a[5])}),l.append("rect").attr("height",v).attr("y",g).attr("fill",ka).attr("width",function(a,b){return m[b](a[4])}),l.append("path").attr("transform",function(a,b){var c=m[b](a[3]<a[6]?a[3]:a[6]);return"translate("+(c<m[b](a[3])?m[b](a[3]):c)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),l.append("path").attr("transform",function(a,b){var c=m[b](a[6]<a[6]?a[6]:a[6]);return"translate("+(c<m[b](a[3])?m[b](a[3]):c)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),l.append("path").attr("transform",function(a,b){var c=m[b](a[5]<a[6]?a[5]:a[6]);return"translate("+(c<m[b](a[3])?m[b](a[3]):c)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none").attr("class","none"),l.append("path").attr("transform",function(a,b){var c=m[b](a[4]<a[6]?a[4]:a[6]);return"translate("+(c<m[b](a[3])?m[b](a[3]):c)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","1").attr("stroke","black").attr("fill","none"),l.append("rect").attr("width","5").attr("x","0").attr("y","0").attr("height",v+g).attr("fill","#333").transition().duration(b.animationDuration).attr("x",function(a,b){var c=m[b](a[0]<a[3]?a[3]:a[0]<a[6]?a[0]:a[6])-5;return c<m[b](a[3])?m[b](a[3]):c}),l.filter(function(a){return!isNaN(a[1])}).append("path").attr("transform",function(a,b){var c=m[b](a[1]<a[6]?a[1]:a[6])-5;return"translate("+(c<m[b](a[3])?m[b](a[3]):c)+",0)"}).attr("d","M0 "+g+" 0 "+(v+2*g)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none");var o=j.append("div").style("text-align","left").style("position","relative").style("margin-top","-10px");k.append("span").attr("class","gauge-value").style("color",G.color).style("font-family",G.fontName).style("font-size",G.fontSize).style("font-weight",G.bold?"bold":"normal").style("font-style",G.italic?"italic":"normal").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}).style("left","0").transition().duration(b.animationDuration).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[0])-5-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"}).tween("text",function(a){var b=oa(a[3],a[0]),c=this;return function(a){c.textContent=b(a)}}),o.filter(function(a){return!isNaN(a[1])}).append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[1]),n)}).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[1])-5-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"}),o.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[3]),n)}).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[3])-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"}),o.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[6]),n)}).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[6])-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"}),o.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[4]),n)}).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[4])-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"}),o.append("span").attr("class","gauge-target").text(function(a){return persian(d3.format(G.formatString)(a[5]),n)}).style("left",function(a,b){var c=$(this).outerWidth(),d=m[b](a[5])-c/2;return d<0&&(d=0),d+c>ta&&(d=ta-c),d+"px"});var q=$(k._groups[0][0]).find(".gauge-value").outerHeight();k.style("height",q+"px"),$(k._groups[0][0]).find(".gauge-value").css("height",q+"px"),$(k._groups[0][0]).find(".gauge-value").css("position","absolute");var r=$(o._groups[0][0]).find(".gauge-target").outerHeight();o.style("height",r+"px"),$(o._groups[0][0]).find(".gauge-target").css("height",r+"px"),$(o._groups[0][0]).find(".gauge-target").css("position","absolute")}function k(a,c,d,e,f){m(a,c,d,e,f,function(a,d,e,f,g,h,i,j,k,l,m,o){var r=0,s=0;if(ia>=0&&ha>=0)r=0,s=1.2*ha;else{var t=Math.max(Math.abs(ha),Math.abs(ia));r=t*-1.2,s=1.2*t}var u=d3.scaleLinear().range([f,g]).domain([r,s]),w=d3.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),x=d3.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(function(a){return u(a)}),y=a.append("div").style("margin-bottom","0").append("svg").attr("width",2*h).attr("height",o).append("g").attr("transform","translate("+h+","+h+")");b.chartProp.info.showLabels&&a.append("div").text(function(a,b){var d=p[b];return persian(c.label+(d?" - "+d:""),n)});var z=y.append("path").attr("d",w).attr("transform","translate("+d+","+d+")").attr("fill",ja[0]),A=(z.node().getBBox().height,y.append("path").attr("fill",function(a,b){return na(a[2])}).attr("transform","translate("+d+","+d+")").transition().duration(b.animationDuration).attrTween("d",function(a){var b=d3.interpolate(r,a[0]);return function(a){return x(b(a))}}),y.append("g"));A.append("rect").attr("width","5").attr("transform","translate("+(d-2.5)+","+d+")").attr("height",h+e).attr("fill","#333"),A.attr("transform","rotate("+(f*(180/Math.PI)+180)+" "+d+" "+d+" )"),A.append("circle").attr("r","5").attr("cx",d).attr("cy",d),A.transition().duration(b.animationDuration).attrTween("transform",function(a){var b=u(a[0]),c=f*(180/Math.PI)+180;if(isNaN(b))e=c;else var e=u(a[0])*(180/Math.PI)+180;var g=d3.interpolate(c,e);return function(a){return"rotate("+g(a)+" "+d+" "+d+" )"}}),y.filter(function(a){return!isNaN(a[1])}).append("path").attr("d","M"+d+" "+d+" "+d+" "+(v+d+e)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none").attr("transform",function(a){return"rotate("+u(a[1])*(180/Math.PI)+" "+d+" "+d+")translate(0,"+(-h-e)+")"}),y.filter(function(a){return!isNaN(a[1])}).append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(G.formatString)(a[1]),n)}).attr("transform",function(a){return"rotate("+u(a[1])*(180/Math.PI)+" "+d+" "+d+" )translate("+d+","+(-h+d-e)+")"});$(q+" svg > g").get(0).getBBox(),y.append("text").attr("class","gauge-value").attr("text-anchor","middle").style("fill",G.color).style("font-family",G.fontName).attr("dy","1em").style("font-size",G.fontSize).style("font-weight",G.bold?"bold":"normal").style("font-style",G.italic?"italic":"normal").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}).attr("transform","translate("+d+","+m+")").transition().duration(b.animationDuration).tween("text",function(a){var b=oa(a[3],a[0]),c=this;return function(a){c.textContent=b(a)}})})}function l(a,c,d,e,f){m(a,c,d,e,f,function(a,d,e,f,g,h,i,j,k,l,m,o){function q(a,b,c,d){w.append("path").attr("d",function(c,d){var e=c.map(function(a,b){return t[d](a)});return u({start:e[a],end:e[b]})}).attr("fill",c).attr("transform","translate("+d+","+d+")")}function r(a){w.append("path").attr("d","M"+d+" "+d+" "+d+" "+(v+e+d)).attr("stroke-dasharray","2,2").attr("stroke-width","2").attr("stroke","black").attr("fill","none").attr("transform",function(b,c){return"rotate("+a(b,c)+" "+d+" "+d+")translate(0,"+(-h-e)+")"})}function s(a,b){w.append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(G.formatString)(a[b]),n)}).attr("transform",function(b,c){return"rotate("+t[c](a(b))*(180/Math.PI)+" "+d+" "+d+")translate("+d+","+(-h+d-e)+")"})}var t=[];a.each(function(a,b){t.push(d3.scaleLinear().range([f,g]).domain([a[3],a[6]]))});var u=(d3.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),d3.arc().innerRadius(h).outerRadius(i).startAngle(function(a){return a.start}).endAngle(function(a){return a.end})),w=(d3.arc().innerRadius(h).outerRadius(i).startAngle(f).endAngle(g),a.append("div").style("margin-bottom","0").append("svg").attr("width",2*h+2*d).attr("height",o).append("g").attr("transform","translate("+h+","+h+")"));b.chartProp.info.showLabels&&a.append("div").style("margin-bottom","10px").text(function(a,b){var d=p[b];return persian(c.label+(d?" - "+d:""),n)}),q(3,4,ka,d),q(4,5,la,d),q(5,6,ma,d);var x=w.append("g");x.append("rect").attr("width","5").attr("transform","translate("+(d-2.5)+","+d+")").attr("height",h+e).attr("fill","#333"),x.attr("transform","rotate("+(f*(180/Math.PI)+180)+" "+d+" "+d+")"),x.append("circle").attr("r","5").attr("cx",d).attr("cy",d),x.transition().duration(b.animationDuration).attrTween("transform",function(a,b){var c=t[b](a[0]<a[3]?a[3]:a[0]<a[6]?a[0]:a[6]),e=f*(180/Math.PI)+180,g=e;if(!isNaN(c)){var h=a[0]<a[3]?a[3]:a[0]<a[6]?a[0]:a[6];g=t[0](h)*(180/Math.PI)+180}var b=d3.interpolate(e,g);return function(a){return"rotate("+b(a)+" "+d+" "+d+")"}}),e=0,r(function(a,b){return t[b](a[3])*(180/Math.PI)}),r(function(a,b){return t[b](a[6])*(180/Math.PI)}),r(function(a,b){return t[b](a[4])*(180/Math.PI)}),r(function(a,b){return t[b](a[5])*(180/Math.PI)}),s(function(a){return a[3]},3),s(function(a){return a[6]},6),s(function(a){return a[4]},4),s(function(a){return a[5]},5);w.append("text").attr("class","gauge-value").attr("text-anchor","middle").style("fill",G.color).style("font-family",G.fontName).attr("dy","1em").style("font-size",G.fontSize).style("font-weight",G.bold?"bold":"normal").style("font-style",G.italic?"italic":"normal").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}).attr("transform","translate("+d+","+m+")").transition().duration(b.animationDuration).tween("text",function(a){var b=oa(a[3],a[0]),c=this;return function(a){c.textContent=b(a)}});d3.select(w.node().parentNode).attr("height",o)})}function m(a,c,d,e,f,g){var h=d3.select(a).selectAll("nothings").data(function(a){return a.kpis}).enter().append("div").style("text-align","center"),i=0,j=10,k=0,l="small"==b.chartProp.info.chartSize?2*-Math.PI/5:"medium"==b.chartProp.info.chartSize?2*-Math.PI/4:2*-Math.PI/3,m=-1*l,o=Math.abs(Math.sin(l)),p=h.append("div").attr("class","gauge-value").style("color",G.color).style("font-family",G.fontName).style("font-size",G.fontSize).style("font-weight",G.bold?"bold":"normal").style("font-style",G.italic?"italic":"normal").text(function(a){return persian(d3.format(G.formatString)(a[0]),n)}),q=h.append("svg").append("text").attr("class","gauge-target").attr("text-anchor","middle").attr("dy","-0.3em").text(function(a){return persian(d3.format(G.formatString)("80"),n)}),r=$(p.node()).height(),s={width:$(p.node()).width(),height:$(p.node()).height()};p.remove();q.node().getBBox().height,q.node().getBBox();h.select("svg").remove();var t=b.chartProp.info.showLabels?22:0,u=Math.min(f-2*j,e-r-t)-2*k,w=u/2,x=w,y=x-v,z=2*w*o,A=2*y*o,B=(Math.abs(Math.cos(l))+Math.abs(Math.cos(m)))*w,C=(B>=s.width,Math.abs(Math.sin(l))*w-r),D=u;D=Math.max(D,u),g&&g(h,i,j,l,m,x,y,o,z,A,C,D)}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var n=(a.title,a.chartInfo,"undefined"==typeof a.lang||0==+a.lang),o="undefined"!=typeof a.series?a.series.labels:[],p="undefined"!=typeof a.kpis?a.kpis.labels:[],q=(a.seriesLablesCaptions,a.kpisLablesCaptions,b.LabelY,"#"+b.id),r={top:95,right:20,bottom:0,left:20},s=$(q).width(),t=$(q).hasClass("fromCommentDialog"),u="small"==b.chartProp.info.chartSize?220:"medium"==b.chartProp.info.chartSize?250:"large"==b.chartProp.info.chartSize?280:"veryLarge"==b.chartProp.info.chartSize?330:250,v="small"==b.chartProp.info.height?20:"medium"==b.chartProp.info.height?30:"large"==b.chartProp.info.height?40:"veryLarge"==b.chartProp.info.height?50:30,w=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked;u+r.top+r.bottom,d3.scaleOrdinal(d3.schemeCategory10);b.width=s;var x=d.isProgress,y=d.showProgress,z=(d.title,e(b.chartProp.info.font,"formatString")||b.chartProp.info.formatString||",.2f"),A=e(b.chartProp.info.font,"formatStringCustom")||b.chartProp.info.formatString||",.2f",B=e(b.chartProp.info.font,"fontName")||"Droid",C=e(b.chartProp.info.font,"fontSize")||b.chartProp.info.fontSize||"46px",D=null!=e(b.chartProp.info.font,"italic")?e(b.chartProp.info.font,"italic"):b.chartProp.info.textItalic||!1,E=e(b.chartProp.info.font,"color")||b.chartProp.info.color||"#333333",F=null!=e(b.chartProp.info.font,"bold")?e(b.chartProp.info.font,"bold"):b.chartProp.info.textBold||!1,G={};if(G.formatString=z,G.formatStringCustom=A,G.fontName=B,G.fontSize=C,G.italic=D,G.color=E,G.bold=F,G.formatString="custom"!=G.formatString?G.formatString:G.formatStringCustom,app.chartCommons.setDefault(b.chartProp,p.concat(o),"gauge"),b.editMode&&$(q).trigger("chartproperty",[o.concat(p)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var H=prepareData(a);b.chartProp.info.segmentType=b.chartProp.info.segmentType||"singleSegment";var I="singleSegment"==b.chartProp.info.segmentType,J=b.chartProp.info.value,K=b.chartProp.info.target,L=b.chartProp.info.trend,M=b.chartProp.info.status,N=b.chartProp.info.min,O=b.chartProp.info.max,P=b.chartProp.info.yellow,Q=b.chartProp.info.green;""==K&&(K=void 0);var R=!isNaN(J||"nan"),S=!isNaN(K||"nan"),T=!isNaN(M||"nan"),U=!isNaN(L||"nan"),V=!isNaN(N||"nan"),W=!isNaN(O||"nan"),X=!isNaN(P||"nan"),Y=!isNaN(Q||"nan");$(q).css({overflow:"auto",padding:"0"}),_.isArray(a.levels)&&0!=a.levels.length||b.editMode||$(q).css({overflow:"hidden"});for(var Z=0;Z<H.length;Z++){var aa=H[Z],ba=[];ba=I?[+J,+K,+M,+L]:[+J,+K,+L,+N,+P,+Q,+O];for(var ca=!1,da=0;da<aa.series.length;da++){var ea=b.chartProp.series[o[da]],fa=-1;fa=I?"value"!=ea.type||R?"target"!=ea.type||S?"status"!=ea.type||T?"trend"!=ea.type||U?-1:3:2:1:0:"value"!=ea.typeMs||R?"target"!=ea.typeMs||S?"trend"!=ea.typeMs||U?"min"!=ea.typeMs||V?"yellow"!=ea.typeMs||X?"green"!=ea.typeMs||Y?"max"!=ea.typeMs||W?-1:6:5:4:3:2:1:0,fa!=-1&&(ba[fa]=aa.series[da]*+ea.numberFactor,ca=!0)}(ca||0==aa.kpis.length)&&aa.kpis.push(ba),I?(("undefined"==typeof ba[0]||isNaN(ba[0]))&&(ba[0]=0),("undefined"==typeof ba[2]||isNaN(ba[2]))&&(ba[2]=1),("undefined"==typeof ba[3]||isNaN(ba[3]))&&(ba[3]=1)):(("undefined"==typeof ba[0]||isNaN(ba[0]))&&(ba[0]=0),("undefined"==typeof ba[2]||isNaN(ba[2]))&&(ba[2]=1),("undefined"==typeof ba[3]||isNaN(ba[3]))&&(ba[3]=0),("undefined"==typeof ba[4]||isNaN(ba[4]))&&(ba[4]=ba[0]>0?.3*ba[0]:30),("undefined"==typeof ba[5]||isNaN(ba[5]))&&(ba[5]=ba[0]>0?.7*ba[0]:70),("undefined"==typeof ba[6]||isNaN(ba[6]))&&(ba[6]=ba[0]>0?1.2*ba[0]:100))}var ga=d3.select(q).append("div").attr("class","legend-bar temporal");if(ga.breadcrumb(a.levels,b,d,n),!a.matrix||0==a.matrix.length)return void d3.select(q).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var ha=d3.max(H,function(a){return d3.max(a.kpis,function(a){return Math.max(f(a[0],!0),f(a[1],!0))})}),ia=d3.min(H,function(a){return d3.min(a.kpis,function(a){return Math.min(f(a[0],!1),f(a[1],!1))})}),ja=["#eee","#ddd","#ccc"],ka=b.chartProp.info.colorAriaOne||"#e14d57",la=b.chartProp.info.colorAriaTwo||"#FBEE58",ma=b.chartProp.info.colorAriaThree||"#71b37c",na=function(a){return a>0?ma:0==a?la:ka},oa=function(a,b){var c,d,e=/^([0-9,.-]+)$/,f=d3.format(G.formatString);return c=e.exec(a),d=e.exec(b),c&&d?(a=parseFloat(c[1]),b=parseFloat(d[1])-a,function(c){var d=a+b*c;return persian(f(d),n)}):function(b){return a}};2==app.dashboardLayoutVersion;var pa=$(q).width(),qa=$(q).height(),ra=H.length,sa=g(pa,qa,ra,b.chartProp.info.style);d3.select(q).styles({display:"flex","align-items":"center","flex-direction":"column"});var ta=s;sa.h-=28,sa.w-=28,_.isArray(a.levels)&&0!=a.levels.length||b.editMode||1!=ra||$(q).css({overflow:"hidden"});d3.select(q).append("div").attr("class","temporal gauge-container").styles({display:"flex","align-items":"center","flex-wrap":"wrap","justify-content":"space-around","flex-grow":1,"flex-shrink":1,"flex-basis":"0%",width:"100%"}).selectAll("nothings").data(H).enter().append("div").attr("class",function(a,b){return""!=a.onClickVal||w?"gauge-item temporal pointer":"gauge-item temporal"}).on("click",function(a,c){return t?void app.chartCommons.commentUtils.clickOnCommentIcon(a,b.ChartInPageId):""==a.onClickVal?void(w&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:a.value,refreshDatasource:b.input.RefreshDatasource})):void(x()||(y(!0),b.drill="down",app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,a.onClickVal,b.input.RefreshDatasource),b.parameters={selectedItem:a.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId},app.chartCommons.levelTypeUtils.getParam(b),$(q).charts(b.type,"refreshWithData",b)))}).each(function(a,c){switch(b.chartProp.info.style){case"arc":I?k(this,a,c,sa.h,sa.w):l(this,a,c,sa.h,sa.w);break;case"horizontal":I?h(this,a,c,sa.h,sa.w):j(this,a,c,sa.h,sa.w);break;case"circle":I?k(this,a,c,sa.h,sa.w):l(this,a,c,sa.h,sa.w);break;case"semiCircle":I?k(this,a,c,sa.h,sa.w):l(this,a,c,sa.h,sa.w);break;case"verical":I?h(this,a,c,sa.h,sa.w):j(this,a,c,sa.h,sa.w);break;case"number":i(this,a,c,sa.h,sa.w)}})};var app=app||{};app.charts=app.charts||{},app.charts.map={},app.charts.map.draw=function(a,b,c,d){function e(c){function d(a,b){var c=K.indexOf(a.properties.Code+"");coordinates=d3.mouse(d3.select(l).select(".map-container").node());var d=coordinates[0]+7,e=coordinates[1]+7;d3.select(l+" #map-tooltip ").transition().duration(200).style("opacity",.9),d3.select(l+" #map-tooltip ").html(h(c,m,a.properties.Name)).style("left",d+"px").style("top",e+"px");
}function e(){d3.select(l+" #map-tooltip ").transition().duration(500).style("opacity",0)}function k(d){if(n&&!b.editMode)return void app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:d.value,refreshDatasource:b.input.RefreshDatasource});var e,f,g,h=[q[d.properties.Code+""]];if(d&&S!==d){var i=G.centroid(d);e=i[0],f=i[1],g=4,S=d}else e=D/2,f=C/2,g=1,S=null,h=null;L.selectAll("path").classed("active",S&&function(a){return a===S}),L.transition().duration(750).attr("transform","translate("+D/2+","+C/2+")scale("+g+")translate("+-e+","+-f+")").style("stroke-width",1.5/g+"px"),b.editMode||(app.chartCommons.userFilter.setFilter({id:b.ChartInPageId,values:h,variableType:c.VariableType,dimensionName:a.dimensionName,chartInPageId:b.ChartInPageId,datasourceId:a.DataSourceId,disableClear:!1}),app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),app.filterBox.refresh())}var c=JSON.parse(c),o=j.indexOf(b.chartProp.info.mainSeries);o==-1&&(o=0),$(l+" .temporal").remove();for(var p={},q={},r=0,s=0;s<a.matrix.length;s++){var t=+a.series.data[s][o];p[a.matrix[s].captions[0]]=t,q[a.matrix[s].values[0]]=a.matrix[s].values[0],r+=t}b.chartProp.info.colorStart=b.chartProp.info.colorStart||"#31a354",b.chartProp.info.colorEnd=b.chartProp.info.colorEnd||"#c7e9c0";var u=$.extend({formatString:",.0f",colorStart:"#31a354",colorEnd:"#c7e9c0"},b.chartProp.series[a.series.labels[o]]),v=d3.max(a.series.data,function(a){return+a[o]}),w=d3.min(a.series.data,function(a){return+a[o]}),x=d3.interpolate(b.chartProp.info.colorEnd,b.chartProp.info.colorStart),y="pointer";b.editMode||(y="");var z=d3.select(l).append("div").attr("class","legend temporal "+y).styles({"text-align":"left",position:"absolute","background-color":"#fff","z-index":"1","border-radius":"4px"});b.chartProp.info.legendPosition=b.chartProp.info.legendPosition||"top left";var A={"top right":{top:0,right:0},"top left":{top:0,left:0},"top center":{top:0,right:"50%",transform:"translate(50%)"},"bottom right":{bottom:0,right:0},"bottom left":{bottom:0,left:0},"bottom center":{bottom:0,right:"50%",transform:"translate(50%)"},"center right":{top:"50%",right:0},"center left":{top:"50%",left:0}};if(z.styles(A[b.chartProp.info.legendPosition]),f(l,b.chartProp.info.colorStart,b.chartProp.info.colorEnd,w,v,u,z),b.chartProp.info.showChart&&b.chartProp.info.showChartLegend){var B=_.map(a.series.labels,function(a,b){return{name:a,prop:g(b)}});z.legend({font:b.chartProp.info.legendFont,width:$(l).width(),selector:l,data:B.filter(function(a,b){return!a.prop.hidden}).map(function(a){return{label:(a.prop.name||a.name).replace(/^\[measure\]/,""),color:a.prop.color,key:a.name}})},i)}var C=$(l).height(),D=$(l).width();C<150&&(C=150);var E=topojson.feature(c,c.objects.map),F=d3.geoMercator().scale(1).translate([0,0]),G=d3.geoPath().projection(F),H=G.bounds(E),I=.95/Math.max((H[1][0]-H[0][0])/D,(H[1][1]-H[0][1])/C),J=[(D-I*(H[1][0]+H[0][0]))/2,(C-I*(H[1][1]+H[0][1]))/2];F.scale(I).translate(J),G=G.projection(F);var K=a.matrix.map(function(a){return a.captions[0]}),L=d3.select(l).append("div").style("overflow","hidden").style("position","relative").attr("class","map-container temporal").append("svg").attr("class","temporal").attr("width",D).attr("height",C).append("g");d3.select(l).append("div").attr("id","map-tooltip").attr("class","temporal"),L.selectAll("path").data(E.features).enter().append("path").attr("d",G).classed("pointer",!0).style("fill",function(c,d){var e=a.series.labels,f=K.indexOf(c.properties.Code+"");if(f!==-1){var g=a.series.data[f],h=app.chartCommons.indicator.getIndicator(g,e,b.chartProp.indicator),i=_.flatten(h);if(i.length>0){var j=_.filter(i,{operand:"1"}),k=_.first(j);if(k)return k.secondFieldColor}}var l=p[c.properties.Code+""];return"undefined"==typeof l?b.chartProp.info.defaultColor||"#eee":x(v-w==0?1:(l-w)/(v-w))}).on("click",k).on("mousemove",d).on("mouseout",e),L.append("path").datum(topojson.mesh(c,c.objects.map,function(a,b){return!0})).attr("id","state-borders").attr("stroke",b.chartProp.info.borderColor||"#666").style("stroke-width",(b.chartProp.info.borderWidth||"0.5")+"px").attr("d",G);var M=d3.scaleOrdinal(d3.schemeCategory10),N=.05*C,O=5,P=8;if(_.each(a.series.labels,function(a,b){var c=g(b);c.color=c.color||M(b)}),b.chartProp.info.showChart&&"bar"==b.chartProp.info.chartType&&L.selectAll("g.bar").data(E.features).enter().append("g").classed("bar",!0).attr("transform",function(b){var c=K.indexOf(b.properties.Code+""),d=a.series.data[c];return b.childes=_.map(d,function(a,b){return{index:b,data:a}}),b.childes=_.filter(b.childes,function(a){return!g(a.index).hidden}),"translate("+(G.centroid(b)[0]-b.childes.length*O/2)+", "+G.centroid(b)[1]+")"}).on("click",k).on("mousemove",d).on("mouseout",e).selectAll("rect").data(function(a){return a.childes}).enter().append("rect").attr("width",O+"px").attr("fill",function(a,b){return g(a.index).color||M(b)}).attr("height",function(a){var b=a.data/v;return b*N+"px"}).attr("transform",function(a,b){var c=a.data/v;return"translate("+b*O+", -"+c*N+")"}),b.chartProp.info.showChart&&"pie"==b.chartProp.info.chartType){var Q=d3.pie().value(function(a){return a.data}),R=d3.max(a.series.data,function(a){return d3.max(a,function(a){return+a})});L.selectAll("g.pie").data(E.features).enter().append("g").classed("pie",!0).attr("transform",function(b){var c=K.indexOf(b.properties.Code+""),d=a.series.data[c];b.childes=_.map(d,function(a,b){return{index:b,data:a}}),b.childes=_.filter(b.childes,function(a){return!g(a.index).hidden});var e=d3.max(b.childes,function(a){return a.data}),f=e/R*N*.65,h=.65*N/2.5;h>f&&(f=h);var i=d3.arc().innerRadius(0).outerRadius(f);return _.each(b.childes,function(a){a.arc=i}),"translate("+(G.centroid(b)[0]-b.childes.length*O/2)+", "+G.centroid(b)[1]+")"}).on("click",k).on("mousemove",d).on("mouseout",e).selectAll("path").data(function(a){return Q(a.childes)}).enter().append("path").attr("d",function(a){return a.data.arc(a)}).attr("fill",function(a,b){return g(a.data.index).color||M(b)})}b.chartProp.info.showName&&L.selectAll(".city-name").data(E.features).enter().append("svg:text").classed("city-name",!0).text(function(a){return a.properties.Name}).attr("x",function(a){return G.centroid(a)[0]}).attr("y",function(a){return G.centroid(a)[1]+P}).attr("text-anchor","middle").attr("fill",b.chartProp.info.nameEditor.color||"#333").style("font-size",b.chartProp.info.nameEditor.fontSize||"9px").style("font-family",b.chartProp.info.nameEditor.fontName||"IRANSans").style("font-weight",b.chartProp.info.nameEditor.bold?"bold":"200").style("font-style",b.chartProp.info.nameEditor.italic?"italic":"inherit").on("click",k).on("mousemove",d).on("mouseout",e),b.chartProp.info.showValue&&L.selectAll(".data-value").data(E.features).enter().append("svg:text").classed("data-value",!0).text(function(a){var c=p[a.properties.Code+""];return"undefined"==typeof c?"":persian(d3.format(b.chartProp.info.valueEditor.formatString)(c),i)}).attr("x",function(a){return G.centroid(a)[0]}).attr("y",function(a){return G.centroid(a)[1]+P+(b.chartProp.info.showName?-10:0)}).attr("text-anchor","middle").attr("fill",b.chartProp.info.valueEditor.color||"#333").style("font-size",b.chartProp.info.valueEditor.fontSize||"9px").style("font-family",b.chartProp.info.valueEditor.fontName||"IRANSans").style("font-weight",b.chartProp.info.valueEditor.bold?"bold":"200").style("font-style",b.chartProp.info.valueEditor.italic?"italic":"inherit").on("click",k).on("mousemove",d).on("mouseout",e);var S}function f(c,d,e,f,g,h,j){if(!b.chartProp.info.showLegend)return d3.select(c).append("div");var k=h.name||a.seriesLablesCaptions[0],l=.05*$(c).width();j.append("span").text(k).style("margin","0 7px");var m=j.append("div").classed("ltr",!0).style("display","inline-block");return m.append("span").text(persian(d3.format(h.formatString)(f||0),i)),m.append("div").style("background","-webkit-linear-gradient(to right, "+e+", "+d+")").style("background","-o-linear-gradient(to right, "+e+", "+d+")").style("background","-moz-linear-gradient(to right, "+e+", "+d+")").style("background","linear-gradient(to right, "+e+", "+d+")").style("display","inline-block").style("height","7px").style("width",l+"px").style("margin","0 7px"),m.append("span").text(persian(d3.format(h.formatString)(g||100),i)),b.chartProp.info.showChart&&b.chartProp.info.showChartLegend||j.on("click",function(){c&&$(c).trigger("legendClick",[k,0,{key:a.series.labels[0]}])}),j}function g(c){return b.chartProp.series[a.series.labels[c]]}function h(c,d,e){if(c==-1)return app.chartCommons.tooltip.tooltipFormatter({points:a.series.labels.map(function(b,c){return{data:"NaN",label:g(c).name||a.series.labels[c],format:g(c).formatString}}),key:e,sum:"NaN",avg:"NaN",format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,i);var f=a.series.data[c];if(1==d)f=[f[0]];else if(2==d)var f=f.filter(function(a,b){return!g(b).hidden});return f=f.map(function(b,c){return{data:b,label:g(c).name||a.seriesLablesCaptions[c],format:g(c).formatString}}),app.chartCommons.tooltip.tooltipFormatter({points:f,key:e,sum:d3.sum(f,function(a){return a.data}),avg:d3.sum(f,function(a){return a.data})/f.length,format:f.length>0?f[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat)}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var i=(a.title,a.chartInfo,"undefined"==typeof a.lang||0==+a.lang),j="undefined"!=typeof a.series?a.series.labels:[],k="undefined"!=typeof a.kpis?a.kpis.labels:[],l="#"+b.id,m=+b.chartProp.info.tooltip||1,n=(d3.scaleOrdinal(d3.schemeCategory10),d.isProgress,d.showProgress,d.title,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked);if(app.chartCommons.setDefault(b.chartProp,k.concat(j),"map"),b.editMode&&$(l).trigger("chartproperty",[k.concat(j)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));if(!a.matrix||0==a.matrix.length)return void d3.select(l).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var o=b.chartProp.info.map.selectedMap;"undefined"!=typeof b.map&&o==b.map.id?e(b.map.data):(d3.select(l+"").append("div").style("padding","15px").attr("class","temporal info").text("در حال بارگذاری نقشه ..."),$.get(app.urlPrefix+"Moderation/Map/Get?Id="+o,null,function(a){a.result?(b.map=a.map,b.map.id=o,e(a.map.data)):d3.select(l+" .info").text("نقشه انتخاب شده معتبر نیست. در منوی تنظیمات یک نقشه را انتخاب کنید یا نقشه‌ی مورد نظر خود را بارگذاری نمایید.")}))};var app=app||{};app.charts=app.charts||{},app.charts.pie={},app.charts.pie.draw=function(a,b,c,d){function e(){var a=Math.min(p,D)/2,c=+b.chartProp.info.hole/100*a,d=d3.arc().innerRadius(c).outerRadius(a),e=d3.arc().innerRadius(1.1*a).outerRadius(1.1*a);return{radius:a,arc:d,arcText:e}}function f(a){return a.startAngle+(a.endAngle-a.startAngle)/2}function g(c,d){return V?void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId):(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.data.value],b.chartProp.globalvariable),$(o+" path.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.data.onClickVal?void(u&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:c.value,refreshDatasource:b.input.RefreshDatasource})):void(s()||(t(!0),app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.data.onClickVal,b.input.RefreshDatasource),b.parameters={selectedItem:c.data.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.levelTypeUtils.getParam(b),$(o).charts(b.type,"refreshWithData",b))))}function h(a){return{left:a.pos[0]-("start"===a.anchor?a.box.width:0),right:a.pos[0]+("start"===a.anchor?0:a.box.width),top:a.pos[1],bottom:a.pos[1]+a.box.height}}function i(a){var b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform",a);var c,d,e,f=b.transform.baseVal.consolidate().matrix,g=f.a,h=f.b,i=f.c,j=f.d,k=f.e,l=f.f;return(c=Math.sqrt(g*g+h*h))&&(g/=c,h/=c),(e=g*i+h*j)&&(i-=g*e,j-=h*e),(d=Math.sqrt(i*i+j*j))&&(i/=d,j/=d,e/=d),g*j<h*i&&(g=-g,h=-h,e=-e,c=-c),{translateX:k,translateY:l,rotate:Math.atan2(h,g)*Math.PI/180,skewX:Math.atan(e)*Math.PI/180,scaleX:c,scaleY:d}}function j(a){var c=[0,0];c=d3.mouse(C.node());var d=c[0]+7,e=c[1]+7,f=(K.centroid(a),a.data.series),g=+b.chartProp.info.tooltip||1;1==g&&(f=[f[0]]),2==g&&(f=f.filter(function(a){return!a.prop.hidden})),f=f.map(function(a,c){return{data:a.data,label:a.prop.name||a.label,format:b.chartProp.info.formatString,color:a.prop.seriesColor,percentage:100*a.data/y[c]}});var h=app.chartCommons.tooltip.tooltipFormatter({points:f,key:a.data.label,sum:d3.sum(a,function(a){return a.data}),avg:d3.sum(a,function(a){return a.data})/a.length,format:a.length>0?a[0].format:",.2f"},b.chartProp.info.tooltipHeader,b.chartProp.info.tooltipFormat,r);ia.html(h),ia.style("opacity",1).style("left",d+"px").style("top",e+"px")}function k(a){ia.transition().duration(500).style("opacity",1e-6).each("end",function(){ia.style("left","0px").style("top","0px")})}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var l=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),m="undefined"!=typeof a.kpis?a.kpis.labels:[],n=b.chartProp.info.showLabels||b.chartProp.info.showValues||b.chartProp.info.showValuesPercent,o=(b.LabelY,"#"+b.id),p=$(o).width(),q=($(o).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130);b.width=p;var r="undefined"==typeof a.lang||0==+a.lang,s=d.isProgress,t=d.showProgress,u=(d.title,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked);if(app.chartCommons.setDefault(b.chartProp,m.concat(l),"pie"),b.editMode&&$(o).trigger("chartproperty",[m.concat(l)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(o).addClass("pie-chart");var v=prepareData(a),w=a.seriesLablesCaptions,x=a.kpisLablesCaptions;d3Utils.prepareDataForBarChart(v,b,l,m,w,x);var y=0==v.length?[1]:v[0].series.map(function(a,b){return d3.sum(v.map(function(a){return a.series[b].data}))}),z=d3.scaleOrdinal(d3.schemeCategory10);switch(+b.chartProp.info.colorType){case 2:z=d3.scaleOrdinal(d3.schemeBrBG[11]);break;case 3:z=d3.scaleOrdinal(d3.schemePuOr[11]);break;case 4:z=d3.scaleOrdinal(d3.schemeRdGy[11])}var A=function(a){var b=a.series.filter(function(a){return"series"===a.type&&a.prop.main});return b.length>0?b[0].data:a.series.filter(function(a){return"series"===a.type})[0].data},B=d3.select(o).append("div").attr("class","legend-bar temporal");B.breadcrumb(a.levels,b,d,r),b.chartProp.info.showLabels?B.append("div").attr("class","legendBar"):(B.legend({width:p,font:b.chartProp.info.legendFont,position:b.chartProp.info.legendPosition,selector:o,data:v.map(function(a,b){var c=a.series.filter(function(a){return"series"===a.type&&a.prop.main}),d=null;d=c.length>0?c[0]:a.series.filter(function(a){return"series"===a.type})[0];var e={label:a.label.join(", "),color:z(b)};return e})},r),B.style("margin-bottom","12px"));var C=null;C=_.indexOf(["bottom left","bottom right","bottom center"],b.chartProp.info.legendPosition)!=-1?d3.select(o).insert("div",":first-child").attr("class","temporal").style("position","relative"):d3.select(o).append("div").attr("class","temporal").style("position","relative");var D=0;if(app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,2===app.dashboardLayoutVersion){var E=$(o+" .title").outerHeight()||0,F=$(o+" .legend-bar"),G="undefined"==typeof F?0:F.outerHeight(!0);D=$(o).height()-E-G}else 1==app.dashboardLayoutVersion&&(p=q,p>300&&(p=300));var H=C.append("svg").attr("class","temporal").attr("width",p).attr("height",D),I=e(),J=I.radius,K=I.arc,L=I.arcText;H.append("svg:rect").attr("class","background").style("fill","white").style("opacity","0").attr("width",p).attr("height",D).on("click",function(c,d){""!=a.levels&&(s()||(t(!0),b.parameters={isUp:!0,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.drillDown.up(b.ChartInPageId),app.chartCommons.levelTypeUtils.getParam(b),$(o).charts(b.type,"refreshWithData",b)))}).on("mouseout",k);var M=H.append("g").attr("transform","translate("+p/2+","+D/2+")"),N=d3.pie().value(A);b.chartProp.info.sort||(N=N.sort(null));var O=M.datum(v).selectAll("path").data(N).enter();_.each(O._groups[0],function(a){a.__data__.category=a.__data__.data.series[0].category,a.__data__.seriesLable=a.__data__.data.series[0].seriesLable,a.__data__.seriesKey=a.__data__.data.series[0].seriesKey,a.__data__.commentCount=a.__data__.data.series[0].commentCount});var P=null;if(n){var Q,R=0,S=0;M.append("g").attr("class","labels"),P=M.select(".labels").selectAll("text").data(N).enter().append("text"),P.attr("class",function(a,b){return""!=a.data.onClickVal||T||u?"label pointer":" label"}).attr("id",function(a,b){return"l-"+b}).attr("dy",".35em").text(function(a,c){var d=[];return b.chartProp.info.showLabels&&d.push(persian(a.data.label,r)),b.chartProp.info.showValues&&d.push(persian(d3.format(b.chartProp.info.legendFont.formatString)(a.value),r)),b.chartProp.info.showValuesPercent&&d.push(persian(d3.format(",.2f")(100*a.value/y),r)+"%"),d.join(" - ")}).styles({direction:"rtl","font-size":b.chartProp.info.legendFont.fontSize}).on("click",g).on("mouseover",j).on("mousemove",j).each(function(a){var b=f(a)>=Math.PI?"left":"right",c=this.getBBox();Q=c.height,"left"==b?R<c.width&&(R=c.width):S<c.width&&(S=c.width)}),p=p-S-R-20,p<70&&(p=70),D-=2*Q,I=e(),J=I.radius,K=I.arc,L=I.arcText}var T=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0,U=O.append("g").classed("part",!0);U.append("path").attr("class",function(a,b){return""!=a.data.onClickVal||T||u?"arc pointer":" arc"}).attr("title","").attr("fill",function(a,b){return z(b)}).attr("d",K).each(function(a){this._current=a.data.series[0].data}).on("click",g).on("mouseover",j).on("mousemove",j);var V=$(o).hasClass("fromCommentDialog");if(app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,U,function(a){return K.centroid(a)[0]},function(a){return K.centroid(a)[1]}),V&&app.chartCommons.commentUtils.setOnHighlightListener(U,b.ChartInPageId),n){var W=[];P.attr("transform",function(a,b){var c=L.centroid(a);return c[0]=1.1*J*(f(a)<Math.PI?1:-1),W[b]={pos:c,box:this.getBBox(),data:a.data.label[0]},"translate("+c+")"}).style("text-anchor",function(a,b){return W[b].anchor=f(a)>=Math.PI?"start":"end",f(a)>=Math.PI?"start":"end"}).style("display",function(a){var b=d3.select(this),c=(i(b.attr("transform")),"start"==b.style("text-anchor")?1:-1,this.getBBox(),"auto");return c});for(var X=0;X<W.length-1;X++)for(var Y=W[X],Z=X+1;Z<W.length;Z++){var aa=W[Z];if(aa.hide!==!0){var ba=h(Y),ca=h(aa),da=Math.max(ba.left,ca.left),ea=Math.min(ba.right,ca.right),fa=Math.min(ba.bottom,ca.bottom),ga=Math.max(ba.top,ca.top);da<ea&&fa>ga&&(aa.hide=!0)}}P.style("display",function(a,b){return W[b].hide===!0?"none":"auto"}),M.append("g").attr("class","lines");var ha=M.select(".lines").selectAll("polyline").data(N).enter().append("polyline");ha.attr("points",function(a,b){this._current=this._current||a;var c=d3.interpolate(this._current,a);this._current=c(0);var d=L.centroid(a);return d[0]=1*J*(f(a)<Math.PI?1:-1),[K.centroid(a),L.centroid(a),d]}).style("display",function(a,b){return $(o+" #l-"+b).css("display")})}var ia=C.append("div").style("position","absolute").style("color","#fff").style("-moz-border-radius","5px").style("-webkit-border-radius","5px").style("border-radius","5px").style("padding","7px 15px").style("text-align","right").style("z-index","10").style("opacity","0").style("background-color","#000");$(o).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.radar={},app.charts.radar.draw=function(a,b,c,d){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var e=(a.title,a.chartInfo,"undefined"==typeof a.lang||0==+a.lang),f="undefined"!=typeof a.series?a.series.labels:[],g="undefined"!=typeof a.kpis?a.kpis.labels:[],h="#"+b.id,i={top:10,right:20,bottom:0,left:20},j=("small"==b.chartProp.info.chartSize?180:"medium"==b.chartProp.info.chartSize?250:"large"==b.chartProp.info.chartSize?400:"veryLarge"==b.chartProp.info.chartSize?600:130,b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked),k=$(h).width(),l=$(h).height()-i.top-i.bottom;d3.scaleOrdinal(d3.schemeCategory10);b.width=k;var m=d.isProgress,n=d.showProgress;d.title;if($(h).addClass("radar-chart"),app.chartCommons.setDefault(b.chartProp,g.concat(f),"radar"),b.editMode&&$(h).trigger("chartproperty",[g.concat(f)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));for(var o=prepareData(a),p=0;p<o.length;p++)for(var q=0;q<o[p].series.length;q++)b.chartProp.series[f[q]].cumulative&&(o[p].series[q]+=o[p-1]?o[p-1].series[q]:0);var r=d3.select(h).append("div").attr("class","legend-bar temporal");if(r.breadcrumb(a.levels,b,d,e),!a.matrix||0==a.matrix.length)return void d3.select(h).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var s=a.seriesLablesCaptions,t=a.kpisLablesCaptions;d3Utils.prepareDataForBarChart(o,b,f,g,s,t),r.legend({width:k,selector:h,data:o[0].series.filter(function(a){return!a.prop.hidden}).map(function(a){return{label:(a.prop.name||a.label).replace(/^\[measure\]/,""),color:a.prop.seriesColor,key:a.key}})},e);var u=$(h+" .title").outerHeight()||0,v=$(h+" .legend-bar"),w="undefined"==typeof v?0:v.height()+ +v.css("margin-top").replace("px","");l=$(h).height()-u-w,l<150&&(l=150);var x=_.extend({bold:!1,color:"#737373",italic:!1,fontSize:"10px",fontName:"IRANSans",formatString:b.chartProp.info.formatString||",.2f",formatStringCustom:",.2f"},b.chartProp.info.font),y=function(){var c={radius:4,w:600,h:600,factor:1,factorLegend:.85,levels:6,maxValue:0,radians:2*Math.PI,opacityArea:.5,ToRight:5,TranslateX:0,TranslateY:0,ExtraWidthX:0,ExtraWidthY:0,color:d3.scaleOrdinal(d3.schemeCategory10)},d=d3.select(h).append("div").attr("class","temporal").style("position","relative").style("margin","0 auto").style("text-align","left"),f=o.map(function(a,b){return a.label}),g=f.length,i=0,p=d.selectAll(".axis-label").data(f).enter().append("div").text(function(a){return persian(a,e)}).attr("class","axis-label").style("width","100px").style("font-size","11px").style("padding","5px").style("text-overflow","ellipsis").style("white-space","nowrap").style("text-align",function(a,b){return i=$(this).outerHeight()||0,"right"});p.remove(),c.h=Math.min(l-2*i,k-200),c.w=c.h,c.maxValue=Math.max(c.maxValue,d3.max(o,function(a){return d3.max(a.series.filter(function(a,b){return!a.prop.hidden}).map(function(a){return a.data}))}));var q=c.factor*Math.min(c.w/2,c.h/2);d3.format("%");d.style("height",c.h+2*i+"px"),d.style("width",c.w+200+"px");var r=d.append("div"),s=r.append("svg"),t=d.selectAll(".axis-label").data(f).enter().append("div").text(function(a){return persian(a,e)}).attr("title",function(a){return a}).attr("class","axis-label").style("width","100px").style("position","absolute").style("font-size","11px").style("padding","5px").style("text-overflow","ellipsis").style("white-space","nowrap").style("overflow","hidden").style("text-align",function(a,b){var d=c.w/2*(1-c.factor*Math.sin(b*c.radians/g)),e="right";return d>=c.w/2&&(e="left"),e}),i=0;t.style("left",function(a,b){var d=c.w/2*(1-c.factor*Math.sin(b*c.radians/g));return d>=c.w/2&&(d+=100),d+"px"}).style("top",function(a,b){var d=$(d3.select(this).node()).outerHeight()||0;i=d;var e=c.h/2*(1-c.factor*Math.cos(b*c.radians/g));return e+=d/2,0==b&&(e=0),e+"px"});var u=i;r.style("left","100px").style("position","absolute").style("top",u+"px");for(var v,w=s.attr("width",c.w).attr("height",c.h).append("g").attr("transform","translate("+c.TranslateX+","+c.TranslateY+")"),y=0;y<c.levels-1;y++){var A=c.factor*q*((y+1)/c.levels);w.selectAll(".levels").data(f).enter().append("svg:line").attr("x1",function(a,b){return A*(1-c.factor*Math.sin(b*c.radians/g))}).attr("y1",function(a,b){return A*(1-c.factor*Math.cos(b*c.radians/g))}).attr("x2",function(a,b){return A*(1-c.factor*Math.sin((b+1)*c.radians/g))}).attr("y2",function(a,b){return A*(1-c.factor*Math.cos((b+1)*c.radians/g))}).attr("class","line").style("stroke","grey").style("stroke-opacity","0.75").style("stroke-width","0.3px").attr("transform","translate("+(c.w/2-A)+", "+(c.h/2-A)+")")}for(var y=0;y<c.levels;y++){var A=c.factor*q*((y+1)/c.levels);w.selectAll(".levels").data([1]).enter().append("svg:text").attr("x",function(a){return A*(1-c.factor*Math.sin(0))}).attr("y",function(a){return A*(1-c.factor*Math.cos(0))}).attr("class","legend").style("font-size",x.fontSize).style("font-family",x.fontName).attr("dy","1em").attr("transform","translate("+(c.w/2-A+c.ToRight)+", "+(c.h/2-A)+")").attr("fill",x.color).text(persian(d3.format(x.formatString)((y+1)*c.maxValue/c.levels),e))}var B=w.selectAll(".axis").data(f).enter().append("g").attr("class","axis");B.append("line").attr("x1",c.w/2).attr("y1",c.h/2).attr("x2",function(a,b){return c.w/2*(1-c.factor*Math.sin(b*c.radians/g))}).attr("y2",function(a,b){return c.h/2*(1-c.factor*Math.cos(b*c.radians/g))}).attr("class","line").style("stroke","grey").style("stroke-width","1px"),series=0,o[0].series.forEach(function(a,b){a.prop.hidden||(dataValues=[],w.selectAll(".nodes").data(o,function(a,d){dataValues.push([c.w/2*(1-parseFloat(Math.max(a.series[b].data,0))/c.maxValue*c.factor*Math.sin(d*c.radians/g)),c.h/2*(1-parseFloat(Math.max(a.series[b].data,0))/c.maxValue*c.factor*Math.cos(d*c.radians/g))])}),dataValues.push(dataValues[0]),w.selectAll(".area").data([dataValues]).enter().append("polygon").attr("class","radar-chart-serie"+series).style("stroke-width","2px").style("stroke",o[0].series[b].prop.seriesColor).attr("points",function(a){for(var b="",d=0;d<a.length;d++)b=b+c.w/2+","+c.h/2+" ";return b}).style("fill",function(a,c){return o[0].series[b].prop.seriesColor}).style("fill-opacity",c.opacityArea).on("mouseover",function(a){z="polygon."+d3.select(this).attr("class"),w.selectAll("polygon").transition(200).style("fill-opacity",.1),w.selectAll(z).transition(200).style("fill-opacity",.7)}).on("mouseout",function(){w.selectAll("polygon").transition(200).style("fill-opacity",c.opacityArea)}).transition(500).attr("points",function(a){for(var b="",c=0;c<a.length;c++)b=b+a[c][0]+","+a[c][1]+" ";return b}),series++)}),series=0;var C=b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&b.chartProp.globalvariable.filter(function(b){return b.field==a.CurrentDimName}).length>0;_.each(o,function(a){});var D=o[0].series.map(function(a,b){return o.map(function(a){var c=a.series[b];return c.onClickVal=a.onClickVal,c})}),E=w.selectAll(".entry-group").data(D).enter().append("g").classed("entry-group",!0),F=E.selectAll(".entry-group").data(function(a){return a}).enter().append("g").classed("entry",!0),G=$(h).hasClass("fromCommentDialog");F.append("svg:circle").attr("class",function(a,b){return"radar-chart-serie"+b+" "+(""!=a.onClickVal||C||j?" pointer":"")}).classed("circle",!0).attr("r",c.radius).attr("alt",function(a){return d3.format(x.formatString)(a.data)}).attr("cx",function(a,b){return c.w/2}).attr("cy",function(a,b){return c.h/2}).attr("data-id",function(a){return a.axis}).style("fill","#fff").style("stroke",function(a){return a.prop.seriesColor}).style("stroke-width","2px").on("click",function(c,d){return G?void app.chartCommons.commentUtils.clickOnCommentIcon(c,b.ChartInPageId):(b.chartProp.globalvariable&&b.chartProp.globalvariable.length>0&&!b.editMode&&(app.globalVariableHelper.updateGlobalVariables([a.CurrentDimName],[c.value],b.chartProp.globalvariable),$(h+" circle.selected-item").attr("class",$(this).attr("class").replace("selected-item","")),$(this).attr("class",$(this).attr("class")+" selected-item")),""==c.onClickVal?void(j&&!b.editMode&&app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:b.input.dimensionName,value:c.value,refreshDatasource:b.input.RefreshDatasource})):void(m()||(n(!0),b.parameters={selectedItem:c.onClickVal,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode},app.chartCommons.drillDown.add(b.ChartInPageId,b.input.DataSourceId,b.input.CurrentDimName,c.onClickVal,b.input.RefreshDatasource),app.chartCommons.levelTypeUtils.getParam(b),$(h).charts(b.type,"refreshWithData",b))))}).on("mouseover",function(a){newX=parseFloat(d3.select(this).attr("cx")),newY=parseFloat(d3.select(this).attr("cy")),v.style("left",newX+105+"px").style("top",newY-5+"px").html(a.label+"<br/><b>"+a.label+": </b>"+persian(d3.format(x.formatString)(a.data),e)).transition(200).style("opacity",1);var b=($(v[0][0]).width(),$(v[0][0]).height());v.style("top",newY+b/2+"px"),z="polygon."+d3.select(this).attr("class"),w.selectAll("polygon").transition(200).style("fill-opacity",.1),w.selectAll(z).transition(200).style("fill-opacity",.7)}).on("mouseout",function(){v.transition(200).style("opacity",0).each("end",function(){v.style("left",0).style("top",0)}),w.selectAll("polygon").transition(200).style("fill-opacity",c.opacityArea)}).transition(500).attr("cx",function(a,b){return c.w/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.sin(b*c.radians/g))}).attr("cy",function(a,b){return c.h/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.cos(b*c.radians/g))}),app.chartCommons.commentUtils.addCommentIcon(b.ChartInPageId,F,function(a,b){return c.w/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.sin(b*c.radians/g))-5},function(a,b){return c.h/2*(1-Math.max(a.data,0)/c.maxValue*c.factor*Math.cos(b*c.radians/g))-24}),G&&app.chartCommons.commentUtils.setOnHighlightListener(F,b.ChartInPageId),v=d.append("div").attr("class","tooltip").style("position","absolute").style("color","#fff").style("-moz-border-radius","5px").style("-webkit-border-radius","5px").style("border-radius","5px").style("padding","7px 15px").style("text-align","right").style("z-index","1000").style("opacity","0").style("background-color","#000").style("max-width","200px").style("opacity",0).style("font-size","13px")};y(),$(h).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.table={},app.charts.table.draw=function(a,b,c,d){function e(a){var c={numberFactor:"1",textAlign:"right",formatString:",.2f",fontSize:"1em",textItalic:!1,textBold:!1,color:"#000000",rowResult:"0",isHidden:!1};try{return b.chartProp.series[a]||b.chartProp.series["default"]||c}catch(d){return c}}function f(){for(var a=[],b=$(j+" table thead th input"),c=0;c<b.length;c++){if(value=$(j+" #filterbox-"+c+" input").val(),type=$(j+" #filterbox-"+c+" select").val()||1,null==type)return;"undefined"!=typeof value&&null!=value&&""!=value&&($(j+" #filterbox-"+c+" .glyphicon-filter").addClass("show"),d3.select(j+" #filterbox-"+c+" select").on("click",function(a){d3.event.stopPropagation()}),d3.select(j+" #filterbox-"+c+" input").on("click",function(a){d3.event.stopPropagation()}),$(j+" #filterbox-"+c+" input").mousedown(function(a){3==a.which&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation());
})),a.push({value:value,type:type})}return $(j).data("filterbox",a),a}function g(){var a=f();"undefined"!=typeof L&&L.style("display",function(b){"undefined"!=typeof b.label&&(b=[b.label].concat(b.series));var c=i(b,a);return c?null:"none"}),b.editMode&&$(j).trigger("tableInfo",[{TableInfo:t}])}function h(a,b){if("undefined"!=typeof a){for(var c=!1,d=0;d<a.length;d++)"undefined"!=typeof a[d].value&&""!=a[d].value&&(c=!0),$(j+" #filterbox-"+d+" input").val(a[d].value),_.isEmpty(a[d].value)||$(j+" #filterbox-"+d+" .table-filter-icon").addClass("fill"),$(j+" #filterbox-"+d+" select").val(a[d].type);c&&!b&&g()}}function i(a,b){for(var c=!0,d=0;d<b.length;d++)if(parameter=b[d].value,parameter=depersian(parameter),parameter=RegExp(/^[\d,\s]+$/).test(parameter)?+parameter.replace(/,/g,""):parameter,type=b[d].type,"undefined"!=typeof parameter&&""!=parameter)switch(+type){case 1:a[d];c=c&&a[d].indexOf(parameter)!=-1;break;case 6:a[d];c=c&&a[d].indexOf(parameter)==-1;break;case 2:c=c&&(parseFloat(a[d])||0)==parameter;break;case 3:c=c&&(parseFloat(a[d])||0)>parameter;break;case 4:c=c&&(parseFloat(a[d])||0)<parameter;break;case 5:var e=parameter.split(",");"undefined"!=e&&(c=c&&(parseFloat(a[d])||0)>e[0]&&(parseFloat(a[d])||0)<e[1])}return c}var j="#"+b.id,k={top:10,right:20,bottom:0,left:20},l=$(j).width(),m="small"==b.chartProp.info.chartSize?170:"medium"==b.chartProp.info.chartSize?300:"large"==b.chartProp.info.chartSize?400:"veryLarge"==b.chartProp.info.chartSize?500:250;m+k.top+k.bottom;b.width=l;var n=d.isProgress,o=d.showProgress,p=(d.title,"undefined"==typeof a.lang||0==+a.lang),q=b.chartProp.info.openDashboard&&b.chartProp.info.openDashboard.checked;_.isArray(b.chartProp.info.columnsWidth);var r=b.chartProp.info.nullReplacement;_.isUndefined(r)&&(r="");var s=$(j).data("table-info"),t=s||b.tableInfo||{};$(j).data("table-info",t);"undefined"==typeof b.chartProp.info.showHeader||b.chartProp.info.showHeader;if($(j).addClass("table-chart-container table-chart"),$(j).parents(".content").addClass("hidden-overflow"),b.editMode&&($(j).addClass("edit-mode"),$(j).css("margin","0px")),2==app.dashboardLayoutVersion&&!b.editMode){var u=$(j+" .title").outerHeight()||0,v=$(j).height()-u;m=v}"undefined"==typeof b.chartProp.info.stripped&&(b.chartProp.info.stripped=!0),"undefined"==typeof b.chartProp.info.hover&&(b.chartProp.info.hover=!0);var w=((b.chartProp.info.bordered?" table-bordered":"")+(b.chartProp.info.stripped?" table-striped":"")+(b.chartProp.info.hover?" table-hover":"")+" ",{option:{},headerTemplate:function(a){this.filteredHeaders=_.filter(a,function(a){return!a.prop.isHidden});var b=_.map(this.filteredHeaders,function(a,b){var c=a.prop.name||a.value;w.option.page=w.option.page||{};var d=_.find(w.option.page.Order,{Index:b}),e="";d&&(e='<i class="icon sort '+(1==d.DescType?"ascending":"descending")+'"></i>'),w.option.settings.chartProp.info.headerFont=w.option.settings.chartProp.info.headerFont||{bold:!0,italic:!1,fontSize:"13px",fontName:"IRANSans"};var f=["font-weight:"+(w.option.settings.chartProp.info.headerFont.bold?"bold":"normal"),"italic","font-size:"+w.option.settings.chartProp.info.headerFont.fontSize,"text-align:"+w.option.settings.chartProp.info.headerFont.textAlign,"color:"+w.option.settings.chartProp.info.headerFont.color,"font-family:"+w.option.settings.chartProp.info.headerFont.fontName],g=f.join(";");return w.option.settings.chartProp.info.headerNowrap||(g+=";white-space:initial;"),'<th title="'+c+'" style="'+g+'"><span class="resize"></span><div>'+c+e+"</div></th>"}).join("");return"<tr>"+b+"</tr>"},getFooterTemplate:function(){if(!_.some(w.option.resultRows,function(a){return+a.Type>0}))return"";var a=_.map(_.filter(w.option.tableData.headers,function(a,b){return!a.prop.isHidden}),function(a){var b=_.find(w.option.resultRows,{Name:a.key});if(!b||0==+b.Type)return"<td><div></div></td>";var c={data:b.Value},d=_.findIndex(w.option.tableData.headers,{key:a.key}),e=w.getStyle(w.option.tableData.headers[d].prop);return'<td style="'+e+'" title="'+w.getText(c,d)+'"><div>'+w.getText(c,d)+"</div></td>"}).join(""),b='  <table class="ui celled table unstackable small  footer-table" style="margin:0;border-left: none;border-right: none;">                                                      <tbody>                                                <tr>'+a+"</tr>    </tbody>                                                 </table>                                                 ";return b},svg:'<svg  class="td-comment" width="24" height="24" style="position: absolute; left: 6px; fill-opacity: 0.5;"><g transform="translate(0,0)scale(0.38)" class="comment"><rect width="24" height="24" class="comment-background"></rect><path d="M10.718,18.561l6.78,5.311C17.609,23.957,17.677,24,17.743,24  c0.188,0,0.244-0.127,0.244-0.338v-5.023c0-0.355,0.233-0.637,0.548-0.637L21,18c2.219,0,3-1.094,3-2s0-13,0-14s-0.748-2-3.014-2  H2.989C0.802,0,0,0.969,0,2s0,13.031,0,14s0.828,2,3,2h6C9,18,10.255,18.035,10.718,18.561z"></path><text x="34" y="0.7em" style="font-size: 20px;"></text></g></svg>',svgShow:'<svg  class="" width="24" height="24" style="position: absolute; left: 6px; fill-opacity: 0.5;"><g transform="translate(0,0)scale(0.38)" class="comment show"><rect width="24" height="24" class="comment-background"></rect><path d="M10.718,18.561l6.78,5.311C17.609,23.957,17.677,24,17.743,24  c0.188,0,0.244-0.127,0.244-0.338v-5.023c0-0.355,0.233-0.637,0.548-0.637L21,18c2.219,0,3-1.094,3-2s0-13,0-14s-0.748-2-3.014-2  H2.989C0.802,0,0,0.969,0,2s0,13.031,0,14s0.828,2,3,2h6C9,18,10.255,18.035,10.718,18.561z"></path><text x="34" y="0.7em" style="font-size: 20px;"></text></g></svg>',bodyTemplate:function(a){var c="";if(this.option.remoteData){var d=this.option.page.Page;c=this.paging(d)}var e=b.chartProp.info.stripped?"striped ":"",f=b.chartProp.info.hover?"selectable ":"",g=b.chartProp.info.bordered?"celled ":"",h='<div class="clusterize temporal" style="overflow: hidden;">                                     <table class="ui '+e+f+g+' table unstackable small  header-table" style="margin:0;border-left: none;border-right: none;">                                                      <thead>                                                '+w.headerTemplate(a.headers)+'    </thead>                                                 </table>                                                   <div id="scrollArea'+b.id+'" class="clusterize-scroll" style="xdisplay: flex;max-height:200px; overflow:auto;">              <table class="ui '+e+f+g+' table unstackable  small body-table" style="margin:0;border: none; border-bottom: 1px solid #eaeaea;">                                                      <tbody id="contentArea'+b.id+'" class="clusterize-content">          <tr class="clusterize-no-data">                              <td>Loading data…</td>                                   </tr>                                                    </tbody>                                                 </table>                                               '+(app.commentOnChart?w.svg:"")+"  </div>                                                   "+w.getFooterTemplate(a.headers)+c+"</div>                                                     ";return h},getStyle:function(a){"%"==a.formatString&&(a.formatString=".0%"),a.font=_.extendWith({},{bold:a.textBold,italic:a.textItalic,fontSize:a.fontSize,color:a.color,formatString:a.formatString,fontName:"IRANSans"},a.font);var b=["font-weight:"+(a.font.bold?"bold":"normal"),"italic","font-size:"+a.font.fontSize,"font-family:"+a.font.fontName,"text-align:"+a.textAlign,"color:"+a.font.color,"position:relative","display:"+(a.isHidden?"none":"auto")];return a.forceLtr&&b.push(app.lang.isRtl()?"direction:ltr":"direction:rtl"),w.option.settings.chartProp.info.wrapContent&&(b.push("white-space:initial"),b.push("height:"+(w.option.settings.chartProp.info.cellHeight||50)+"px")),b.join(";")},getThenStyle:function(a){var b=[];a&&_.each(a,function(a){switch(+a.operand){case 1:b.push("color:"+a.secondFieldColor);break;case 3:b.push("background-color:"+a.secondFieldBackColor);break;case 4:var c=+a.secondFieldStyle;1==c&&(b.push("font-weight: normal"),b.push("font-style: normal")),2!=c&&4!=c||b.push("font-weight: bold"),3!=c&&4!=c||b.push("font-style: italic"),5==c&&b.push("text-decoration: underline")}});var c=_.head(_.filter(a,{operand:"2"}));c&&(c=' <i class="'+c.secondFieldIcon+'"></i>');var d=_.head(_.filter(a,{operand:"5"}));return d&&(d=d.secondFieldReplace),{style:b.join(";"),icon:c,replace:d}},getText:function(a,b){var c=a.data;if(""===c)return r;var d=w.option.tableData.headers[b].prop.isHtml,e=isNaN(c);if(!e){var f=w.option.tableData.headers[b].prop.font.formatString;return"custom"==f&&(f=w.option.tableData.headers[b].prop.font.formatStringCustom),d?c:persian(d3.format(f)(c),p)}return d?c:persian(c,p)},render:function(b){function c(){var b=$(this).data("xrow"),c=$(this).data("xcol");if(!w.option.tableData.headers[c].prop.preventClick){if(w.option.pivoteMode){var d=g.rows[b][0];if(h)return;if(f.chartProp.globalvariable&&f.chartProp.globalvariable.length>0&&!f.editMode){var i=a.series.labels.concat([a.CurrentDimName]),j=d.series.concat(d.label);app.globalVariableHelper.updateGlobalVariables(i,j,f.chartProp.globalvariable),$(e+" .selected-item").removeClass("selected-item"),$(this).addClass("selected-item")}if(""===d.onClickVal||null===d.onClickVal)return void(q&&!f.editMode?app.chartCommons.openLink(f.chartProp.info.openDashboard,{ChartInPageId:f.ChartInPageId,DataSourceId:f.input.DataSourceId,dimensionName:f.input.dimensionName,value:d.value,refreshDatasource:f.input.RefreshDatasource}):c<a.CurrentDimName.length&&w.onTdClick(b,c,$(this)));if(n())return;o(!0),f.parameters={selectedItem:d.onClickVal,chartId:f.chartId,ChartInPageId:f.ChartInPageId,notEditMode:!f.editMode},app.chartCommons.drillDown.add(f.ChartInPageId,f.input.DataSourceId,f.input.CurrentDimName,d.onClickVal,f.input.RefreshDatasource),app.chartCommons.levelTypeUtils.getParam(f),$(e).charts(f.type,"refreshWithData",f)}w.option.pivoteMode||w.onTdClick(b,c,$(this))}}function d(){var a=$(x).scrollLeft();$(e+" .header-table").css("-ms-transform","translate3d("+(-y+a)+"px,0px,0px)"),$(e+" .footer-table").css("-ms-transform","translate3d("+(-y+a)+"px,0px,0px)"),$(e+" .header-table").css("-webkit-transform","translate3d("+(y-a)+"px,0px,0px)"),$(e+" .footer-table").css("-webkit-transform","translate3d("+(y-a)+"px,0px,0px)"),$(e+" .header-table").css("-moz-transform","translate3d("+-a+"px,0px,0px)"),$(e+" .footer-table").css("-moz-transform","translate3d("+-a+"px,0px,0px)")}w.option=b;var e=b.selector,f=b.settings,g=b.tableData,h=(b.resultRows,$(e).hasClass("fromCommentDialog"));$(e).append(w.bodyTemplate(g));var i=_.map(g.headers,"key");w.dataset=g.rows.map(function(a,b){var c=app.chartCommons.indicator.getIndicator(_.map(a,"data"),i,f.chartProp.indicator),d=_.flatten(c),e=[],h=a.map(function(a,c){var h=_.filter(d,{firstField:w.option.tableData.headers[c].key}),i=w.getStyle(w.option.tableData.headers[c].prop),j=w.getThenStyle(h);w.option.tableData.headers[c].prop.isHidden||e.push(a.data);var k="";if(w.option.pivoteMode){var l=g.rows[b][0];k=l.onClickVal}var m=w.option.tableData.headers[c].prop.isHtml,n="";("none"!=f.chartProp.info.selectable||""!=k||q||_.size(f.chartProp.globalvariable)>0)&&(n="pointer");var o="";a.commentCount>0&&(o=w.svgShow.replace("</text>",persian(a.commentCount,p)+"</text>")),app.commentOnChart||(o="");var r=j.replace||w.getText(a,c);return'<td class="entry '+n+'" data-xrow="'+b+'" data-xcol="'+c+'" title="'+(m?"":r)+'" ><div style="'+i+";"+j.style+'">'+r+(j.icon||"")+o+"</div></td>"}).filter(function(a,b){return!w.option.tableData.headers[b].prop.isHidden});return{markup:"<tr>"+h.join("")+"</tr>",row:e}});var j=($("#scrollArea"+f.id),$("#contentArea"+f.id)),k=$(e+" .header-table"),l=7,m=function(){var a=[],b=!0;return function(){var c=j.find("tr:not(.clusterize-extra-row):first"),d=c.children(),g=$(e+" .footer-table tr:first-child td"),h=0,i=$(e+" .body-table").height()||0,m=($(e).height()||0)-($(e+" .legend-bar").height()||0)-($(e+" .header-table").height()||0)-($(e+" .footer-table").height()||0)-($(e+" .ui.pagination").height()||0)-4;h=i>m?l:0;var n=$(e).data("columnsWidth");if(n&&(a=n),0==_.size(a)&&(d=k.find("tr").children(),c.children().each(function(b){var c=$(this).outerWidth(),e=$(d.get(b)).outerWidth();0!=b&&c--,c<60&&e>c&&(c=60),_.isArray(f.chartProp.info.columnsWidth)&&(c=Math.max(f.chartProp.info.columnsWidth[b],c)),a.push(c)}),!_.isArray(f.chartProp.info.columnsWidth))){for(var o=$(e).width(),p=0,q=0;q<a.length;q++)p+=a[q];if(p>o)for(var r=600,s=0,q=0;q<a.length;q++)if(a[q]>r&&(p-=a[q]-r,a[q]=r,s=q),p<=o){a[s]+=o-p-h-a.length-1;break}}k.find("tr").children().each(function(b){var c=0;d.length-1==b&&(c=h),$(this).find("div").css({width:a[b]+c+"px"})}),d.each(function(b){var c=0;d.length-1==b&&(c=h),$(g.get(b)).find("div").css({width:a[b]+c+"px"})}),j.find("tr:not(.clusterize-extra-row)").each(function(){$(this).children().each(function(b){$(this).find("div").css({width:a[b]+"px"})})}),b=!1}}(),r=w.dataset;if(!w.option.remoteData&&w.option.page&&w.option.page&&w.option.page.Order&&w.option.page.Order.length>0)for(var s=0;s<w.option.page.Order.length;s++){var t=w.option.page.Order[s];r=_.orderBy(r,function(a){return a.row[s]},1==t.DescType?"asc":"desc")}var u;w.clusterize=new Clusterize({rows:r.map(function(a){return a.markup}),rows_in_block:Math.floor($(e).height()/33)+1,scrollId:"scrollArea"+f.id,contentId:"contentArea"+f.id,callbacks:{clusterChanged:function(){if(m(),w.option.remoteData||j.find("tr:not(.clusterize-extra-row) td").on("mouseover",function(a,b){$(this).find("div").append(u)}),j.find("tr:not(.clusterize-extra-row) td").on("click",c),h){var a=j.find("tr:not(.clusterize-extra-row) td");$(a[0]).data("table-data",w.option.tableData),app.chartCommons.commentUtils.setOnHighlightListener(j.find("tr:not(.clusterize-extra-row) td"),f.ChartInPageId)}}}}),u=$(e+" .td-comment"),u.on("click",function(a){var b=$(this).parents("[data-xrow]").data("xrow"),c=$(this).parents("[data-xcol]").data("xcol"),d=w.option.tableData.rows[b][c];return app.chartCommons.commentUtils.clickOnCommentIcon(d,f.ChartInPageId),a.preventDefault(),!1}),"edit"==f.chartProp.info.selectable&&f.chartProp.info.showAddButton&&($openForm=$(' <div style="margin:5px;" class="temporal ui mini compact button form-new-record"><i class="icon add"></i> '+app.lang.translate("new record")+" </div>"),$(e).parents(".chart-widget").find(".title").append($openForm),$openForm.on("click",function(){$("body").trigger("open-form",[a.form,0,e])}));var v=($(e).height()||0)-($(e+" .legend-bar").height()||0)-($(e+" .header-table").height()||0)-($(e+" .footer-table").height()||0)-($(e+" .form-new-record-container").outerHeight()||0)-($(e+" .ui.pagination").height()||0)-4;$(e+" .clusterize-scroll").css({"max-height":v+"px","min-height":v+"px"});var x="#scrollArea"+f.id,y=$(x).scrollLeft();$(function(){var a,b,c=!1,d=void 0;$(e+" .header-table th .resize").on("click",function(a){return a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1}),$(e+" .header-table th .resize").mousedown(function(e){d=$(this).parent().find("div"),c=!0,a=e.pageX,b=d.outerWidth(),$(d).addClass("resizing")}),$(document).mousemove(function(e){if(c){var f=b+(a-e.pageX);$(d).css({width:f+"px"})}}),$(document).mouseup(function(a){if(c){$(d).removeClass("resizing"),c=!1;var b=[];$(e+" .header-table th").each(function(){b.push($(this).outerWidth())}),b[b.length-1]-=l;for(var f=0,g=0;g<b.length;g++)f+=b[g];$(e).data("columnsWidth",b),m(),y=$(x).scrollLeft(),$(e).trigger("columnsWidth",[{columnsWidth:b}])}})}),$(x).on("scroll",d),d(),$(e+" .ui.pagination a").on("click",function(){var a=$(this).attr("value");w.gotoPage(parseInt(a))}),$(e+" .header-table th").on("click",function(a,b){var c=+$(this).index();w.option.page=w.option.page||{},w.option.page.Order=w.option.page.Order||[];var d=_.find(w.option.page.Order,{Index:c});d||(d={Index:c,DescType:2}),_.remove(w.option.page.Order,d),w.option.page.Order.push(d),d.DescType=1==d.DescType?2:1,$(this).find(".icon").remove(),$(this).find("div").append('<i class="icon sort '+(1==d.DescType?"ascending":"descending")+'"></i>'),w.sort()}),!w.option.remoteData&&w.option.page.Order&&w.sort()},sort:function(){if(!w.option.remoteData){var a=_.reverse(w.option.page.Order.map(function(a){return function(b){return b.row[a.Index]}})),c=_.reverse(w.option.page.Order.map(function(a){return 1==a.DescType?"asc":"desc"}));w.clusterize.update(_.map(_.orderBy(w.dataset,a,c),"markup"))}w.option.remoteData&&w.sortRemote(),b.editMode&&$(j).trigger("tableInfo",[{TableInfo:w.option.page}])},sortRemote:function(){n()||(o(!0),$.extend(b.parameters,{TableInfo:w.option.page,notEditMode:!b.editMode}),app.chartCommons.levelTypeUtils.getParam(b),$(j).charts(b.type,"refreshWithData",b,{refreshRelatedDatasources:!1}))},paging:function(a){var b=Math.ceil(w.option.totalRows/w.option.page.Limit),c=5;if(1!=b){b<c&&(c=b);for(var d=a-Math.ceil(c/2)>0,e=a+Math.ceil(c/2)<b,f=d?e?a-Math.ceil(c/2)+1:b-c+1:1,g="",h=0;h<c;h++)g+="<a  "+(f+h==a?'class="active item"':'class="item"')+' value="'+(f+h)+'">'+persian(f+h,p)+"</a>";var i="";return""!=g&&(i='<div  class="ui borderless pagination menu attached  " style="">                                <a  '+(d?'class="item"':'class="disabled item"')+' value="1" style="border-right:1px solid #d4d4d5; border-radius:0;">&laquo;</a>                                '+g+"                                <a  "+(e?'class="item"':'class="disabled item"')+' value="'+b+'">&raquo;</a>                                <div class="item" style="font-size: 0.8em;color: #9E9E9E;"> '+app.lang.translate("all rows count")+": "+persian(this.option.totalRows,p)+"</div>                            </div>"),i}},gotoPage:function(a){n()||(o(!0),t.Page=a,t.IsPageValid=!0,$.extend(b.parameters,{TableInfo:t,notEditMode:!b.editMode}),app.chartCommons.levelTypeUtils.getParam(b),$(j).charts(b.type,"refreshWithData",b,{refreshRelatedDatasources:!1}),b.parameters.TableInfo.IsPageValid=!1)},onTdClick:function(c,d,e){if("undefined"==typeof b.chartProp.info.selectable&&(b.chartProp.info.selectable="multi"),"none"!=b.chartProp.info.selectable){if("edit"==b.chartProp.info.selectable)return void $("body").trigger("open-form",[a.form,a.formIds[c],j]);var f=e.hasClass("selected-item"),g=d+1+(b.chartProp.info.showRowNumber?1:0);if(b.chartProp.info.rowAsKey&&b.chartProp.info.rowKey){var h=_.findIndex(this.filteredHeaders,{key:b.chartProp.info.rowKey});if(h==-1)return;"one"==b.chartProp.info.selectable&&$(j+" .selected-item").removeClass("selected-item"),f?e.parents("tr").find("td").removeClass("selected-item"):e.parents("tr").find("td").addClass("selected-item")}else"one"==b.chartProp.info.selectable&&$(j+" td:nth-child("+g+").selected-item").removeClass("selected-item"),f?e.removeClass("selected-item"):e.addClass("selected-item");if(!b.editMode){var i=$(j+" td.selected-item").map(function(){var a=+$(this).data("xrow"),b=+$(this).data("xcol");return b!=d?null:w.option.tableData.rows[a][b].data}).filter(function(a){return null!=a}).toArray(),k=this.filteredHeaders[d].key;if(q&&!b.editMode)return void app.chartCommons.openLink(b.chartProp.info.openDashboard,{ChartInPageId:b.ChartInPageId,DataSourceId:b.input.DataSourceId,dimensionName:k,value:i,refreshDatasource:b.input.RefreshDatasource});var l={Id:-1,Values:i,VariableType:0,dimensionName:k,datasourceId:a.DataSourceId,chartInPageId:b.ChartInPageId,chartId:a.chartId};app.moderation.dashboadpage.selectValueOnChart(l,a.RefreshDatasource)}}}});if(+a.isPivot>-1){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var x=a.chartInfo,y="undefined"!=typeof a.series?a.series.labels:[],z="undefined"!=typeof a.kpis?a.kpis.labels:[],A=d3Utils.convertToKeyValue(a);A.seriesLabels=A.seriesLabels.map(function(a){return a.prop=e(a.key),a});var B=A.seriesLabels.map(function(a){return a.key});A.seriesLabels.map(function(a){return a.value}),b.LabelY,d3.scaleOrdinal(d3.schemeCategory10);if(app.chartCommons.setDefault(b.chartProp,B.concat(x.hierarchyLabels),"table"),b.editMode&&$(j).trigger("chartproperty",[B.concat(x.hierarchyLabels)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var C=prepareData(a,null,!0),D=a.seriesLablesCaptions,E=a.kpisLablesCaptions;if(d3Utils.prepareDataForBarChart(C,b,y,z,D,E),a.levels&&a.levels.length>0){var F=d3.select(j).append("div").attr("class","legend-bar temporal");F.breadcrumb(a.levels,b,d,p)}if(2==app.dashboardLayoutVersion&&!b.editMode){var G=$(j+" .legend-bar"),H=G.css("margin-top"),I=(H?+G.css("margin-top").replace("px",""):0,"undefined"==typeof G?0:G.height()+0);m-=I}if(!a.matrix||0==a.matrix.length)return void d3.select(j).append("div").attr("class","temporal").style("font-size","0.8em").style("margin","15px").append("span").attr("class","translate").attr("data-trans-key","داده‌ای برای نمایش وجود ندارد").text("داده‌ای برای نمایش وجود ندارد");var J=A.seriesLabels.map(function(a){return{key:a.key,value:a.value,prop:e(a.key)}});_.each(a.CurrentDimName,function(a){J.unshift({key:a,value:a,prop:e(a)})});var K={rows:C.map(function(a){var b=a.series;return _.each(a.label,function(c,d){b.unshift({data:c,prop:J[d].prop,key:J[d].key,label:J[d].value,onClickVal:a.onClickVal?a.value:null,value:a.value})}),b}),headers:J};return void w.render({selector:j,settings:b,tableData:K,resultRows:a.resultRows,pivoteMode:!0,page:b.tableInfo});var L}else{if(b.input=a,app.chartCommons.setDefault(b.chartProp,a.headers,"table"),b.editMode&&$(j).trigger("chartproperty",[a.headers]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));var M=a.nonPivotMatrix,N=a.Dimentions.Hierarchies.concat(a.Dimentions.SeriesLevel||[]),J=a.headers.map(function(a,b){return{key:N[b],value:a,prop:e(a)}}),K={rows:M.map(function(a){var b=a.map(function(a){return{data:a}});return b}),headers:J};return void w.render({selector:j,settings:b,tableData:K,resultRows:a.resultRows,page:a.TableInfo,totalRows:a.nonPivotMatrixLength,remoteData:!0})}if(a.TableInfo&&a.TableInfo.Filter){var O=a.TableInfo.Filter.map(function(a){return{value:a.FilterParameter,type:a.FilterType}});h(O)}var O=$(j).data("filterbox");h(O)},function(a,b){"undefined"!=typeof module?module.exports=b():"function"==typeof define&&"object"==typeof define.amd?define(b):this[a]=b()}("Clusterize",function(){"use strict";function a(a,b,c){return b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent("on"+a,c)}function b(a,b,c){return b.removeEventListener?b.removeEventListener(a,c,!1):b.detachEvent("on"+a,c)}function c(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(a,b){return window.getComputedStyle?window.getComputedStyle(b)[a]:b.currentStyle[a]}var e=function(){for(var a=3,b=document.createElement("b"),c=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><i><![endif]-->",c[0];);return a>4?a:document.documentMode}(),f=navigator.platform.toLowerCase().indexOf("mac")+1,g=function(d){if(!(this instanceof g))return new g(d);var e=this,h={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};e.options={};for(var i,j=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],k=0;i=j[k];k++)e.options[i]="undefined"!=typeof d[i]&&null!=d[i]?d[i]:h[i];for(var l,m=["scroll","content"],k=0;l=m[k];k++)if(e[l+"_elem"]=d[l+"Id"]?document.getElementById(d[l+"Id"]):d[l+"Elem"],!e[l+"_elem"])throw new Error("Error! Could not find "+l+" element");e.content_elem.hasAttribute("tabindex")||e.content_elem.setAttribute("tabindex",0);var n=c(d.rows)?d.rows:e.fetchMarkup(),o={},p=e.scroll_elem.scrollTop;e.insertToDOM(n,o),e.scroll_elem.scrollTop=p;var q=!1,r=0,s=!1,t=function(){f&&(s||(e.content_elem.style.pointerEvents="none"),s=!0,clearTimeout(r),r=setTimeout(function(){e.content_elem.style.pointerEvents="auto",s=!1},50)),q!=(q=e.getClusterNum())&&e.insertToDOM(n,o),e.options.callbacks.scrollingProgress&&e.options.callbacks.scrollingProgress(e.getScrollProgress())},u=0,v=function(){clearTimeout(u),u=setTimeout(e.refresh,100)};a("scroll",e.scroll_elem,t),a("resize",window,v),e.destroy=function(a){b("scroll",e.scroll_elem,t),b("resize",window,v),e.html((a?e.generateEmptyRow():n).join(""))},e.refresh=function(a){(e.getRowsHeight(n)||a)&&e.update(n)},e.update=function(a){n=c(a)?a:[];var b=e.scroll_elem.scrollTop;n.length*e.options.item_height<b&&(e.scroll_elem.scrollTop=0,q=0),e.insertToDOM(n,o),e.scroll_elem.scrollTop=b},e.clear=function(){e.update([])},e.getRowsAmount=function(){return n.length},e.getScrollProgress=function(){return this.options.scroll_top/(n.length*this.options.item_height)*100||0};var w=function(a,b){var d=c(b)?b:[];d.length&&(n="append"==a?n.concat(d):d.concat(n),e.insertToDOM(n,o))};e.append=function(a){w("append",a)},e.prepend=function(a){w("prepend",a)}};return g.prototype={constructor:g,fetchMarkup:function(){for(var a=[],b=this.getChildNodes(this.content_elem);b.length;)a.push(b.shift().outerHTML);return a},exploreEnvironment:function(a,b){var c=this.options;c.content_tag=this.content_elem.tagName.toLowerCase(),a.length&&(e&&e<=9&&!c.tag&&(c.tag=a[0].match(/<([^>\s\/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&(b.data=this.html(a[0]+a[0]+a[0])),c.tag||(c.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(a))},getRowsHeight:function(a){var b=this.options,c=b.item_height;if(b.cluster_height=0,a.length){var e=this.content_elem.children;if(e.length){var f=e[Math.floor(e.length/2)];if(b.item_height=f.offsetHeight,"tr"==b.tag&&"collapse"!=d("borderCollapse",this.content_elem)&&(b.item_height+=parseInt(d("borderSpacing",this.content_elem),10)||0),"tr"!=b.tag){var g=parseInt(d("marginTop",f),10)||0,h=parseInt(d("marginBottom",f),10)||0;b.item_height+=Math.max(g,h)}return b.block_height=b.item_height*b.rows_in_block,b.rows_in_cluster=b.blocks_in_cluster*b.rows_in_block,b.cluster_height=b.blocks_in_cluster*b.block_height,c!=b.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var a=this.options;if(!a.tag||!a.show_no_data_row)return[];var b,c=document.createElement(a.tag),d=document.createTextNode(a.no_data_text);return c.className=a.no_data_class,"tr"==a.tag&&(b=document.createElement("td"),b.colSpan=100,b.appendChild(d)),c.appendChild(b||d),[c.outerHTML]},generate:function(a,b){var c=this.options,d=a.length;if(d<c.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:d?a:this.generateEmptyRow()};var e=Math.max((c.rows_in_cluster-c.rows_in_block)*b,0),f=e+c.rows_in_cluster,g=Math.max(e*c.item_height,0),h=Math.max((d-f)*c.item_height,0),i=[],j=e;g<1&&j++;for(var k=e;k<f;k++)a[k]&&i.push(a[k]);return{top_offset:g,bottom_offset:h,rows_above:j,rows:i}},renderExtraTag:function(a,b){var c=document.createElement(this.options.tag),d="clusterize-";return c.className=[d+"extra-row",d+a].join(" "),b&&(c.style.height=b+"px"),c.outerHTML},insertToDOM:function(a,b){this.options.cluster_height||this.exploreEnvironment(a,b);var c=this.generate(a,this.getClusterNum()),d=c.rows.join(""),e=this.checkChanges("data",d,b),f=this.checkChanges("top",c.top_offset,b),g=this.checkChanges("bottom",c.bottom_offset,b),h=this.options.callbacks,i=[];e||f?(c.top_offset&&(this.options.keep_parity&&i.push(this.renderExtraTag("keep-parity")),i.push(this.renderExtraTag("top-space",c.top_offset))),i.push(d),c.bottom_offset&&i.push(this.renderExtraTag("bottom-space",c.bottom_offset)),h.clusterWillChange&&h.clusterWillChange(),this.html(i.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",c.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(c.rows_above-1),h.clusterChanged&&h.clusterChanged()):g&&(this.content_elem.lastChild.style.height=c.bottom_offset+"px")},html:function(a){var b=this.content_elem;if(e&&e<=9&&"tr"==this.options.tag){var c,d=document.createElement("div");for(d.innerHTML="<table><tbody>"+a+"</tbody></table>";c=b.lastChild;)b.removeChild(c);for(var f=this.getChildNodes(d.firstChild.firstChild);f.length;)b.appendChild(f.shift())}else b.innerHTML=a},getChildNodes:function(a){for(var b=a.children,c=[],d=0,e=b.length;d<e;d++)c.push(b[d]);return c},checkChanges:function(a,b,c){var d=b!=c[a];return c[a]=b,d}},g}),!function(){"use strict";function a(d){if(!d)throw new Error("No options passed to Waypoint constructor");if(!d.element)throw new Error("No element option passed to Waypoint constructor");if(!d.handler)throw new Error("No handler option passed to Waypoint constructor");this.key="waypoint-"+b,this.options=a.Adapter.extend({},a.defaults,d),this.element=this.options.element,this.adapter=new a.Adapter(this.element),this.callback=d.handler,this.axis=this.options.horizontal?"horizontal":"vertical",this.enabled=this.options.enabled,this.triggerPoint=null,this.group=a.Group.findOrCreate({name:this.options.group,axis:this.axis}),this.context=a.Context.findOrCreateByElement(this.options.context),a.offsetAliases[this.options.offset]&&(this.options.offset=a.offsetAliases[this.options.offset]),this.group.add(this),this.context.add(this),c[this.key]=this,b+=1}var b=0,c={};a.prototype.queueTrigger=function(a){this.group.queueTrigger(this,a)},a.prototype.trigger=function(a){this.enabled&&this.callback&&this.callback.apply(this,a)},a.prototype.destroy=function(){this.context.remove(this),this.group.remove(this),delete c[this.key]},a.prototype.disable=function(){return this.enabled=!1,this},a.prototype.enable=function(){return this.context.refresh(),this.enabled=!0,this},a.prototype.next=function(){return this.group.next(this)},a.prototype.previous=function(){return this.group.previous(this)},a.invokeAll=function(a){var b=[];for(var d in c)b.push(c[d]);for(var e=0,f=b.length;f>e;e++)b[e][a]()},a.destroyAll=function(){a.invokeAll("destroy")},a.disableAll=function(){a.invokeAll("disable")},a.enableAll=function(){a.Context.refreshAll();for(var b in c)c[b].enabled=!0;return this},a.refreshAll=function(){a.Context.refreshAll()},a.viewportHeight=function(){return window.innerHeight||document.documentElement.clientHeight},a.viewportWidth=function(){return document.documentElement.clientWidth},a.adapters=[],a.defaults={context:window,continuous:!0,enabled:!0,group:"default",horizontal:!1,offset:0},a.offsetAliases={"bottom-in-view":function(){return this.context.innerHeight()-this.adapter.outerHeight()},"right-in-view":function(){return this.context.innerWidth()-this.adapter.outerWidth()}},window.Waypoint=a}(),function(){"use strict";function a(a){window.setTimeout(a,1e3/60)}function b(a){this.element=a,this.Adapter=e.Adapter,this.adapter=new this.Adapter(a),this.key="waypoint-context-"+c,this.didScroll=!1,this.didResize=!1,this.oldScroll={x:this.adapter.scrollLeft(),y:this.adapter.scrollTop()},this.waypoints={vertical:{},horizontal:{}},a.waypointContextKey=this.key,d[a.waypointContextKey]=this,c+=1,e.windowContext||(e.windowContext=!0,e.windowContext=new b(window)),this.createThrottledScrollHandler(),this.createThrottledResizeHandler()}var c=0,d={},e=window.Waypoint,f=window.onload;b.prototype.add=function(a){var b=a.options.horizontal?"horizontal":"vertical";this.waypoints[b][a.key]=a,this.refresh()},b.prototype.checkEmpty=function(){var a=this.Adapter.isEmptyObject(this.waypoints.horizontal),b=this.Adapter.isEmptyObject(this.waypoints.vertical),c=this.element==this.element.window;a&&b&&!c&&(this.adapter.off(".waypoints"),delete d[this.key])},b.prototype.createThrottledResizeHandler=function(){function a(){b.handleResize(),b.didResize=!1}var b=this;this.adapter.on("resize.waypoints",function(){b.didResize||(b.didResize=!0,e.requestAnimationFrame(a))});
},b.prototype.createThrottledScrollHandler=function(){function a(){b.handleScroll(),b.didScroll=!1}var b=this;this.adapter.on("scroll.waypoints",function(){(!b.didScroll||e.isTouch)&&(b.didScroll=!0,e.requestAnimationFrame(a))})},b.prototype.handleResize=function(){e.Context.refreshAll()},b.prototype.handleScroll=function(){var a={},b={horizontal:{newScroll:this.adapter.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.adapter.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}};for(var c in b){var d=b[c],e=d.newScroll>d.oldScroll,f=e?d.forward:d.backward;for(var g in this.waypoints[c]){var h=this.waypoints[c][g];if(null!==h.triggerPoint){var i=d.oldScroll<h.triggerPoint,j=d.newScroll>=h.triggerPoint,k=i&&j,l=!i&&!j;(k||l)&&(h.queueTrigger(f),a[h.group.id]=h.group)}}}for(var m in a)a[m].flushTriggers();this.oldScroll={x:b.horizontal.newScroll,y:b.vertical.newScroll}},b.prototype.innerHeight=function(){return this.element==this.element.window?e.viewportHeight():this.adapter.innerHeight()},b.prototype.remove=function(a){delete this.waypoints[a.axis][a.key],this.checkEmpty()},b.prototype.innerWidth=function(){return this.element==this.element.window?e.viewportWidth():this.adapter.innerWidth()},b.prototype.destroy=function(){var a=[];for(var b in this.waypoints)for(var c in this.waypoints[b])a.push(this.waypoints[b][c]);for(var d=0,e=a.length;e>d;d++)a[d].destroy()},b.prototype.refresh=function(){var a,b=this.element==this.element.window,c=b?void 0:this.adapter.offset(),d={};this.handleScroll(),a={horizontal:{contextOffset:b?0:c.left,contextScroll:b?0:this.oldScroll.x,contextDimension:this.innerWidth(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:b?0:c.top,contextScroll:b?0:this.oldScroll.y,contextDimension:this.innerHeight(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}};for(var f in a){var g=a[f];for(var h in this.waypoints[f]){var i,j,k,l,m,n=this.waypoints[f][h],o=n.options.offset,p=n.triggerPoint,q=0,r=null==p;n.element!==n.element.window&&(q=n.adapter.offset()[g.offsetProp]),"function"==typeof o?o=o.apply(n):"string"==typeof o&&(o=parseFloat(o),n.options.offset.indexOf("%")>-1&&(o=Math.ceil(g.contextDimension*o/100))),i=g.contextScroll-g.contextOffset,n.triggerPoint=Math.floor(q+i-o),j=p<g.oldScroll,k=n.triggerPoint>=g.oldScroll,l=j&&k,m=!j&&!k,!r&&l?(n.queueTrigger(g.backward),d[n.group.id]=n.group):!r&&m?(n.queueTrigger(g.forward),d[n.group.id]=n.group):r&&g.oldScroll>=n.triggerPoint&&(n.queueTrigger(g.forward),d[n.group.id]=n.group)}}return e.requestAnimationFrame(function(){for(var a in d)d[a].flushTriggers()}),this},b.findOrCreateByElement=function(a){return b.findByElement(a)||new b(a)},b.refreshAll=function(){for(var a in d)d[a].refresh()},b.findByElement=function(a){return d[a.waypointContextKey]},window.onload=function(){f&&f(),b.refreshAll()},e.requestAnimationFrame=function(b){var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||a;c.call(window,b)},e.Context=b}(),function(){"use strict";function a(a,b){return a.triggerPoint-b.triggerPoint}function b(a,b){return b.triggerPoint-a.triggerPoint}function c(a){this.name=a.name,this.axis=a.axis,this.id=this.name+"-"+this.axis,this.waypoints=[],this.clearTriggerQueues(),d[this.axis][this.name]=this}var d={vertical:{},horizontal:{}},e=window.Waypoint;c.prototype.add=function(a){this.waypoints.push(a)},c.prototype.clearTriggerQueues=function(){this.triggerQueues={up:[],down:[],left:[],right:[]}},c.prototype.flushTriggers=function(){for(var c in this.triggerQueues){var d=this.triggerQueues[c],e="up"===c||"left"===c;d.sort(e?b:a);for(var f=0,g=d.length;g>f;f+=1){var h=d[f];(h.options.continuous||f===d.length-1)&&h.trigger([c])}}this.clearTriggerQueues()},c.prototype.next=function(b){this.waypoints.sort(a);var c=e.Adapter.inArray(b,this.waypoints),d=c===this.waypoints.length-1;return d?null:this.waypoints[c+1]},c.prototype.previous=function(b){this.waypoints.sort(a);var c=e.Adapter.inArray(b,this.waypoints);return c?this.waypoints[c-1]:null},c.prototype.queueTrigger=function(a,b){this.triggerQueues[b].push(a)},c.prototype.remove=function(a){var b=e.Adapter.inArray(a,this.waypoints);b>-1&&this.waypoints.splice(b,1)},c.prototype.first=function(){return this.waypoints[0]},c.prototype.last=function(){return this.waypoints[this.waypoints.length-1]},c.findOrCreate=function(a){return d[a.axis][a.name]||new c(a)},e.Group=c}(),function(){"use strict";function a(a){this.$element=b(a)}var b=window.jQuery,c=window.Waypoint;b.each(["innerHeight","innerWidth","off","offset","on","outerHeight","outerWidth","scrollLeft","scrollTop"],function(b,c){a.prototype[c]=function(){var a=Array.prototype.slice.call(arguments);return this.$element[c].apply(this.$element,a)}}),b.each(["extend","inArray","isEmptyObject"],function(c,d){a[d]=b[d]}),c.adapters.push({name:"jquery",Adapter:a}),c.Adapter=a}(),function(){"use strict";function a(a){return function(){var c=[],d=arguments[0];return a.isFunction(arguments[0])&&(d=a.extend({},arguments[1]),d.handler=arguments[0]),this.each(function(){var e=a.extend({},d,{element:this});"string"==typeof e.context&&(e.context=a(this).closest(e.context)[0]),c.push(new b(e))}),c}}var b=window.Waypoint;window.jQuery&&(window.jQuery.fn.waypoint=a(window.jQuery)),window.Zepto&&(window.Zepto.fn.waypoint=a(window.Zepto))}(),function(a){var b,c=a(document),d=a("head"),e=null,f={},g=0,h="id",i="px",j="JColResizer",k="JCLRFlex",l=parseInt,m=Math,n=navigator.userAgent.indexOf("Trident/4.0")>0;try{b=sessionStorage}catch(o){}d.append("<style type='text/css'>  .JColResizer{table-layout:fixed;} .JColResizer > tbody > tr > td, .JColResizer > tbody > tr > th{overflow:hidden}  .JPadding > tbody > tr > td, .JPadding > tbody > tr > th{padding-left:0!important; padding-right:0!important;} .JCLRgrips{ height:0px; position:relative;} .JCLRgrip{margin-left:-5px; position:absolute; z-index:5; } .JCLRgrip .JColResizer{position:absolute;background-color:red;filter:alpha(opacity=1);opacity:0;width:10px;height:100%;cursor: col-resize;top:0px} .JCLRLastGrip{position:absolute; width:1px; } .JCLRgripDrag{ border-left:1px dotted black;\t} .JCLRFlex{width:auto!important;} .JCLRgrip.JCLRdisabledGrip .JColResizer{cursor:default; display:none;}</style>");var p=function(b,c){var e=a(b);if(e.opt=c,e.mode=c.resizeMode,e.dc=e.opt.disabledColumns,e.opt.removePadding&&e.addClass("JPadding"),e.opt.disable)return q(e);var i=e.id=e.attr(h)||j+g++;e.p=e.opt.postbackSafe,!e.is("table")||f[i]&&!e.opt.partialRefresh||("col-resize"!==e.opt.hoverCursor&&d.append("<style type='text/css'>.JCLRgrip .JColResizer:hover{cursor:"+e.opt.hoverCursor+"!important}</style>"),e.addClass(j).attr(h,i).before('<div class="JCLRgrips"/>'),e.g=[],e.c=[],e.w=e.width(),e.gc=e.prev(),e.f=e.opt.fixed,c.marginLeft&&e.gc.css("marginLeft",c.marginLeft),c.marginRight&&e.gc.css("marginRight",c.marginRight),e.cs=l(n?b.cellSpacing||b.currentStyle.borderSpacing:e.css("border-spacing"))||2,e.b=l(n?b.border||b.currentStyle.borderLeftWidth:e.css("border-left-width"))||1,f[i]=e,r(e))},q=function(a){var b=a.attr(h),a=f[b];a&&a.is("table")&&(a.removeClass(j+" "+k).gc.remove(),delete f[b])},r=function(c){var d=c.find(">thead>tr:first>th,>thead>tr:first>td");d.length||(d=c.find(">tbody>tr:first>th,>tr:first>th,>tbody>tr:first>td, >tr:first>td")),d=d.filter(":visible"),c.cg=c.find("col"),c.ln=d.length,c.p&&b&&b[c.id]&&s(c,d),d.each(function(b){var d=a(this),e=c.dc.indexOf(b)!=-1,f=a(c.gc.append('<div class="JCLRgrip"></div>')[0].lastChild);f.append(e?"":c.opt.gripInnerHtml).append('<div class="'+j+'"></div>'),b==c.ln-1&&(f.addClass("JCLRLastGrip"),c.f&&f.html("")),f.bind("touchstart mousedown",y),e?f.addClass("JCLRdisabledGrip"):f.removeClass("JCLRdisabledGrip").bind("touchstart mousedown",y),f.t=c,f.i=b,f.c=d,d.w=d.width(),c.g.push(f),c.c.push(d),d.width(d.w).removeAttr("width"),f.data(j,{i:b,t:c.attr(h),last:b==c.ln-1})}),c.cg.removeAttr("width"),c.find("td, th").not(d).not("table th, table td").each(function(){a(this).removeAttr("width")}),c.f||c.removeAttr("width").addClass(k),t(c)},s=function(a,c){var d,e,f=0,g=0,h=[];if(c){if(a.cg.removeAttr("width"),a.opt.flush)return void(b[a.id]="");for(d=b[a.id].split(";"),e=d[a.ln+1],!a.f&&e&&(a.width(e*=1),a.opt.overflow&&(a.css("min-width",e+i),a.w=e));g<a.ln;g++)h.push(100*d[g]/d[a.ln]+"%"),c.eq(g).css("width",h[g]);for(g=0;g<a.ln;g++)a.cg.eq(g).css("width",h[g])}else{for(b[a.id]="";g<a.c.length;g++)d=a.c[g].width(),b[a.id]+=d+";",f+=d;b[a.id]+=f,a.f||(b[a.id]+=";"+a.width())}},t=function(a){a.gc.width(a.w);for(var b=0;b<a.ln;b++){var c=a.c[b];a.g[b].css({left:c.offset().left-a.offset().left+c.outerWidth(!1)+a.cs/2+i,height:a.opt.headerOnly?a.c[0].outerHeight(!1):a.outerHeight(!1)})}},u=function(a,b,c){var d=e.x-e.l,f=a.c[b],g=a.c[b+1],h=f.w+d,j=g.w-d;f.width(h+i),a.cg.eq(b).width(h+i),a.f?(g.width(j+i),a.cg.eq(b+1).width(j+i)):a.opt.overflow&&a.css("min-width",a.w+d),c&&(f.w=h,g.w=a.f?j:g.w)},v=function(b){var c=a.map(b.c,function(a){return a.width()});b.width(b.w=b.width()).removeClass(k),a.each(b.c,function(a,b){b.width(c[a]).w=c[a]}),b.addClass(k)},w=function(a){if(e){var b=e.t,c=a.originalEvent.touches,d=c?c[0].pageX:a.pageX,f=d-e.ox+e.l,g=b.opt.minWidth,h=e.i,j=1.5*b.cs+g+b.b,k=h==b.ln-1,l=h?b.g[h-1].position().left+b.cs+g:j,n=b.f?h==b.ln-1?b.w-j:b.g[h+1].position().left-b.cs-g:1/0;if(f=m.max(l,m.min(n,f)),e.x=f,e.css("left",f+i),k){var o=b.c[e.i];e.w=o.w+f-e.l}if(b.opt.liveDrag){k?(o.width(e.w),!b.f&&b.opt.overflow?b.css("min-width",b.w+f-e.l):b.w=b.width()):u(b,h),t(b);var p=b.opt.onDrag;p&&(a.currentTarget=b[0],p(a))}return!1}},x=function(d){if(c.unbind("touchend."+j+" mouseup."+j).unbind("touchmove."+j+" mousemove."+j),a("head :last-child").remove(),e){if(e.removeClass(e.t.opt.draggingClass),e.x-e.l!=0){var f=e.t,g=f.opt.onResize,h=e.i,i=h==f.ln-1,k=f.g[h].c;i?(k.width(e.w),k.w=e.w):u(f,h,!0),f.f||v(f),t(f),g&&(d.currentTarget=f[0],g(d)),f.p&&b&&s(f)}e=null}},y=function(b){var g=a(this).data(j),h=f[g.t],i=h.g[g.i],k=b.originalEvent.touches;if(i.ox=k?k[0].pageX:b.pageX,i.l=i.position().left,i.x=i.l,c.bind("touchmove."+j+" mousemove."+j,w).bind("touchend."+j+" mouseup."+j,x),d.append("<style type='text/css'>*{cursor:"+h.opt.dragCursor+"!important}</style>"),i.addClass(h.opt.draggingClass),e=i,h.c[g.i].l)for(var l,m=0;m<h.ln;m++)l=h.c[m],l.l=!1,l.w=l.width();return!1},z=function(){for(var a in f)if(f.hasOwnProperty(a)){a=f[a];var c,d=0;if(a.removeClass(j),a.f){for(a.w=a.width(),c=0;c<a.ln;c++)d+=a.c[c].w;for(c=0;c<a.ln;c++)a.c[c].css("width",m.round(1e3*a.c[c].w/d)/10+"%").l=!0}else v(a),"flex"==a.mode&&a.p&&b&&s(a);t(a.addClass(j))}};a(window).bind("resize."+j,z),a.fn.extend({colResizable:function(b){var c={resizeMode:"fit",draggingClass:"JCLRgripDrag",gripInnerHtml:"",liveDrag:!1,minWidth:15,headerOnly:!1,hoverCursor:"col-resize",dragCursor:"col-resize",postbackSafe:!1,flush:!1,marginLeft:null,marginRight:null,disable:!1,partialRefresh:!1,disabledColumns:[],removePadding:!0,onDrag:null,onResize:null},b=a.extend(c,b);switch(b.fixed=!0,b.overflow=!1,b.resizeMode){case"flex":b.fixed=!1;break;case"overflow":b.fixed=!1,b.overflow=!0}return this.each(function(){p(this,b)})}})}(jQuery);var app=app||{};app.charts=app.charts||{},app.charts.tree={},app.charts.tree.draw=function(a,b,c,d){function e(c){return c.dimensionName=a.dimensionName,c.datasourceId=a.DataSourceId,c.chartId=b.editMode?-1:a.chartId,b.editMode||c.Id!=-1||app.chartCommons.userFilter.setFilter({id:c.Id,values:c.Values,variableType:c.VariableType,dimensionName:c.dimensionName,chartInPageId:b.ChartInPageId,datasourceId:c.datasourceId}),+c.Id==-1?(app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),void app.filterBox.refresh()):void $.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(c),success:function(a){a.result?(app.moderation.dashboadpage.refreshRelatedDatasources(a.relatedDatasource,[+b.ChartInPageId]),app.filterBox.refresh()):alert(a.Message)}})}b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var f=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),g="undefined"!=typeof a.kpis?a.kpis.labels:[],h=(b.LabelY,"#"+b.id),i=$(h).width();$(h).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130;b.width=i;"undefined"==typeof a.lang||0==+a.lang,d.isProgress,d.showProgress,d.title;if(b.editMode&&$(h).trigger("chartproperty",[g.concat(f)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(h).addClass("tree-chart");var j=$(h+" .title").outerHeight(),k=$(h).outerHeight()-j-2,l=d3.select(h).append("ul").attr("class","root-node temporal tree").text("");l.style("height",k+"px");var m=function(a,c){a.select(".loading").remove(),$(a.node()).data("vals",c.vals);var d=$(a.node()).find(".tree-caret"),f=0==d.length||d.hasClass("rotate"),g=d3.select($("<ul></ul>").get(0)).attr("class","tree-element collapse fade "+(f?"in":""));c.data=c.data.map(function(a){return{id:a[0],parent:a[1],name:a[2]||a[0],type:c.hasType?a[3]:null,childs:a[a.length-1]}});var i=g.selectAll("li").data(c.data).enter().append("li").attr("class","node tree-element");i.append("span").text(function(a,b){return a.name}).attr("class","value pointer").on("click",function(a){var d=b.chartProp.info.selectable;if("undefined"!=typeof d&&"none"!=d){"one"==d&&$(this).closest(".tree-chart").find(".value.active").removeClass("active"),$(this).toggleClass("active");var f=d3.select(h).selectAll(".active").data().map(function(a){return a.id}),g=_.filter(c.vals,function(a){return a[0]==f}).map(function(a){return a[1]});e({Id:-1,Values:g,VariableType:0})}}),i.each(function(a){0!=+a.childs&&d3.select(this).append(b.editMode?"span":"i").attr("class",function(){return b.editMode?"glyphicon-chevron-left glyphicon tree-caret pointer":"icon angle down icon-animate large  tree-caret pointer"}).text(" ").on("click",function(a,c){if(0!=+a.childs){var d=$(this),e=d.hasClass("rotate");e?d.removeClass("rotate"):d.addClass("rotate");var f=$(this).data("loaded");if(f){var g=$(this).parent().find(" > ul");return void(b.editMode?g.collapse(d.hasClass("rotate")?"hide":"show"):g.transition(e?"out scale right":"in  scale left"))}$(this).data("loaded",!0);var h=app.urlPrefix+"Charts/BarChart/getTreeData",i={parent:a.id,chartId:b.chartId,ChartInPageId:b.ChartInPageId,notEditMode:!b.editMode};b.editMode&&(i.ChartInfo=$("#divChart").data("chartInfo"));var j=d3.select(this).node().parentElement;d3.select(j).append("ul").attr("class","loading collapse fade in").html('<div class="ui active inline loader mini"></div>');var k=app.mobileMode?proxy.ajax:$.ajax,l=app.mobileMode&&!app.mobileModeTest?i:JSON.stringify(i);k({url:h,type:"POST",dataType:"json",data:l,success:function(a,c,d){b.mobileModeData={isOnline:c,date:d},m(d3.select(j),a)},contentType:"application/json",error:function(){}})}})}),b.editMode||g.style("display","none"),$(a._groups[0][0]).append($(g._groups[0][0])),b.editMode||$(a._groups[0][0]).find("> ul").transition("in scale ")};m(l,a),$(h).trigger("heightChange")};var app=app||{};app.charts=app.charts||{},app.charts.text={},app.charts.text.draw=function(a,b,c,d){b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var e=(a.title,a.chartInfo,"undefined"!=typeof a.series?a.series.labels:[]),f="undefined"!=typeof a.kpis?a.kpis.labels:[],g=(b.LabelY,"#"+b.id),h=$(g).width();$(g).height(),"small"==b.chartProp.info.chartSize?150:"medium"==b.chartProp.info.chartSize?200:"large"==b.chartProp.info.chartSize?250:"veryLarge"==b.chartProp.info.chartSize?400:130;b.width=h;"undefined"==typeof a.lang||0==+a.lang,d.isProgress,d.showProgress,d.title;if(b.editMode&&$(g).trigger("chartproperty",[f.concat(e)]),!a.result)return void $("#"+b.id).append(app.chartCommons.getError(a));$(g).addClass("tree-chart").css("text-align","right");var i=$(g+" .title").outerHeight(),j=$(g).outerHeight()-i-2,k=d3.select(g).append("ul").attr("class","root-node temporal tree").text("");k.style("height",j+"px"),$(g).append(b.chartProp.info.html)};var app=app||{};app.charts=app.charts||{},app.charts.userControl={},String.prototype.deentitize=function(){var a=this.replace(/&gt;/g,">");return a=a.replace(/&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&quot;/g,'"'),a=a.replace(/&apos;/g,"'"),a=a.replace(/<br r >/g,"\r"),a=a.replace(/<br n >/g,"\n")},String.prototype.entitize=function(){var a=this;return a=a.replace(/&/g,"&amp;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/</g,"&lt;"),a=a.replace(/"/g,"&quot;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/\r/g,"<br r >"),a=a.replace(/\n/g,"<br n >")},app.charts.userControl.draw=function(a,b,c,d){function e(){function c(a){var c=[a],d=b.chartProp.info.textOperand||"or",e="undefined"==typeof b.chartProp.info.useLike||b.chartProp.info.useLike,f="undefined"==typeof b.chartProp.info.useNormal||b.chartProp.info.useNormal;c.push(JSON.stringify({op:d,useLike:e,useNormal:f}));var g=b.chartProp.info.dimensions.map(function(a){return a.Name}).join(", ");if(c.push(g),b.chartProp.info.dimensions.forEach(function(a){c.push(a.formula)}),b.editMode)$(l).trigger("default-value",[!0,c,5]);else{var h={Id:b.chartProp.info.variableId||-1,Values:c,VariableType:5};k(h)}}var d='<div class="input-group temporal" style="margin-top:10px">                   <span class="input-group-btn">                     <button type="button" class="btn btn-default">                     <span style="font-size:13px" class="glyphicon glyphicon-search"> </span>                     </button>                   </span>                   <input type="text" placeholder="جستجو..." class="form-control">                 </div>';d='<div class="ui form temporal"><div class=" field"><div class="ui icon input">  <input type="text" placeholder="جستجو...">  <i class="search icon"></i></div></div></div>',$(l).append(d),$(l+" input").on("keydown",function(a){if(13==a.keyCode){var b=$(this).val();c(b)}}),$(l+" button").on("click",function(){var a=$(l+" input").val();c(a)});var e=[];e=a.GloablFilterDefaultValue?a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&b.chartProp.info.variableId!=-1?a.DefaultValue:b.chartProp.info.variableDefault&&b.chartProp.info.variableDefault.values&&"NONE"==b.chartProp.info.variableDefaultType&&b.chartProp.info.variableId!=-1?b.chartProp.info.variableDefault.values:["",""],$(l+" input").val(e[0])}function f(){if(!b.editMode){var c=app.chartCommons.userFilter.getFilterValue(b.ChartInPageId);_.isNull(c)||(a.GloablFilterDefaultValue=a.GloablFilterDefaultValue||{},a.GloablFilterDefaultValue.ValuesType=c.variableType,a.GloablFilterDefaultValue.Value=3==+c.variableType?c.defaultValue:c.values)}}function g(){var d=a.fields.map(function(a){return a.Value}),e=a.fields.map(function(a){return a.Key});e.length!=d.length&&$("#"+b.id).append(app.chartCommons.getError(a));for(var f=[],g=0;g<d.length;g++)f.push({Caption:e[g],Uniquename:d[g],IsChecked:!1});var h=function(c){var d=c.filter(function(a){return a.IsChecked}).map(function(a){return a.Uniquename}),e=c.filter(function(a){return a.IsChecked}).map(function(a){return a.Caption}),f='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+e.map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(f),a.DefaultValue=d,b.editMode?$(l).trigger("default-value",[!0,d,0]):k({Id:b.chartProp.info.variableId||-1,Values:d})};if(select='<div class="container-fluid temporal" style="margin: 15px 0px 10px;"><div class="row"><a  class=" btn btn-primary pointer filter-member btn-block"> '+(b.chartProp.info.label||"انتخاب")+' <span class="glyphicon glyphicon-list-alt"></span></a></div><div class="row selected-item col-sm-12"></div></div>',$(l).append(select),$(l+" .filter-member").on("click",function(){app.helper.filterMemberDialog(f,h)}),null!=a.DefaultValue&&a.DefaultValue.length>0){f.filter(function(b){return a.DefaultValue.indexOf(b.Uniquename)!=-1}).forEach(function(a,b){a.IsChecked=!0});var i='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+f.filter(function(a){return a.IsChecked}).map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a.Caption+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(i)}else if(b.chartProp.info.variableDefault&&b.chartProp.info.variableDefault.values){var j=b.chartProp.info.variableDefault.values;f.filter(function(a){return j.indexOf(a.Uniquename)!=-1}).forEach(function(a,b){a.IsChecked=!0});var i='<div style="text-align: right; font-size: 0.9em; margin-top: 7px;"><b>انتخاب‌ها:</b><ul>'+f.filter(function(a){return a.IsChecked}).map(function(a){return'<li style="  float:right; display:inline; width:33%;">'+a.Caption+"</li>"}).join("")+"</ul></div>";$(l+" .selected-item").html(i)}if(b.editMode){$(l).find("select");$(l).trigger("default-value",[!1,[f[0].UniqueName],0])}c&&h(f)}function h(c){function d(a){return jd_to_persian(gregorian_to_jd(a[0],a[1]+1,a[2]))}function e(a,b){var c="000000000"+a;return c.substr(c.length-b)}function f(a,c,d,e,f){if((!c||d&&e)&&(c||d)&&(b.editMode||!(c&&i==d&&j==e||!c&&i==d))){i=d,j=e;var g=c?[d,e]:[d,b.chartProp.info.dateOp];if(b.input.DefaultValue=g,!b.editMode&&f){var h={Id:b.chartProp.info.variableId||-1,Values:g,VariableType:c?2:4};k(h)}else{$(l).find("select");$(l).trigger("default-value",[!0,g,c?2:4])}$(l).data("user-value",g)}}var g='<div class="ui form temporal"><div class=" field"><div class="ui input">                        <input autocomplete="off" type="text" id=""  class="form-control from" placeholder="تاریخ" /><input id="from-value" type="hidden"/>                      </div></div></div>';c&&(g='<div class="ui grid temporal form-content" ><div class="row">                        <div class="five wide column ui input">                            <input autocomplete="off" type="text" class="datepicker form-control from" placeholder="تاریخ شروع" />                            <input id="from-value" type="hidden"/>                        </div>                        <div class="two wide column">تا</div>                        <div class="five wide column ui input">                            <input autocomplete="off" type="text" class="datepicker form-control to" placeholder="تاریخ پایان"/>                            <input id="to-value" type="hidden"/>                        </div>                      </div></div>'),g=$(g),$(l).append(g);var h=function(){setTimeout(function(){$(".ui-datepicker").css("z-index",4)},0)};c?(g.find(".from").datepicker({defaultDate:"+1w",changeYear:!0,changeMonth:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#from-value"),onClose:function(a){a&&(g.find(".to").datepicker("option","minDate",a),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!0))},yearRange:"-30:+30",beforeShow:h}),g.find(".to").datepicker({defaultDate:"+1w",changeYear:!0,changeMonth:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#to-value"),onClose:function(a){a&&(g.find(".from").datepicker("option","maxDate",a),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!0))},yearRange:"-30:+30",beforeShow:h})):g.find(" .from").datepicker({changeMonth:!0,changeYear:!0,dateFormat:b.chartProp.info.dateFormatShow+"",altFormat:b.chartProp.info.dateFormatValue+"",altField:g.find("#from-value"),onClose:function(a){a&&f(g,c,g.find("#from-value").val(),null,!0)},yearRange:"-30:+30",beforeShow:h});var i,j,m=!1;if("undefined"==typeof a.DefaultValue||!a.DefaultValue){var n=new Date,o=d([n.getFullYear(),n.getMonth(),n.getDate()]),p=o[0]+"/"+e(o[1],2)+"/"+e(o[2],2);g.find(".from").datepicker("option","dateFormat","yy/mm/dd"),g.find(".from").datepicker("setDate",p),g.find(".from").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue),p=g.find(".from").val(),a.DefaultValue=[p,p],m=!0}var q=[];a.GloablFilterDefaultValue?q=a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&b.chartProp.info.variableId!=-1&&(q=a.DefaultValue),q=q.map(function(a){return a.replace(/\[[^\]]+\]/,"")}),g.find(".from").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue+""),g.find(".to").datepicker("option","dateFormat",b.chartProp.info.dateFormatValue+""),i=m?"":q[0],g.find(".from").datepicker("setDate",q[0]),c&&(g.find(".to").datepicker("setDate",q[1]),j=m?"":q[1]),f(g,c,g.find("#from-value").val(),g.find("#to-value").val(),!1)}function i(c){function d(a,c){if(a||c.push(b.chartProp.info.sliderRange),b.input.DefaultValue=c,b.editMode)$(l).trigger("default-value",[!0,c,1]);else{var d={Id:b.chartProp.info.variableId||-1,Values:c,VariableType:1};$(l).data("user-value",c),k(d)}}var e=a.fields.map(function(a){return a.Value}),f=(a.fields.map(function(a){return a.Key}),""!=b.chartProp.info.sliderMax&&"undefined"!=typeof b.chartProp.info.sliderMax?+b.chartProp.info.sliderMax:d3.max(e,function(a){return+a.replace(/\[[^\]]+\]/,"")})||100),g=""!=b.chartProp.info.sliderMin&&"undefined"!=typeof b.chartProp.info.sliderMin?+b.chartProp.info.sliderMin:d3.min(e,function(a){return+a.replace(/\[[^\]]+\]/,"")})||0,h='<div class="temporal" style="padding-left: 15px; padding-right: 15px; padding-top:5px">                        <div class="slider"></div>                        <div class="slider-value ltr" style="margin-top:5px"> </div>                        <input id="from-value" type="hidden"/>                      </div>';h=$(h),$(l).append(h),b.chartProp.info.sliderFont=_.extend({bold:!1,color:"#333333",italic:!1,fontSize:"10px",fontName:"IRANSans",formatString:b.chartProp.info.sliderFormat||",.2f",formatStringCustom:",.2f"},b.chartProp.info.sliderFont);var i="min-max"==b.chartProp.info.sliderRange,j=function(a){var c=b.chartProp.info.sliderFont.formatString||",.2f";return Array.isArray(a)?'<div class="inline">'+persian(d3.format(c)(a[0]),n)+'</div> <div class="inline"> تا </div> <div class="inline">'+persian(d3.format(c)(a[1]),n)+"</div>":persian(d3.format(c)(a),n)};h.find(".slider").slider({range:!!i||b.chartProp.info.sliderRange,min:g,max:f,slide:function(a,b){h.find(".slider-value").html(j(i?b.values:b.value))},stop:function(a,b){d(i,i?b.values:[b.value])}}),h.find(".slider .ui-slider-range").css("background-color","#ddd"),h.find(".slider.ui-widget-content").css("box-shadow","none"),h.find(".slider .ui-slider-handle").css("background-color","#337ab7");var m=[];m=a.GloablFilterDefaultValue?a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&b.chartProp.info.variableId!=-1?a.DefaultValue:[g,f],m=m.map(function(a){return+a.toString().replace(/\[[^\]]+\]/,"")||0}),1==m.length&&m.splice(0,0,0),m[1]<m[0]&&(m[1]=m[0]),h.find(".slider-value").html(j(i?m:m[0])),h.find(".slider-value").css({"font-size":b.chartProp.info.sliderFont.fontSize,"font-family":b.chartProp.info.sliderFont.fontName,color:b.chartProp.info.sliderFont.color,"font-weight":b.chartProp.info.sliderFont.bold?"bold":"normal","font-style":b.chartProp.info.sliderFont.italic?"italic":"normal"}),i?h.find(".slider").slider("values",m):h.find(".slider").slider("value",m[0]),$(l).data("user-value",m)}function j(c){function d(){p||(clearTimeout(o),o=setTimeout(function(){var a=$(l+" .ui.dropdown").dropdown("get value");_.isArray(a)||(a=[a]),a=_.filter(a,null),m(_.map(a,function(a){return a.deentitize()}))},200))}var e=b.chartProp.info.comboStyle;(app.mobile||b.editMode)&&(e="default");var f=a.fields.map(function(a){return a.Value.entitize()}),g=a.fields.map(function(a){return a.Key.entitize()});g.length!=f.length&&$("#"+b.id).append(app.chartCommons.getError(a));var h='<select class="temporal ui fluid '+(c?"multiple":"")+' search selection dropdown" '+(c?"multiple":"")+" >";h+='  <option value="">'+b.chartProp.info.label+"</option>";for(var i=0;i<g.length;i++)h+='  <option value="'+f[i]+'">'+g[i]+"</option>";h+="</select>",$(l).append(h);var j=$(l).find("select");j.on("change",function(){app.lang.setLang({selector:l})});var m=null;m=b.editMode?function(b){a.DefaultValue=b,$(l).trigger("default-value",[!0,a.DefaultValue,0])}:function(c){return!b.chartProp.info.disableClear||c&&c.length?(a.DefaultValue=c,void k({Id:b.chartProp.info.variableId||-1,Values:a.DefaultValue,VariableType:0})):void $(l+" .ui.dropdown").dropdown("set selected",a.DefaultValue)};var n=[];a.GloablFilterDefaultValue&&b.chartProp.info.variableId==-1?n=a.GloablFilterDefaultValue.Value:null!=a.DefaultValue&&a.DefaultValue.length>0&&(n=a.DefaultValue),a.DefaultValue=n;var o,p=!0;$(l+" .ui.dropdown").dropdown({onChange:function(a,b,e){c||d()},onRemove:function(a,b,c){d()},onAdd:function(a,b,c){d()},apiSettings:{url:app.urlPrefix+"api/chartdata/GetColumnMembers",cache:!1,method:"post",beforeSend:function(a){var c=_.filter(app.chartCommons.drillDown.filters,function(a){if(!b.input||!b.input.RefreshDatasource)return!1;var c=b.input.RefreshDatasource.indexOf(a.datasourceId)!=-1;return c&&a.chartInPageId!=b.ChartInPageId}),d=$.extend([],_.filter(app.chartCommons.userFilter.filters,function(a){if(!b.input||!b.input.RefreshDatasource)return!1;var c=b.input.RefreshDatasource.indexOf(a.datasourceId)!=-1;return c}));_.remove(d,{chartInPageId:b.ChartInPageId});var e=JSON.parse(localStorage.getItem("userVariable"))||[];return a.data={chartId:b.chartId,chartInPageId:b.ChartInPageId,userVariable:e,userControlFilter:d,otherFilters:c,query:a.urlData.query,chartInfo:$("#divChart").data("chartInfo")},a},onResponse:function(a){a.fields=a.fields.map(function(a){return{Key:a.Key.entitize(),Value:a.Value.entitize()}});var b=$(l+" .ui.dropdown").dropdown("get value");return b||(b=[]),_.isArray(b)||(b=[b]),a.fields=a.fields.filter(function(a){return b.indexOf(a.Value)==-1}),a},dataType:"json"},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"Key",value:"Value"},saveRemoteData:!1,forceSelection:!1}),$(l+" .ui.dropdown .dropdown.icon").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(l+" .ui.dropdown input").focus()}),$(l+" .ui.dropdown").dropdown("set selected",n),p=!1}function k(c){function d(a,d){var f={id:c.Id,values:c.Values,variableType:c.VariableType,dimensionName:d,chartInPageId:b.ChartInPageId,datasourceId:a,disableClear:c.disableClear};app.chartCommons.userFilter.setFilter(f),e({url:app.urlPrefix+"api/chartdata/logUserControl",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(f)})}var e=app.mobileMode?proxy.ajax:$.ajax;if(c.disableClear=b.chartProp.info.disableClear,b.editMode||o||(a.datasources?_.each(a.datasources,function(a){d(a.datasourceId,a.name)}):d(a.DataSourceId,a.dimensionName)),+c.Id==-1)return app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),void app.filterBox.refresh();c.dimensionName=a.dimensionName,c.datasourceId=a.DataSourceId,c.chartId=a.chartId;var f=app.mobileMode?c:JSON.stringify(c);console.log("### user control ajaxCall init *****************"),e({type:"POST",url:app.urlPrefix+"api/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:f,success:function(a){debugger;a.result?"undefined"!=typeof b.chartProp.info.variableId&&b.chartProp.info.variableId!=-1?$(".bar-chart").each(function(){var a=$(this).data("settings");"undefined"!=typeof a.input.GlobalVariables&&a.input.GlobalVariables.indexOf(b.chartProp.info.variableId)!=-1&&(a.titlebar.showProgress(!0),$(this).charts(a.type,"refreshWithData",a,{refreshRelatedDatasources:!1}))}):app.mobileMode?app.mobile.filterChanged(a.RefreshDatasource,[+b.ChartInPageId]):(app.moderation.dashboadpage.refreshRelatedDatasources(a.RefreshDatasource,[+b.ChartInPageId]),
app.filterBox.refresh()):alert(a.Message)},error:function(a){app.mobileMode&&app.mobile.showToastMessage(a)}})}app.dashboardLayoutVersion=app.dashboardLayoutVersion||2,b.input=a,app.chartCommons.calculateFields(a.series,b.calculatedFields);var l="#"+b.id,m=$(l).width();b.width=m;var n="undefined"==typeof a.lang||0==+a.lang;d.isProgress,d.showProgress,d.title;if("NONE"==b.chartProp.info.variableDefaultFunction&&(b.chartProp.info.variableDefaultType="NONE"),!a.result&&"datepicker"!=b.chartProp.info.type&&"datepicker-range"!=b.chartProp.info.type)return void $("#"+b.id).append(app.chartCommons.getError(a));var o=b.chartProp.info.variableId!=-1;switch(f(),b.chartProp.info.type){case"combo":j();break;case"multi":j(!0);break;case"datepicker":h(!1);break;case"datepicker-range":h(!0);break;case"multi-filter":g();break;case"slider":i();break;case"text":e()}$(l).trigger("heightChange")};
// داشبورد مدیریتی صدف info@sadafdashboard.ir 

var manageApp=angular.module("services",["ngMaterial","ngAnimate","ui.sortable","uibCollapseCat"]),ngApp=angular.module("services");ngApp.service("datasources",["$http","$mdMedia","$mdDialog","$compile","$rootScope","$q","$timeout",function(a,b,c,d,e,f,g){function h(){return l||(l=a.get(app.urlPrefix+"api/menus/get")),l}function i(){o={name:"همه",open:!0},p={name:"همه",open:!0}}function j(a,b){var c={type:["charts"],search:["content"],selectableDir:!1,justDir:!1,multipleChart:!0,multipleDatasource:!1};b=angular.extend({},c,b);var h=f.defer();b.deferred=h;var i=$("#asset-picker");if(!i.length){m=e.$new(),m.options=b;var j=d('<select-asset-dialog ng-model="options" ></select-asset-dialog>')(m);angular.element("div[ng-app]").append(j)}return g(function(){i=$("#asset-picker"),m.options=b,m.options.setLastSelect=function(a){n.charts=a.charts},i.modal("show")},1),h.promise}function k(b){var c=app.urlPrefix+"Moderation/OlapChartDesign/CubeInformation?DataSourceId="+b;return a.get(c).then(function(a){return a.data})}var l,m,n={},o={name:"همه",open:!0},p={name:"همه",open:!0};return{get:h,select:j,lastSelected:n,reset:i,getColumns:k}}]),ngApp.directive("selectAssetDialog",[function(){return{scope:{ngModel:"="},controller:["$scope","$mdDialog","$timeout","$http",function(a,b,c,d){function e(b){function e(c){return console.log("search ",c),c?(a.showCharts&&(a.searchProgressChart=!0,d.get(app.urlPrefix+"api/charts/getlist?q="+c+"&parentRole="+b.parentRole).then(function(b){a.searchProgressChart=!1,l&&m?a.searchResultChart=b.data.list:l?a.searchResultChart=_.filter(b.data.list,{type:2}):a.searchResultChart=_.filter(b.data.list,{type:1})})),void(a.showDatasources&&(a.searchProgressDatasource=!0,d.get(app.urlPrefix+"api/datasources/get?q="+c).then(function(b){a.searchProgressDatasource=!1,l&&m?a.searchResultDatasource=b.data.list:l?a.searchResultDatasource=_.filter(b.data.list,{type:2}):searchResultDatasource=_.filter(b.data.list,{type:1})})))):(a.searchResultDatasource=null,void(a.searchResultChart=null))}function f(a,b){b(a),a.nodes&&(_.forEach(a.nodes,function(a){f(a,b)}),_.forEach(a.contents,function(a){f(a,b)}))}var g={name:"همه",open:!0},h={name:"همه",open:!0};a.query=null,a.searchResultDatasource=null,a.searchResultChart=null,a.showCharts=b.type.indexOf("charts")!=-1,a.showDatasources=b.type.indexOf("datasources")!=-1,a.selectedIndex=a.showDatasources?0:1;var i;a.search=function(b,d){c.cancel(i),i=c(function(){e(a.query)},400)},a.cancel=function(){$("#asset-picker").modal("hide")},a.select=function(){var c,d;a.showCharts&&a.showDatasources?(c=0==a.selectedIndex?a.datasources:a.charts,d=0==a.selectedIndex?"datasources":"charts"):a.showDatasources?(c=a.datasources,d="datasources"):(c=a.charts,d="charts");var e=[];a.searchResultDatasource||a.searchResultChart?(e=_.filter("charts"==d?a.searchResultChart:a.searchResultDatasource,{check:!0}),b.setLastSelect({charts:e})):f(c,function(a){a.active&&e.push(a)}),b.deferred.resolve({selected:e,type:d}),$("#asset-picker").modal("hide")};var j=function(a){if(!a.nodes){var c=app.urlPrefix+"api/charts/getlist?packageId="+a.id+"&parentRole="+b.parentRole;d.get(c).then(function(b){a.loaded=!0,a.nodes=_.filter(b.data.list,{type:1}),a.contents=_.filter(b.data.list,{type:2})})}},k=function(a){if(!a.nodes){var c=app.urlPrefix+"api/datasources/get?packageId="+a.id+"&parentRole="+b.parentRole;d.get(c).then(function(b){a.loaded=!0,a.nodes=_.filter(b.data.list,{type:1}),a.contents=_.filter(b.data.list,{type:2})})}};a.optDatasource={urlPrefix:app.urlPrefix+"api/datasources/get?packageId=",multiple:b.multipleDatasource,selectableDir:b.selectableDir,url:k,justDir:b.justDir},a.optChart={urlPrefix:app.urlPrefix+"api/charts/getlist?packageId=",multiple:b.multipleChart,selectableDir:b.selectableDir,url:j,justDir:b.justDir},a.datasources=g,a.charts=h,f(a.datasources,function(a){a.active=!1}),f(a.charts,function(a){a.active=!1}),a.showCharts&&j(a.charts),a.showDatasources&&k(a.datasources);var l=b.search.indexOf("content")!=-1,m=b.search.indexOf("dir")!=-1}a.$watch("ngModel",function(a,b){e(a)})}],template:'<div class="ui modal" id="asset-picker" aria-label="{{\'choose\' | translate}}" >                                                                                                                                 <div class="header">                                                                                                                                                                              <div class="ui form" >                <div class="field icon ui input fluid">                    <input type="text" ng-model="query" ng-change="search()" placeholder="{{\'جستجو\' | translate}}" />                    <i class="icon" title="{{\'clear\' | translate}}" ng-class="{remove: query.length, search: !query}" ng-click="query = null;search();" style="cursor:pointer !important; pointer-events:all !important"></i>                </div>            </div>        </div>                                                                                                                                                                         <div class="content scrolling">                                                                                                                                                                       <div class ="" >                                                                                                                                                    <div class="ui menu secondary pointing" ng-show="showDatasources&&showCharts">                    <div class="pointer item" ng-class="{active: selectedIndex==0}" ng-click="selectedIndex = 0">{{ \'datasources\' | translate }}</div>                    <div class="pointer item" ng-class="{active: selectedIndex==1}" ng-click="selectedIndex=1">{{ \'charts\' | translate }}</div>                </div>                <div >                    <div ng-if="showDatasources" ng-show="selectedIndex==0" >                                                                                                                                         <div class="ui active dimmer inverted" style="position:inherit;" ng-show="searchProgressDatasource">                            <div class="ui active centered inline text loader">                                                                       {{\'searching\' | translate}}                                                                                                                                                       </div>                                                                                                                                                                                </div>                                                                                                                                                                                <div ng-show="searchResultDatasource && !searchResultDatasource.length && !searchProgressDatasource">{{\'search_no_result\' | translate}}</div>                                 <tree ng-show="!searchResultDatasource" ng-model="datasources" option="optDatasource" class ="block"></tree>                                                                          <div ng-show="searchResultDatasource" layout-margin >                                                                                                                                     <div ng-repeat="i in searchResultDatasource">                                                                                                                                             <label><input type="checkbox" ng-model="i.check"/> {{i.name}}</label>                                                                                                                          </div>                                                                                                                                                                            </div>                                                                                                                                                                            </div>                                                                                                                                                                                                                                                                                                                                                                   <div  ng-if="showCharts" ng-show="selectedIndex==1">                                                                                                                                                <div class="ui active dimmer inverted" style="position:inherit;" ng-show="searchProgressChart">                            <div class="ui active centered inline text loader">                                  {{\'searching\' | translate}}                                                                                                                                                       </div>                                                                                                                                                                                </div>                                                                                                                                                                                <div class ="md-caption" layout-padding ng-show="searchResultChart && !searchResultChart.length && !searchProgressChart">{{\'search_no_result\' | translate}}</div>                                           <tree ng-show="!searchResultChart" ng-model="charts" option="optChart" class ="block"></tree>                                                                                         <div ng-show="searchResultChart" layout-margin >                                                                                                                                          <div ng-repeat="i in searchResultChart">                                                                                                                                                  <label><input type="checkbox" ng-model="i.check"/> {{i.name}}</label>                                                                                                                          </div>                                                                                                                                                                            </div>                                                                                                                                                                            </div>                                                                                                                                                                         </div>                                                                                                                                                                        </div>                                                                                                                                                                            </div>                                                                                                                                                                  <div class="actions">                                                                                                                                                          <div class="ui button green" ng-click="select()"> {{\'choose\' | translate}} </div>            <div class="ui button" ng-click="cancel()"> {{\'cancel\' | translate}} </div>        </div>                                                                                                                                                          </div>'}}]),ngApp.directive("collapse",function(){return{restrict:"E",transclude:!0,scope:{title:"@",hideIcon:"@",onTitleClick:"&",model:"=?ngModel",selectableDir:"=?"},controller:["$scope",function(a){var b,c;a.model=a.model||{},this.addHeader=function(d){b=d,b.show=a.model.open,b.click=function(){c&&(a.model.open=!c.show,c.show=!c.show),a.onTitleClick()}},this.addBody=function(b){c=b,c.show=a.model.open},"true"==a.hideIcon&&b&&(b.hideIcon=!0),a.$watch("hideIcon",function(c){"true"==a.hideIcon&&b&&(b.hideIcon=!0)})}],template:"<div ng-transclude><div>"}}).directive("collapseHeader",function(){return{restrict:"E",transclude:!0,require:"^^collapse",scope:{},link:function(a,b,c,d){d.addHeader(a)},template:'<div ng-click="show = !show; click()" class="pointer title">                        <i style="width:30px;" class="ui icon angle left icon-animate" ng-class ="{\'rotate-90\' : show}" ng-style="{\'visibility\': !hideIcon ? \'visible\' : \'hidden\'}" xng-hide="hideIcon"></i>                        <div ng-transclude style="width: calc(100% - 40px); display:inline-block;" ><div>                 </div>'}}).directive("collapseBody",function(){return{restrict:"E",transclude:!0,require:"^^collapse",scope:{},link:function(a,b,c,d){d.addBody(a)},template:'<div class="body" uib-collapse="!show" style="min-height:unset;" ng-transclude></div>'}}).directive("tree",function(){return{restrict:"E",transclude:!0,scope:{root:"=ngModel",option:"=",url:"&"},controller:["$scope","$http","$translate",function(a,b,c){function d(a,b){b(a),a.nodes&&(_.forEach(a.nodes,function(a){d(a,b)}),_.forEach(a.contents,function(a){d(a,b)}))}a.root=a.root||{name:"root",open:!0},a.active=function(b){var c=b.active;a.option.multiple||d(a.root,function(a){a.active=!1}),b.active=c},a.selectAll=function(a,b){_.each(a.contents,function(a){a.active=b})}}],template:'<div class ="sadaf-tree">    <div style="list-style:none" class ="tree-element ul">        <div ng-repeat="data in [root]" class ="tree-element li" ng-include="\'tree_item_renderer.html\'"></div>    </div></div><script type="text/ng-template" id="tree_item_renderer.html">    <collapse class ="block" selectable-dir="option.selectableDir" ng-model="data"        hide-icon="{{(!data.nodes || !data.nodes.length ) && ( option.justDir || ( !data.contents || !data.contents.length) ) && data.loaded }}">        <collapse-header class ="block" ng-click="$event.stopPropagation(); option.url(data)">            <label ng-show="option.selectableDir" style="margin:0">                 <input type="checkbox" ng-model="data.active"ng-change="active(data)" ng-click="$event.stopPropagation()"/> {{data.name}}</label>            <span ng-show="!option.selectableDir">{{data.name}}</span>        </collapse-header>        <collapse-body class ="block">            <div class ="tree-element ul" style="list-style:none" >                <div class="ui active dimmer inverted" style="position:inherit; display:inline" ng-show="!data.loaded">                     <div class="ui active mini inline text loader">                    </div>                </div>                <div ng-show="data.loaded" class ="tree-element li">                    <label ng-show="option.multiple && data.contents.length" >                         <input type="checkbox" ng-click="$event.stopPropagation()" ng-model="data.selectAll" ng-change="selectAll(data, data.selectAll)"/> <small> {{"select_all" | translate}} </small></label></div>                <div ng-repeat="data in data.nodes" class ="tree-element li" ng-include="\'tree_item_renderer.html\'"></div>                <div ng-repeat="u in data.contents" class ="tree-element li" ng-class ="{active : u.active}" ng-hide="option.justDir">                    <label  style="margin-bottom:0"> <input ng-model="u.active" ng-change="active(u)"type="checkbox" /> {{u.name}}</label>                </div>            </div>        </collapse-body>    </collapse></script>'}}),ngApp.service("chartComments",["$http",function(a){function b(b,c){return a.post(app.urlPrefix+"api/ChartComments/save/"+b,c).then(function(a){return a.data})}return{save:b}}]);var sApp=angular.module("services");sApp.service("menus",["$http",function(a){function b(b){return f||(f=a.get(app.urlPrefix+"api/menus/get"+(b?"?JustEdit=true":""))),f}function c(b){return a.get(app.urlPrefix+"api/menus/getMenu/"+b)}function d(b){return a.post(app.urlPrefix+"api/menus/save/",b)}function e(c){return c?a.get(app.urlPrefix+"api/menus/get?ParentId="+c):b()}var f;return{get:b,save:d,getMenu:c,getParentMenu:e,getEditable:function(){return b(!0)}}}]),sApp.service("mainmenus",["$http",function(a){function b(b){var c=a.get(app.urlPrefix+"api/mainmenus/get/"+b);return c}function c(b){return a.post(app.urlPrefix+"api/mainmenus/save",b)}function d(b){return a.get(app.urlPrefix+"api/mainmenus/delete/"+b)}function e(b){return a.get(app.urlPrefix+"api/mainmenus/search/"+b)}function f(b,c){return a.post(app.urlPrefix+"api/mainmenus/savePermissions/"+b,c)}return{get:b,save:c,remove:d,search:e,savePermissions:f}}]),sApp.service("menuCategories",["$http",function(a){function b(){return f||(f=a.get(app.urlPrefix+"api/menuCategories/get")),f}function c(b){return a.post(app.urlPrefix+"api/mainmenus/save",b)}function d(b){return a.get(app.urlPrefix+"api/mainmenus/delete/"+b)}function e(b){return a.get(app.urlPrefix+"api/mainmenus/search/"+b)}var f;return{get:b,save:c,remove:d,search:e}}]),sApp.service("mostRecentMenus",["$http",function(a){function b(){var b=a.get(app.urlPrefix+"api/mostRecentMenus/get");return b}function c(b){return a.get(app.urlPrefix+"api/mainmenus/delete/"+b)}return{get:b,remove:c}}]);var ngApp=angular.module("services");ngApp.service("roles",["$http",function(a){function b(){return console.log("role service"),e||(e=a.get(app.urlPrefix+"api/roles/get")),e}function c(){e=null}function d(a){function b(a,c){if(a.id==c.id)return a;if(_.isArray(a.nodes))for(var d=0;d<a.nodes.length;d++){var e=b(a.nodes[d],c);if(null!=e)return e}return null}var c={name:"root",nodes:[],contents:[]};_.each(a,function(b){var c=_.find(a,{id:b.parent});c||(b.parent=0)});var d=[].concat(a);_.each(d,function(a){a.nodes=[]});for(var e=0,f=d.length*d.length,g=performance.now();d.length&&(e++,!(e>f));){var h=d.pop();if(h.parent){var i=b(c,{id:h.parent});i?(i.nodes=i.nodes||[],i.nodes.push(h)):d.unshift(h)}else c.nodes.push(h)}return console.log("time",performance.now()-g),c.open=!0,c}var e;return{get:b,reset:c,createTree:d}}]),ngApp.directive("selectRoles",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settings:"=?"},controller:["$scope","$http","roles",function(a,b,c){a.model=a.model||[],a.settings=a.settings||{},c.get().then(function(b){a.roles=_.extend([],b.data.list)})}],template:'<div>                     <sm-dropdown class="selection search multiple fluid"  settings="{fullTextSearch: true}" model="model" items="roles" label="item.name" value="item.id" ></sm-dropdown>                   </div>',link:function(a,b,c){}}});
// داشبورد مدیریتی صدف info@sadafdashboard.ir 

var cal=angular.module("calendar",[]),ngApp=angular.module("sadafForms",["iframeCommunicate","ng-sortable","services","calendar","semantic-ui","ngRoute","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","ngFileUpload"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/forms/list",{templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-list.html?v="+app.version,controller:"fromsCtrl",controllerAs:"c"}).when("/forms/:id?",{templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-editor.html?v="+app.version,controller:"fromGeneratorCtrl",controllerAs:"c"})}]);var iframeCommunicate=angular.module("iframeCommunicate",[]);iframeCommunicate.service("iframeService",["$location","$http",function(a,b){return{setPath:function(a){window.location.href=app.urlPrefix+a,console.log("### [iframeService] window.location.href ",app.urlPrefix+a)},handleMessage:function(a){console.log("handleMessage",a),$this=this,"route"===a.type&&this.setPath(a.param),"action-call"===a.type&&b.get(a.param),"set-variable"===a.type&&(_.isArray(a.param.userVariables)&&localStorage.setItem("userVariable",JSON.stringify(a.param.userVariables)),$this.setPath(a.param.url))}}}]);var ngApp=angular.module("sadafForms");ngApp.directive("sadafForm",function(){return{scope:{id:"@",rowId:"@?",onCancel:"&?",onFinish:"&?",onSave:"&?",option:"=?",settings:"=?"},controller:["$scope","$http","$sce","$routeParams","$timeout","$q","formsService","formsSubmitService","$attrs","taskExecutor",function($scope,$http,$sce,$routeParams,$timeout,$q,formsService,formsSubmitService,$attrs,taskExecutor){function executeTask(a){}function changeDigitType(a){_.each(a,function(a){rec(a.controls,function(a){2==a.type&&null!=a.value&&(a.value=+a.value)})})}function rec(a,b){_.each(a,function(a){b(a),13==a.type&&_.each(a.multiRowForm.rows,function(a){rec(a,b)})})}function getFormData(){$scope.clearForm(),$scope.rowId&&0!=+$scope.id&&($scope.formLoading=!0,formsSubmitService.get($scope.id,$scope.rowId).then(function(a){changeDigitType(a.model.pages),$scope.editPermission=a.editPermission,$scope.addPermission=a.addPermission,$scope.deletePermission=a.deletePermission,$timeout(function(){$scope.data&&$scope.data.pages&&($scope.data.pages=[])},0),$timeout(function(){$scope.data=a.model,$scope.data.id=a.id,$scope.data.rowId=$scope.rowId,$scope.modelId=a.id,$scope.allControl=[],runOnAllControll($scope.data,function(a){$scope.allControl.push(a)})},250),$timeout(function(){$scope.formLoading=!1,$timeout(function(){$("#"+$scope.selector).modal("refresh")},50)},500)},function(){$scope.formLoading=!1}))}function getFormEmptyData(){console.log("### [getFormEmptyData]"),$scope.clearForm(),$scope.formLoading=!0,formsService.get($scope.id).then(function(a){$scope.formLoading=!1,$scope.data=a.model,$scope.editPermission=a.editPermission,$scope.deletePermission=a.deletePermission,$scope.addPermission=a.addPermission,changeDigitType(a.model.pages),$scope.allControl=[],runOnAllControll($scope.data,function(a){$scope.allControl.push(a),a&&2==a.type&&a.validations&&a.validations.autoIncrement&&(autoIncMap[a.name]=autoIncMap[a.name]||+a.value)})},function(){$scope.formLoading=!1})}function clearIfFilterHasControl(a,b){if(b.useFilter&&b.filters&&b.filters.length){var c=_.some(b.filters,{control:a,type:2});c&&(b.value=null)}}function findControl(a,b){var c=null;return runOnAllControll(b,function(b){if(b.name===a)return c=b,!1}),c}function runOnAllControll(a,b,c){if(a){var d=[];_.each(a.pages,function(a){c&&c(a),a&&_.isArray(a.controls)&&(d=d.concat(a.controls))}),_.each(d,function(a){13==a.type&&_.each(a.multiRowForm.rows,function(a){_.each(a,function(c){var d=b(c,a);if(d===!1)return!1})});var c=b(a,d);if(c===!1)return!1})}}function GetMultiRowControlBaseOnChildName(a){var b;return runOnAllControll($scope.data,function(c){if(13==c.type){var d=_.findIndex(c.multiRowForm.rows[0],{name:a});d!=-1&&(b={control:c,index:d})}}),b}function calcFlatFormula(f,rowControls){var params=[],r=f.replace(/\[(field-\d+)\]/gi,function(a,b,c){var d=_.find(rowControls,{name:b});if(8==d.type){var e="00:00";d.value&&(e=d.value.substring(0,5)),params.push({type:"millisecond",value:moment.duration(e).asMilliseconds()})}if(9==d.type){var e="1300/0/01";d.value&&(e=d.value),params.push({type:"millisecond",value:1e3*moment(e,"jYYYY/jMM/jDD").utc().unix()})}if(14==d.type){var e="1300/0/01 00:00:00";d.value&&(e=d.value),params.push({type:"millisecond",value:1e3*moment(e,"jYYYY/jMM/jDD HH:mm:ss").utc().unix()})}return(2==d.type||5==d.type&&"digit"==d.calcType||16==d.type&&"digit"==d.calcType)&&params.push({type:"digit",value:+d.value||0}),(5==d.type&&"millisecond"==d.calcType||16==d.type&&"millisecond"==d.calcType)&&params.push({type:"millisecond",value:d.calculate.calculatedValue}),"{"+(params.length-1)+"}"}),newR=r.replace(/\{(\d+)\}/gi,function(a,b,c){return" "+params[+b].value+" "}),haveDate=_.filter(params,function(a){return"millisecond"==a.type||"millisecond"==a.type||"millisecond"==a.type}).length>0,haveDigit=_.some(params,{type:"digit"});if(haveDate){var v=moment.duration(+eval(newR)).format("d روز و h ساعت و m دقیقه");return{value:v,calculatedValue:+eval(newR),type:"millisecond"}}var v=+eval(newR);return{value:v,calculatedValue:+eval(newR),type:"digit"}}function updateCalculated(newVal,oldVal){console.log("updateCalculated");var filteredBaseOnField=[];runOnAllControll($scope.data,function(a){a.useFilter&&_.each(a.filters,function(b){2==b.type&&b.control&&filteredBaseOnField.push({name:a.name,source:a,filter:b.control})})}),runOnAllControll($scope.data,function(control,rowControls){if(5==control.type){var o=calcFlatFormula(control.calculate.expression,rowControls);control.value=o.value,control.formula=o.formula,control.calcType=o.type,control.calculate.calculatedValue=o.calculatedValue}if(16==control.type){var regex=/\s*(sum|avg|var)\s*\(([^\)]+)\)\s*/gi,hasDurationFormat=!1,r=control.calculate.expression.replace(regex,function(a,b,c){var d=[],e=c.replace(/.*\[(field-\d+)\].*/gi,"$1"),f=GetMultiRowControlBaseOnChildName(e);if(!f)return"از فیلدهای مربوط به فرم چند ردیفه باید استفاده شود";_.each(f.control.multiRowForm.rows,function(a){var b=calcFlatFormula(c,a);"digit"!=b.type?(hasDurationFormat=!0,d.push(b.calculatedValue||0)):d.push(b.value||0)});var g=0;return"sum"===b&&(g=d3.sum(d)),"avg"===b&&(g=d3.mean(d)),"var"===b&&(g=d3.variance(d))," "+g+" "});if(hasDurationFormat){var v=moment.duration(+eval(r)).format("d روز و h ساعت و m دقیقه");control.value=v,control.calculate.calculatedValue=+eval(r),control.calcType="millisecond"}else try{control.value=+eval(r).toFixed(5),control.calculate.calculatedValue=+eval(r)}catch(e){control.value=r}}if(17==control.type){var forwatch=_.find(rowControls,{name:control.tableLookup.controlName});if(!forwatch)return void(model.value=null);var v=[];if(forwatch.dropdown&&forwatch.dropdown.listValue&&forwatch.dropdown.listValue.length?v.concat(forwatch.dropdown.listValue):forwatch.value&&v.push(forwatch.value),control.tableLookup.lastV&&v.length==control.tableLookup.lastV.length&&0==_.difference(v,control.tableLookup.lastV).length)return;control.tableLookup.lastV=v,control.inProgress=!0,formsService.tableLookup(control.tableLookup,v).then(function(a){control.inProgress=!1,console.log("### data",a),a&&a.length&&(control.value=a[0].value)})}if(control.useFilter&&control.filters&&control.filters.length){var controlValue=null;_.map(control.filters,function(a){if(2==a.type){var b=findControl(a.control,$scope.data);a.controlValue=b.value}})}})}var c=this;$scope.selector="selector-"+Math.floor(999999*Math.random()+1e6),$scope.option=$scope.option||{},$scope.onCancel=$scope.onCancel||function(){};var id=$scope.id;$scope.submittedStatus=0,$scope.formLoading=!0,$scope.activePage=0,$scope.setActivePage=function(a){$scope.activePage=a,$scope.settings.modal&&$timeout(function(){$("#"+$scope.selector).modal("refresh")},0)},$scope.isValid=function(){var a=!1;if($scope.data&&$scope.data.pages)a:for(var b=0;b<$scope.data.pages.length;b++)for(var c=0;c<$scope.data.pages[b].controls.length;c++){var d=$scope.data.pages[b].controls[c];if(12==d.type&&!d.isValid){a=!0;break a}}return a},$scope.submit=function(){$scope.loading!==!0&&($scope.loading=!0,$scope.clearAllErrors(),formsSubmitService.submit($scope.id,$scope.data).then(function(a){if($scope.loading=!1,$scope.submittedStatus=0,!a.result&&a.messages&&($scope.pagesContainError=$scope.pagesContainError||[],_.each($scope.data.pages,function(b){_.each(a.messages,function(a){var c=_.find(b.controls,{name:a.name});c&&(c.error=a.error,_.findIndex($scope.pagesContainError,b)==-1&&$scope.pagesContainError.push(b))})})),!a.result&&a.pageMessages&&_.each(a.pageMessages,function(a){var b=_.find($scope.data.pages,{name:a.name});b&&(b.error=a.error)}),a.result){0==+$scope.rowId,$scope.data;_.each(autoIncMap,function(a,b){autoIncMap[b]=a+1}),$timeout(function(){$("#"+$scope.selector+" .close-btn").focus()},0),$scope.data.showSubmitedInfo?($scope.submittedStatus=1,runOnAllControll($scope.data,function(a){a.readonly=!0})):$scope.submitNewInfo(),$scope.onSave&&$scope.onSave({data:a})}},function(a){a.data.title&&a.data.desc?$scope.error={title:a.data.title,desc:a.data.desc}:$scope.error=null,$scope.loading=!1,$scope.submittedStatus=2}))},$scope.submitNewInfo=function(){$scope.submittedStatus=0,runOnAllControll($scope.data,function(a){a.readonly=!1}),$scope.onFinish&&$scope.onFinish(),$scope.clearForm(),formsService.clearCache($scope.id),getFormEmptyData()},$scope.clearAllErrors=function(){$scope.pagesContainError=[],runOnAllControll($scope.data,function(a){a.error=null},function(a){a.error=null})};var autoIncMap={};$scope.clearForm=function(){$scope.submittedStatus=0,$scope.activePage=0,runOnAllControll($scope.data,function(a){return a&&2==a.type&&a.validations&&a.validations.autoIncrement?void(a.value=autoIncMap[a.name]):(a.value=null,a.dropdown&&(a.dropdown.listValue=null),a.value=null,a.dropdown&&(a.dropdown.listValue=null),void(13==a.type&&a.multiRowForm.rows.splice(0,a.multiRowForm.rows.length-1)))})},$scope.cancel=function(){$scope.submitNewInfo(),$scope.onCancel()},$scope.remove=function(){var a=confirm("آیا برای حذف اطلاعات جاری فرم اطمینان دارید؟");a&&formsSubmitService.remove($scope.id,$scope.rowId).then(function(){executeTask(2),$scope.onCancel(),$scope.submitNewInfo()},function(a){a.data.title&&a.data.desc&&alert(a.data.desc)})},$scope.$watch(angular.bind(this,function(){return this.allControl}),function(a,b){console.log("### $scope.$watch allControl"),a&&b&&_.each(a,function(a){var c=_.find(b,{name:a.name});a.value!=c.value&&12==a.type&&_.each($scope.allControl,function(b){a.name!=b.name&&clearIfFilterHasControl(a.name,b)})})},!0);var lastRun=null;$scope.$watch("data",function(a,b){$timeout.cancel(lastRun),lastRun=$timeout(updateCalculated,350)},!0),!$scope.rowId&&$scope.id&&getFormEmptyData(),$scope.settings&&($scope.settings.notify=function(a,b){$scope.rowId=b,$scope.id=a,0!=+$scope.id&&($scope.allControl=null,$scope.rowId?getFormData():getFormEmptyData())}),$scope.colseBtn=function(a){(a.ctrlKey&&13==a.keyCode||27==a.keyCode)&&$scope.submitNewInfo()}}],restrict:"AE",templateUrl:app.urlPrefix+"dist/partial/forms/form-render.html?v="+app.version}}),ngApp.service("formsSubmitService",["$http",function(a){var b=function(b,c){return a.get(app.urlPrefix+"api/formsSubmit/getData/"+b+"?rowId="+c).then(function(a){var b=a.data;return b})},c={};c.CONTROL_TYPE_TEXT_SINGLE_LINE=0,c.CONTROL_TYPE_TEXT_MULTI_LINE=1,c.CONTROL_TYPE_NUMBER=2,c.CONTROL_TYPE_TEXT_LABEL=3,c.CONTROL_TYPE_DROP_DOWN=4,c.CONTROL_TYPE_CALCULATE=5,c.CONTROL_TYPE_CHECKBOX=6,c.CONTROL_TYPE_MULTI_CHOISE=7,c.CONTROL_TYPE_TIME=8,c.CONTROL_TYPE_DATE=9,c.CONTROL_TYPE_PHOTO=10,c.CONTROL_TYPE_LINK=11,c.CONTROL_TYPE_FORM_LOOKUP=12,c.CONTROL_TYPE_MULTI_ROW=13,c.CONTROL_TYPE_DATE_TIME=14,c.CONTROL_TYPE_BUTTON=15,c.CONTROL_TYPE_CALCULATE_SUM=16,c.CONTROL_TYPE_FILE_ATTACHMENT=19;var d=function(b,c){return a.post(app.urlPrefix+"api/formssubmit/submit/"+b,c).then(function(a){return app.moderation.dashboadpage.refreshRelatedDatasources(a.data.RefreshDatasource),a.data})},e=function(b,c){return a.post(app.urlPrefix+"api/formssubmit/delete/"+b,c).then(function(a){return app.moderation.dashboadpage.refreshRelatedDatasources(a.data.RefreshDatasource),a.data})};return{submit:d,remove:e,get:b}}]),ngApp.directive("selectForm",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{onSelect:"&",settings:"=?"},controller:["$scope","$http","formsService",function(a,b,c){a.model=a.model||[],a.settings=a.settings||{},c.get().then(function(b){a.forms=b}),a.opt={closable:!1,onApprove:function(){return a.model&&a.model.length?(a.onSelect({forms:a.model,settings:a.settings}),!1):(alert("حداقل یک مورد باید انتخاب شود"),!1)}}}],template:'<div>                   <sm-modal visible="settings.visible" settings="opt">                        <div class="header">انتخاب فرم</div>                        <div class="content">                            <p>لطفا فرم‌های مورد نظر خود را انتخاب کنید</p>                            <div class="ui form">                                <div class="field">                                    <label>انتخاب فرم</label>                                    <sm-dropdown class="selection search multiple"  settings="{fullTextSearch: true}" model="model" items="forms" label="item.name" value="item" ></sm-dropdown>                                </div>                            </div>                        </div>                        <div class="actions">                            <div class="ui black deny button">لغو</div>                            <div class="ui positive button" ng-class="{loading: settings.loaging}" >اضافه کردن</div>                        </div>                    </sm-modal>                    </div>',link:function(a,b,c){}}}),function(){function findControl(a,b){var c=null;return runOnAllControll(b,function(b){if(b.name===a)return c=b,!1}),c}function runOnAllControll(a,b,c){var d=[];_.each(a,function(a){c&&c(a),a&&_.isArray(a.controls)&&(d=d.concat(a.controls))}),_.each(d,function(a){13==a.type&&a.multiRowForm&&_.each(a.multiRowForm.rows,function(a){_.each(a,function(c){b(c,a)})}),b(a,d)})}function showErrorToast(a,b){b.show({template:'<md-toast class="md-toast error"> <span class="md-toast-text" flex>'+a+"</span></md-toast>",hideDelay:3e3,position:"bottom left"})}function getFormLookupFields(a,b,c){if(a&&a.form)return a.formLookupSourceFields&&a.formLookupSourceFields.length?void(c&&c()):void b.get(a.form).then(function(b){a.formLookupSourceFields=[],_.each(b.model.pages,function(b){_.each(b.controls,function(b){a.formLookupSourceFields.push(b)})}),a.formLookupSourceFields.push({name:"_id",label:app.lang.translate("identity")}),c&&c()})}var ngApp=angular.module("sadafForms");ngApp.controller("fromGeneratorCtrl",["$scope","$http","$sce","$timeout","$mdToast","$routeParams","formsService","controlPropertyService","$translate",function(a,b,c,d,e,f,g,h,i){function j(){n=[],runOnAllControll(k.pages.data,function(a){n.push(a.columnName)})}a.saveProgress=!1;var k=this;k.id=f.id||0;var l=k.id>0;k.app=app,k.items=[{order:1,columnClass:"four",key:"متن کوتاه",label:"نام",icon:"text cursor",type:0,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{order:2,columnClass:"four",key:"متن بلند",label:"متن بلند",icon:"text cursor",type:1,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{order:3,columnClass:"four",key:"عدد",label:"عدد",icon:"hashtag",type:2,showUniqueProp:!0,"default":!0,require:!0,format:",.0f",accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],validations:{autoIncrementSeed:1}},{order:4,columnClass:"four",key:"برچسب",label:"برچسب",icon:"font",type:3,showUniqueProp:!1,"default":!1,require:!1,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{order:5,columnClass:"four",key:"چند گزینه",icon:"caret down",label:"چند گزینه",type:4,showUniqueProp:!0,"default":!0,require:!0,dropdown:{useRemoteData:!1},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[]},{order:6,columnClass:"four",key:"چند گزینه ریموت",icon:"caret down",label:"چند گزینه ریموت",type:4,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,dropdown:{useRemoteData:!0},accessControlEditRoles:[],accessControlViewRoles:[]},{columnClass:"four",key:"تایید",icon:"checkmark box",type:6,label:"انتخاب مقدار",showUniqueProp:!1,"default":!0,require:!1,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:7},{columnClass:"four",key:"زمان",icon:"wait",label:"زمان",type:8,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:8},{columnClass:"four",key:"تاریخ",label:"تاریخ",icon:"calendar",type:9,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:9},{columnClass:"eight",key:" زمان - تاریخ",label:" زمان - تاریخ",icon:"calendar",type:14,showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:9},{columnClass:"four",key:"ارجاع به فرم",label:"ارجاع به فرم",icon:"pointing right",type:12,formLookup:{form:-1,keyControls:[],showAddButton:!0},showUniqueProp:!0,"default":!0,require:!0,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:10},{columnClass:"twelve",key:"گروه تکرار شونده",label:"لیست",dontShowAccessControl:!0,icon:"table",type:13,showUniqueProp:!1,"default":!1,require:!1,accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],multiRowForm:{addKeyText:"ردیف جدید",rows:[[]],controlSize:"mini"},order:11},{columnClass:"four",key:"کلید",label:"کلید",icon:"square",type:15,showUniqueProp:!1,"default":!1,require:!1,button:{type:1,openLinkType:0,colorClass:"black",size:"tiny",tasks:[{type:0,openLinkType:0}]},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:12},{columnClass:"four",key:"محاسباتی",icon:"calculator",label:"فیلد محاسباتی",type:5,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",calculate:{expression:""},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:13},{columnClass:"four",key:"محاسباتی - جمع",label:"محاسباتی - جمع",icon:"calculator",type:16,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",calculate:{expression:"",func:"sum"},accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:14},{columnClass:"four",key:"اطلاعات اضافه ارجاع به فرم",label:"اطلاعات اضافه ارجاع به فرم",dontShowAccessControl:!0,icon:"info",type:17,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],tableLookup:{},order:15},{columnClass:"twelve",dontShowColumnSize:!0,dontShowHide:!0,dontShowAccessControl:!0,key:"تیتر",label:"تیتر",icon:"header",type:18,showUniqueProp:!1,"default":!1,require:!1,format:"#,#",accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:16},{columnClass:"twelve",dontShowColumnSize:!0,dontShowHide:!0,dontShowAccessControl:!0,key:"پیوست کردن فایل",label:"لیست فایل‌ها",icon:"file outline",type:19,showUniqueProp:!1,"default":!1,require:!0,format:"#,#",accessControlEdit:!1,accessControlView:!1,accessControlEditRoles:[],accessControlViewRoles:[],order:17}],i(["short text","long text","number","label","combo","remote combo","checkbox","time","date","date time","refer to form","iterator","calculator","calculator sum","extra info","header","key","file list"]).then(function(a){function b(a,b,c,d){var e=_.find(k.items,null==b?{type:a}:b);e.key=c,e.label=d}b(0,null,a["short text"],a["short text"]),b(1,null,a["long text"],a["long text"]),b(2,null,a.number,a.number),b(3,null,a.label,a.label),b(4,function(a){return 4==a.type&&0==a.dropdown.useRemoteData},a.combo,a.combo),b(4,function(a){return 4==a.type&&1==a.dropdown.useRemoteData},a["remote combo"],a["remote combo"]),b(6,null,a.checkbox,a.checkbox),b(8,null,a.time,a.time),b(9,null,a.date,a.date),b(14,null,a["date time"],a["date time"]),b(12,null,a["refer to form"],a["refer to form"]),b(13,null,a.iterator,a.iterator),b(15,null,a.key,a.key),b(5,null,a.calculator,a.calculator),b(16,null,a["calculator sum"],a["calculator sum"]),b(17,null,a["extra info"],a["extra info"]),b(18,null,a.header,a.header),b(19,null,a["file list"],a["file list"])}),k.publishFrom=function(a){k.publishProgress=!0,g.publish(k.id,k.name,a).then(function(a){k.publishProgress=!1,k.url=a.url,k.publish=a.publish})},k.controlProperty=function(a){return a?_.find(k.items,{type:a.type}):{showUniqueProp:!1,"default":!1,require:!1}},k.sortableOptions={"ui-floating":!0},k.compConf={sort:!1,group:{name:"form",pull:"clone",put:!1},animation:150,onEnd:function(a){a.model.name=k.pages.naming.getName(),a.model.columnName=a.model.name,a.model.canView=!0,a.model.canEdit=!0}},k.checkColumnName=function(a,b){var c=!1;return runOnAllControll(k.pages.data,function(b){if(b.name!==a.name&&b.columnName===a.columnName)return c=!0,!0}),c?(i("duplicate name").then(function(a){alert(a)}),void(a.columnName=b)):void(n.indexOf(a.columnName)!=-1&&(a.columnName=b,i("duplicate name").then(function(a){alert(a)})))},k.drags=k.items.map(function(a){return[a]});var m=!1;k.draggableOptions={connectWith:".drop-target",placeholder:"form-control-highlight",helper:"clone",stop:function(a,b){if(b.item.sortable.source.hasClass("draggable-element")&&b.item.sortable.droptarget&&b.item.sortable.droptarget!=b.item.sortable.source&&b.item.sortable.droptarget.hasClass("drop-target")){var c=b.item.sortable.droptargetModel[b.item.sortable.dropindex];c=_.merge({},c),c.name=k.pages.naming.getName(),c.columnClass=c.columnClass||"twelve",c.formLookup=_.extend({},b.item.sortable.model.formLookup),c.dropdown=_.extend({},b.item.sortable.model.dropdown),c.canView=!0,c.canEdit=!0;var d=JSON.parse(JSON.stringify(b.item.sortable.model));b.item.sortable.sourceModel.push(d)}}},k.control=h.get(),k.formLookupSourceFields=[],a.$watch("c.control.active.formLookup",function(a){a&&a.form&&getFormLookupFields(a,g)}),k.pages={data:[],add:function(a){var b={name:app.lang.translate("page")+" "+(k.pages.data.length+1),type:0,controls:[],rowValidation:{uniqueMultiField:!1,uniques:[]},size:"tiny"};k.pages.data.push(b),k.pages.setActive(b)},removeControl:function(a,b){var c=app.lang.translate("delete control message"),d=confirm(c);d&&(m=!0,k.pages.activePage.controls.splice(a,1))},copy:function(a,b){m=!0;var c=_.extend({},b);k.pages.activePage.controls.splice(a,0,c)},remove:function(a){if(k.pages){var b=!0;if(k.pages.data[a].controls.length&&(b=confirm("delete page message")),b){k.pages.data[a].controls.length&&(m=!0);var c=k.pages.data.splice(a,1);c[0]===k.pages.activePage&&k.pages.setActive()}}},setActive:function(a){_.each(k.pages.data,function(a){a.active=!1}),!a&&k.pages.data.length&&(a=k.pages.data[0]),k.pages.activePage=a,k.pages.activePage.active=!0,k.control.active&&(k.control.active.isActive=!1,k.control.active=null)},getControlForRowValidation:function(){var a=k.pages.activePage.controls;return a},naming:{getName:function(){return"field-"+k.pages.naming.getMaxId()},exist:function(a){if("_id"==a)return!0;var b=!1;return _.each(k.pages.data,function(c){_.each(c.controls,function(c){var d=c.name||"";if(d==a)return b=!0,!1})}),b},getMaxId:function(){return k.maxFieldNumber=+k.maxFieldNumber||0,k.maxFieldNumber++,k.maxFieldNumber}}},k.controlList=[],a.$watch("c.pages",function(){k.controlList=[],runOnAllControll(k.pages.data,function(a){13!=a.type&&k.controlList.push(a)})},!0),k.saveProgress=!1,k.save=function(){var a=!1;a=!m||confirm("edit form message‌"),a&&(m=!1,k.saveProgress=!0,g.save(k.id,{pages:k.pages.data,name:k.name,maxFieldNumber:k.maxFieldNumber,triggers:k.triggers,showSubmitedInfo:k.showSubmitedInfo}).then(function(a){k.saveProgress=!1,k.id=a,location.replace(app.hashUrlPrefix+"#/forms/"+a),j();var b=e.simple().textContent(app.lang.translate("saving successfully"));e.show(b)},function(a){k.saveProgress=!1;var b=app.lang.translate("error in saving");a.data.desc&&(b=a.data.desc),showErrorToast(b,e)}))},l||(k.name=app.lang.translate("new form"),k.showSubmitedInfo=!0,k.pages.add());var n=[];l&&g.get(k.id,!0).then(function(a){k.pages.data=a.model.pages,k.name=a.model.name,k.showSubmitedInfo=a.model.showSubmitedInfo,k.triggers=a.model.triggers,k.url=a.url,k.publish=a.publish,k.maxFieldNumber=a.model.maxFieldNumber,k.pages.setActive(),j(),runOnAllControll(k.pages.data,function(a){a.dropdown&&a.dropdown.items&&(a.dropdown.itemsTemp=a.dropdown.items.map(function(a){return a.label}).join("\n"))})}),k.getSiblingControl=function(a){var b={};return runOnAllControll(k.pages.data,function(c,d){a===c.name&&(b.row=d,b.index=_.findIndex(d,{name:a}))}),b},a.$watch("c.control.active",function(a){a&&a.name&&(k.activeSibling=k.getSiblingControl(a.name),k.activeSibling.rootControls=[],_.each(k.pages.data,function(a){_.each(a.controls,function(a){k.activeSibling.rootControls.push(a)})}))})}]),ngApp.directive("formControl",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settingsClick:"&?",remove:"&?",id:"@",edit:"@",settings:"=?",copy:"&?",sdSubmit:"&"},controller:["$scope","$translate","$timeout","$http","taskExecutor",function(a,b,c,d,e){a._=_,a.randomId=Math.floor(1e5*Math.random())+1,a.model.randomId=a.randomId,a.$watch("model.value",function(b){null==b&&$(".form-"+a.randomId+" .dropdown").dropdown("clear")}),a.simpleDropdownsettings={message:{noResults:app.lang.translate("No results found.")},fullTextSearch:!0,forceSelection:!1},a.$watch("model.dropdown.listValue",function(b){null==b&&$(".form-"+a.randomId+" .dropdown").dropdown("clear")}),a.model.dropdown&&a.model.dropdown.multiSelectDropdown&&a.model.dropdown.useRemoteData&&(a.model.items=a.model.dropdown.listValue),a.initDropdown=function(b){a.model.dropdown&&a.model.dropdown.multiSelectDropdown&&a.model.dropdown.useRemoteData&&c(function(){$(b).dropdown("set selected",a.model.dropdown.listValue)},100)},a.buttonClick=function(){a.edit||_.each(a.model.button.tasks,function(b){e.exec(b,a.$parent.$parent.$parent.data)})},a.getFilteredDropdonItems=function(b,c,d){if(!a.model.useFilter||!a.model.filters)return!1;var e=!1;return _.each(a.model.filters,function(a){return!!(a&&a.staticValue&&b&&b.value)&&(1==a.type?(e=a.staticValue.trim().indexOf(b.value.trim())!=-1||b.value.trim().indexOf(a.staticValue.trim())!=-1,!1):void 0)}),e},12===a.model.type&&(a.model.formDialogInfo={formInfo:{form:a.model.formLookup.form},showModal:!1},a.showFormInModal=function(){a.model.formDialogInfo.showModalFunc()}),a.keyup=function(b){b&&b.ctrlKey&&13==b.keyCode&&a.sdSubmit()}}],templateUrl:app.urlPrefix+"dist/partial/forms/editor/form-generator-control.directive.html?v="+app.version}}]),ngApp.directive("multiRowForm",["$compile",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settings:"=?",id:"@",edit:"@"},controller:["$scope","$http","formsService","controlPropertyService","$timeout",function(a,b,c,d,e){a.model=a.model||{},a.firstRow=a.model.multiRowForm.rows[0],a.$watch("firstRow",function(){_.each(a.firstRow,function(a){a.childOfMultiRow=!0})},!0),a.sortableOptions={placeholder:"form-control-highlight",handle:".drag-handle"},a.control=d.get(),a.setProp=function(b){a.control.setActive(b)},a.remove=function(b,c){var d=confirm(app.lang.translate("delete control message"));d&&a.model.multiRowForm.rows[0].splice(c,1)};var f={};a.addRow=function(){if(!a.edit){var b=[];_.each(a.model.multiRowForm.rows[0],function(a){var c=JSON.parse(JSON.stringify(a));return c.rowId=0,c&&2==c.type&&c.validations&&c.validations.autoIncrement?(f[c.name]=(f[c.name]||+c.value)+1,void(c.value=f[c.name])):(c.value=null,c.dropdown&&(c.dropdown.listValue=null),void b.push(c))}),a.model.multiRowForm.rows.push(b)}},a.removeRow=function(b,c){var d=b.splice(c,1);a.model.multiRowForm.deletedIds=a.model.multiRowForm.deletedIds||[],a.model.multiRowForm.deletedIds.push(d[0][0].rowId)}}],template:'<div class="ui form field" ng-class="model.multiRowForm.controlSize">                            <div class="ui secondary pointing tiny menu">                                <div class="active item">{{model.label}} </div>                                <div class="ui right item" ng-hide="model.readonly">                                    <div class="pointer" ng-click="addRow()">{{model.multiRowForm.addKeyText}}<i class="icon plus square outline large"></i></div>                                </div>                            </div>                                <div ng-hide="model.multiRowForm.rows[0].length || !edit" class="gray center aligned twelve wide column"><small>{{\'drag control here\' | translate}}</small></div>                            <div class="ui grid content-form multi-row-container" >                            </div>                       </div>',link:function(b,c,d){function e(){b.model.multiRowForm.columns=b.model.multiRowForm.columns||3;var a=1==b.model.multiRowForm.columns?"one":2==b.model.multiRowForm.columns?"two":3==b.model.multiRowForm.columns?"three":4==b.model.multiRowForm.columns?"four":5==b.model.multiRowForm.columns?"five":6==b.model.multiRowForm.columns?"six":"eight";return a}function f(){var d;d=b.edit?angular.element('<div class="drop-target doubling '+e()+' column row {{model.multiRowForm.separator? \'separator\':\'\'}}" xui-sortable="sortableOptions"  xng-model="model.multiRowForm.rows[0]"                                                         ng-sortable="{group: {name: \'form\', pull:true, put:true}, animation:150}" style="min-height:100px;">                                                                                                        <div class="column"                                                              ng-repeat="component in model.multiRowForm.rows[0] track by $index"                                                             ng-click="setProp(component);$event.stopPropagation();">                                                                <form-control ng-class="{active: component.isActive}" class="column" remove="remove(component, $index)" edit="true" ng-model="component" id="{{id}}" settings="{fromMultiRow:true}"></form-control>                                                    </div>                                                </div>'):angular.element('<div ng-repeat="row in model.multiRowForm.rows" class="doubling '+e()+' column row no-padding {{model.multiRowForm.separator? \'separator\':\'\'}}">                                                    <div class="column no-padding"                                                          ng-repeat="component in row track by $index">                                                            <div class="ui grid" ng-if="!edit && model.multiRowForm.rows.length > 1 && $last" style="margin:0;">                                                                <form-control class="ten wide column field" remove="remove(component, $index)" ng-model="component" id="{{id}}"  settings="{showLabel:$parent.$parent.$index == 0, fromMultiRow:true}"></form-control>                                                                <div class="two wide column field" ng-hide="model.readonly" >                                                                    <label ng-show="$parent.$parent.$index == 0">&nbsp;</label>                                                                    <div class="ui icon mini xbutton pointer gray" ng-click="removeRow(model.multiRowForm.rows, $parent.$parent.$index)"><i class="icon remove"></i></div>                                                                </div>                                                            </div>                                                            <form-control ng-if="edit || model.multiRowForm.rows.length == 1 || !$last" class="column" remove="remove(component, $index)" ng-model="component" id="{{id}}" settings="{showLabel:$parent.$parent.$index == 0, fromMultiRow:true}"></form-control>                                                    </div>                                                </div>'),
a(d)(b),angular.element(c[0].querySelector(".content-form")).html(d)}b.$watch("model.multiRowForm.columns",function(a,b){f()})}}}]),ngApp.directive("newFormModal",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",show:"=?"},template:'<div>                            <div class="xcontent" ></div>                       </div>',link:function(b,c,d){function e(){b.id||(b.id=Math.floor(999999*Math.random())+1e6,$($(c).find(".modal")[0]).addClass("id"+b.id)),b.modal=$(".id"+b.id).modal(b.option),$(".ui.modal.active").length>0?($(".id"+b.id+".modal").css("position","fixed"),$(".id"+b.id).modal("show")):($(".id"+b.id+".modal").css("position","initial"),$(".id"+b.id).modal("show"))}function f(){var d=angular.element('<div xng-if="openFormTask" sadaf-form id="{{model.formInfo.form}}" on-finish="hideModal()" on-save="saveFinish(data)" option="{showCancel:true}" settings="formSettings" on-cancel="hideModal()"></div>                                                    </div>');a(d)(b),angular.element(c[0].querySelector(".xcontent")).html(d)}b.hideModal=function(a){b.model.showModal=!1,$(".id"+b.id).modal("hide")},b.saveFinish=function(a){debugger},b.option={showCancel:!0,allowMultiple:!0,autofocus:!1},b.formSettings={modal:!0},b.model.showModalFunc=e,f()}}}]),ngApp.directive("formLookupProperty",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",settings:"=?"},controller:["$scope","$http","formsService",function(a,b,c){a.model=a.model||{},a.settings=angular.merge({selectableColumns:!0},a.settings||{}),c.get().then(function(b){a.forms=b}),a.$watch("model.form",function(b){b==-1&&(a.model.form=a.forms[0].id),b&&c.get(b).then(function(b){if(a.formControls=[],_.each(b.model.pages,function(b){_.each(b.controls,function(b){a.formControls.push(b)})}),a.model.keyControls){var c=_.map(a.formControls,"columnName");a.model.keyControls=_.intersection(c,a.model.keyControls)}})})}],template:' <div class="field">                        <div class="field">                            <label>{{\'select form\' | translate}}</label>                            <sm-dropdown class="selection search fluid"  settings="{fullTextSearch: true, forceSelection: false}" model="model.form" items="forms" label="item.name" value="item.id" ></sm-dropdown>                        </div>                        <div class="field" ng-show=settings.selectableColumns>                            <label>{{\'key columns\' | translate}}</label>                            <sm-dropdown class="selection search multiple fluid" settings="{fullTextSearch: true, forceSelection: false}" model="model.keyControls" items="formControls" label="item.label" value="item.name" ></sm-dropdown>                        </div>                    </div>',link:function(a,b,c){}}}),ngApp.directive("formLookupGetId",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",id:"@"},controller:["$scope","$http","formsService","$timeout",function(a,b,c,d){function e(){a.model.formLookup.keyControls=a.model.formLookup.keyControls||[],a.keys=a.model.formLookup.keyControls.map(function(b){var c={name:b,dropdownSettings:j(b),change:function(a){c.value!==a&&(c.value=a,i())},defaultText:a.model.label};return c})}function f(){if(a.model.formLookup.keyControlsBindedValue&&a.keys)for(var b=0;b<a.model.formLookup.keyControlsBindedValue.length;b++){var c=a.model.formLookup.keyControlsBindedValue[b];null!=a.model.value&&(a.keys[b].defaultText=c,a.keys[b].boldText=!0)}}function g(){a.model.useFilter&&a.model.filters.length&&_.map(a.model.filters,function(a){})}function h(){$(".form-"+a.model.randomId+" .dropdown").dropdown("clear")}function i(){var c=a.keys.map(function(a){return{label:a.name,value:a.value}});a.model.formLookup.selected=_.map(c,function(a){return a.value});var d=_.some(c,function(a){return _.isUndefined(a.value)||null==a.value});if(!d){if(a.model.filters&&a.model.filters.length){c=c||[];var e=a.model.filters.map(function(a){return{label:a.sourceField,value:2==a.type?a.controlValue:a.staticValue}});c=c.concat(e)}a.model.isValid=!1,b.post(app.urlPrefix+"api/forms/getFormLookupIds/"+a.model.formLookup.form,c).then(function(b){a.model.isValid=!0,_.isArray(b.data)&&b.data.length&&(a.model.value=b.data[0])})}}a.model.formLookup=a.model.formLookup||{};var j=function(b){return{apiSettings:{url:app.urlPrefix+"api/forms/getFormColumnData",cache:!1,method:"get",dataType:"json",beforeSend:function(c){return c.data={id:a.model.formLookup.form,name:b,query:c.urlData.query,others:a.keys.map(function(a){return{label:a.name,value:a.value}}),filters:a.model.useFilter?a.model.filters:[]},c},onResponse:function(a){return a.fields=a.fields.map(function(a){return{value:a.value,label:a.label}}),a}},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"label",value:"value"},saveRemoteData:!1,fullTextSearch:!0,forceSelection:!1}};a.$watch("model.formLookup.keyControlsBindedValue",function(a){f()},!0),a.$watch("model.filters",function(a){g()},!0),a.$watch("model.formLookup.keyControls",function(a){e(),f()},!0);var k=!1,l=!1;a.$watch("model.value",function(b){a.model;null==b&&(l=!0,h())}),a.init=function(a){k=!0,l&&h()},a.model.isValid=!0}],template:' <div class="">                        <div class="xfield" ng-repeat="f in keys">                            <sm-dropdown settings="f.dropdownSettings" on-init="init"ng-class="{\'bold-text\':f.boldText}" class="selection search {{f.name}} fluid" label="item.label" on-change="f.change" value="item.value" default-text="f.defaultText" ></sm-dropdown>                        </div>                    </div>'}}),ngApp.directive("selectMenu",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",multiple:"@?"},controller:["$scope","$http","$timeout",function(a,b,c){b.get(app.urlPrefix+"api/menus/get").then(function(b){a.menus=b.data})}],template:'<div><sm-dropdown style="width:100%;"items="menus" model="model" class="selection search {{multiple}}" settings="{forceSelection: false}" label="item.name" value="item.id" ></sm-dropdown></div>'}}),ngApp.directive("selectDatasourceColumns",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel"},controller:["$scope","$http","datasources",function(a,b,c){function d(){c.getColumns(a.model.remoteDatasource.value).then(function(b){a.model.datasourceColumns=b.CubeInfo.Dimensions[0].Hierarchies,a.model.userProperties=b.UsersProperty})}a.select=function(){c.select(null,{type:["datasources"]}).then(function(b){b.selected&&b.selected.length&&(a.model.remoteDatasource={value:b.selected[0].id,label:b.selected[0].name},d(),a.model.remoteColumnKey=null,a.model.remoteColumnLabel=null)})},a.model=a.model||{},a.$watch("model",function(b){console.log(a.model.remoteColumnKey),b&&d()})}],template:' <div class="ui form">                        <div class="field">                            <label>{{\'انتخاب منبع داده\'| translate}}</label>                            <button class="ui tiny button" ng-click="select()">                                <span ng-show="!model.remoteDatasource">{{\'select\'| translate}}</span>                                <span ng-show="model.remoteDatasource">{{model.remoteDatasource.label}}</span>                            </button>                        </div>                        <div class="field" ng-show="model.datasourceColumns">                            <label>{{\'value column\'| translate}}</label>                            <sm-dropdown class="selection search fluid" settings="{fullTextSearch: true}" model="model.remoteColumnKey" items="model.datasourceColumns" label="item.Name" value="item.Name" ></sm-dropdown>                        </div>                        <div class="field" ng-show="model.datasourceColumns">                            <label>{{\'label column\'| translate}}</label>                            <sm-dropdown class="selection search fluid" settings="{fullTextSearch: true}" model="model.remoteColumnLabel" items="model.datasourceColumns" label="item.Name" value="item.Name" ></sm-dropdown>                        </div>                    </div>',link:function(a,b,c){}}}),ngApp.controller("fromsCtrl",["$scope","$http","$sce","$timeout","$mdToast","$routeParams","formsService","$mdDialog","utils","$translate",function(a,b,c,d,e,f,g,h,i,j){var k=this;k.progress=!0,k.app=app,k.utils=i,g.get().then(function(a){k.progress=!1,k.data=a,k.formsModule=g.getFormsModule(),k.securityCertPatch=g.securityCertPatch()}),k["delete"]=function(a,b,c){j(["remove","remove_form_desc","cancel"]).then(function(d){var f=h.confirm().title(d.remove).textContent(d.remove_form_desc+" "+b.name).ariaLabel(d.remove).targetEvent(a).ok(d.remove).cancel(d.cancel);h.show(f).then(function(){g.remove(b.id).then(function(a){var b=k.data.splice(c,1),d=e.simple().textContent("فرم "+b[0].name+" با موفقیت حذف شد");e.show(d)})})})}}]),ngApp.directive("sadafDropdwon",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",formId:"@",edit:"@?"},controller:["$scope","$http","formsService","controlPropertyService",function(a,b,c,d){}],template:"<div></div>",link:function(a,c,d){function e(){clearTimeout(j),j=setTimeout(function(){var c=$(".form-"+a.model.randomId+" .ui.dropdown").dropdown("get value"),d=_.map($(".form-"+a.model.randomId+" .ui.dropdown").dropdown("get item"),function(a){return $(a).text()});_.isArray(c)||(c=[c]),c=_.filter(c,null),b(function(){a.model.dropdown.listValue=c,a.model.dropdown.selected=d},0)},200)}for(var f=$(c).hasClass("multiple"),g=f?a.model.dropdown.listValue||[]:[a.model.value||""],h='<select class="temporal ui fluid '+(f?"multiple":"")+' search selection dropdown" '+(f?"multiple":"")+" >",i=0;i<g.length;i++)h+='  <option value="'+g[i]+'">'+g[i]+"</option>";h+="</select>",h=$(h);var j,k={onChange:function(c,d,e){f||b(function(){a.model.dropdown.selected=[d],a.model.value=c},0)},onRemove:function(a,b,c){e()},onAdd:function(a,b,c){e()},apiSettings:{url:app.urlPrefix+"api/forms/getdropdowndata",cache:!1,method:"get",dataType:"json",beforeSend:function(b){return b.data={id:a.formId,name:a.model.name,query:b.urlData.query},a.edit&&(b.data={datasourceId:a.model.dropdown.remoteDatasource.value,remoteColumnKey:a.model.dropdown.remoteColumnKey,remoteColumnLabel:a.model.dropdown.remoteColumnLabel,query:b.urlData.query}),b},onResponse:function(a){return a.fields=a.fields.map(function(a){return{value:a.value.entitize(),label:a.label.entitize()}}),a}},message:{noResults:app.lang.translate("No results found.")},fields:{remoteValues:"fields",name:"label",value:"value"},saveRemoteData:!1,fullTextSearch:!0,forceSelection:!1};if($(c).append(h),$(h).dropdown(k),a.model.dropdown.listValue){var l=a.model.dropdown.multiSelectDropdown?a.model.dropdown.listValue:a.model.value;null!=l&&$(h).dropdown("set selected",l)}}}}]),ngApp.directive("controlSize",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},template:"<sm-dropdown items=\"[{label:('خیلی کوچک' | translate), value:'mini'}, {label:('کوچک' | translate), value:'tiny'}, {label:('normal' | translate), value:''}]\" model=\"model\" label=\"item.label\" value=\"item.value\"></sm-dropdown> "}}]),ngApp.filter("formatNumber",function(){return function(a,b){var c=b;return isNaN(a)?a:c?d3.format(c)(a):a}}),ngApp.filter("persian",function(){return function(a){return app.lang&&0==+app.lang.langType?persian(a,!0):a}}),ngApp.directive("sadafCheckbox",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="ui checkbox"><input type="checkbox" ng-model="model" /><label ng-transclude></label></div>',link:function(a,c,d){a.model===!0||a.model&&a.model.match(/(true)/gi)?a.model=!0:a.model=!1,$(c).checkbox({onChange:function(d,e){b(function(){a.model=$(c).find("input").is(":checked"),a.change&&a.change()})}})}}}]),ngApp.directive("filterProperty",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel",controls:"=",sourceFields:"=?",name:"=?"},controller:["$scope",function(a){var b={type:2};a.add=function(){a.model.push(_.extend({},b))},a.$watch("model",function(c){c||(a.model=a.model||[b])}),a.$watch("controls",function(b){b&&(a.cnts=[],a.cnts=a.cnts.concat(b.row),a.cnts=a.cnts.concat(b.rootControls),a.cnts=_.filter(a.cnts,{type:12}),a.cnts=_.filter(a.cnts,function(b){return b.name!=a.name}),a.cnts=_.uniqBy(a.cnts,"name"))})}],template:'<div class="inner-section">                          <div class="field" ng-repeat="f in model track by $index">                            <div class="inline fields" >                                <label class="three wide field">{{\'type\' | translate}}</label>                                <div class="six wide field">                                    <sm-dropdown model="f.type" class="" settings="{fullTextSearch: true, forceSelection: false}" items="[{type: 1, name:(\'fix value\' | translate)},{type: 2, name:(\'control value\' | translate)}]" label="item.name" value="item.type"></sm-dropdown>                                </div>                                <div class="three wide field">                                    <i class="gray pointer icon plus" ng-click="add()"></i>                                    <i class="gray pointer icon delete" ng-click="model.splice($index, 1)" ng-hide="model.length==1"></i>                                </div>                            </div>                            <div class="inline fields" ng-show="f.type == 1">                                <label class="three wide field">(\'value\' | translate)</label>                                <input ng-model="f.staticValue" />                            </div>                                                        <small ng-show="f.type == 2">{{\'control base filter desc\' | translate}}</small>                            <div class="field" >                                <div class="inline fields" ng-show="f.type == 2">                                    <label class="three wide field">{{\'control\' | translate}}</label>                                    <sm-dropdown model="f.control" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="cnts" label="item.label" value="item.name"></sm-dropdown>                                </div>                            </div>                                                        <small ng-show="f.type == 2">{{\'control base filter desc 2\' | translate}}</small>                            <div class="inline fields" ng-show="sourceFields" ng-show="f.type == 2">                                <label class="three wide field">{{\'column\' | translate}}</label>                                <sm-dropdown model="f.sourceField" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="sourceFields" label="item.label" value="item.name"></sm-dropdown>                            </div>                        </div>                   </div>',link:function(a,b,c){}}}]),ngApp.directive("tableLookup",["$compile","$timeout","formsService",function(a,b,c){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel",controls:"="},controller:["$scope",function(a){a.$watch("model",function(b){b||(a.model=a.model||{})}),a.$watch("controls",function(b){b&&(a.cnts=[],a.cnts=a.cnts.concat(b.row),a.cnts=a.cnts.concat(b.rootControls),a.cnts=_.filter(a.cnts,function(a){return 12==a.type}),a.cnts=_.filter(a.cnts,function(b){return b.name!=a.name}),a.cnts=_.uniqBy(a.cnts,"name"))}),a.$watch("model.controlName",function(b,d){if(b){var e=_.find(a.cnts,{name:b});a.model.lookupField=e.formLookup.keyControls[0],a.model.id=e.formLookup.form,a.model.type="form",getFormLookupFields(e.formLookup,c,function(){a.fields=e.formLookup.formLookupSourceFields})}})}],template:'<div class="">                          <div class="field">                            <small>{{\'extra info desc\' | translate}}</small>                            <div class="inline fields">                                <label class="three wide field">{{\'control\' | translate}}</label>                                <sm-dropdown model="model.controlName" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="cnts" label="item.label" value="item.name"></sm-dropdown>                            </div>                            <div class="inline fields">                                <label class="three wide field">{{\'column\' | translate}}</label>                                <sm-dropdown model="model.resultField" class="selection fluid" settings="{fullTextSearch: true, forceSelection: false}" items="fields" label="item.label" value="item.name"></sm-dropdown>                            </div>                        </div>                   </div>',link:function(a,b,c){}}}]),ngApp.directive("sadafDraggable",["$timeout",function(a){return function(a,b,c){function d(){$("[sadaf-draggable]").draggable({connectToSortable:"[sadaf-sortable]",helper:"clone",revert:"invalid",start:function(a,b){$(b.helper).css("width",$(b.helper).width()+"px")},stop:function(a,b){$(b.helper).css("width","100%")}}),$("[sadaf-draggable]").disableSelection()}a.$last&&d()}}]),ngApp.directive("sadafSortable",["$timeout",function(a){return function(a,b,c){function d(){$("[sadaf-sortable]").sortable({revert:!0}),$("[sadaf-sortable]").disableSelection()}d()}}]),ngApp.directive("sadafCalendar",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",sdKeyup:"&"},template:'<div  style="display:inline-block;width:100%;"><input type="text" id=""  class="form-control from" placeholder="{{\'date\' | translate}}" /><input id="from-value" type="hidden"/></div>',link:function(a,b,c){var d=b.find(" .from");d.datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy/mm/dd",altFormat:"yy/mm/dd",altField:b.find("#from-value"),onClose:function(b){a.model=b,a.$apply()}}),d.keyup(function(b){console.log("input.keyup",b),a.sdKeyup({$event:b})}),a.$watch("model",function(c){b.find(".from").datepicker("setDate",a.model)}),b.find(".from").datepicker("setDate",a.model)}}}),ngApp.directive("sadafCalendarRange",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"=ngModel",sdKeyup:"&"},template:'<div class="" style="display:flex; flex-direction:row;">                        <div class="" style="flex-grow:1;">                            <input id="" type="text" class="datepicker from" placeholder="تاریخ شروع" />                            <input id="from-value" type="hidden"/>                        </div>                        <div class="" style="padding: 8px;">تا</div>                        <div class="" style="flex-grow:1;">                            <input id="" type="text" class="datepicker to" placeholder="تاریخ پایان"/>                            <input id="to-value" type="hidden"/>                        </div>                      </div>',link:function(a,b,c){b.find(" .from").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy/mm/dd",altFormat:"yy/mm/dd",altField:b.find("#from-value"),onClose:function(c){return a.model=a.model||{},c?(b.find(".to").datepicker("option","minDate",c),a.model.from=c,void a.$apply()):void(a.model.from=null)}}),b.find(".to").datepicker({defaultDate:"+1w",changeYear:!0,changeMonth:!0,dateFormat:"yy/mm/dd",altFormat:"yy/mm/dd",altField:b.find("#to-value"),onClose:function(c){return a.model=a.model||{},c?(b.find(".from").datepicker("option","maxDate",c),a.model.to=c,void a.$apply()):void(a.model.to=null)}}),a.$watch("model",function(c){a.model&&(b.find(".from").datepicker("setDate",a.model.from),b.find(".to").datepicker("setDate",a.model.to))})}}}),ngApp.directive("sadafTime",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="" >                        <input list="timeList" type="time" ng-model="timeValue" ng-change="change()"/>                        <datalist id="timeList">                            <option value="01:00">                            <option value="02:00">                            <option value="03:00">                            <option value="04:00">                            <option value="05:00">                            <option value="06:00">                            <option value="07:00">                            <option value="08:00">                            <option value="09:00">                            <option value="10:00">                            <option value="11:00">                            <option value="12:00">                            <option value="13:00">                            <option value="14:00">                            <option value="15:00">                            <option value="16:00">                            <option value="17:00">                            <option value="18:00">                            <option value="19:00">                            <option value="20:00">                            <option value="21:00">                            <option value="22:00">                            <option value="23:00">                            <option value="24:00">                        </datalist>                   </div>',link:function(a,c,d){a.silent=!1,a.timeValue,a.$watch("timeValue",function(c,d){c&&(a.silent=!0,a.model=a.timeValue.toTimeString().split(" ")[0].substring(0,5),b(function(){a.silent=!1}))}),a.$watch("model",function(b,c){if(!a.silent)return b?void(a.timeValue=new Date("1969-12-31 "+a.model)):void(a.timeValue=null)})}}}]),ngApp.directive("sadafTimeRange",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="" style="display:flex; flex-direction:row;">                        <div class="" style="flex-grow:1;">                        <input list="timeListFrom" type="time" ng-model="timeFrom" ng-change="change()"/>                        <datalist id="timeListFrom">                            <option value="01:00">                            <option value="02:00">                            <option value="03:00">                            <option value="04:00">                            <option value="05:00">                            <option value="06:00">                            <option value="07:00">                            <option value="08:00">                            <option value="09:00">                            <option value="10:00">                            <option value="11:00">                            <option value="12:00">                            <option value="13:00">                            <option value="14:00">                            <option value="15:00">                            <option value="16:00">                            <option value="17:00">                            <option value="18:00">                            <option value="19:00">                            <option value="20:00">                            <option value="21:00">                            <option value="22:00">                            <option value="23:00">                            <option value="24:00">                        </datalist>                        </div>                        <div class="" style="padding: 8px ;">تا</div>                        <div class="" style="flex-grow:1;">                        <input list="timeListTo" type="time" ng-model="timeTo" ng-change="change()" />                        <datalist id="timeListTo">                            <option value="01:00">                            <option value="02:00">                            <option value="03:00">                            <option value="04:00">                            <option value="05:00">                            <option value="06:00">                            <option value="07:00">                            <option value="08:00">                            <option value="09:00">                            <option value="10:00">                            <option value="11:00">                            <option value="12:00">                            <option value="13:00">                            <option value="14:00">                            <option value="15:00">                            <option value="16:00">                            <option value="17:00">                            <option value="18:00">                            <option value="19:00">                            <option value="20:00">                            <option value="21:00">                            <option value="22:00">                            <option value="23:00">                            <option value="24:00">                        </datalist>                        </div>                      </div>',link:function(a,c,d){a.silent=!1,a.timeFrom,a.timeTo,a.model=a.model||{},a.$watch("timeFrom",function(c,d){c&&(a.silent=!0,a.model=a.model||{},a.model.from=a.timeFrom.toTimeString().split(" ")[0].substring(0,5),"Inval"==a.model.from&&(a.model.from=null),b(function(){a.silent=!1}))}),a.$watch("timeTo",function(c,d){c&&(a.silent=!0,a.model=a.model||{},a.model.to=a.timeTo.toTimeString().split(" ")[0].substring(0,5),"Inval"==a.model.to&&(a.model.to=null),b(function(){a.silent=!1}))}),a.$watch("model",function(c,d){if(console.log("watch model",c),!a.silent)return c?void b(function(){a.timeFrom=new Date("1969-12-31 "+a.model.from),a.timeTo=new Date("1969-12-31 "+a.model.to)}):(a.timeFrom={},void(a.timeTo={}))}),a.model||(console.log("scope.model",a.model),a.timeFrom=new Date("1969-12-31 "+a.model.from),a.timeTo=new Date("1969-12-31 "+a.model.to))}}}]),ngApp.directive("sadafDateTime",["$compile","$timeout",function(a,b){return{restrict:"E",replace:!0,scope:{model:"=ngModel",change:"&?ngChange"},template:'<div class="ui two columns grid"><div class="row" style="margin: 1rem 0;">                           <sadaf-calendar class="wide column" ng-model="innerModel.date"></sadaf-calendar>                           <sadaf-time class="wide column" ng-model="innerModel.time"></sadaf-time>                       </div></div>',link:function(a,c,d){function e(){b(function(){a.silent=!1},0)}function f(a){return a<10?"0"+a:a}a.innerModel={},a.silent=!1,a.$watch("innerModel",function(b,c){if(b&&(b.time||b.date)&&!a.silent){var d=b.time||"00:00",f=b.date||"1397/01/01",g=f.split(/\//).map(function(a){return+a});jd_to_gregorian(persian_to_jd(g[0],g[1],g[2]));a.silent=!0,a.model=f+" "+d+":00",e()}},!0),a.$watch("model",function(b,c){if(b&&!a.silent){var d=b.split(/[\/: ]/).map(function(a){return+a});jd_to_persian(gregorian_to_jd(d[0],d[1],d[2]));a.silent=!0,a.innerModel.date=d[0]+"/"+f(d[1])+"/"+f(d[2]),a.innerModel.time=f(d[3])+":"+f(d[4]),e()}},!0)}}}]),ngApp.directive("sadafFile",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,replace:!0,scope:{model:"=ngModel"},controller:["$scope","Upload",function(a,b){function c(){_.each(a.model.attachment.uploadList,function(a){a.added||(a.added=!0,e(a))})}function d(a){var b={docx:"word",doc:"word",pptx:"powerpoint",ppt:"powerpoint",pdf:"pdf",xlsx:"excel",xls:"excel",mp4:"video",mp3:"audio",wma:"audio"},c=a.name.split(".").pop().toLowerCase();a.icon=b[c]}function e(a){d(a),b.upload({url:app.urlPrefix+"api/Upload/PostFile",data:{file:a}}).then(function(b){a.serverPath=b.data[0].path,a.fileName=b.data[0].name,a.success=!0},function(a){},function(b){var c=parseInt(100*b.loaded/b.total);a.progress=c,b.loaded==b.total&&(a.uploadFinish=!0)})}a.files,a.progress=null,a.model.attachment=a.model.attachment||{},a.model.attachment.uploadList=a.model.attachment.uploadList||[],_.each(a.model.attachment.uploadList,function(a){a.added=!0,a.name=a.fileName,a.uploadFinish=!0,a.success=!0,d(a)}),console.log("$scope.model.attachment.uploadList ",a.model.attachment.uploadList),a.upload=function(b,d,e){b&&b.length&&(_.each(b,function(b){a.model.attachment.uploadList.push(b)}),c())},a.getLink=function(a){return a.serverDbId?app.urlPrefix+"api/upload/get/"+a.serverDbId:app.urlPrefix+"api/upload/get?path="+a.serverPath+"&name="+encodeURI(a.name)},a.getSrc=function(a){return app.urlPrefix+"images/file_word.png"}}],template:'<div class="file-uplaod ">                            <div class="ui secondary pointing tiny menu">                                <div class="active item">{{model.label}} <span ng-show="model.validations.isRequire" style="color:#db2828">&nbsp;*&nbsp;</span></div>                                <div class="ui right item" ng-hide="model.readonly">                                    <div class="pointer" ngf-select ngf-change="upload($files, $event, $rejectedFiles)" ngf-multiple="true"  ngf-allow-dir="false" ngf-accept="\'*\'">{{\'add file\' | translate}}<i class="icon plus square outline large"></i></div>                                </div>                            </div>                                                              <div ng-hide="model.attachment.uploadList.length" class="gray center aligned twelve wide column"><small>{{\'no file selected\' | translate}}</small></div>                            <div class="">                                <div ng-repeat="file in model.attachment.uploadList" class="file-item" >                                    <div class="">                                        <div class="">                                            <span class="ui img"><i class="icon file outline large" ng-class="file.icon"></i></span>                                            <span ng-hide="file.serverDbId || file.serverPath">{{file.name}} </span>                                            <a ng-show="file.serverDbId || file.serverPath"class="file-link" target="_blank" href="{{getLink(file)}}">{{file.name}} </a>                                            <span ng-show="file.uploadFinish && file.success && !model.readonly" class="pointer" ng-click="model.attachment.uploadList.splice($index,1)"><i class="icon remove small grey"></i></span>                                            <span ng-show="file.uploadFinish && !file.success" class="ui tiny"><span class="ui text tiny active inline center loader" ></span></span>                                            <sm-progress class="blue tiny" model="file.progress" ng-show="file.progress != null && !file.uploadFinish" style="margin-top:4px;"></sm-progress>                                        </div>                                    <div>                                </div>                             </div>                        </div>'}}]),ngApp.service("controlPropertyService",function(){function a(){return b.control}var b={};return b.control={active:null,setActive:function(a){a&&(b.control.active&&(b.control.active.isActive=!1),b.control.active=a,b.control.active.isActive=!0)},remove:function(a,c){var d=confirm(app.lang.translate("delete control message"));d&&(dangerChangeOccured=!0,b.pages.activePage.controls.splice(a,1))},createItems:function(a){if(a.dropdown.itemsTemp){var b=a.dropdown.itemsTemp.split(/[\r\n]/);a.dropdown.items=[],_.each(b,function(b){var c=b.trim();a&&""!=c&&a.dropdown.items.push({label:c,value:c})})}},resetListValue:function(){b.control.active.dropdown&&(b.control.active.dropdown.listValue=[])}},{setActive:b.control.setActive,remove:b.control.remove,getActive:b.control.active,createItems:b.control.createItems,get:a}}),ngApp.service("updateModel",["$http",function(a){function b(a){}function c(a){}return{updateValuesForSave:c,updateValuesForGet:b}}]),ngApp.service("formsService",["$http","updateModel",function(a,b){var c=0,d=!1,e={},f=function(a){a&&(e[a]=null)},g=function(f,g){f||(f="");var h="";return g&&(h="?fromEditor=true"),e[f||"all"]||(e[f||"all"]=a.get(app.urlPrefix+"api/forms/get/"+f+h).then(function(a){
return f?(b.updateValuesForGet(a.data.model.pages),a.data):(c=a.data.formsModule,d=a.data.securityCertPatch,a.data.list)})),e[f||"all"]},h=function(b,c){return e={},a.post(app.urlPrefix+"api/forms/save/"+b,c).then(function(a){return a.data})},i=function(b){return e={},a.get(app.urlPrefix+"api/forms/delete/"+b).then(function(a){return a.data})},j=function(b,c){return e={},a.post(app.urlPrefix+"api/forms/addFormToDashboard/"+b,c).then(function(a){return a.data})},k=function(b,c){return a.post(app.urlPrefix+"api/forms/deleteFormFromDashboard/"+b,c).then(function(a){return a.data})},l=function(b,c){var d={values:c,tableLookup:b};return a.post(app.urlPrefix+"api/forms/getTableLookup",d).then(function(a){return a.data})},m=function(b,c,d){return a.get(app.urlPrefix+"api/forms/publish",{params:{name:c,id:b,publish:d}}).then(function(a){return a.data})};return{save:h,get:g,remove:i,addFormToDashboard:j,deleteFormFromDashboard:k,getFormsModule:function(){return c},securityCertPatch:function(){return d},clearCache:f,tableLookup:l,publish:m}}]),ngApp.filter("d3format",function(){return function(a,b){return"#,#"==b&&(b=",.0f"),"undefined"==typeof a||null==a?a:d3.format(b)(a)}}),ngApp.directive("sadafTasks",["$compile","$timeout",function(a,b){return{restrict:"E",transclude:!0,scope:{model:"=ngModel"},controller:["$scope",function(a){function b(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}a.add=function(){a.model=a.model||[],a.model.push({type:0,openLinkType:0,uuid:b()})},a.addWebParam=function(a){a.webserviceParameters=a.webserviceParameters||[],a.webserviceParameters.push({})}}],template:'<div class="" style="margin: 30px 0;"><div class="ui mini icon button" ng-click="add()">{{\'add task\' | translate}} <i class="ui icon add"></i></div><div class="ui secondary black segment" style="margin-left: -12px;margin-right: -12px;border-radius: 0;" ng-repeat="task in model" ng-init="model = model || []">        <button ng-click="model.splice($index, 1)" class="ui mini  basic icon button" style="box-shadow: none; position: absolute; top :0; left:0;" ><i class="ui icon close"></i></button>        <div class="inline fields">            <label class="four wide field">{{\'type\' | translate}}</label>            <div class="eight wide field"><sm-dropdown items="[{label:(\'goto dashboard\' | translate), value:0}                         , {label:(\'sms\' | translate), value:4}                         , {label:(\'web service\' | translate), value:2}                         , {label:(\'javascript\' | translate), value:3}]"                         style="width: 100%;"                         model="task.type" label="item.label" value="item.value"></sm-dropdown></div>        </div>        <div class="field" ng-show="task.type == 0">                 <label class="">{{\'dashboard\'|translate}}</label>                 <select-menu class="" ng-model="task.dashboardId"></select-menu>        </div>        <div class="inline fields" ng-show="task.type == 0">            <label class="four wide field">{{\'open type\'|translate}}</label>            <div class="eight wide field"><sm-dropdown items="[{label:(\'new page\' | translate), value:0}, {label:(\'current page\' | translate), value:1}]"                         style="width: 100%;"                         model="task.openLinkType" label="item.label" value="item.value"></sm-dropdown></div>        </div>        <div class="field" ng-show="task.type == 1">            <form-lookup-property ng-model="task.formInfo" settings="{selectableColumns:false}"></form-lookup-property>        </div>        <div class="field" ng-show="task.type == 2">            <label>{{\'آدرس\' | translate}}</label>            <input style="direction: ltr;" ng-model="task.webserviceUrl" placeholder="{{\'آدرس\' | translate}}">        </div>        <div class="field" ng-show="task.type == 4">            <label>{{\'sms body\' | translate}}</label>            <textarea ng-model="task.smsBody"></textarea>        </div>        <div class="field" ng-show="task.type == 4">            <label>{{\'roles\' | translate}}</label>            <select-roles ng-model="task.smsRoles"></select-roles>        </div>        <div class="inline fields" ng-show="task.type == 2">            <label class="four wide field">{{\'method\' | translate}}</label>            <div class="eight wide field"><sm-dropdown items="[                         {label:\'GET\' , value:0}                         , {label:\'POST\', value:1}]"                         style="width: 100%;"                         model="task.webserviceMethod" label="item.label" value="item.value"></sm-dropdown></div>        </div>        <div class="field" ng-show="task.type == 2">            <label>{{\'parameters\' | translate}}</label>            <div ng-repeat="p in task.webserviceParameters">                <div style="padding-left: 20px;position: relative;">                    <input ng-model="p.key" class="form-flat-input" type="text" placeholder="key">                    <input ng-model="p.value" class="form-flat-input" type="text" placeholder="value">                    <i style="position:absolute; left:0; top:0;" class="ui icon close pointer" ng-click="task.webserviceParameters.splice($index, 1)"></i>                </div>            </div>            <span class="link-button" ng-click="addWebParam(task)">{{\'new row\' | translate}} <i class="ui icon add"></i></span>        </div>        <div class="field" ng-show="task.type == 3">            <label>{{\'javascript\' | translate}}</label>            <textarea ng-model="task.script" style="direction:ltr; font-family:monospace;"placeholder="{{\'javascript\' | translate}}"></textarea>        </div>    </div></div>'}}]),ngApp.service("taskExecutor",["$http",function($http){function exec(task,formModel){function replaceValue(a){return a.replace(/@\((field-\d+)\)/gi,function(a,b){var c=findControl(b,formModel.pages);return null!=c?c.value:""})}if(0==task.type){if(!+task.dashboardId)return;var name=0==+task.openLinkType?"_blank":"_self";window.open(app.urlPrefix+"#/dashboard/"+task.dashboardId,name)}if(2==task.type){if(_.isEmpty(task.webserviceUrl))return;var url=replaceValue(task.webserviceUrl);$http.get(url).then(function(){alert(app.lang.translate("successfull run"))})["catch"](function(){alert(app.lang.translate("unsuccessfull run"))})}if(3==task.type){if(_.isEmpty(replaceValue(task.script)))return;eval(task.script)}}return{exec:exec}}])}();
// داشبورد مدیریتی صدف info@sadafdashboard.ir 

function fixLayout(a){if(!a)return void dashboard.resize();dashboard.showEmptyMessageIfNeed();var b=function(){if("undefined"!=typeof Storage){var a=localStorage.getItem("lastEditedChartId");if(localStorage.removeItem("lastEditedChartId"),!_.isUndefined(a)&&a){var b=$("."+a.replace("ID","cid")).offset();b&&$("html, body").animate({scrollTop:b.top-20,scrollLeft:b.left-20})}}};dashboard.drow(b)}var notification=angular.module("notificationCat",["semantic-ui"]);notification.controller("notificationController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){}]),notification.directive("notification",function(){return{scope:{},controller:["$scope","notificationService",function(a,b){function c(){a.unreadCount=_.filter(a.notifications,{Readed:!1}).length}a.persian=persian,a.momet=moment,a.d3=d3,b.getUnreader().then(function(b){a.notifications=b,c()}),a.init=function(b){a.el=b},a.toggleRead=function(a){a.Readed=!a.Readed,b.toggleRead(a.Id,a.Readed),c()},a.remove=function(d,e){var f=confirm("برای حذف این هشدار اطمینان دارید؟");f&&(a.notifications.splice(e,1),b.remove(d.Id),c())},a.readAll=function(){b.readAll(),_.each(a.notifications,function(a){a.Readed=!0}),c()},a.removeAll=function(){var d=confirm("برای حذف همه هشدارها اطمینان دارید؟");d&&(b.removeAll(),a.notifications=[],c(),a.el.popup("hide"))}}],templateUrl:app.urlPrefix+"dist/partial/dashboardPage/notification.html?v="+app.version}}),notification.service("notificationService",["$http",function(a){var b=function(){return a.get(app.urlPrefix+"api/notification/get").then(function(a){return _.each(a.data.notifications,function(a){0==a.Type&&(a.Content=JSON.parse(a.Content)),a.time=new Date(a.DateTime).getTime(),a.fromNow=moment(new Date(a.DateTime).getTime()).fromNow()}),a.data.notifications})},c=function(b,c){return a.get(app.urlPrefix+"api/notification/read?id="+b+"&read="+c)},d=function(b){return a.get(app.urlPrefix+"api/notification/delete?id="+b)},e=function(b){return a.get(app.urlPrefix+"api/notification/deleteAll")},f=function(b){return a.get(app.urlPrefix+"api/notification/readAll")};return{getUnreader:b,toggleRead:c,remove:d,removeAll:e,readAll:f}}]);var ngApp=angular.module("navbarCat",["pascalprecht.translate","ngSanitize"]);ngApp.factory("navbar",["$rootScope",function(a){var b=null;return{getOption:function(){return b},setOption:function(c){b=c,a.$broadcast("navbarChange")}}}]),ngApp.factory("drawer",[function(a){var b={init:function(){if(!$("body #drawer-overlay").length){var a='<div class="drawer-overlay" id="drawer-overlay"></div>';$("body").append(a),$("body #drawer-overlay").on("click",this.close)}},toggle:function(){$("body").hasClass("drawer-open")?$("body").removeClass("drawer-open"):$("body").addClass("drawer-open")},close:function(){$("body").removeClass("drawer-open")}};return{init:b.init,toggle:b.toggle,close:b.close}}]),ngApp.controller("navbarCtrl",["$scope","$http","$rootScope","navbar","drawer","$translate",function(a,b,c,d,e,f){a.toggle=function(){e.toggle()},f.use(0==+$("#lang").val()?"fa":"en"),b.get(app.urlPrefix+"menu/MainMenu").then(function(b){a.menu=b.data,a.dashboardActions={fullScreenToggle:function(){},designToggle:function(){},printToggle:function(){},slideShowToggle:function(){},canDesign:!0},d.getOption()&&(a.dashboardActions=d.getOption()),c.$on("navbarChange",function(){d.getOption()&&(a.dashboardActions=d.getOption())})}),app.lang.setLang({selector:".navbar.navbar-inverse"})}]),angular.module("uibCollapseCat",[]).directive("uibCollapse",["$animate","$q","$parse","$injector",function(a,b,c,d){var e=d.has("$animateCss")?d.get("$animateCss"):null;return{link:function(d,f,g){function h(){f.hasClass("collapse")&&f.hasClass("in")||b.resolve(l(d)).then(function(){f.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),e?e(f,{addClass:"in",easing:"ease",to:{height:f[0].scrollHeight+"px"}}).start()["finally"](i):a.addClass(f,"in",{to:{height:f[0].scrollHeight+"px"}}).then(i)})}function i(){f.removeClass("collapsing").addClass("collapse").css({height:"auto"}),m(d)}function j(){return f.hasClass("collapse")||f.hasClass("in")?void b.resolve(n(d)).then(function(){f.css({height:f[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),e?e(f,{removeClass:"in",to:{height:"0"}}).start()["finally"](k):a.removeClass(f,"in",{to:{height:"0"}}).then(k)}):k()}function k(){f.css({height:"0"}),f.removeClass("collapsing").addClass("collapse"),o(d)}var l=c(g.expanding),m=c(g.expanded),n=c(g.collapsing),o=c(g.collapsed);d.$eval(g.uibCollapse)||f.addClass("in").addClass("collapse").attr("aria-expanded",!0).attr("aria-hidden",!1).css({height:"auto"}),d.$watch(g.uibCollapse,function(a){a?j():h()})}}}]);var ngApp=angular.module("sadaf",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]),ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401===b.status&&(alert("زمان نشست شما به اتمام رسیده است. لطفا دوباره در برنامه لاگین کنید"),document.location="/account/login"),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);var service=["$http","$interval",function(a,b){var c;return{start:function(){},stop:function(){b.cancel(c)}}}];try{var sadaf=angular.module("sadaf");sadaf.factory("heartBeat",service),sadaf.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}try{var management=angular.module("management");management.factory("heartBeat",service),management.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}var app=app||{};app.contentSegment=$("#content_segment"),app.contentSegmentModal=$("#content_segmentModal"),console||(console={},console.log=function(){}),app.chartLoadDelay=120,app.absoluteUrl="/",app.setAboluteUrl=function(a){app.absoluteUrl=a},app.loadContent=function(a){app.showLoadingProgress(),$("#content_segment").load(app.urlPrefix+a,function(){app.hideLoadingProgress(),app.lang.setLang()})},app.setContent=function(a){$("#content_segment").html(a),app.hideLoadingProgress(),app.lang.setLang()},app.setLocation=function(a){app.router.navigate(a,{trigger:!0})},app.urlPrefix="/",app.setUrlPrefix=function(a){app.urlPrefix=a.replace(/Moderation.*/g,"")},app.showInfo=function(a){$("#app-info-text").html(a),$("#app-info-text").fadeIn(),$("#app-loading-text").hide(),app.showInfoHolder.show(),setTimeout(function(){app.showInfoHolder.hide(),$("#app-info-text").fadeOut(400,function(){$("#app-loading-text").show()})},4e3)},app.showLoadingProgress=function(){app.showInfoHolder.show()},app.hideLoadingProgress=function(){app.showInfoHolder.hide()},app.showInfoHolder={holderCount:0,timeout:{},hide:function(){if(app.showInfoHolder.holderCount>0&&--app.showInfoHolder.holderCount,0==app.showInfoHolder.holderCount){var a=(new Date).getTime()-app.showInfoHolder.ticks;clearTimeout(app.showInfoHolder.timeout),setTimeout(function(){$("#app-loading").parent("div").animate({top:"0",opacity:0},400)},a<1e3?1e3:0)}},show:function(){var a=$("#app-loading").parent("div");a.css("left",$(window).width()/2-a.outerWidth()/2),++app.showInfoHolder.holderCount,app.showInfoHolder.ticks=(new Date).getTime(),app.showInfoHolder.timeout=setTimeout(function(){$("#app-loading").parent("div").animate({top:"50",opacity:1},400)},1e3)}},app.encodeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},app.convertOldPropObject=function(a,b){if(a){if(a.chartProp&&a.chartProp.info)return a;var c={};if(c.chartProp={},+b==chartTypes.TABLE){c.chartProp.info={chartSize:a.chartProp.chartSize,pivotTable:a.chartProp.pivotTable},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:a.seriesProp[""+d].table.headerName,numberFactor:"1",textAlign:a.seriesProp[""+d].table.textAlign,formatString:a.seriesProp[""+d].table.formatString,fontSize:a.seriesProp[""+d].table.fontSize,textBold:!1,textItalic:!1,color:a.seriesProp[""+d].table.fontColor}),c.chartProp.series["default"]={name:"",numberFactor:"1",textAlign:"right",formatString:"A",fontSize:"1m",textBold:!1,textItalic:!1,color:"#000000"}}if(+b==chartTypes.BAR){c.chartProp.info={chartSize:a.chartProp.chartSize,horizontalLines:a.chartProp.horizontalLine,formatString:a.chartProp.formatString},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:"",numberFactor:a.seriesProp[""+d].barlineChartProp.numberFactor,seriesType:a.seriesProp[""+d].barlineChartProp.barlineChartType,seriesColor:a.seriesProp[""+d].barlineChartProp.barlineChartColor,lineType:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartStyle,lineStyle:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineStyle,lineWeight:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineWeight,lineFace:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineDashes});c.chartProp.series["default"]={name:"",numberFactor:"1",seriesType:"bar",seriesColor:"#1f77b4",lineType:"line-dot-area",lineStyle:"linear",lineWeight:"2",lineFace:"5,0"}}return+b==chartTypes.PIE&&(c.chartProp.info={horizontalLines:a.chartProp.horizontalLine,chartSize:a.chartProp.chartSize,formatString:a.chartProp.formatString,pieStyle:a.chartProp.pieStyle,hole:"65"},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1"}),+b==chartTypes.GAUGE&&(c.chartProp.info={chartSize:a.chartProp.chartSize,style:a.chartProp.gaugeStyle,height:"medium",color:"#333333",fontSize:"3em",formatString:",.2f",status:"",target:"",textBold:!0,textItalic:!1,trend:"",value:"",segmentType:"singleSegment",min:"",yellow:"",green:"",max:""},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1",type:"value",typeMs:"value"}),c.dataUrl=a.chartProp.DataUrl,c.editMode=a.chartProp.editMode,c}},app.autoPlayTimer=app.autoPlayTimer||{counter:0},app.autoPlay=function(a,b){if(a&&"start"==a){var c=$(".side-menu .dashboard-menu a");b=b||10,$(".sadaf-circular-preogress").progressbar(10,1e3*+b),app.autoPlayTimer.timer=setTimeout(function(){var a=$(c[app.autoPlayTimer.counter++%c.length]);document.location.href=a.attr("href"),a.parents(".panel-collapse").collapse("show"),$(".sadaf-circular-preogress").progressbar("stop"),app.autoPlay("start",b)},1e3*+b)}a&&"stop"==a&&($(".sadaf-circular-preogress").progressbar("stop"),clearTimeout(app.autoPlayTimer.timer))};var resizeTimer;app.lestenWindowResize=function(a){function b(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){a()},400)}var c=$(window).width();$(window).resize(function(){$(window).width();$(window).width()!=c&&(c=$(this).width(),b())})};var designMenuTimer,printMenuTimer;app.onMenusClick=function(a,b){return"showPrintMenu"==a||"hidePrintMenu"==a?(clearTimeout(printMenuTimer),void(printMenuTimer=setTimeout(function(){"showPrintMenu"==a?$(".navbar .print-toggle").fadeIn():"hidePrintMenu"==a&&$(".navbar .print-toggle").fadeOut()},800))):(clearTimeout(designMenuTimer),designMenuTimer=setTimeout(function(){"showDesignMenu"==a?$(".navbar .design-toggle").fadeIn():"hideDesignMenu"==a&&$(".navbar .design-toggle").fadeOut(),b&&"showfullScreenMenu"==b?$(".navbar .fullscreen-toggle").parents(".pull-right").fadeIn():$(".navbar .fullscreen-toggle").parents(".pull-right").fadeOut()},800),void $("html,body").animate({scrollTop:0},"slow",function(){$(".side-menu").hasClass("open")&&$("#side-menu-toggle").click()}))},app.print={printSingle:function(a,b){var c=this.getWidgetHtml(a);app.print.print(c,b)},getWidgetHtml:function(a){var b=$(a).height(),c=$(a).width(),d=$(a).clone();d.width(c),d.height(b);var e=d.find(".ui.dimmer .dimmer-info").html();d.find(".header").remove(),d.find(".ui.dimmer ").remove(),d.find(".gs-resize-handle").remove(),d.find(" .title").remove(),d.find(" #sort_checkbox").remove(),d.find(" .comment").remove();var f=$("<div>").append(d).html(),g=$('<div style="margin-top:10px;">'+e+"</div>").width(c),h=$("<div>").html(f).append(g);h.css({"page-break-inside":"avoid",margin:"0 50px 50px 50px"}),h.addClass("pull-left");var i=$("<div>").append(h).html();return i},printPage:function(){var a="";$(".chart-widget").each(function(){var b=$(this).find(".chart-layout").attr("id");a+=app.print.getWidgetHtml("#"+b)});var b=$(".dashboard-page.active > a").text();app.print.print(a,b)},print:function(a,b){var c='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1.5cm;                                @top-center {                                        content: "sapam";                                    }                                }                                .clusterize-scroll { max-height:initial !important;}                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>',d=window.open();d.document.write('<html><head><meta charset="utf-8"><title>'+b+"</title>"+c),d.document.write("</head><body>"),d.document.write(a),d.document.write("</body></html>"),d.document.close(),d.focus(),setTimeout(function(){d.print()},400)}},app.post=function(a,b,c){$.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json; charset=utf-8",traditional:!0,success:c})},app.lang={langType:0,setLangTyle:function(a){this.langType=+(a||0)},isRtl:function(){return 0==app.lang.langType},translate:function(a){return app.lang.lang?app.lang.lang[a]||a:a},q:[],translateAsync:function(a,b){app.lang.lang?b&&b(app.lang.lang[a]||a):this.q.push({key:a,callback:b})},setLang:function(a){if(a&&a.data&&(this.lang=a.data),this.lang||!this.inProgress){if(!this.lang&&!this.inProgress){var b=0==app.lang.langType?"fa":"en";this.inProgress=!0;var c=app.urlPrefix+"dist/locales/locale-"+b+".js?v="+app.version;return void $.getJSON(c,null,function(a){for(app.lang.setLang({data:a});app.lang.q.length>0;){var b=q.pop();b.callback&&callback(app.lang.lang[b.key]||b.key)}})}var d;d=a&&a.selector?$(a.selector).find("*[data-trans-key]"):$("*[data-trans-key]"),d.each(function(){var a=$(this),b=a.data("translated");if(!b){var c=app.lang.lang[a.data("trans-key")],d=a.data("trans-attr");d?a.attr(d,c):a.text(c),a.data("translated",!0)}})}}};var app=app||{};app.filterBox=angular.module("filterBox",["ngAnimate"]),app.filterBox.controller("filterBoxController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){e.$on("app-filterbox-refresh",function(){a.refresh()}),a.getCleanValue=function(a){var b=/.*&\[(.*)\]/gi;return a.match(b)&&(a=a.replace(b,"$1")),a},a.refresh=function(){d(function(){a.otherFilters=[],_.forEach(app.chartCommons.drillDown.filters,function(b){_.forEach(b.drillDown,function(c){a.otherFilters.push({key:c.key,keyCaption:JSON.parse(c.key).join(", "),value:c.value,valueCaption:JSON.parse(c.value).join(", "),chartInPageId:b.chartInPageId,datasourceId:b.datasourceId,refreshDatasource:b.refreshDatasource})})}),a.userControlFilter=[],app.chartCommons.userFilter.filters.forEach(function(b){function d(a){switch(a){case"GetDate":return"امروز";case"MonthToDate":return"از ابتدای ماه تا امروز";case"YearToDate":return"از ابتدای سال تا امروز";case"DaysAgo":return persian(b.values[2]||0)+" روز قبل تا "+persian(b.values[3]||0)+" روز قبل";case"MonthAgo":return persian(b.values[2]||0)+" ماه قبل تا "+persian(b.values[3]||0)+" ماه قبل"}return""}var e={};e.key=b.dimensionName,e.disableClear=b.disableClear,e.chartInPageId=b.chartInPageId,e.values=_.map(b.values,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a});var f=e.values.join(", ");if(f.length>30&&(f=f.substring(0,30)+"..."),e.Caption=c.trustAsHtml(f),3==+b.variableType)e.Caption=c.trustAsHtml(d(b.values[0]));else if(4==+b.variableType){var g={gr:"بزرگتر",eqgr:"بزرگتر مساوی",ls:"کوچکتر",eqls:"کوچکتر مساوی",eq:"برابر",nteq:"نابرابر"};e.Caption=c.trustAsHtml("<b>"+g[b.values[1]]+"</b> "+b.values[0])}else 5==+b.variableType&&(e.Caption=c.trustAsHtml("<b>"+b.values[0]+"</b>"+("or"==b.values[1]?" در یکی از ":" در همه ")+": "+b.values[2]));e.refreshDatasource=b.refreshDatasource,a.userControlFilter.push(e)})},0)},a.removeUserControl=function(b){var c=a.userControlFilter[b];a.userControlFilter.splice(b,1);var d=_.find(app.chartCommons.userFilter.filters,{chartInPageId:c.chartInPageId,dimensionName:c.key});_.isUndefined(d)||_.remove(app.chartCommons.userFilter.filters,d);var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f)},a.removeDrillDown=function(b){var c=a.otherFilters[b];a.otherFilters.splice(b,1);var d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:c.chartInPageId});_.isUndefined(d)||_.remove(d.drillDown,{key:c.key});var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f)},a.clearAll=function(){var b=[];_.each(a.otherFilters,function(a){var c=$("#ID"+a.chartInPageId).data("settings");c&&c.input&&_.isArray(c.input.RefreshDatasource)&&(b=_.concat(b,c.input.RefreshDatasource))}),_.each(a.userControlFilter,function(a){var c=$("#ID"+a.chartInPageId).data("settings");_.isArray(c&&c.input&&c.input.RefreshDatasource)&&!a.disableClear&&(b=_.concat(b,c.input.RefreshDatasource))}),app.chartCommons.drillDown.clearAll(),app.chartCommons.userFilter.filters=_.filter(app.chartCommons.userFilter.filters,{disableClear:!0}),a.refresh(),app.moderation.dashboadpage.refreshRelatedDatasources(_.uniq(b))}}]),app.filterBox.refresh=function(){angular.element("#filter-box-controller").scope().refresh(),angular.element("#filter-box-controller").scope().$apply()},app.moderation=app.moderation||{},app.moderation.dashboadpage=app.moderation.dashboadpage||{},app.moderation.dashboadpage.globalFilterList=[],app.moderation.dashboadpage.syncWithGlobalFilter=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=$.grep(app.moderation.dashboadpage.globalFilterList,function(c){return c.Uniquename==a[b].Uniquename&&c.DataSourceId==a[b].DataSourceId&&c.CubeName==a[b].CubeName});0!=c.length&&(a[b].Members=c[0].Members.slice())}},app.moderation.dashboadpage.isRelated=!1,app.moderation.dashboadpage.onRelatedChange=function(a){app.moderation.dashboadpage.isRelated=a;for(var b=app.moderation.dashboadpage.charts,c=0;c<b.length;c++){var d=$("#ID"+b[c].pageId),e=d.data("settings");e.link="bold"}app.moderation.dashboadpage.isRelated?$(".glyphicon-link").show():$(".glyphicon-link").hide()},app.moderation.dashboadpage.showDimentions=function(){var a=$("#corelate-filter-list .filter-content").html();if(""==a.trim()){$(".glyphicon-link").addClass("link");for(var b=app.moderation.dashboadpage.charts,c=[],d=!0,e=0;e<b.length;e++){var f=$("#ID"+b[e].pageId),g=f.data("settings"),h=g.input.Dimentions;if(g.input.EditPermission)for(var i in h)for(var j=0;j<h[i].length;j++){var f={Uniquename:h[i][j],DataSourceId:g.input.DataSourceId,CubeName:g.input.CubeName,ChartId:g.chartId},k=$.grep(c,function(a){return a.Uniquename==f.Uniquename&&a.DataSourceId==f.DataSourceId&&a.CubeName==f.CubeName});0==k.length&&c.push(f)}else d=!1}var l=$("#corelate-filter-list .filter-content");l.html('<div style="padding:3px"><img style="width: 1.3em" src="'+app.urlPrefix+'Images/progress.gif" /><span  data-trans-key="در حال بارگذاری..."></span></div>'),0==c.length?($("#corelate-filter-list .filter-content").empty(),$("#corelate-filter-list .filter-content").html(d?"":"شما مجوز استفاده از این امکان را ندارید.")):$.ajax({type:"post",url:app.urlPrefix+"Charts/DashboardPage/GetHierarchies",data:JSON.stringify(c),contentType:"application/json; charset=utf-8"}).done(function(a){function b(a,b){if(null!=a)for(var c='<div class="container-fluid form-horizontal " style="margin-bottom:-15px;"><div class="form-group">',d=0,e=0,f=0;f<a.length;f++){var g=a[f];null!=g.Members&&(f>0&&(3==e||d!=g.DataSourceId)&&(c+='</div><div class="form-group">',e=0),d!=g.DataSourceId&&f>0&&(c+='<hr style="margin-top: 5px;;"/>'),e++,d=g.DataSourceId,c+='<div class="col-md-4">                                    <div class="btn btn-default col-md-12 filter-member-dialog" style="overflow: hidden; text-overflow: ellipsis;"                                            CubeName="'+g.CubeName+'" DataSourceId="'+g.DataSourceId+'" Uniquename="'+g.Uniquename+'"                                             title="'+g.Caption+'">'+g.Caption+"</div></div>")}return c+="</div></div>"}if($("#corelate-filter-list .filter-content").empty(),!a.result)return void $("#corelate-filter-list .filter-content").html(a.message);var c=b(a.data,"");l.html(c),l.find(".filter-member-dialog").on("click",function(){var b=$(this),c=$(this).attr("Uniquename"),d=$(this).attr("DataSourceId"),e=$(this).attr("CubeName"),f=$.grep(a.data,function(a,b){return a.Uniquename==c&&a.DataSourceId==d&&a.CubeName==e})[0];app.helper.filterMemberDialog(f.Members,function(a){f.Members=a;var c=a.filter(function(a){return a.IsChecked}).map(function(a){return a.Caption}),d=f.Caption;c.length>3?d="انتخاب "+c.length+" از "+a.length:c.length>0&&(d=c.join(" و ")),b.text(d),app.moderation.dashboadpage.getWheres(f,f.DataSourceId)})})})}},app.moderation.dashboadpage.getWheres=function(a,b){if("undefined"!=typeof b){$.grep(a.Members,function(a){return a.IsChecked})}if(app.moderation.dashboadpage.isRelated){for(var c=app.moderation.dashboadpage.globalFilterList,d=app.moderation.dashboadpage.charts,e=!1,f=0;f<c.length;f++){var g=c[f];g.Uniquename==a.Uniquename&&g.DataSourceId==a.DataSourceId&&g.CubeName==a.CubeName&&(c[f]=$.extend({},a),e=!0)}e||c.push($.extend({},a));for(var f=0;f<d.length;f++){var h=$("#ID"+d[f].pageId),i=h.data("settings");if(i.input.DataSourceId==a.DataSourceId&&i.input.CubeName==a.CubeName&&$("#ID"+d[f].pageId+" .glyphicon-link").hasClass("link")){var j=($.inArray(a.Uniquename,i.input.Dimentions.Where)!=-1,$.inArray(a.Uniquename,i.input.Dimentions.Hierarchies)!=-1,$.inArray(a.Uniquename,i.input.Dimentions.SeriesLevel)!=-1,h.find("#filter").data("data"));"undefined"!=typeof j&&(app.moderation.dashboadpage.syncWithGlobalFilter(j.Where),app.moderation.dashboadpage.syncWithGlobalFilter(j.Hierarchies),app.moderation.dashboadpage.syncWithGlobalFilter(j.SeriesLevel)),i.titlebar.showProgress(!0);var k=$.extend({},a);k.Members=$.grep(a.Members,function(a){return a.IsChecked}),i.parameters={ChartInPageId:i.ChartInPageId,Filter:[k]},app.chartCommons.levelTypeUtils.getParam(i),h.charts(i.type,"refreshWithData",i)}}}},app.moderation.dashboadpage.refreshRelatedDatasources=function(a,b){var b=b||[],a=a||[];b=b.map(function(a){return+a});var c=0;$(".bar-chart").each(function(d){$el=$(this);var e=$el.data("settings");if("undefined"!=typeof e){var f=app.customChart.getConfig(e.type);if(f.needData!==!1&&"undefined"!=typeof e&&"undefined"!=typeof e.input&&!e.input.disableFilter){if(b.indexOf(+e.ChartInPageId)!=-1)return;var g=_.difference(a,e.input.RefreshDatasource);if(g.length==a.length)return;7!=+e.type&&c++,setTimeout(function(a){e.titlebar.showProgress(!0),app.chartCommons.levelTypeUtils.getParam(e),a.charts(e.type,"refreshWithData",e,{refreshRelatedDatasources:!1})},7==+e.type?0:c*app.chartLoadDelay,$el)}}})},app.moderation.dashboadpage.selectValueOnChart=function(a,b){var c=a.chartInPageId;return+a.Id==-1?(app.chartCommons.userFilter.setFilter({id:a.Id,values:a.Values,variableType:a.VariableType,dimensionName:a.dimensionName,chartInPageId:a.chartInPageId,datasourceId:a.datasourceId}),app.moderation.dashboadpage.refreshRelatedDatasources(b,[+c]),void app.filterBox.refresh()):void $.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(a),success:function(a){a.result?(app.moderation.dashboadpage.refreshRelatedDatasources(a.relatedDatasource,[+c]),app.filterBox.refresh()):alert(a.Message)}})};var app=app||{};app.dashboardLayoutVersion=2;var dashboard={defuals:{maxCols:12},charts:[],pageInfo:{},pageId:-1,arrangePer:!1,minChartSize:{1:[500,250],2:[350,350],3:[300,200],4:[300,300],5:[500,300],6:[300,200],7:[350,50],8:[300,300],9:[300,300]},padding:10,maxCols:12,baseDimantion:{y:30},serialize:function(){dashboard.gs.serialize()},drillDownResize:function(a,b){},setMaxCols:function(){var a=dashboard.getPagePosition();dashboard.maxCols=a?a.maxCol||12:12,$("#dashboard-col").val(dashboard.maxCols)},setInfo:function(a,b,c,d,e){this.arrangePer=d||!1,this.charts=a||[],this.pageInfo=b||{chartsOrder:[],layout:[],pageLayout:"30_30_30"},this.pageId=c||-1,this.forms=e||[],this.charts=this.charts.concat(this.forms),this.setMaxCols()},disable:function(){dashboard.gs.disable(),dashboard.gs.disable_resize()},enable:function(){dashboard.gs.enable(),dashboard.gs.enable_resize()},saveSerialize:function(){dashboard.serializeData=dashboard.gs.serialize();var a=dashboard.serializeData.map(function(a){var b;return b="form"===a.type?a.id:a.data.ChartInPageId,{type:a.type,chartIdPageId:b,col:a.wgd.col,row:a.wgd.row,size_x:a.wgd.size_x,size_y:a.wgd.size_y}}),b={pageId:this.pageId,chartsPosition:a,media:dashboard.media,maxCol:dashboard.maxCols};try{"undefined"==typeof dashboard.pageInfo.layout&&(dashboard.pageInfo.layout=[]);var c=dashboard.pageInfo.layout.filter(function(a){return a.media===dashboard.media});c.length>0?c[0].chartsPosition=a:dashboard.pageInfo.layout.push({media:dashboard.media,chartsPosition:a,maxCol:dashboard.maxCols})}catch(d){}$.ajax({type:"POST",url:app.urlPrefix+"Charts/DashboardPage/SetChartsOrder",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(a){}})},add:function(a,b,c,d,e){b=b>dashboard.maxCols?dashboard.maxCols:b,d=d>dashboard.maxCols?dashboard.maxCols:d,dashboard.gs.add_widget(a,b,c,d,e)},initGs:function(a){return dashboard.baseDimantion={x:$(".gridster").width()/dashboard.maxCols,y:50},dashboard.gs=$(".gridster>div").gridster({widget_margins:[0,0],widget_base_dimensions:[dashboard.baseDimantion.x,dashboard.baseDimantion.y],max_cols:dashboard.maxCols,min_cols:dashboard.maxCols,resize:{enabled:!0,stop:function(a,b,c){dashboard.saveSerialize();var d=$(c).data("type");if("form"!==d){var e=$(c).find(".chart-data").data("settings");e.isDashboardResize=!0,$(c).find(".chart-data").charts(e.type,"refresh",e),e.widgetSize.size_y=+$(c).attr("data-sizey"),e.widgetSize.size_x=+$(c).attr("data-sizex")}}},serialize_params:function(a,b){var c=a.data("type"),d=a.data("id");return{type:c,id:d,data:a.find(".chart-data").data("settings"),wgd:b}},draggable:{handle:".content > .move, content > .move b",cancel:".desc",start:function(a,b){},drag:function(a,b){},stop:function(a,b){$(b.$helper).removeClass("player-revert"),dashboard.saveSerialize()}}}).data("gridster"),a||(dashboard.gs.disable(),dashboard.gs.disable_resize()),dashboard.gs},deleteAll:function(){$("#ID0").data("settings");dashboard.gs.remove_widget($("#ID0"))},deleteChartFromGs:function(a,b){var c=$(a).parents(".chart-widget");dashboard.gs.remove_widget(c),b&&b()},getPagePosition:function(){var a=dashboard.pageInfo.layout.filter(function(a){return a.media<=dashboard.media}).sort(function(a,b){return+b.media-+a.media});if(0==a.length){var b=_.map(dashboard.pageInfo.layout,function(a){return a.media}),c=-1,d=1e3;_.each(dashboard.pageInfo.layout,function(a,b){var e=Math.abs(a.media-dashboard.media);e<d&&(d=e,c=b)}),c!=-1&&(a=[dashboard.pageInfo.layout[c]],a[0].media=b,a[0].maxCols=dashboard.maxCols)}return a[0]},getChartPosition:function(a,b,c){var d,e=null,f=1e3;"form"===a.type?(e="form",d=a.id):(d=a.pageId,f=+a.type);var g=dashboard.minChartSize[+f]||[300,300],h={col:1,row:1e3,size_x:Math.floor(g[0]/dashboard.baseDimantion.x)+1,size_y:Math.floor(g[1]/dashboard.baseDimantion.y)+1},i=[];try{var j=dashboard.getPagePosition();i=j.chartsPosition.filter(function(a){return a.chartIdPageId===d&&(!a.type||a.type===e)})}catch(k){}return i[0]||h},sortCharts:function(){try{this.charts.sort(function(a,b){try{var c=dashboard.getChartPosition(a),d=dashboard.getChartPosition(b),e=c.row==d.row?c.col>d.col?1:c.col<d.col?-1:0:c.row>d.row?1:c.row<d.row?-1:0;return e}catch(f){return-1e3}})}catch(a){Error(a)}},addTasks:[],drow:function(a){dashboard.initGs(this.arrangePer),dashboard.sortCharts();var b=0;this.charts.forEach(function(c,d){7!=+c.type&&b++;var e=b,f=setTimeout(function(){dashboard.addChart(c,null,!1,e*app.chartLoadDelay),d==dashboard.charts.length-1&&a&&a()},50*d);dashboard.addTasks.push(f)})},resize:function(){this.setMaxCols();var a=$(".chart-data").map(function(a,b){return $(b).data("settings")}).toArray();$(".gridster").remove(),$("#dashboard-chart-panel").html('<div class="gridster"><div></div></div>'),dashboard.initGs(this.arrangePer),a.forEach(function(a){dashboard.addChart(null,a,!0)}),dashboard.forms&&_.each(dashboard.forms,function(a){dashboard.addChart(a)})},addChart:function(a,b,c,d,e){var f;if(a&&"form"===a.type){var g=dashboard.getChartPosition(a),h=app.absoluteUrl+"sadaf/management/#/forms/"+a.id,i=!1,j="javascript:dashboard.deleteForm("+a.id+")",k=!1,l="";f=$('<div data-type="form" data-id="'+a.id+'" class="chart-widget"></div>');var m=dashboard.getFormTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.name,o,a.lastRefresh,l,k);f.append(m),dashboard.add(f,g.size_x,g.size_y,g.col,g.row),$("body").trigger("form-widget-add",[a.id]),app.lang.setLang({selector:"div[data-type=form][data-id="+a.id+"]"})}else{"undefined"==typeof d&&(d=0),b&&(a={id:b.chartId,pageId:b.ChartInPageId,title:"undefined"!=typeof b.title?b.title:b.input.title,type:b.type.id,isCustom:b.type.isCustom,permissions:b.permissions,lastRefresh:b.lastRefresh,desc:b.desc});var n={chartId:a.id,ChartInPageId:a.pageId},o="ID"+a.pageId;f=$("<div class='chart-widget cid"+a.pageId+"'></div>");var p=b;b||(p=JSON.parse(a.detail));var q=app.customChart.getConfig({isCustom:a.isCustom,id:+a.type}),r=q.needData!==!1,s=p.chartProp.info||{};a.isCustom&&(s=p.chartProp.general.info||{}),s.dontShowTitle===!0&&(q.noTitle=!0),s.noPadding===!0&&(q.noPadding=!0);var k=!(!r||!a.isCustom&&7==+a.type),i=!(!r||!a.isCustom&&7==+a.type),h=app.absoluteUrl+"sadaf/management/#/charts/edit/0/"+n.chartId,j="javascript:dashboard.deleteChart("+n.ChartInPageId+", "+n.chartId+", "+a.permissions.DeletePermission+")",l=_.isEmpty(a.desc)?"":"<p><br/><b>"+app.lang.translate("desc")+":</b> "+a.desc.replace(/(\r\n|\n|\r)/gm,"<br/>")+"</p>",t="combo-kpi"==p.dataType,m=dashboard.getChartTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.title,o,a.lastRefresh,l,k,t,q,s);f.append(m),s.backgroundColor&&f.find(".ui.card ").css("background",s.backgroundColor),s.titleFont&&(f.find(".ui.card .title-content").css({"font-size":s.titleFont.fontSize,color:s.titleFont.color,"font-family":s.titleFont.fontName,"font-weight":s.titleFont.bold?"bold":"normal","font-style":s.titleFont.italic?"italic":"normal"}),f.find(".ui.card .title").css({
"text-align":s.titleFont.align})),q.noPadding&&f.find(".ui.card .title + .description").addClass("chart-fit-to-container"),a.permissions.Filter||f.find(".icon.filter").remove(),a.permissions.Description||f.find(".icon.info").remove(),a.permissions.Comment||f.find(".icon.comments").remove(),a.permissions.ExportExcel||f.find(".item.export-excel").remove();var b=b||$.extend({permissions:a.permissions,parameters:n,chartId:n.chartId,editLink:h,removeLink:j,RemoveFromPage:this.arrangePer,ChartInPageId:a.pageId,input:{RefreshDatasource:a.RefreshDatasource},lastRefresh:a.lastRefresh,desc:a.desc,type:a.type,isCustom:a.isCustom},p);if(g=dashboard.getChartPosition(a),b.widgetSize=g,e)return void(c?e.find(".chart-data").charts(b.type,c,b):(e.append(f),f.find(".menu-bar ").remove(),f.find(".chart-data").charts(b.type,b)));if(dashboard.add(f,g.size_x,g.size_y,g.col,g.row),c)f.find(".bar-chart").data("settings",b),f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refresh",b,!0);else{var u=setTimeout(function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},b)},a.isCustom||7!=+a.type?d:0);dashboard.addTasks.push(u)}app.lang.setLang({selector:".chart-widget.cid"+a.pageId})}f.find(".show-extra-info").on("click",function(){f.find(".ui.card .ui.dimmer.overflow-auto").dimmer("show")}),f.find(".dimmer-info").on("click",function(){f.find(".ui.card .ui.dimmer").dimmer("hide")}),f.find(".refresh-chart").on("click",function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refreshWithData",b,!0),f.find(".bar-chart").data("settings").titlebar.showProgress(!0)}),f.find(".export-excel").on("click",function(){var a=f.find(".chart-data").data("settings");app.chartCommons.setFilterParameter(a),$.ajax({type:"POST",url:app.urlPrefix+"Charts/BarChart/ExportToExcel",data:JSON.stringify({ChartId:b.chartId,ChartInPageId:b.ChartInPageId,TableInfo:p.TableInfo,IsPivot:1==+p.chartProp.info.aggregation,drillDown:a.parameters.drillDown,userControlFilter:a.parameters.userControlFilter,userVariable:a.parameters.userVariable,otherFilters:a.parameters.otherFilters,filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId)}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){window.location=app.urlPrefix+"Charts/BarChart/Download?name="+a.id}})}),f.find(".export-png").on("click",function(){var b=f.get(0);html2canvas(b,{background:null,scale:5,useCORS:!0,onclone:function(b){$(b).find(".cid"+a.pageId+" .header").remove(),$(b).find(".cid"+a.pageId+" .title").remove(),$(b).find(".cid"+a.pageId+" #sort_checkbox").remove(),$(b).find(".cid"+a.pageId+" .comment").remove(),$(b).find(".cid"+a.pageId+" .ui.card").css("background","none"),$(b).find(".cid"+a.pageId+" rect.background").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart .line").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart circle").css("fill","#fff"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("fill","none"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke-width","1px"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke","#000"),$(b).find(".cid"+a.pageId+" *").css("font-family","IRANSans,Droid,Tahoma,Arial"),$(b).find(".cid"+a.pageId+" .map-container  #state-borders").css("fill","none")}}).then(function(b){b.fillStyle=null,b.fillRect=null,b.toBlob(function(b){saveAs(b,a.title+".png")})})}),f.find(".export-print").on("click",function(){app.print.printSingle(".cid"+a.pageId,a.title)}),f.find(".clone-chart").on("click",function(){app.post(app.urlPrefix+"Moderation/Charts/CloneChart",{Id:b.chartId,PageId:dashboard.pageId},function(a){if(a.result&&a.insertedId){var b=a.insertedId,c=app.urlPrefix+"api/dashboards/getSingleChartInfo?chartId="+b+"&chartInPageId="+a.chartInPageId;$.get(c,function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1),$("html, body").animate({scrollTop:$(document).height()-$(window).height()},1e3)})}})}),f.find(".chart-dimentions").on("click",function(){f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade")}),f.find(".show-chart-dimensions").on("click",function(){var a=f.find(".chart-dimentions-content");f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade"),""==a.html()&&(a.html('<div class="ui text active loader">در حال بارگذاری</div>'),$.ajax(app.urlPrefix+"api/chartdata/GetChart?Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId).done(function(c){function d(a,b){return null!=a?"<ul class='sortable list-unstyled pointer' index='"+b+"'>"+a.map(function(a,b){return a.ShowFilter?'<li value="'+a.Uniquename+'">  '+a.Caption+'<i class="icon filter filter-member-dialog" style="float:left; margin-right:5px;"></i></li>':'<li value="'+a.Uniquename+'"> '+a.Caption+"</li>"}).join("")+"</ul>":""}function e(){function d(b,c){var d=b[c],e=[];a.find("ul[index="+c+"] li").each(function(a,b){var c=$(this).attr("value"),f=$.grep(d,function(a){return a.Uniquename==c})[0];f.Members=$(this).data("members"),e.push(f)}),b[c]=e}d(c,"Hierarchies"),d(c,"Where"),d(c,"SeriesLevel");var e=function(a){b.parameters={filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId),chartId:b.chartId,ChartInPageId:b.ChartInPageId},$("#ID"+b.ChartInPageId).charts({id:b.type,isCustom:b.isCustom},"refreshWithData",b,{refreshRelatedDatasources:!1})};e(c)}a.data("data",c);var f=null,g=null,h=null;f=d(c.Hierarchies,"Hierarchies"),g=d(c.Where,"Where"),h=d(c.SeriesLevel,"SeriesLevel");var i='<table class="ui single line unstackable table chart-design" xstyle="display:none" xstyle="position:absolute;margin-bottom:0px; background-color:#fff;display:none; border-bottom:1px solid silver">                                           <thead><tr class="">                                             <th style="'+(""==h?"display:none":"")+'"><span data-trans-key="شاخص‌ها (ستون‌های عددی)" > </span> </th>                                             <th style="'+(""==f?"display:none":"")+'"><span data-trans-key="ابعاد (ستون‌های رشته‌ای)" > </span> </th>                                             <th style="'+(""==g?"display:none":"")+'"><span data-trans-key="شرط" > </span></th>                                         </tr></thead>                                         <tr>                                             <td  style="'+(""==h?"display:none":"")+'"id="div-x" class="myc">'+h+'</td>                                             <td  style="'+(""==f?"display:none":"")+'"id="div-y" class="myc">'+f+'</td>                                             <td  style="'+(""==g?"display:none":"")+'"id="div-where" class="myc">'+g+"</td>                                         </tr>                                     </table>";a.html(i),a.find(".filter-member-dialog").on("click",function(){function a(a,b){app.helper.filterMemberDialog(a,b,function(a){d.data("members",a),e()})}var d=$(this).parent(),f=$(this).parent().attr("value"),g=c[$(this).closest("ul").attr("index")],h=($.grep(g,function(a,b){return a.Uniquename==f})[0],$(this).parent().data("members")),i=app.urlPrefix+"api/chartdata/GetMemberOfFilterHierarchy?Uniquename="+f+"&Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId;"undefined"==typeof h?$.ajax(i).done(function(b){$(this).parent().data("members",b),a(b,i)}):a(h,i)}),a.find(".sortable").sortable({start:function(a,b){b.placeholder.addClass("filter-placeholder"),b.placeholder.height(b.item.height()),b.placeholder.width(b.item.width()),b.placeholder.parent().width(b.item.width()),b.placeholder.parent().parent().width(b.item.width())},stop:function(a,b){e()}}),app.lang.setLang({selector:a.selector})}))}),f.find(".dropdown").lazyDropdown({onShow:function(a,b){f.find(".menu-bar").addClass("show-dropdown")},onHide:function(a,b){f.find(".menu-bar").removeClass("show-dropdown")}}),this.showEmptyMessageIfNeed()},showEmptyMessageIfNeed:function(){0==dashboard.charts.length?$("#chart-empty-message").hasClass("hidden")&&$("#chart-empty-message").transition("scale in"):$("#chart-empty-message").hasClass("hidden")||$("#chart-empty-message").transition("scale out")},deleteChart:function(a,b,c){if(a)c?$("#deleteChart .checkbox").show():$("#deleteChart .checkbox").hide(),$("#deleteChart").data("cId",a),$("#deleteChart").data("chartId",b),$("#deleteChart").modal("show");else{var a=$("#deleteChart").data("cId"),b=$("#deleteChart").data("chartId"),d=app.urlPrefix+"charts/dashboardPage/removeChartFromPage";$("#deleteChart .action-btn").addClass("loading"),$.post(d,{ChartInPageId:a,pageId:dashboard.pageId},function(b){if(0==b)return void alert("شما مجوز پاک کردن این نمودار را ندارید");for(var c,d=0;d<dashboard.charts.length;d++)if(dashboard.charts[d].pageId==a){c=dashboard.charts[d].pageId,dashboard.charts.splice(d,1)}dashboard.deleteChartFromGs("#ID"+c,function(){$(this).remove(),dashboard.showEmptyMessageIfNeed()}),$("#deleteChart").modal("hide"),$("#deleteChart .action-btn").removeClass("loading")});var e=$("#delete-from-dash").prop("checked");e&&$.post(app.urlPrefix+"Moderation/Charts/DeleteCharts",{Ids:["ChartId-"+b]},function(a){})}},deleteForm:function(a){$("body").trigger("delete-form",[a,dashboard.pageId])},setReturnUrl:function(a){localStorage.setItem("returnUrl",window.location.href),localStorage.setItem("lastEditedChartId",a)},getChartTemplate:function(a,b,c,d,e,f,g,h,i,j,k,l){return'<div class="ui card">  <div class="content" style="">    <div class="header '+(a?"move":"")+'" style="position:absolute; width:50%;z-index:2;">&nbsp;</div><div class="title'+(l.noTitle===!0?" no-title ":a?" move":"")+'">            <div class="menu-bar " style="z-index:2;">                <i class="icon titlebar-icon" style="xbackground: #fff;width: 100%;position: absolute;display: block;top: 0;height: 100%;"></i>                '+(app.mobileMode?e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"":'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon titlebar-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit outline icon"></i></a>':"")+"                          "+(b?' <a class="item clone-chart"><span data-trans-key="تکرار" > </span> <i class="clone outline icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف نمودار از صفحه" > </span> <i class="trash alternate outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-excel"><span data-trans-key="خروجی اکسل" > </span> <i class="file excel outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-png"><span data-trans-key="export png"> </span> <i class="camera icon"></i></a>':"")+"                          "+(e?'<a class="item refresh-chart">'+app.lang.translate("data refresh")+' <i class="refresh icon"></i></a>':"")+"                          "+(j?'<a class="item export-print"><span data-trans-key="print" > </span> <i class="print icon"></i></a>':"")+'                        </div>                </div>                <div class=" ">                    '+(e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"")+"                    "+(!e||k?"":'<i class="filter icon chart-setting-icon show-chart-dimensions pointer titlebar-icon"></i>')+"                    "+(e&&app.commentOnChart?'<i class="comments icon chart-setting-icon show-chart-comments pointer titlebar-icon"></i>':"")+"                </div>")+"            </div>        "+(l.noTitle===!0?"":'<span class="title-content">'+f+"</span>")+'    </div>    <div class="description chart-data bar-chart" id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader mini"></div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: '+(app.mobileMode?"0":"4")+'px !important;"><div class="content"><div class="center"><div class="dimmer-info"><b>'+app.lang.translate("lastUpdate")+':</b> <span class="last-refresh">'+app.chartCommons.lastRefreshDateFormat(h)+"</span>"+i+"</div></div></div></div></div>"},getFormTemplate:function(a,b,c,d,e,f,g,h,i,j){return'<div class="ui card ">  <div class="content" style="">    <div class="header '+(a?"move":"")+'">            <div class="menu-bar ">                '+(a||b?'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف" > </span> <i class="trash outline icon"></i></a>':"")+"                                                   </div>                </div>":"")+'                <div class="">                   <i xclass="info icon chart-setting-icon show-extra-info pointer"></i>                </div>            </div>        <span class="title-content">'+f+'</span>    </div>    <div class="description form-content " id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader tiny">'+app.lang.translate("در حال بارگذاری")+'</div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: 4px !important;"><div class="content"><div class="center"><div class="dimmer-info">'+i+"</div></div></div></div></div>"},setLastRefresh:function(a,b){var c=$(".cid"+a+" .last-refresh");c.html(app.chartCommons.lastRefreshDateFormat(b))}},ngApp=angular.module("sadaf");ngApp.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit(d.onFinishRender)})}}}]),ngApp.directive("sglclick",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.sglclick),f=200,g=0,h=null;c.on("click",function(a){g++,1===g?h=setTimeout(function(){b.$apply(function(){e(b,{$event:a})}),g=0},f):(clearTimeout(h),g=0)})}}}]),ngApp.controller("dashboardPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","drawer","$translate","$rootScope","$compile","formsService","dashboardContainerService","chartComments","iframeService","datasources",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){function a(){$(window).width()<768?(dashboard.media=1,dashboard.maxCols=1):$(window).width()<992?(dashboard.media=2,dashboard.maxCols=1):$(window).width()<1200?(dashboard.media=3,dashboard.maxCols=12):(dashboard.media=4,dashboard.maxCols=12);try{var a=dashboard.getPagePosition();dashboard.maxCols=a&&a.length&&a[0].maxCol||12}catch(b){Error(b)}$("#dashboard-col").val(dashboard.maxCols),$("#device-selector .icon").removeClass("active"),$($("#device-selector .icon").get(4-dashboard.media)).addClass("active")}function b(a,b){if(dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.pageInfo.layout.filter(function(b){return+b.media==+a});c.length>0&&(c[0].maxCol=b)}}_renderBefor=!0,a(),app.lestenWindowResize(function(){0!=$("#dashboard-chart-panel").length&&(a(),fixLayout(!1))}),$("#dashboard-col").on("change",function(){var a=dashboard.getPagePosition();a.maxCol=+$(this).val()||dashboard.maxCols,dashboard.resize(dashboard.arrangePer),dashboard.saveSerialize(),b(dashboard.media,dashboard.maxCols)});$("#device-selector .item").on("click",function(a){var b=$(this);if($("#device-selector .icon").removeClass("active"),b.find(".icon").addClass("active"),dashboard.media=4-b.index(),dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.getPagePosition();dashboard.maxCols=c.length>0&&c[0].maxCol?c[0].maxCol:4==dashboard.media||3==dashboard.media?12:1,$("#dashboard-col").val(dashboard.maxCols),dashboard.resize(dashboard.arrangePer)}});var c=null,d=$('<div class="copy-handler"></div>').css("position","fixed").css("display","none");$("body").append(d),$("#device-selector .icon").mousedown(function(a){var b=a.currentTarget;c=$(b).attr("id"),d.show(),setTimeout(function(){c=null},3e3)}),$("#device-selector .icon").mouseup(function(a){var b=a.currentTarget;if(target=$(b).attr("id"),null!=c&&c!=target){var d=function(a){return"laptop"==a?4:"tablet"==a?3:"smartphone-land"==a?2:1},e=dashboard.pageInfo.layout.indexOf(dashboard.pageInfo.layout.filter(function(a){return a.media==+d(target)})[0]),f=$.extend({},dashboard.pageInfo.layout.filter(function(a){return a.media==+d(c)})[0]);f.media=+d(target),dashboard.pageInfo.layout.splice(e,1,f);var g=dashboard.media;dashboard.media=f.media,dashboard.saveSerialize(),dashboard.media=g,c=null,alert("cope done!")}}),$(".freeze-menu").on("hide.bs.collapse",function(){$(".freeze-menu").addClass("hide-aff")}).on("show.bs.collapse",function(){$(".freeze-menu").removeClass("hide-aff")}),$(".freeze-menu").on("affixed.bs.affix",function(){$(".freeze-menu.affix").css("width",$("#content_segment").width()+"px")})}function q(){window.parent.postMessage("ready","*")}function r(b){a.menuCategories=b.data;var c=b.data.defaultId;a.reorderPermission=b.data.reorderPermission;var f=d.id||w||c,g=d.appid||1;d.id||e.path("app/"+g+"/dashboard/"+f),a.menuCategories&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.open=!0,a.active=!0,b.active=!0)})})}function s(){a.routeChangeSuccess&&a.getMenusData&&r(a.getMenusData)}function t(){$(".ui.modal#edit-menus").modal("show"),$(".ui.modal#edit-menus input[type=text]").off("keyup"),$(".ui.modal#edit-menus input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#edit-menus .ui.button.btn-primary").click()})}function u(){$(".ui.modal#edit-menus").modal("hide")}function v(){var b=$(window).width()<=723,c=$(".side-menu");b||a.isFullscreen?($(".toc-toggle").show(),c.removeClass("my-fix no-padd no-margin"),c.addClass("sidebar right  menu fixed vertical"),$(".main-container").addClass("mobile")):($(".toc-toggle").hide(),c.addClass("my-fix no-padd no-margin"),c.removeClass("sidebar right  menu fixed vertical"),$(".main-container").removeClass("mobile")),b?$(".full-screen-toggle").hide():$(".full-screen-toggle").show()}a.mainMenuType=2,a.iframeService=n,p(),h.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),g.init(),q(),a.setPath=function(a){e.path(a)},a.$watch("visible",function(b){b||(a.formId=0,a.rowId=0)}),a.hideForm=function(){$(".modal.singletone-edit").modal("hide")},a.formInfo={modalSettings:{closable:!1,observeChanges:!0,autofocus:!1,allowMultiple:!0}},a.publishDashboard={show:function(){a.publishDashboard.showModal=!0},showModal:!1,publishProgress:!1,publish:!1,setPublishState:function(b){b?(a.publishDashboard.url=b,a.publishDashboard.publish=!0):a.publishDashboard.publish=!1},publishing:function(c){this.publishProgress=!0,b.get(app.urlPrefix+"api/dashboards/publish",{params:{id:dashboard.pageId,enable:c}}).then(function(b){a.publishDashboard.publishProgress=!1,a.publishDashboard.setPublishState(b.data)})["catch"](function(){a.publishDashboard.publishProgress=!1})}},i.$on("publish-url",function(b,c){a.publishDashboard.setPublishState(c.url)}),a.formSettings={modal:!0,xc:!1,selector:"singletone-edit"},$("body").on("open-form",function(b,c,d,e){$(".modal.form-editor.singletone-edit").modal(a.formInfo.modalSettings).modal("show");var g=a.formSettings.notify;g(c,d),f(function(){$(".modal.form-editor.singletone-edit .form-controls")},1e3)}),$("body").on("form-widget-add",function(b,c){f(function(){var b=$("div[data-type=form][data-id="+c+"] .form-content");b.html('<div class="" sadaf-form id="'+c+'" settings="{pop:true}"></div>'),j(b)(a)},0)}),$("body").on("delete-form",function(b,d,e){f(function(){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("آیا فرم از صفحه حذف شود؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف..."),k.deleteFormFromDashboard(e,[d]).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),u();var c=$("div[data-type=form][data-id="+d+"]");dashboard.gs.remove_widget(c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},0)}),$("body").on("show-chart-comments",function(b,c){f(function(){a.comment={value:null,ok:function(){var b=app.chartCommons.getFilterParameter(c.chartInPageId,c.input.RefreshDatasource);m.save(0,{chartId:c.chartId,dashboardId:c.dashboardId,datasourceId:c.datasourceId,dimention:c.dimention,input:JSON.stringify(c.input),drillDown:b.drillDown,otherFilters:b.otherFilters,userControlFilter:b.userControlFilter,userVariable:b.userVariable,where:c.where,comment:a.comment.value}).then(function(a){}),$(".ui.modal#input-comments").modal("hide")}},$(".ui.modal#input-comments").modal("show"),$(".ui.modal#input-comments input[type=text]").off("keyup"),$(".ui.modal#input-comments input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#input-comments .ui.button.btn-primary").click()})},0)}),i.$on("permission-change",function(b,c){a.hasEditPermission=c;var d="visible"==$(".dashboard-edit-panel").css("visibility");c&&!d&&$(".dashboard-edit-panel").transition("fade left in"),!c&&d&&$(".dashboard-edit-panel").transition("fade right out")}),a.$on("ngRepeatFinished",function(){$(".side-menu .ui.dropdown").lazyDropdown({onShow:function(){$(this).parents(".side-menu-item").addClass("show-dropdown")},onHide:function(){$(this).parents(".side-menu-item").removeClass("show-dropdown")}})});var w=+localStorage.getItem("defaultDashboard");if($("#dashboardPublishMenuId").val()&&(w=$("#dashboardPublishMenuId").val()),!app.mobileMode){a.$on("$routeChangeSuccess",function(){a.routeChangeSuccess=!0,s()});var x=a.$on("$routeChangeSuccess",function(){var c=d.appid||1;b.get(app.urlPrefix+"menu/MenuCategories/"+c).then(function(b){a.getMenusData=b,s(),x()},function(a){!app.mobileMode&&a&&a.data&&a.data.forceSignout&&(console.log("مجوز برنامه مشکل دارد."),alert("مجوز برنامه مشکل دارد."),window.location.href=app.urlPrefix+"account/logoff")})})}a.sortableOptions={disabled:!a.editMode,stop:function(c,d){f(function(){a.isDrag=!1;var c=$(d.item).parents(".menu-category").data("id"),e=$(d.item).data("id"),f=$(d.item).parents(".menu-category").find(".dashboard-menu").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"menu/ChangeMenuOrder",{list:f,menuId:e,parentCategoryId:c}).then(null,function(a){alert(a.data.title+" - "+a.data.desc)})},0)},connectWith:".connected-sortable"},a.sortableCatOptions={disabled:!a.editMode,stop:function(a,c){f(function(){var a=$(".menu-category").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"menu/ChangeMenuCategoryOrder",{list:a})},0)}},a.clearActive=function(){a.menuCategories&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1,_.each(a.menus,function(a){a.active=!1})})},a.closeAll=function(b){var c=b.open;a.menuCategories&&!a.editMode&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1}),b.open=!c,b.active=!c},a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode,$("div[ui-sortable=sortableOptions]").sortable("option","disabled",!a.editMode),$("div[ui-sortable=sortableCatOptions]").sortable("option","disabled",!a.editMode),a.editMode?$(".icon.sort").transition("set looping").transition("pulse"):$(".icon.sort").transition("remove looping")},a.isFullscreen=$("#isFullscreen").val(),a.fullscreenToggle=function(){a.isFullscreen=!a.isFullscreen,v(),dashboard.resize(),b.get(app.urlPrefix+"api/users/toogleFullscreen?isFullScreen="+a.isFullscreen),a.isFullscreen||(app.autoPlay("stop"),a.slidePlay=!1)},a.slidePlayToggle=function(){a.slidePlay=!a.slidePlay,a.slidePlay?app.autoPlay("start",dashboard.PageSwiching||10):app.autoPlay("stop")},a.addChart=function(){o.select(null,{type:["charts"]}).then(function(a){var b=_.map(a.selected,function(a){return a.id});b.forEach(function(a){var b=app.urlPrefix+"api/dashboards/addChartToPage";$.get(b,{chartId:a,pageId:dashboard.pageId},function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1)})})})},a.$on("$locationChangeStart",function(b,c,d){if(/\/app\/\d+\/dashboard\/\d+/.test(e.path())){var f=+e.path().replace(/\/app\/\d+\/dashboard\/(\d+)/gi,"$1");a.clearActive(),a.menuCategories&&a.menuCategories.data&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.active=!0,a.open=!0,b.active=!0)})})}}),a.modal={body:c.trustAsHtml(""),btnClass:"btn-primary",btnText:"ذخیره",inProgress:!1},a.addFormSettings={},a.onFormSelect=function(b){a.addFormSettings.loaging=!0,k.addFormToDashboard(dashboard.pageId,b.map(function(a){return a.id})).then(function(c){a.addFormSettings.loaging=!1,a.addFormSettings.visible=!1,_.each(b,function(a){var b=_.extend({},a);b.type="form",dashboard.charts.push(b),dashboard.addChart(b)})})},a.hideModal=function(){u()},a.addMenuToCategory=function(f){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var g=app.urlPrefix+"Charts/DashboardPage/addMenu";b.post(g,{menuName:a.modal.val,menuCategory:f.category.Id,mainMenu:d.appid,menulink:""}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),$("#dashboard-page-modal").modal("hide"),f.menus=f.menus||[],f.menus.push(b.data),e.path("/app/"+d.appid+"/dashboard/"+b.data.menu.Id),u()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.editCategory=function(e){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,label:app.lang.translate("نام جدید را وارد کنید"),val:e.category.Name,ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var f=app.urlPrefix+"Charts/DashboardPage/editMenu";b.post(f,{menuName:a.modal.val,menuCategory:e.category.Id,mainMenu:d.appid}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),e.category.Name=b.data.Name,u()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.deleteCategory=function(d,e){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، گروه <b>"+d.category.Name+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال حذف...");var f=app.urlPrefix+"Charts/DashboardPage/deleteMenu";b.post(f,{menuCategory:d.category.Id}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),a.menuCategories.data.splice(e,1),u()},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.editMenu=function(d,e){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,val:d.menu.Name,label:app.lang.translate("نام جدید را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var e=app.urlPrefix+"Charts/DashboardPage/editMenu";b.post(e,{menuName:a.modal.val,menuId:d.menu.Id}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),d.menu.Name=b.data.Name,u()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.deleteMenu=function(f,g,h){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، منوی <b>"+f.menu.Name+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف...");var i=app.urlPrefix+"Charts/DashboardPage/deleteMenu";b.post(i,{menuId:f.menu.Id}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),g.menus.splice(h,1),u();var c=$(".side-menu-item-child").data("id");e.path("/app/"+d.appid+"/dashboard/"+c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.duplicateMenu=function(a,c){b.post(app.urlPrefix+"menu/DuplicateMenu",{Id:a.menu.Id}).then(function(a){c.menus=c.menus||[],c.menus.push(a.data.item),u()},function(a){alert(a.data)})},a.addCat=function(){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var e=app.urlPrefix+"Charts/DashboardPage/addMenu";b.post(e,{menuName:a.modal.val,mainMenu:d.appid}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,$("#dashboard-page-modal").modal("hide"),a.menuCategories=a.menuCategories||{},a.menuCategories.data=a.menuCategories.data||[];var c={category:{Id:b.data.menu.Id,MainMenuId:b.data.menu.MainMenuId,Name:b.data.menu.Name,Type:b.data.menu.Type},hasAddPer:!0,hasDeletePer:!0,hasEditPer:!0,open:!0,menus:[]};a.menuCategories.data.push(c),u()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(b.data))})}},t()},a.closeSidebar=function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("hide")},a.cancelRequests=function(){for($(".chart-data").each(function(){var a=$(this).data("ajaxRequest");a&&a.abort()});dashboard.addTasks.length;){var a=dashboard.addTasks.pop();clearTimeout(a)}},$(".toc-toggle").on("click",function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("toggle")}),$(window).resize(function(){v()}),v()}]),ngApp.service("dashboardContainerService",function(){function a(a){console.log("### call renderBody"),a()}return{renderBody:a}}),ngApp.controller("dashboardPageBodyCtrl",["$scope","$http","$sce","$routeParams","navbar","$rootScope","$timeout","drawer","$q","$rootScope","dashboardContainerService",function(a,b,c,d,e,f,g,h,i,f,j){function k(){a.progress=!0,b({method:"GET",url:m,timeout:dashboard.canceler.promise}).then(function(b){a.progress=!1;var c=$(window).width()<=723,e=!c&&b.data.arrangePer;if(document.title=b.data.name,console.log("$scope.$parent",a.$parent),a.$parent&&(a.$parent.name=b.data.name),l(b.data,e),a.paramkey){var g=JSON.parse(localStorage.getItem("filter-params")||"[]");app.chartCommons.clearFilterParamsCache(g);var h=_.find(g,{dash:+d.id,key:d.paramkey});h&&(app.chartCommons.drillDown.filters=h.data.drillDown,app.chartCommons.userFilter.filters=h.data.userFilter)}f.$broadcast("app-filterbox-refresh"),f.$broadcast("publish-url",{url:b.data.publishUrl}),f.$broadcast("permission-change",e),b.data.ForceChangePass&&$(".ui.modal#change-pass").modal("setting","closable",!1).modal("show")})["catch"](function(b){a.progress=!1,3===b.data.type?$("#update-message").transition("in scale"):$("#no-page-message").transition("in scale");
})}function l(a,b){$("body").removeClass("full-height-container"),$(".main-container").addClass("full-height-container"),app.chartCommons.userFilter.setUserControlFilters(a.userControlFilters),app.chartCommons.drillDown.clearAll(),dashboard.setInfo(a.charts,a.pageInfo,a.pageId,b,a.forms),dashboard.PageSwiching=a.PageSwiching,app.dashboardLayoutVersion=2;app.urlPrefix+"charts/dashboardpage/setchartsorder";app.moderation.dashboadpage.isRelated=!1,fixLayout(!0)}a.app=app,h.close(),a.model="param: "+d.id,a.paramkey=d.paramkey;var m=app.urlPrefix+"api/dashboards/get/"+d.id;dashboard.canceler&&dashboard.canceler.resolve("http call aborted"),dashboard.canceler=i.defer(),j.renderBody(k)}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/app/:appid/dashboard/:id/:paramkey?",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardBody.html?v="+app.version,controller:"dashboardPageBodyCtrl"}).otherwise({redirectTo:"/nothings"})}]),jQuery.fn.createModal=function(a){$el=$(this),0==$el.length&&($el=$("#content_segmentModal")),$el.find("#"+a.id).remove();var b="undefined"!=typeof a.okId?' id="'+a.okId+'" ':"",c="undefined"!=typeof a.okFun?' onclick="'+a.okFun+'" ':"";"undefined"!=typeof a.okFunObj&&(c="");var d=' <div class="modal '+("undefined"==typeof a.Fade||a.Fade?"fade":"")+'" id="'+a.id+'" tabindex="-1" role="dialog" aria-labelledby="'+a.id+'Label" aria-hidden="true">          <div class="modal-dialog">                                                                                                       <div class="modal-content">                                                                                                      <div class="modal-header">                                                                                                       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                                 <h4 class="modal-title">'+a.title+'</h4>                                                                       </div>                                                                                                                       <div class="modal-body">                                                                                                         '+a.body+'                                                                                                     </div>                                                                                                                       <div class="modal-footer">                                                                                                      '+("undefined"!=typeof a.cancelText?' <button type="button" class="btn btn-default" data-dismiss="modal" >'+a.cancelText+"</button>":"")+"                        "+("undefined"!=typeof a.okText?'<button type="button" class="btn '+a.okClass+' okbtn" data-dismiss="modal" '+c+b+">"+a.okText+"</button>":"")+"</div>                                                                                                                   </div>                                                                                                                       <!-- /.modal-content -->                                                                                                 </div>                                                                                                                       <!-- /.modal-dialog -->                                                                                                  </div>                                                                                                                       <!-- /.modal -->                                                                                                                     ",e=$(d);e.appendTo($el),"undefined"!=typeof a.okFunObj&&e.find(".okbtn").on("click",function(){a.okFunObj()}),"undefined"==typeof a.id||"undefined"!=typeof a.onKey&&!a.onKey||($("#"+a.id).on("keypress",function(b){13===b.keyCode&&(b.preventDefault(),$("#"+a.id+" .okbtn").click())}),$("#"+a.id).on("shown.bs.modal",function(){$("#"+a.id+" input").first().focus()}))},app=app||{},app.globalVariableHelper={},app.globalVariableHelper.updateGlobalVariables=function(a,b,c){return},app.globalVariableHelper.createModalRow=function(a){var b=$(app.globalVariableHelper.addModalRow);return a&&b.find(".default-value").val(a),b.find(".btn-plus").on("click",function(){var a=app.globalVariableHelper.createModalRow(this);$(this).parents(".form-group").after(a)}),b.find(".btn-minus").on("click",function(){$(this).parents(".form-group").remove()}),b},app.globalVariableHelper.AddGlobalVariables=function(a){var b=$(app.globalVariableHelper.addModal);$("#gb-modal").remove(),b.find(".row-container").append(app.globalVariableHelper.createModalRow()),app.contentSegmentModal.append(b),$("#gb-modal .btn-primary").on("click",function(){var b={Name:$("#gb-modal input.name").val(),Scope:$("#gb-modal select.scope").val(),DefaultValue:$("#gb-modal input.default-value").map(function(){return $(this).val()}).toArray()};$.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/Add",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(b){b.result?a(b):alert(b.Message)}})}),$("#gb-modal").modal("show")},app.globalVariableHelper.EditGlobalVariables=function(a,b){var c=$(app.globalVariableHelper.addModal);$("#gb-modal").remove(),c.find("input.name").val(a.Name),c.find("select.scope").val(a.Scope),c.find(".btn-primary").text("تغییر");var d=JSON.parse(a.DefaultValue||'[""]');d&&0!=d.length||(d=[""]),d.forEach(function(a){var b=app.globalVariableHelper.createModalRow(a);c.find(".row-container").append(b)}),app.contentSegmentModal.append(c),$("#gb-modal .btn-primary").on("click",function(){var c={Id:a.Id,Name:$("#gb-modal input.name").val(),Scope:$("#gb-modal select.scope").val(),DefaultValue:$("#gb-modal input.default-value").map(function(){return $(this).val()}).toArray()};$.ajax({type:"POST",url:app.urlPrefix+"Moderation/GlobalVariable/Add",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(c),success:function(a){a.result?b(a):alert(a.Message)}})}),$("#gb-modal").modal("show")},app.globalVariableHelper.addModal='<div class="modal fade" id="gb-modal" tabindex="-1" role="dialog" aria-labelledby="gb-modal-label" aria-hidden="true                style="font-size: 14px; text-align: justify;">                <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">                            <span aria-hidden="true">&times;</span><span class="sr-only">بستن</span></button>                        <h4 class="modal-title" id="gb-modal-label">ساخت متغیر سراسری</h4>                    </div>                <div class="modal-body">                    <p>                        این متغیر برای تمامی کاربران قابل اعمال است.                                        .نام متغیر نباید شامل علامت باشد و باید ترکیبی از حروف و اعداد باشد                    </p>                    <div class="form-horizontal">                        <div class="form-group">                            <label class="col-sm-4" style="font-weight: bold;">نام متغیر: </label>                            <div class="col-sm-8">                                <input type="text" class="form-control name" placeholder="نام متغیر" />                            </div>                        </div>                        <div class="form-group">                            <label class="col-sm-4" style="font-weight: bold;">حوزه اعتبار: </label>                            <div class="col-sm-8">                                <select class="form-control scope" >                                <option value="0">تمام صفحات</option>                                <option value="1" selected="selected">صفحه جاری</option>                                </select>                            </div>                        </div>                        <div class="row-container"></div>                    </div>                                          </div>                                                                                                                                                   <div class="modal-footer">                    <button type="button" class="btn btn-default" data-dismiss="modal">بستن</button>                    <button type="button" class="btn btn-primary" data-dismiss="modal">ساختن</button>                </div>            </div>        </div>    </div>',app.globalVariableHelper.addModalRow='            <div class="form-group modal-row">                <label class="col-sm-4" style="font-weight: bold;">مقدار پیش‌فرض: </label>                <div class="col-sm-5">                    <input type="text" class="form-control default-value" placeholder="مقدار پیش‌فرض" />                </div>                <div class="col-md-3">                    <div class="btn-group btn-group-justified">                        <a type="button" class="btn btn-default btn-plus"><span class="glyphicon glyphicon-plus"></span></a>                        <a type="button" class="btn btn-default btn-minus"><span class="glyphicon glyphicon-minus"></span></a>                    </div>                </div>            </div>';var app=app||{};app.packages={},app.packages.controller={scopes:{CHARTS:1,DATASOURCES:2},add:function(a,b,c,d,e){$.ajax({url:app.urlPrefix+"Moderation/Package/Create",data:JSON.stringify({name:a,scope:b,parentId:d,permissions:c,isEdit:isEdit}),type:"POST",dataType:"json",contentType:"application/json",traditional:!0,success:function(a){a.result?e&&e():alert(a.message)}})},getRoles:function(a){app.post(app.urlPrefix+"Moderation/Package/GetRoles",null,a)}},app.packages.view={createPackage:function(a,b,c){var d=$(app.packages.view.createModal);app.contentSegmentModal.append(d),d.modal("show"),d.on("shown.bs.modal",function(){d.find("#name").focus()}),d.find("#name").keyup(function(a){13==a.keyCode&&d.find(".btn-primary").click()}),d.find(".btn-primary").addClass("disabled"),app.packages.controller.getRoles(function(e){var f=e.roles||[];d.find(".btn-primary").removeClass("disabled");var g="<h3>نقش‌ها</h3><form id='packages-permission' style='height: 180px; overflow-y: scroll;'> <table class='table table-hover '>";f.forEach(function(a){g+="<tr>           <td>                                                                                                                                     <label style='font-weight: normal; font-size: 1em;'>                                                                                     <input type='checkbox' name='Roles' value='"+a.Id+"' >                                                                          "+a.RoleName+"                                                                                                              </label>                                                                                                                         </td>                                                                                                                                <td>                                                                                                                                     <select class='form-control' name='ChartActions'>                                                                                        <option value='1-"+a.Id+"' >مشاهده</option>                                        <option value='2-"+a.Id+"'>مشاهده و ویرایش</option>                               <option value='4-"+a.Id+"' >مشاهده، ویرایش و حذف</option>                   </select>                                                                                                                        </td>                                                                                                                            </tr>"}),g+="</form>",d.find("#progress").hide(),d.find(".modal-body").append(g),app.packages.view.showPermissionChoise("#package-modal .modal-body"),d.find(".btn-primary").on("click",function(){var e=d.find("#packages-permission").serializeArray();e&&(e=e.filter(function(a){return"ChartActions"==a.name}).map(function(a){return a.value})),$(this).button("loading");var f=d.find("#name").val();app.post(app.urlPrefix+"Moderation/Package/Create",{name:f,scope:a,parentId:b,permissions:e},function(a){d.find(".btn-primary").button("reset"),d.modal("hide"),c(a)})})})},editPackage:function(a,b){var c=$(app.packages.view.createModal);app.contentSegmentModal.append(c),c.modal("show"),c.on("shown.bs.modal",function(){c.find("#name").focus();var a=c.find("#name").val().length;c.find("#name").get(0).setSelectionRange(a,a)}),c.find("#name").keyup(function(a){13==a.keyCode&&c.find(".btn-primary").click()}),c.find(".btn-primary").addClass("disabled"),c.find(".btn-primary").html("ویرایش"),app.post(app.urlPrefix+"Moderation/Package/GetInfo",{id:a},function(d){var e=d.roles||[];c.find(".btn-primary").removeClass("disabled");var f="<h3>نقش‌ها</h3><form id='packages-permission' style='height: 180px; overflow-y: scroll;'> <table class='table table-hover '>";if(e.forEach(function(a){f+="<tr>           <td>                                                                                                                                     <label style='font-weight: normal; font-size: 1em;'>                                                                                     <input type='checkbox' name='Roles' value='"+a.Id+"' >                                                                          "+a.RoleName+"                                                                                                              </label>                                                                                                                         </td>                                                                                                                                <td>                                                                                                                                     <select class='form-control' name='ChartActions'>                                                                                        <option value='1-"+a.Id+"' >مشاهده</option>                                        <option value='2-"+a.Id+"'>مشاهده و ویرایش</option>                               <option value='4-"+a.Id+"' >مشاهده، ویرایش و حذف</option>                   </select>                                                                                                                        </td>                                                                                                                            </tr>"}),f+="</form>",c.find("#progress").hide(),c.find(".modal-body").append(f),app.packages.view.showPermissionChoise("#package-modal .modal-body"),d.info&&d.info.actions){var g=d.info.actions||[];g.forEach(function(a){c.find("option[value="+a.Action+"-"+a.RoleId+"]").attr("selected","selected").parents("tr").find("input").click()})}c.find("#name").val(d.info.Name),c.find(".btn-primary").on("click",function(){var d=c.find("#packages-permission").serializeArray();d&&(d=d.filter(function(a){return"ChartActions"==a.name}).map(function(a){return a.value}));var e=c.find("#name").val();c.find(".btn-primary").data("loading-text","در حال تغییر"),c.find(".btn-primary").button("loading"),app.post(app.urlPrefix+"Moderation/Package/Edit",{id:a,name:e,permissions:d},function(a){c.find(".btn-primary").button("reset"),c.modal("hide"),b(a)})})})},showPermissionChoise:function(a){function b(a,b){a?b.find("select").css("visibility","visible").attr("disabled",null):b.find("select").css("visibility","hidden").attr("disabled","")}$(a+" tr input").each(function(){b($(this).prop("checked"),$(this).closest("tr"))}),$(a+" tr input").change(function(){b(this.checked,$(this).closest("tr"))}),$(a+" table thead input").change(function(){var a=this.checked;$(this).closest("table").find("tr input").each(function(){$(this).prop("checked",a),b(this.checked,$(this).closest("tr"))})})},selectPackage:function(a,b,c){var d=$(app.packages.view.selectPackageModal);$("body #package-modal").remove(),$("body").append(d),d.modal("show"),app.post(app.urlPrefix+"Moderation/Package/GetPackages",{scope:a,withContent:c},function(a){d.find("#progress").hide(),d.find(".content").html(a.packages),d.find(".content>ul").css("direction","ltr"),d.find(".content>ul").selectable({filter:".select-package",selecting:function(a,b){!c&&d.find(".ui-selected, .ui-selecting").length>1&&$(b.selecting).removeClass("ui-selecting")}}),d.find(".content>ul").treeview({animated:"fast",collapsed:!0,toggle:function(){}}),d.find(".btn-primary").on("click",function(){var a=d.find(".ui-selected"),c=a.map(function(a){return $(this).data("id")}).toArray();b&&b(c,{hide:function(){d.modal("hide")},setLoading:function(){d.find(".btn-primary").addClass("loading")}})})})},createModal:'<div class="modal fade" id="package-modal" tabindex="-1" role="dialog" aria-labelledby="gb-modal-label" aria-hidden="true                style="font-size: 14px; text-align: justify;">                <div class="modal-dialog">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal">                            <span aria-hidden="true">&times;</span><span class="sr-only">بستن</span></button>                        <h4 class="modal-title" id="gb-modal-label">ساخت پوشه جدید</h4>                    </div>                <div class="modal-body" >                    <div class="form-group">                        <label for="chartTitleFarsi" class="col-md-4 control-label">نام پوشه:</label>                        <div class="col-md-8" style="margin-bottom: 30px;"><input id="name" class="form-control"placeholder="نام پوشه" /></div>                    </div>                    <div id="progress" >                        <img style="width: 1.3em" src="'+app.urlPrefix+'Images/progress.gif" />                        در حال بارگذاری . . .                    </div>                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-default" data-dismiss="modal">انصراف</button>                    <button type="button" class="btn btn-primary" data-loading-text="در حال ساختن...">ساختن</button>                </div>            </div>        </div>    </div>',selectPackageModal:'<div class="ui modal small" id="package-modal">    <i class="close icon"></i>    <div class="header">فیلتر کردن مقادیر</div>    <div class="content" style="height: 180px; overflow-y: scroll;">        <div class="ui active inverted dimmer"><div class="ui text loader">در حال بارگذاری</div></div></div>    <div class="actions">        <button type="button" class="ui button deny black" >انصراف</button>        <button type="button" class="ui button green btn-primary" >انتخاب</button>    </div></div>'},$.fn.tableSortable=function(a){var b=$(this);b.find("th").addClass("pointer").on("click",function(c,d){var d=$(this).index()+1,e=b.find("tbody tr");a&&(e=e.not(a));var f=$(this).data("isdesc");"undefined"==typeof f&&(f=!0),$(this).data("isdesc",!f),e.sort(function(a,b){var c=depersian($(a).find("td:nth-child("+d+")").text()),e=depersian($(b).find("td:nth-child("+d+")").text());return f?/^[0-9.]+$/.test(c)?d3.descending(+c,+e):d3.descending(c,e):/^[0-9.]+$/.test(c)?d3.ascending(+c,+e):d3.ascending(c,e)}),e.remove(),b.append(e)})},$.fn.tableBindSearchbox=function(a,b){var c=$(this),a=a instanceof $?a:$(a);a.keyup(function(){var a=$(this).val(),d=c.find("tbody tr");b&&(d=d.not(b)),d.each(function(){$(this).text().toLocaleLowerCase().indexOf(a.toLocaleLowerCase())==-1?$(this).hide():$(this).show()})})},jQuery.fn.progressbar=function(a,b){function c(){var a=d3.interpolate(0,h);return function(b){return j.endAngle(a(d3.easeLinear(b)))()}}if("stop"==a)return void d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var d=+a||25,e=d/5,f=2*d,g=2*d,h=2*Math.PI,i=+b||1e4,j=d3.arc().startAngle(0).innerRadius(d-e).outerRadius(d);d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var k=d3.select($(this).get(0)).append("svg").attr("width",f).attr("height",g).attr("class","sadaf-circular-timeout").append("g").attr("transform","translate("+f/2+","+g/2+")"),l=k.append("g").attr("class","progress-meter");l.append("path").attr("class","background").style("fill","#666").style("opacity","0.2").attr("d",j.endAngle(h));var m=l.append("path").style("fill","#212121").attr("class","foreground");m.attr("d",j.endAngle(0*h)),m.transition().duration(i).attrTween("d",c)},$.extend($.datepicker,{_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+(c?0:$(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:$(document).scrollTop());return b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0),b.top<50&&(b.top=55),b}});var app=app||{};app.escapeBraket=function(a){return a.replace("[","\\\\[").replace("]","\\\\]")};var ngApp=angular.module("sadafMain",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services"]);ngApp.controller("dashboardMainPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","$translate","mainmenus","mostRecentMenus",function(a,b,c,d,e,f,g,h,i){function j(){var b=d.id||0;a.appLoading=!0,h.get(b).then(function(b){a.apps=b.data.list,a.isAdmin=b.data.isAdmin,a.brand=b.data.brand,a.path=_.reverse(b.data.parents),a.appLoading=!1,_.each(a.apps,function(a){var b=k();a.detail=JSON.parse(a.detail||"{}"),a.detail.startColor||(a.detail.startColor=b[0]),a.detail.endColor||(a.detail.endColor=b[1]),a.detail.pic||(a.detail.pic=n)})})["catch"](function(){a.appLoading=!1})}function k(){var a=[["#03A9F4","#0277BD"],["#e91e63","#ad1457"],["#f44336","#b71c1c"],["#009688","#00695c"],["#ff9800","#ef6c00"],["#ffeb3b","#f9a825"],["#dce775","#c0ca33"],["#aed581","#7cb342"],["#ba68c8","#8e24aa"]],b=a[Math.ceil(8*Math.random())];return b}function l(){var a=k(),b=d.id||0,c={id:0,edit:!0,detail:{startColor:a[0],endColor:a[1],pic:n},parent:b,permissions:{ViewPermission:!0,EditPermission:!0,DeletePermission:!0}};return c}function m(){i.get().then(function(b){a.mostRecentMenus=b.data.list})["catch"](function(){})}a.mainMenuType=2,a.gApp=app,g.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),$(".dropdown.userinfo").dropdown();var n="data:image/png;base64,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";
$(".ui.dimmer.modals .mainmenu-permission").remove(),a.roles=[],m(),a.add=function(){var b=l();a.apps.push(b)},a.save=function(a,b){a.progress=!0,h.save(a).then(function(c){a.progress=!1,a.id=c.data.id,a.name=c.data.name,a.detail=c.data.detail,a.editDesc=!1,a.edit=!1,b&&b(a)})["catch"](function(){a.progress=!1})},a.keyup=function(b,c){13==b.keyCode&&a.save(c),27==b.keyCode&&(c.edit=!1)},a.edit=function(a){a.edit=!0,f(function(){$(".app-"+a.id+" input").focus()},0)},a.editDesc=function(a){a.editDesc=!0,f(function(){$(".app-"+a.id+" textarea").focus()},0)},a.remove=function(b,c){var d=confirm("آیا برای حذف اطمینان دارید؟");if(d){if(!b.id)return void a.apps.splice(c,1);b.progressTrash=!0,h.remove(b.id).then(function(d){b.progressTrash=!1,a.apps.splice(c,1)})["catch"](function(){b.progressTrash=!1})}},a.settings=function(a,b){a.render||(a.render=!0,$(".app-"+a.id+" .popup-btn").popup({transition:"flip vertical",on:"click",popup:$(".app-"+a.id+" .setting-popup")}),$(".app-"+a.id+" .popup-btn").click())},a.previewFile=function(b,c){var d=b.files[0];if(d.size>35e3)return void alert("حجم فایل باید کمتر از ۳۵ کیلو بایت باشد");var e=new FileReader,g=$(b).attr("index");e.addEventListener("load",function(){f(function(){var b=a.apps[g];b.detail.pic=e.result,a.save(b)},0)},!1),d&&e.readAsDataURL(d)},a.search=function(b){console.log("### query ",b),b&&b.trim()||(a.searchResult=null,j()),b.length<3||(a.searchProgress=!0,h.search(b).then(function(b){a.searchProgress=!1,a.searchResult=b.data})["catch"](function(){a.searchProgress=!1}))},a.addChild=function(b){var c=l();c.name="پروژه جدید",c.parent=b.id,a.save(c,function(a){e.path("/"+a.parent)})},a.$on("$routeChangeSuccess",function(){j()}),a.conf={id:0},a.showSettings=function(b){a.conf.id=b.id,$(".mainmenu-permission").modal("show"),$(".app-"+b.id+" .popup-btn").popup("hide")},a.savePermissions=function(){a.savePerProgress=!0;var b=_.filter(a.roles,{check:!0}).map(function(a){return{id:a.id,action:a.action}});h.savePermissions(a.conf.id,b).then(function(){a.savePerProgress=!1,$(".mainmenu-permission").modal("hide")})["catch"](function(){a.savePerProgress=!1})}}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/:id",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardMainPage.html?v="+app.version,controller:"dashboardMainPageCtrl"}).otherwise({redirectTo:"/0"})}]),ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]),ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401===b.status&&(alert("زمان نشست شما به اتمام رسیده است. لطفا دوباره در برنامه لاگین کنید"),document.location="/account/login"),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);