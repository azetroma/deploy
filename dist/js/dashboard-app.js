// داشبورد مدیریتی صدف info@sadafdashboard.ir 

function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS)$/.test(a)}var ngApp=angular.module("navbarCat",["pascalprecht.translate","ngSanitize"]);ngApp.factory("navbar",["$rootScope",function(a){var b=null;return{getOption:function(){return b},setOption:function(c){b=c,a.$broadcast("navbarChange")}}}]),ngApp.factory("drawer",[function(a){var b={init:function(){if(!$("body #drawer-overlay").length){var a='<div class="drawer-overlay" id="drawer-overlay"></div>';$("body").append(a),$("body #drawer-overlay").on("click",this.close)}},toggle:function(){$("body").hasClass("drawer-open")?$("body").removeClass("drawer-open"):$("body").addClass("drawer-open")},close:function(){$("body").removeClass("drawer-open")}};return{init:b.init,toggle:b.toggle,close:b.close}}]),ngApp.controller("navbarCtrl",["$scope","$http","$rootScope","navbar","drawer","$translate",function(a,b,c,d,e,f){a.toggle=function(){e.toggle()},f.use(0==+$("#lang").val()?"fa":"en"),a.urlPrefix=app.urlPrefix}]),angular.module("uibCollapseCat",[]).directive("uibCollapse",["$animate","$q","$parse","$injector",function(a,b,c,d){var e=d.has("$animateCss")?d.get("$animateCss"):null;return{link:function(d,f,g){function h(){f.hasClass("collapse")&&f.hasClass("in")||b.resolve(l(d)).then(function(){f.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),e?e(f,{addClass:"in",easing:"ease",to:{height:f[0].scrollHeight+"px"}}).start()["finally"](i):a.addClass(f,"in",{to:{height:f[0].scrollHeight+"px"}}).then(i)})}function i(){f.removeClass("collapsing").addClass("collapse").css({height:"auto"}),m(d)}function j(){return f.hasClass("collapse")||f.hasClass("in")?void b.resolve(n(d)).then(function(){f.css({height:f[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),e?e(f,{removeClass:"in",to:{height:"0"}}).start()["finally"](k):a.removeClass(f,"in",{to:{height:"0"}}).then(k)}):k()}function k(){f.css({height:"0"}),f.removeClass("collapsing").addClass("collapse"),o(d)}var l=c(g.expanding),m=c(g.expanded),n=c(g.collapsing),o=c(g.collapsed);d.$eval(g.uibCollapse)||f.addClass("in").addClass("collapse").attr("aria-expanded",!0).attr("aria-hidden",!1).css({height:"auto"}),d.$watch(g.uibCollapse,function(a){a?j():h()})}}}]);var ngApp=angular.module("sadaf",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services","ngMaterial"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]);var logout=_.debounce(function(){alert("مهلت اعتبار ارتباط شما با سایت پایان یافته، لطفا دوباره وارد شوید"),document.location="/account/login"},1e3);ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401!==b.status||app.shareMode||logout(),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);var service=["$http","$interval",function(a,b){var c;return{start:function(){},stop:function(){b.cancel(c)}}}];try{var sadaf=angular.module("sadaf");sadaf.factory("heartBeat",service),sadaf.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}try{var management=angular.module("management");management.factory("heartBeat",service),management.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}var app=app||{};app.contentSegment=$("#content_segment"),app.contentSegmentModal=$("#content_segmentModal"),$.ajaxSetup({beforeSend:function(a,b){if(!csrfSafeMethod(b.type)&&!this.crossDomain){var c=$("input[name=__RequestVerificationToken]").val();a.setRequestHeader("__RequestVerificationToken",c)}}}),console||(console={},console.log=function(){}),app.chartLoadDelay=120,app.absoluteUrl="/",app.setAboluteUrl=function(a){app.absoluteUrl=a},app.loadContent=function(a){app.showLoadingProgress(),$("#content_segment").load(app.urlPrefix+a,function(){app.hideLoadingProgress(),app.lang.setLang()})},app.setContent=function(a){$("#content_segment").html(a),app.hideLoadingProgress(),app.lang.setLang()},app.setLocation=function(a){app.router.navigate(a,{trigger:!0})},app.urlPrefix="/",app.setUrlPrefix=function(a){app.urlPrefix=a.replace(/Moderation.*/g,"")},app.showInfo=function(a){$("#app-info-text").html(a),$("#app-info-text").fadeIn(),$("#app-loading-text").hide(),app.showInfoHolder.show(),setTimeout(function(){app.showInfoHolder.hide(),$("#app-info-text").fadeOut(400,function(){$("#app-loading-text").show()})},4e3)},app.showLoadingProgress=function(){app.showInfoHolder.show()},app.hideLoadingProgress=function(){app.showInfoHolder.hide()},app.showInfoHolder={holderCount:0,timeout:{},hide:function(){if(app.showInfoHolder.holderCount>0&&--app.showInfoHolder.holderCount,0==app.showInfoHolder.holderCount){var a=(new Date).getTime()-app.showInfoHolder.ticks;clearTimeout(app.showInfoHolder.timeout),setTimeout(function(){$("#app-loading").parent("div").animate({top:"0",opacity:0},400)},a<1e3?1e3:0)}},show:function(){var a=$("#app-loading").parent("div");a.css("left",$(window).width()/2-a.outerWidth()/2),++app.showInfoHolder.holderCount,app.showInfoHolder.ticks=(new Date).getTime(),app.showInfoHolder.timeout=setTimeout(function(){$("#app-loading").parent("div").animate({top:"50",opacity:1},400)},1e3)}},app.encodeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},app.convertOldPropObject=function(a,b){if(a){if(a.chartProp&&a.chartProp.info)return a;var c={};if(c.chartProp={},+b==chartTypes.TABLE){c.chartProp.info={chartSize:a.chartProp.chartSize,pivotTable:a.chartProp.pivotTable},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:a.seriesProp[""+d].table.headerName,numberFactor:"1",textAlign:a.seriesProp[""+d].table.textAlign,formatString:a.seriesProp[""+d].table.formatString,fontSize:a.seriesProp[""+d].table.fontSize,textBold:!1,textItalic:!1,color:a.seriesProp[""+d].table.fontColor}),c.chartProp.series["default"]={name:"",numberFactor:"1",textAlign:"right",formatString:"A",fontSize:"1m",textBold:!1,textItalic:!1,color:"#000000"}}if(+b==chartTypes.BAR){c.chartProp.info={chartSize:a.chartProp.chartSize,horizontalLines:a.chartProp.horizontalLine,formatString:a.chartProp.formatString},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:"",numberFactor:a.seriesProp[""+d].barlineChartProp.numberFactor,seriesType:a.seriesProp[""+d].barlineChartProp.barlineChartType,seriesColor:a.seriesProp[""+d].barlineChartProp.barlineChartColor,lineType:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartStyle,lineStyle:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineStyle,lineWeight:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineWeight,lineFace:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineDashes});c.chartProp.series["default"]={name:"",numberFactor:"1",seriesType:"bar",seriesColor:"#1f77b4",lineType:"line-dot-area",lineStyle:"linear",lineWeight:"2",lineFace:"5,0"}}return+b==chartTypes.PIE&&(c.chartProp.info={horizontalLines:a.chartProp.horizontalLine,chartSize:a.chartProp.chartSize,formatString:a.chartProp.formatString,pieStyle:a.chartProp.pieStyle,hole:"65"},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1"}),+b==chartTypes.GAUGE&&(c.chartProp.info={chartSize:a.chartProp.chartSize,style:a.chartProp.gaugeStyle,height:"medium",color:"#333333",fontSize:"3em",formatString:",.2f",status:"",target:"",textBold:!0,textItalic:!1,trend:"",value:"",segmentType:"singleSegment",min:"",yellow:"",green:"",max:""},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1",type:"value",typeMs:"value"}),c.dataUrl=a.chartProp.DataUrl,c.editMode=a.chartProp.editMode,c}},app.autoPlayTimer=app.autoPlayTimer||{counter:0},app.autoPlay=function(a,b){if(a&&"start"==a){var c=function(a){b=b||10,$(".sadaf-circular-preogress").progressbar(10,1e3*+b),app.autoPlayTimer.timer=setTimeout(function(){document.location.href=app.urlPrefix+"#/app/"+a.appId+"/dashboard/"+a.id,$(".sadaf-circular-preogress").progressbar("stop"),app.autoPlay("start",b)},1e3*+b)};app.autoPlayTimer.links?c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length]):$.get(app.urlPrefix+"api/menus/get").done(function(a){app.autoPlayTimer.links=a,c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length])})}a&&"stop"==a&&($(".sadaf-circular-preogress").progressbar("stop"),clearTimeout(app.autoPlayTimer.timer))};var resizeTimer;app.lestenWindowResize=function(a){function b(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){a()},400)}var c=$(window).width();$(window).resize(function(){$(window).width();$(window).width()!=c&&(c=$(this).width(),b())})};var designMenuTimer,printMenuTimer;app.onMenusClick=function(a,b){return"showPrintMenu"==a||"hidePrintMenu"==a?(clearTimeout(printMenuTimer),void(printMenuTimer=setTimeout(function(){"showPrintMenu"==a?$(".navbar .print-toggle").fadeIn():"hidePrintMenu"==a&&$(".navbar .print-toggle").fadeOut()},800))):(clearTimeout(designMenuTimer),designMenuTimer=setTimeout(function(){"showDesignMenu"==a?$(".navbar .design-toggle").fadeIn():"hideDesignMenu"==a&&$(".navbar .design-toggle").fadeOut(),b&&"showfullScreenMenu"==b?$(".navbar .fullscreen-toggle").parents(".pull-right").fadeIn():$(".navbar .fullscreen-toggle").parents(".pull-right").fadeOut()},800),void $("html,body").animate({scrollTop:0},"slow",function(){$(".side-menu").hasClass("open")&&$("#side-menu-toggle").click()}))},app.print={printSingle:function(a,b){var c=this.getWidgetHtml(a);app.print.print(c,b,null,null,a)},getWidgetHtml:function(a){var b=($(a).height(),$(a).width(),$(a).clone());b.find(".ui.dimmer .dimmer-info").html();b.find(".ui.dimmer ").remove(),b.find(".gs-resize-handle").remove(),b.find(" #sort_checkbox").remove(),b.find(" .comment").remove(),b.find(" .menu-bar").remove();var c=$("<div>").append(b).html();return c},printPage:function(){var a="",b=$("<div/>");b.append(a);$(".dashboard-page.active > a").text()},print:function(a,b,c,d,e){var f=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(f=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var g='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+f+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",h=window.open();h.window.onafterprint=function(){h.window.close()},h.document.write('<html><head><meta charset="utf-8"><title>'+b+"</title>"+g),h.document.write("</head><body>"),h.document.write(a),h.document.write("</body></html>"),h.document.close(),h.focus();try{var i=$(e).find("canvas")[0],j=h.document.getElementsByTagName("canvas")[0];j.width=i.width,j.height=i.height;var k=j.getContext("2d");k.drawImage(i,0,0)}catch(l){}setTimeout(function(){h.print(),h.window.onfocus=function(){}},400)},printHeaderFooter:function(a,b,c,d,e,f,g){function h(){return'<html>                                                                                                                        <head>                                                                         <meta http-equiv=Content-Type content="text/html; charset=unicode">    <title>'+b+"</title> "+j+"       <style>                                                                        body, html {                                                                   margin: 0;                                                                 direction: rtl;                                                            width: 21cm;                                                               font-family: IRMitra !important;                                           font-size: 21px;                                                           text-align: justify;                                                       color: black;                                                   }                                                                                                                                                            table.report-container {                                                       page-break-after: always;                                                  font-size:inherit;                                                         text-align: inherit;                                                   }                                                                                                                                                     thead.report-header {                                                          display: table-header-group;                                               background-color: #00000000;                                           }                                                                                                                                                     tfoot.report-footer {                                                          display: table-footer-group;                                               background-color: #00000000;                                           }                                                                                                                                                     .back {                                                                        position: fixed;                                                           top: 0;                                                                    z-index: -1;                                                           }                                                                                                                                                     u {                                                                            text-decoration: unset;                                                    border-bottom: 1px solid black;                                            line-height: 1;                                                            display: inline-block;                                                 }                                                                          .content {                                                                     width: 21cm;                                                               padding: 0 2cm;                                                        }                                                                                                                                                         .content p {                                                                   margin: 0;                                                                 line-height:1.9;                                                           margin-bottom: 10px;                                                   }                                                                                                                                                 @page {                                                                        margin: 0cm;                                                           }                                                                                                                                                                                                                                .center {                                                                      text-align: center;                                                    }                                                                                                                                                     .flex {                                                                        display: flex;                                                             -ms-flex-direction: row;                                                   -webkit-flex-direction: row;                                               flex-direction: row;                                                   }                                                                      </style>                                                               </head>                                                                                                                                               <body>                                                                         "+(e?'<img class="back" src="/api/upload/getPic/'+e+'" />':"")+'                                                                 <table class="report-container">                                                                <thead class="report-header">                                                                   <tr>                                                                                            <th>                                                                                            <div style="height:'+(f||3)+'cm">                                                                                       </div>                                                                                  </th>                                                                                   </tr>                                                                                   </thead>                                                                                    <tfoot class="report-footer">                                                                   <tr>                                                                                            <td>                                                                                            <div style="height:'+(g||3)+'cm">                                                                                       </div>                                                                                  </td>                                                                                   </tr>                                                                                   </tfoot>                                                                                    <tbody class="report-content">                                                                  <tr>                                                                                            <td>                                                                                            <div class="content"> '+a+"</div>                                                                                  </td>                                                                                   </tr>                                                                                   </tbody>                                                                                </table>                                                                                </body>                                                                                     </html>"}var i=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(i=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var j='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+i+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",k=window.open();k.window.onafterprint=function(){k.window.close()},k.document.write(h()),k.document.close(),k.focus(),setTimeout(function(){k.print(),k.window.onfocus=function(){}},400)}},app.post=function(a,b,c){$.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json; charset=utf-8",traditional:!0,success:c})},app.lang={langType:0,setLangTyle:function(a){this.langType=+(a||0)},isRtl:function(){return 0==app.lang.langType},translate:function(a){return app.lang.lang?app.lang.lang[a]||a:a},q:[],translateAsync:function(a,b){app.lang.lang?b&&b(app.lang.lang[a]||a):this.q.push({key:a,callback:b})},setLang:function(a){if(a&&a.data&&(this.lang=a.data),this.lang||!this.inProgress){if(!this.lang&&!this.inProgress){var b=0==app.lang.langType?"fa":"en";this.inProgress=!0;var c=app.urlPrefix+"dist/locales/locale-"+b+".js?v="+app.version;return void $.getJSON(c,null,function(a){for(app.lang.setLang({data:a});app.lang.q.length>0;){var b=app.lang.q.pop();b.callback&&b.callback(app.lang.lang[b.key]||b.key)}})}var d;d=a&&a.selector?$(a.selector).find("*[data-trans-key]"):$("*[data-trans-key]"),d.each(function(){var a=$(this),b=a.data("translated");if(!b){var c=app.lang.lang[a.data("trans-key")],d=a.data("trans-attr");d?a.attr(d,c):a.text(c),a.data("translated",!0)}})}}};var app=app||{};app.filterBox=angular.module("filterBox",["ngAnimate"]),app.filterBox.controller("filterBoxController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){$("#filter-box-controller").data("scope",a),e.$on("app-filterbox-refresh",function(){a.refresh()}),a.getCleanValue=function(a){var b=/.*&\[(.*)\]/gi;return a.match(b)&&(a=a.replace(b,"$1")),a},a.refresh=function(){d(function(){a.otherFilters=[],_.forEach(app.chartCommons.drillDown.filters,function(b){_.forEach(b.drillDown,function(c){a.otherFilters.push({key:c.key,keyCaption:JSON.parse(c.key).join(", "),value:c.value,valueCaption:JSON.parse(c.value).join(", "),chartInPageId:b.chartInPageId,datasourceId:b.datasourceId,refreshDatasource:b.refreshDatasource})})}),a.userControlFilter=[],app.chartCommons.userFilter.filters.forEach(function(b){function d(a){switch(a){case"GetDate":return"امروز";case"MonthToDate":return"از ابتدای ماه تا امروز";case"YearToDate":return"از ابتدای سال تا امروز";case"minData":return"کمترین: "+b.defaultValue[0];case"maxData":return"بیشترین: "+b.defaultValue[0];case"DaysAgo":return persian(b.values[2]||0)+" روز قبل تا "+persian(b.values[3]||0)+" روز قبل";case"MonthAgo":return persian(b.values[2]||0)+" ماه قبل تا "+persian(b.values[3]||0)+" ماه قبل"}return""}var e={};e.key=b.dimensionName,e.disableClear=b.disableClear,e.chartInPageId=b.chartInPageId,b.valuesCaption?e.values=_.map(b.valuesCaption,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a}):e.values=_.map(b.values,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a});var f=e.values.join(", ");if(f.length>30&&(f=f.substring(0,30)+"..."),e.Caption=c.trustAsHtml(filterXSS(f)),3==+b.variableType)e.Caption=c.trustAsHtml(filterXSS(d(b.values[0])));else if(4==+b.variableType){var g={gr:"بزرگتر",eqgr:"بزرگتر مساوی",ls:"کوچکتر",eqls:"کوچکتر مساوی",eq:"برابر",nteq:"نابرابر"};e.Caption=c.trustAsHtml(filterXSS("<b>"+g[b.values[1]]+"</b> "+b.values[0]))}else 5==+b.variableType&&(e.Caption=c.trustAsHtml(filterXSS("<b>"+b.values[0]+"</b>"+("or"==b.values[1]?" در یکی از ":" در همه ")+": "+b.values[2])));e.refreshDatasource=b.refreshDatasource,e.label=e.key,7==+b.variableType&&(e.label="نام شاخص"),a.userControlFilter.push(e)})},0)},a.removeUserControl=function(b){var c=a.userControlFilter[b];a.userControlFilter.splice(b,1);var d=_.find(app.chartCommons.userFilter.filters,{chartInPageId:c.chartInPageId,dimensionName:c.key});_.isUndefined(d)||_.remove(app.chartCommons.userFilter.filters,d);var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f,0,e?e.chartProp.info.groups:null)},a.removeDrillDown=function(b){var c=a.otherFilters[b];a.otherFilters.splice(b,1);var d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:c.chartInPageId});_.isUndefined(d)||_.remove(d.drillDown,{key:c.key});var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f,0,e.chartProp.info.groups)},a.clearAll=function(){var b=[];_.each(a.otherFilters,function(a){var c=$("#ID"+a.chartInPageId).data("settings");c&&c.input&&_.isArray(c.input.RefreshDatasource)&&(b=_.concat(b,c.input.RefreshDatasource))}),_.each(a.userControlFilter,function(a){var c=$("#ID"+a.chartInPageId).data("settings");_.isArray(c&&c.input&&c.input.RefreshDatasource)&&!a.disableClear&&(b=_.concat(b,c.input.RefreshDatasource))}),app.chartCommons.drillDown.clearAll(!0),app.chartCommons.userFilter.filters=_.filter(app.chartCommons.userFilter.filters,{disableClear:!0}),a.refresh(),app.moderation.dashboadpage.refreshRelatedDatasources(_.uniq(b),0,"",!0)}}]),app.filterBox.refresh=function(){var a=angular.element("#filter-box-controller").scope();a||(a=$("#filter-box-controller").data("scope")),a&&(a.refresh(),a.$apply())},jQuery.fn.createModal=function(a){$el=$(this),0==$el.length&&($el=$("#content_segmentModal")),$el.find("#"+a.id).remove();var b="undefined"!=typeof a.okId?' id="'+a.okId+'" ':"",c="undefined"!=typeof a.okFun?' onclick="'+a.okFun+'" ':"";"undefined"!=typeof a.okFunObj&&(c="");var d=' <div class="modal '+("undefined"==typeof a.Fade||a.Fade?"fade":"")+'" id="'+a.id+'" tabindex="-1" role="dialog" aria-labelledby="'+a.id+'Label" aria-hidden="true">          <div class="modal-dialog">                                                                                                       <div class="modal-content">                                                                                                      <div class="modal-header">                                                                                                       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                                 <h4 class="modal-title">'+a.title+'</h4>                                                                       </div>                                                                                                                       <div class="modal-body">                                                                                                         '+a.body+'                                                                                                     </div>                                                                                                                       <div class="modal-footer">                                                                                                      '+("undefined"!=typeof a.cancelText?' <button type="button" class="btn btn-default" data-dismiss="modal" >'+a.cancelText+"</button>":"")+"                        "+("undefined"!=typeof a.okText?'<button type="button" class="btn '+a.okClass+' okbtn" data-dismiss="modal" '+c+b+">"+a.okText+"</button>":"")+"</div>                                                                                                                   </div>                                                                                                                       <!-- /.modal-content -->                                                                                                 </div>                                                                                                                       <!-- /.modal-dialog -->                                                                                                  </div>                                                                                                                       <!-- /.modal -->                                                                                                                     ",e=$(d);e.appendTo($el),"undefined"!=typeof a.okFunObj&&e.find(".okbtn").on("click",function(){a.okFunObj()}),"undefined"==typeof a.id||"undefined"!=typeof a.onKey&&!a.onKey||($("#"+a.id).on("keypress",function(b){13===b.keyCode&&(b.preventDefault(),$("#"+a.id+" .okbtn").click())}),$("#"+a.id).on("shown.bs.modal",function(){$("#"+a.id+" input").first().focus()}))},$.fn.tableSortable=function(a){var b=$(this);b.find("th").addClass("pointer").on("click",function(c,d){var d=$(this).index()+1,e=b.find("tbody tr");a&&(e=e.not(a));var f=$(this).data("isdesc");"undefined"==typeof f&&(f=!0),$(this).data("isdesc",!f),e.sort(function(a,b){var c=depersian($(a).find("td:nth-child("+d+")").text()),e=depersian($(b).find("td:nth-child("+d+")").text());return f?/^[0-9.]+$/.test(c)?d3.descending(+c,+e):d3.descending(c,e):/^[0-9.]+$/.test(c)?d3.ascending(+c,+e):d3.ascending(c,e)}),e.remove(),b.append(e)})},$.fn.tableBindSearchbox=function(a,b){var c=$(this),a=a instanceof $?a:$(a);a.keyup(function(){var a=$(this).val(),d=c.find("tbody tr");b&&(d=d.not(b)),d.each(function(){$(this).text().toLocaleLowerCase().indexOf(a.toLocaleLowerCase())==-1?$(this).hide():$(this).show()})})},jQuery.fn.progressbar=function(a,b){function c(){var a=d3.interpolate(0,h);return function(b){return j.endAngle(a(d3.easeLinear(b)))()}}if("stop"==a)return void d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var d=+a||25,e=d/5,f=2*d,g=2*d,h=2*Math.PI,i=+b||1e4,j=d3.arc().startAngle(0).innerRadius(d-e).outerRadius(d);d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var k=d3.select($(this).get(0)).append("svg").attr("width",f).attr("height",g).attr("class","sadaf-circular-timeout").append("g").attr("transform","translate("+f/2+","+g/2+")"),l=k.append("g").attr("class","progress-meter");
l.append("path").attr("class","background").style("fill","#666").style("opacity","0.2").attr("d",j.endAngle(h));var m=l.append("path").style("fill","#212121").attr("class","foreground");m.attr("d",j.endAngle(0*h)),m.transition().duration(i).attrTween("d",c)},$.extend($.datepicker,{_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+(c?0:$(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:$(document).scrollTop());return b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0),b.top<50&&(b.top=55),b}});var app=app||{};app.escapeBraket=function(a){return a.replace("[","\\\\[").replace("]","\\\\]")};var ngApp=angular.module("sadafMain",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services"]);ngApp.controller("dashboardMainPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","$translate","mainmenus","mostRecentMenus","favoriteMenus","appsPermissions",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var b=d.id||0;a.appLoading=!0,h.get(b).then(function(b){a.data=_.merge({},b.data),a.apps=b.data.list,a.isAdmin=b.data.isAdmin,a.hasAminPermission=b.data.hasAminPermission,a.userInfo=b.data.userInfo,a.brand=b.data.brand,a.path=_.reverse(b.data.parents),a.appLoading=!1,$(".dropdown.userinfo").dropdown(),_.each(a.apps,function(a){var b=m();a.detail=JSON.parse(a.detail||"{}"),a.detail.startColor||(a.detail.startColor=b[0]),a.detail.endColor||(a.detail.endColor=b[1])})})["catch"](function(){a.appLoading=!1})}function m(){var a=[["#03A9F4","#0277BD"],["#e91e63","#ad1457"],["#f44336","#b71c1c"],["#009688","#00695c"],["#ff9800","#ef6c00"],["#ffeb3b","#f9a825"],["#dce775","#c0ca33"],["#aed581","#7cb342"],["#ba68c8","#8e24aa"]],b=a[Math.ceil(8*Math.random())];return b}function n(){var a=m(),b=d.id||0,c={id:0,edit:!0,detail:{startColor:a[0],endColor:a[1]},parent:b,permissions:{ViewPermission:!0,EditPermission:!0,DeletePermission:!0}};return c}function o(){i.get().then(function(b){a.mostRecentMenus=b.data.list})["catch"](function(){}),j.get().then(function(b){a.favoriteMenus=b.data.list})["catch"](function(){})}a.mainMenuType=2,a.gApp=app,a.moment=moment,g.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),$(".ui.dimmer.modals .mainmenu-permission").remove(),a.cModel={name:"salam",invalidate:function(){a.$apply()}},a.appsPermissions=k,a.parent=d.id||0,a.roles=[],o(),a.add=function(){var b=n();a.apps.push(b)},a.save=function(a,b){a.progress=!0,h.save(a).then(function(c){a.progress=!1,a.id=c.data.id,a.name=c.data.name,a.detail=c.data.detail,a.editDesc=!1,a.edit=!1,b&&b(a)})["catch"](function(){a.progress=!1})},a.keyup=function(b,c){13===b.keyCode&&a.save(c),27===b.keyCode&&(c.edit=!1)},a.edit=function(a){a.edit=!0,f(function(){$(".app-"+a.id+" input").focus()},0)},a.editDesc=function(a){a.editDesc=!0,f(function(){$(".app-"+a.id+" textarea").focus()},0)},a.remove=function(b,c){var d=confirm("آیا برای حذف اطمینان دارید؟");if(d){if(!b.id)return void a.apps.splice(c,1);b.progressTrash=!0,h.remove(b.id).then(function(d){b.progressTrash=!1,a.apps.splice(c,1)})["catch"](function(){b.progressTrash=!1})}},a.settings=function(a,b){a.render||(a.render=!0,$(".app-"+a.id+" .popup-btn").popup({transition:"flip vertical",on:"click",popup:$(".app-"+a.id+" .setting-popup")}),$(".app-"+a.id+" .popup-btn").click())},a.previewFile=function(b,c){var d=b.files[0];if(d.size>35e3)return void alert("حجم فایل باید کمتر از ۳۵ کیلو بایت باشد");var e=new FileReader,g=$(b).attr("index");e.addEventListener("load",function(){f(function(){var b=a.apps[g];b.detail.pic=e.result,a.save(b)},0)},!1),d&&e.readAsDataURL(d)},a.search=function(b){console.log("### query ",b),b&&b.trim()||(a.searchResult=null),b.length<3||(a.searchProgress=!0,h.search(b).then(function(b){a.searchProgress=!1,a.searchResult=b.data})["catch"](function(){a.searchProgress=!1}))},a.addChild=function(b){var c=n();c.name="پروژه جدید",c.parent=b.id,a.save(c,function(a){e.path("/"+a.parent)})},a.$on("$routeChangeSuccess",function(){l()}),a.conf={id:0},a.showSettings=function(b){a.conf.id=b.id,$(".mainmenu-permission").modal("show"),$(".app-"+b.id+" .popup-btn").popup("hide")},a.savePermissions=function(){a.savePerProgress=!0;var b=_.filter(a.roles,{check:!0}).map(function(a){return{id:a.id,action:a.action}});h.savePermissions(a.conf.id,b).then(function(){a.savePerProgress=!1,$(".mainmenu-permission").modal("hide")})["catch"](function(){a.savePerProgress=!1})},a.mm={}}]),ngApp.service("appsPermissions",["$q","$rootScope","$compile","$timeout","mainmenus","$location",function(a,b,c,d,e,f){function g(f){var g=a.defer();$(".mainmenu-permission").remove();var h=$(".mainmenu-permission");if(!h.length){$pickerScope=b.$new(),$pickerScope.roles=[],$pickerScope.conf={id:f},$pickerScope.savePermissions=function(){$pickerScope.savePerProgress=!0;var a=_.filter($pickerScope.roles,{check:!0}).map(function(a){return{id:a.id,action:a.action}});e.savePermissions($pickerScope.conf.id,a).then(function(){$pickerScope.savePerProgress=!1,$(".mainmenu-permission").modal("hide")})["catch"](function(){$pickerScope.savePerProgress=!1})};var i=c('                <div class="ui modal mainmenu-permission">                    <div class="header">                        <h3 xstyle="margin-bottom:40px">مجوزها</h3>                    </div>                    <div class="content scrolling">                        <datasource-permission type="mainmenu" conf="conf" ng-model="roles"></datasource-permission>                        <div class="ui red message" role="alert" ng-show="error">                            <strong>خطا!</strong> <span ng-bind-html="error"></span>                        </div>                    </div>                    <div class="actions">                        <div class="ui button green" ng-class="{loading: savePerProgress}" ng-click="savePermissions()" ng-disabled="savePerProgress">                            {{ !savePerProgress ? (\'ذخیره\' | translate) : (\'در حال ذخیره‌سازی\' | translate)}}                        </div>                    </div>                </div>                ')($pickerScope);angular.element("[ng-app]").append(i)}return d(function(){h=$(".mainmenu-permission"),h.modal("show")},1),g.promise}function h(a){d(function(){f.path("/"+a)},0)}return{select:g,setPath:h}}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/:id",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardMainPage.html?v="+app.version,controller:"dashboardMainPageCtrl"}).otherwise({redirectTo:"/0"})}]),ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]);var logout=_.debounce(function(){alert("مهلت اعتبار ارتباط شما با سایت پایان یافته، لطفا دوباره وارد شوید"),document.location="/account/login"},1e3);ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401===b.status&&logout(),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);