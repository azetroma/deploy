// داشبورد مدیریتی صدف info@sadafdashboard.ir 

function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS)$/.test(a)}function fixLayout(a){if(!a)return void dashboard.resize();dashboard.showEmptyMessageIfNeed();var b=function(){if("undefined"!=typeof Storage&&!app.mobileMode){var a=localStorage.getItem("lastEditedChartId");if(localStorage.removeItem("lastEditedChartId"),!_.isUndefined(a)&&a){var b=$("."+a.replace("ID","cid")).offset();b&&$("html, body").animate({scrollTop:b.top-20,scrollLeft:b.left-20})}}};dashboard.drow(b)}var notification=angular.module("notificationCat",["semantic-ui"]);notification.controller("notificationController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){}]),notification.directive("notification",function(){return{scope:{ngModel:"=?"},controller:["$scope","notificationService",function(a,b){function c(){a.unreadCount=_.filter(a.notifications,{Readed:!1}).length}a.persian=persian,a.momet=moment,a.d3=d3,a.ngModel=a.ngModel||{},a.ngModel.show=!1,a.moment=moment,a.isNan=isNaN,a.$watch("notifications",function(b){a.ngModel.show=b&&b.length},!0),b.getUnreader().then(function(b){a.notifications=b,c()}),a.init=function(b){a.el=b},a.toggleRead=function(a){a.Readed=!a.Readed,b.toggleRead(a.Id,a.Readed),c()},a.remove=function(d,e){var f=confirm("برای حذف این هشدار اطمینان دارید؟");f&&$(".notification-box[index="+e+"]").transition("scale",400,function(){a.notifications.splice(e,1),b.remove(d.Id),c()})},a.readAll=function(){b.readAll(),_.each(a.notifications,function(a){a.Readed=!0}),c()},a.removeAll=function(){var d=confirm("برای حذف همه هشدارها اطمینان دارید؟");d&&(b.removeAll(),a.notifications=[],c(),a.el.popup("hide"))}}],templateUrl:app.urlPrefix+"dist/partial/dashboardPage/notification.html?v="+app.version}}),notification.service("notificationService",["$http",function(a){var b=function(){return a.get(app.urlPrefix+"api/notification/get").then(function(a){return _.each(a.data.notifications,function(a){0==a.Type&&(a.Content=JSON.parse(a.Content)),a.time=new Date(a.DateTime).getTime(),a.fromNow=moment(new Date(a.DateTime).getTime()).fromNow()}),a.data.notifications})},c=function(b,c){return a.post(app.urlPrefix+"api/notification/read?id="+b+"&read="+c)},d=function(b){return a.post(app.urlPrefix+"api/notification/delete?id="+b)},e=function(b){return a.post(app.urlPrefix+"api/notification/deleteAll")},f=function(b){return a.post(app.urlPrefix+"api/notification/readAll")};return{getUnreader:b,toggleRead:c,remove:d,removeAll:e,readAll:f}}]);var ngApp=angular.module("navbarCat",["pascalprecht.translate","ngSanitize"]);ngApp.factory("navbar",["$rootScope",function(a){var b=null;return{getOption:function(){return b},setOption:function(c){b=c,a.$broadcast("navbarChange")}}}]),ngApp.factory("drawer",[function(a){var b={init:function(){if(!$("body #drawer-overlay").length){var a='<div class="drawer-overlay" id="drawer-overlay"></div>';$("body").append(a),$("body #drawer-overlay").on("click",this.close)}},toggle:function(){$("body").hasClass("drawer-open")?$("body").removeClass("drawer-open"):$("body").addClass("drawer-open")},close:function(){$("body").removeClass("drawer-open")}};return{init:b.init,toggle:b.toggle,close:b.close}}]),ngApp.controller("navbarCtrl",["$scope","$http","$rootScope","navbar","drawer","$translate",function(a,b,c,d,e,f){a.toggle=function(){e.toggle()},f.use(0==+$("#lang").val()?"fa":"en"),a.urlPrefix=app.urlPrefix}]),angular.module("uibCollapseCat",[]).directive("uibCollapse",["$animate","$q","$parse","$injector",function(a,b,c,d){var e=d.has("$animateCss")?d.get("$animateCss"):null;return{link:function(d,f,g){function h(){f.hasClass("collapse")&&f.hasClass("in")||b.resolve(l(d)).then(function(){f.removeClass("collapse").addClass("collapsing").attr("aria-expanded",!0).attr("aria-hidden",!1),e?e(f,{addClass:"in",easing:"ease",to:{height:f[0].scrollHeight+"px"}}).start()["finally"](i):a.addClass(f,"in",{to:{height:f[0].scrollHeight+"px"}}).then(i)})}function i(){f.removeClass("collapsing").addClass("collapse").css({height:"auto"}),m(d)}function j(){return f.hasClass("collapse")||f.hasClass("in")?void b.resolve(n(d)).then(function(){f.css({height:f[0].scrollHeight+"px"}).removeClass("collapse").addClass("collapsing").attr("aria-expanded",!1).attr("aria-hidden",!0),e?e(f,{removeClass:"in",to:{height:"0"}}).start()["finally"](k):a.removeClass(f,"in",{to:{height:"0"}}).then(k)}):k()}function k(){f.css({height:"0"}),f.removeClass("collapsing").addClass("collapse"),o(d)}var l=c(g.expanding),m=c(g.expanded),n=c(g.collapsing),o=c(g.collapsed);d.$eval(g.uibCollapse)||f.addClass("in").addClass("collapse").attr("aria-expanded",!0).attr("aria-hidden",!1).css({height:"auto"}),d.$watch(g.uibCollapse,function(a){a?j():h()})}}}]);var ngApp=angular.module("sadaf",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services","ngMaterial"]);ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]);var logout=_.debounce(function(){alert("مهلت اعتبار ارتباط شما با سایت پایان یافته، لطفا دوباره وارد شوید"),document.location="/account/login"},1e3);ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401!==b.status||app.shareMode||logout(),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);var service=["$http","$interval",function(a,b){var c;return{start:function(){},stop:function(){b.cancel(c)}}}];try{var sadaf=angular.module("sadaf");sadaf.factory("heartBeat",service),sadaf.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}try{var management=angular.module("management");management.factory("heartBeat",service),management.run(["heartBeat",function(a){app.mobileMode||a.start()}])}catch(e){}var app=app||{};app.contentSegment=$("#content_segment"),app.contentSegmentModal=$("#content_segmentModal"),$.ajaxSetup({beforeSend:function(a,b){if(!csrfSafeMethod(b.type)&&!this.crossDomain){var c=$("input[name=__RequestVerificationToken]").val();a.setRequestHeader("__RequestVerificationToken",c)}}}),console||(console={},console.log=function(){}),app.chartLoadDelay=120,app.absoluteUrl="/",app.setAboluteUrl=function(a){app.absoluteUrl=a},app.loadContent=function(a){app.showLoadingProgress(),$("#content_segment").load(app.urlPrefix+a,function(){app.hideLoadingProgress(),app.lang.setLang()})},app.setContent=function(a){$("#content_segment").html(a),app.hideLoadingProgress(),app.lang.setLang()},app.setLocation=function(a){app.router.navigate(a,{trigger:!0})},app.urlPrefix="/",app.setUrlPrefix=function(a){app.urlPrefix=a.replace(/Moderation.*/g,"")},app.showInfo=function(a){$("#app-info-text").html(a),$("#app-info-text").fadeIn(),$("#app-loading-text").hide(),app.showInfoHolder.show(),setTimeout(function(){app.showInfoHolder.hide(),$("#app-info-text").fadeOut(400,function(){$("#app-loading-text").show()})},4e3)},app.showLoadingProgress=function(){app.showInfoHolder.show()},app.hideLoadingProgress=function(){app.showInfoHolder.hide()},app.showInfoHolder={holderCount:0,timeout:{},hide:function(){if(app.showInfoHolder.holderCount>0&&--app.showInfoHolder.holderCount,0==app.showInfoHolder.holderCount){var a=(new Date).getTime()-app.showInfoHolder.ticks;clearTimeout(app.showInfoHolder.timeout),setTimeout(function(){$("#app-loading").parent("div").animate({top:"0",opacity:0},400)},a<1e3?1e3:0)}},show:function(){var a=$("#app-loading").parent("div");a.css("left",$(window).width()/2-a.outerWidth()/2),++app.showInfoHolder.holderCount,app.showInfoHolder.ticks=(new Date).getTime(),app.showInfoHolder.timeout=setTimeout(function(){$("#app-loading").parent("div").animate({top:"50",opacity:1},400)},1e3)}},app.encodeHTML=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},app.convertOldPropObject=function(a,b){if(a){if(a.chartProp&&a.chartProp.info)return a;var c={};if(c.chartProp={},+b==chartTypes.TABLE){c.chartProp.info={chartSize:a.chartProp.chartSize,pivotTable:a.chartProp.pivotTable},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:a.seriesProp[""+d].table.headerName,numberFactor:"1",textAlign:a.seriesProp[""+d].table.textAlign,formatString:a.seriesProp[""+d].table.formatString,fontSize:a.seriesProp[""+d].table.fontSize,textBold:!1,textItalic:!1,color:a.seriesProp[""+d].table.fontColor}),c.chartProp.series["default"]={name:"",numberFactor:"1",textAlign:"right",formatString:"A",fontSize:"1m",textBold:!1,textItalic:!1,color:"#000000"}}if(+b==chartTypes.BAR){c.chartProp.info={chartSize:a.chartProp.chartSize,horizontalLines:a.chartProp.horizontalLine,formatString:a.chartProp.formatString},c.chartProp.series={};for(var d in a.seriesProp)a.seriesProp.hasOwnProperty(d)&&(c.chartProp.series[""+d]={name:"",numberFactor:a.seriesProp[""+d].barlineChartProp.numberFactor,seriesType:a.seriesProp[""+d].barlineChartProp.barlineChartType,seriesColor:a.seriesProp[""+d].barlineChartProp.barlineChartColor,lineType:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartStyle,lineStyle:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineStyle,lineWeight:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineWeight,lineFace:a.seriesProp[""+d].barlineChartProp.barlineChartTypeLineProp.lineChartLineDashes});c.chartProp.series["default"]={name:"",numberFactor:"1",seriesType:"bar",seriesColor:"#1f77b4",lineType:"line-dot-area",lineStyle:"linear",lineWeight:"2",lineFace:"5,0"}}return+b==chartTypes.PIE&&(c.chartProp.info={horizontalLines:a.chartProp.horizontalLine,chartSize:a.chartProp.chartSize,formatString:a.chartProp.formatString,pieStyle:a.chartProp.pieStyle,hole:"65"},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1"}),+b==chartTypes.GAUGE&&(c.chartProp.info={chartSize:a.chartProp.chartSize,style:a.chartProp.gaugeStyle,height:"medium",color:"#333333",fontSize:"3em",formatString:",.2f",status:"",target:"",textBold:!0,textItalic:!1,trend:"",value:"",segmentType:"singleSegment",min:"",yellow:"",green:"",max:""},c.chartProp.series={},c.chartProp.series["default"]={numberFactor:"1",type:"value",typeMs:"value"}),c.dataUrl=a.chartProp.DataUrl,c.editMode=a.chartProp.editMode,c}},app.autoPlayTimer=app.autoPlayTimer||{counter:0},app.autoPlay=function(a,b){if(a&&"start"==a){var c=function(a){b=b||10,$(".sadaf-circular-preogress").progressbar(10,1e3*+b),app.autoPlayTimer.timer=setTimeout(function(){document.location.href=app.urlPrefix+"#/app/"+a.appId+"/dashboard/"+a.id,$(".sadaf-circular-preogress").progressbar("stop"),app.autoPlay("start",b)},1e3*+b)};app.autoPlayTimer.links?c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length]):$.get(app.urlPrefix+"api/menus/get").done(function(a){app.autoPlayTimer.links=a,c(app.autoPlayTimer.links[app.autoPlayTimer.counter++%app.autoPlayTimer.links.length])})}a&&"stop"==a&&($(".sadaf-circular-preogress").progressbar("stop"),clearTimeout(app.autoPlayTimer.timer))};var resizeTimer;app.lestenWindowResize=function(a){function b(){clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){a()},400)}var c=$(window).width();$(window).resize(function(){$(window).width();$(window).width()!=c&&(c=$(this).width(),b())})};var designMenuTimer,printMenuTimer;app.onMenusClick=function(a,b){return"showPrintMenu"==a||"hidePrintMenu"==a?(clearTimeout(printMenuTimer),void(printMenuTimer=setTimeout(function(){"showPrintMenu"==a?$(".navbar .print-toggle").fadeIn():"hidePrintMenu"==a&&$(".navbar .print-toggle").fadeOut()},800))):(clearTimeout(designMenuTimer),designMenuTimer=setTimeout(function(){"showDesignMenu"==a?$(".navbar .design-toggle").fadeIn():"hideDesignMenu"==a&&$(".navbar .design-toggle").fadeOut(),b&&"showfullScreenMenu"==b?$(".navbar .fullscreen-toggle").parents(".pull-right").fadeIn():$(".navbar .fullscreen-toggle").parents(".pull-right").fadeOut()},800),void $("html,body").animate({scrollTop:0},"slow",function(){$(".side-menu").hasClass("open")&&$("#side-menu-toggle").click()}))},app.print={printSingle:function(a,b){var c=this.getWidgetHtml(a);app.print.print(c,b,null,null,a)},getWidgetHtml:function(a){var b=($(a).height(),$(a).width(),$(a).clone());b.find(".ui.dimmer .dimmer-info").html();b.find(".ui.dimmer ").remove(),b.find(".gs-resize-handle").remove(),b.find(" #sort_checkbox").remove(),b.find(" .comment").remove(),b.find(" .menu-bar").remove();var c=$("<div>").append(b).html();return c},printPage:function(){var a="",b=$("<div/>");b.append(a);$(".dashboard-page.active > a").text()},print:function(a,b,c,d,e){var f=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(f=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var g='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+f+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",h=window.open();h.window.onafterprint=function(){h.window.close()},h.document.write('<html><head><meta charset="utf-8"><title>'+b+"</title>"+g),h.document.write("</head><body>"),h.document.write(a),h.document.write("</body></html>"),h.document.close(),h.focus();try{var i=$(e).find("canvas")[0],j=h.document.getElementsByTagName("canvas")[0];j.width=i.width,j.height=i.height;var k=j.getContext("2d");k.drawImage(i,0,0)}catch(l){}setTimeout(function(){h.print(),h.window.onfocus=function(){}},400)},printHeaderFooter:function(a,b,c,d,e,f,g){function h(){return'<html>                                                                                                                        <head>                                                                         <meta http-equiv=Content-Type content="text/html; charset=unicode">    <title>'+b+"</title> "+j+"       <style>                                                                        body, html {                                                                   margin: 0;                                                                 direction: rtl;                                                            width: 21cm;                                                               font-family: IRMitra !important;                                           font-size: 21px;                                                           text-align: justify;                                                       color: black;                                                   }                                                                                                                                                            table.report-container {                                                       page-break-after: always;                                                  font-size:inherit;                                                         text-align: inherit;                                                   }                                                                                                                                                     thead.report-header {                                                          display: table-header-group;                                               background-color: #00000000;                                           }                                                                                                                                                     tfoot.report-footer {                                                          display: table-footer-group;                                               background-color: #00000000;                                           }                                                                                                                                                     .back {                                                                        position: fixed;                                                           top: 0;                                                                    z-index: -1;                                                           }                                                                                                                                                     u {                                                                            text-decoration: unset;                                                    border-bottom: 1px solid black;                                            line-height: 1;                                                            display: inline-block;                                                 }                                                                          .content {                                                                     width: 21cm;                                                               padding: 0 2cm;                                                        }                                                                                                                                                         .content p {                                                                   margin: 0;                                                                 line-height:1.9;                                                           margin-bottom: 10px;                                                   }                                                                                                                                                 @page {                                                                        margin: 0cm;                                                           }                                                                                                                                                                                                                                .center {                                                                      text-align: center;                                                    }                                                                                                                                                     .flex {                                                                        display: flex;                                                             -ms-flex-direction: row;                                                   -webkit-flex-direction: row;                                               flex-direction: row;                                                   }                                                                      </style>                                                               </head>                                                                                                                                               <body>                                                                         "+(e?'<img class="back" src="/api/upload/getPic/'+e+'" />':"")+'                                                                 <table class="report-container">                                                                <thead class="report-header">                                                                   <tr>                                                                                            <th>                                                                                            <div style="height:'+(f||3)+'cm">                                                                                       </div>                                                                                  </th>                                                                                   </tr>                                                                                   </thead>                                                                                    <tfoot class="report-footer">                                                                   <tr>                                                                                            <td>                                                                                            <div style="height:'+(g||3)+'cm">                                                                                       </div>                                                                                  </td>                                                                                   </tr>                                                                                   </tfoot>                                                                                    <tbody class="report-content">                                                                  <tr>                                                                                            <td>                                                                                            <div class="content"> '+a+"</div>                                                                                  </td>                                                                                   </tr>                                                                                   </tbody>                                                                                </table>                                                                                </body>                                                                                     </html>"}var i=1===c?"width: 297mm; height: 190mm;":"width: 210mm;height: 277mm;";"A5"==d&&(i=1===c?"width: 210mm; height: 148mm;":"width: 148mm;height: 210mm;");var j='<link href="'+app.absoluteUrl+"dist/css/dash-all"+(app.lang.isRtl?"-rtl":"")+".css?v="+app.version+'" rel="stylesheet" />                   <style  type="text/css">@page {                                margin: 1cm;                                size: '+("A5"==d?"A5":"A4")+" "+(1===c?"landscape":"portrait")+';                                @top-center {                                        content: "sadaf";                                    }                                }                                body { display: none;}                                @media print {html, body {'+i+"} body{display: block;}}                                .clusterize-scroll { max-height:initial !important;}                                img { max-width: 100%; display: block; margin: 0 auto;}                                body { overflow-y:auto; }                                .chart-data.bar-chart { display:block !important;}                                .ui.card .content { display:block;}                                .ui.card, .ui.cards >.card { -webkit-box-shadow: none;box-shadow: none;   height: auto;      }                                .chart-widget { width:auto !important;   height: auto !important;      }                    </style>",k=window.open();k.window.onafterprint=function(){k.window.close()},k.document.write(h()),k.document.close(),k.focus(),setTimeout(function(){k.print(),k.window.onfocus=function(){}},400)}},app.post=function(a,b,c){$.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json; charset=utf-8",traditional:!0,success:c})},app.lang={langType:0,setLangTyle:function(a){this.langType=+(a||0)},isRtl:function(){return 0==app.lang.langType},translate:function(a){return app.lang.lang?app.lang.lang[a]||a:a},q:[],translateAsync:function(a,b){app.lang.lang?b&&b(app.lang.lang[a]||a):this.q.push({key:a,callback:b})},setLang:function(a){if(a&&a.data&&(this.lang=a.data),this.lang||!this.inProgress){if(!this.lang&&!this.inProgress){var b=0==app.lang.langType?"fa":"en";this.inProgress=!0;var c=app.urlPrefix+"dist/locales/locale-"+b+".js?v="+app.version;return void $.getJSON(c,null,function(a){for(app.lang.setLang({data:a});app.lang.q.length>0;){var b=app.lang.q.pop();b.callback&&b.callback(app.lang.lang[b.key]||b.key)}})}var d;d=a&&a.selector?$(a.selector).find("*[data-trans-key]"):$("*[data-trans-key]"),d.each(function(){var a=$(this),b=a.data("translated");if(!b){var c=app.lang.lang[a.data("trans-key")],d=a.data("trans-attr");d?a.attr(d,c):a.text(c),a.data("translated",!0)}})}}};var app=app||{};app.filterBox=angular.module("filterBox",["ngAnimate"]),app.filterBox.controller("filterBoxController",["$scope","$http","$sce","$timeout","$rootScope",function(a,b,c,d,e){$("#filter-box-controller").data("scope",a),e.$on("app-filterbox-refresh",function(){a.refresh()}),a.getCleanValue=function(a){var b=/.*&\[(.*)\]/gi;return a.match(b)&&(a=a.replace(b,"$1")),a},a.refresh=function(){d(function(){a.otherFilters=[],_.forEach(app.chartCommons.drillDown.filters,function(b){_.forEach(b.drillDown,function(c){a.otherFilters.push({key:c.key,keyCaption:JSON.parse(c.key).join(", "),value:c.value,valueCaption:JSON.parse(c.value).join(", "),chartInPageId:b.chartInPageId,datasourceId:b.datasourceId,refreshDatasource:b.refreshDatasource})})}),a.userControlFilter=[],app.chartCommons.userFilter.filters.forEach(function(b){function d(a){switch(a){case"GetDate":return"امروز";case"MonthToDate":return"از ابتدای ماه تا امروز";case"YearToDate":return"از ابتدای سال تا امروز";case"minData":return"کمترین: "+b.defaultValue[0];case"maxData":return"بیشترین: "+b.defaultValue[0];case"DaysAgo":return persian(b.values[2]||0)+" روز قبل تا "+persian(b.values[3]||0)+" روز قبل";case"MonthAgo":return persian(b.values[2]||0)+" ماه قبل تا "+persian(b.values[3]||0)+" ماه قبل"}return""}var e={};e.key=b.dimensionName,e.disableClear=b.disableClear,e.chartInPageId=b.chartInPageId,b.valuesCaption?e.values=_.map(b.valuesCaption,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a}):e.values=_.map(b.values,function(a){var b=/.*&\[(.*)\]/gi;return a.toString().match(b)&&(a=a.replace(b,"$1")),a&&isNaN(a)?a.replace(/\[(calc|index)-\d+\]/,""):a});var f=e.values.join(", ");if(f.length>30&&(f=f.substring(0,30)+"..."),e.Caption=c.trustAsHtml(filterXSS(f)),3==+b.variableType)e.Caption=c.trustAsHtml(filterXSS(d(b.values[0])));else if(4==+b.variableType){var g={gr:"بزرگتر",eqgr:"بزرگتر مساوی",ls:"کوچکتر",eqls:"کوچکتر مساوی",eq:"برابر",nteq:"نابرابر"};e.Caption=c.trustAsHtml(filterXSS("<b>"+g[b.values[1]]+"</b> "+b.values[0]))}else 5==+b.variableType&&(e.Caption=c.trustAsHtml(filterXSS("<b>"+b.values[0]+"</b>"+("or"==b.values[1]?" در یکی از ":" در همه ")+": "+b.values[2])));e.refreshDatasource=b.refreshDatasource,e.label=e.key,7==+b.variableType&&(e.label="نام شاخص"),a.userControlFilter.push(e)})},0)},a.removeUserControl=function(b){var c=a.userControlFilter[b];a.userControlFilter.splice(b,1);var d=_.find(app.chartCommons.userFilter.filters,{chartInPageId:c.chartInPageId,dimensionName:c.key});_.isUndefined(d)||_.remove(app.chartCommons.userFilter.filters,d);var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f,0,e?e.chartProp.info.groups:null)},a.removeDrillDown=function(b){var c=a.otherFilters[b];a.otherFilters.splice(b,1);var d=_.find(app.chartCommons.drillDown.filters,{chartInPageId:c.chartInPageId});_.isUndefined(d)||_.remove(d.drillDown,{key:c.key});var e=$("#ID"+c.chartInPageId).data("settings"),f=[];c.refreshDatasource&&(f=c.refreshDatasource),e&&(f=e.input.RefreshDatasource),app.moderation.dashboadpage.refreshRelatedDatasources(f,0,e.chartProp.info.groups)},a.clearAll=function(){var b=[];_.each(a.otherFilters,function(a){var c=$("#ID"+a.chartInPageId).data("settings");c&&c.input&&_.isArray(c.input.RefreshDatasource)&&(b=_.concat(b,c.input.RefreshDatasource))}),_.each(a.userControlFilter,function(a){var c=$("#ID"+a.chartInPageId).data("settings");_.isArray(c&&c.input&&c.input.RefreshDatasource)&&!a.disableClear&&(b=_.concat(b,c.input.RefreshDatasource))}),app.chartCommons.drillDown.clearAll(!0),app.chartCommons.userFilter.filters=_.filter(app.chartCommons.userFilter.filters,{disableClear:!0}),a.refresh(),app.moderation.dashboadpage.refreshRelatedDatasources(_.uniq(b),0,"",!0)}}]),app.filterBox.refresh=function(){var a=angular.element("#filter-box-controller").scope();a||(a=$("#filter-box-controller").data("scope")),a&&(a.refresh(),a.$apply())},app.moderation=app.moderation||{},app.moderation.dashboadpage=app.moderation.dashboadpage||{},app.moderation.dashboadpage.globalFilterList=[],app.moderation.dashboadpage.syncWithGlobalFilter=function(a){if(null!=a)for(var b=0;b<a.length;b++){var c=$.grep(app.moderation.dashboadpage.globalFilterList,function(c){return c.Uniquename==a[b].Uniquename&&c.DataSourceId==a[b].DataSourceId&&c.CubeName==a[b].CubeName});0!=c.length&&(a[b].Members=c[0].Members.slice())}},app.moderation.dashboadpage.isRelated=!1,app.moderation.dashboadpage.onRelatedChange=function(a){app.moderation.dashboadpage.isRelated=a;for(var b=app.moderation.dashboadpage.charts,c=0;c<b.length;c++){var d=$("#ID"+b[c].pageId),e=d.data("settings");e.link="bold"}app.moderation.dashboadpage.isRelated?$(".glyphicon-link").show():$(".glyphicon-link").hide()},app.moderation.dashboadpage.showDimentions=function(){var a=$("#corelate-filter-list .filter-content").html();if(""==a.trim()){$(".glyphicon-link").addClass("link");for(var b=app.moderation.dashboadpage.charts,c=[],d=!0,e=0;e<b.length;e++){var f=$("#ID"+b[e].pageId),g=f.data("settings"),h=g.input.Dimentions;if(g.input.EditPermission)for(var i in h)for(var j=0;j<h[i].length;j++){var f={Uniquename:h[i][j],DataSourceId:g.input.DataSourceId,CubeName:g.input.CubeName,ChartId:g.chartId},k=$.grep(c,function(a){return a.Uniquename==f.Uniquename&&a.DataSourceId==f.DataSourceId&&a.CubeName==f.CubeName});0==k.length&&c.push(f)}else d=!1}var l=$("#corelate-filter-list .filter-content");l.html('<div style="padding:3px"><img style="width: 1.3em" src="'+app.urlPrefix+'Images/progress.gif" /><span  data-trans-key="در حال بارگذاری..."></span></div>'),0==c.length?($("#corelate-filter-list .filter-content").empty(),$("#corelate-filter-list .filter-content").html(d?"":"شما مجوز استفاده از این امکان را ندارید.")):$.ajax({type:"post",url:app.urlPrefix+"Charts/DashboardPage/GetHierarchies",data:JSON.stringify(c),contentType:"application/json; charset=utf-8"}).done(function(a){function b(a,b){if(null!=a)for(var c='<div class="container-fluid form-horizontal " style="margin-bottom:-15px;"><div class="form-group">',d=0,e=0,f=0;f<a.length;f++){
var g=a[f];null!=g.Members&&(f>0&&(3==e||d!=g.DataSourceId)&&(c+='</div><div class="form-group">',e=0),d!=g.DataSourceId&&f>0&&(c+='<hr style="margin-top: 5px;;"/>'),e++,d=g.DataSourceId,c+='<div class="col-md-4">                                    <div class="btn btn-default col-md-12 filter-member-dialog" style="overflow: hidden; text-overflow: ellipsis;"                                            CubeName="'+filterXSS(g.CubeName)+'" DataSourceId="'+g.DataSourceId+'" Uniquename="'+filterXSS(g.Uniquename)+'"                                             title="'+filterXSS(g.Caption)+'">'+filterXSS(g.Caption)+"</div></div>")}return c+="</div></div>"}if($("#corelate-filter-list .filter-content").empty(),!a.result)return void $("#corelate-filter-list .filter-content").html(filterXSS(a.message));var c=b(a.data,"");l.html(c),l.find(".filter-member-dialog").on("click",function(){var b=$(this),c=$(this).attr("Uniquename"),d=$(this).attr("DataSourceId"),e=$(this).attr("CubeName"),f=$.grep(a.data,function(a,b){return a.Uniquename==c&&a.DataSourceId==d&&a.CubeName==e})[0];app.helper.filterMemberDialog(f.Members,function(a){f.Members=a;var c=a.filter(function(a){return a.IsChecked}).map(function(a){return a.Caption}),d=f.Caption;c.length>3?d="انتخاب "+c.length+" از "+a.length:c.length>0&&(d=c.join(" و ")),b.text(d),app.moderation.dashboadpage.getWheres(f,f.DataSourceId)})})})}},app.moderation.dashboadpage.getWheres=function(a,b){if("undefined"!=typeof b){$.grep(a.Members,function(a){return a.IsChecked})}if(app.moderation.dashboadpage.isRelated){for(var c=app.moderation.dashboadpage.globalFilterList,d=app.moderation.dashboadpage.charts,e=!1,f=0;f<c.length;f++){var g=c[f];g.Uniquename==a.Uniquename&&g.DataSourceId==a.DataSourceId&&g.CubeName==a.CubeName&&(c[f]=$.extend({},a),e=!0)}e||c.push($.extend({},a));for(var f=0;f<d.length;f++){var h=$("#ID"+d[f].pageId),i=h.data("settings");if(i.input.DataSourceId==a.DataSourceId&&i.input.CubeName==a.CubeName&&$("#ID"+d[f].pageId+" .glyphicon-link").hasClass("link")){var j=($.inArray(a.Uniquename,i.input.Dimentions.Where)!=-1,$.inArray(a.Uniquename,i.input.Dimentions.Hierarchies)!=-1,$.inArray(a.Uniquename,i.input.Dimentions.SeriesLevel)!=-1,h.find("#filter").data("data"));"undefined"!=typeof j&&(app.moderation.dashboadpage.syncWithGlobalFilter(j.Where),app.moderation.dashboadpage.syncWithGlobalFilter(j.Hierarchies),app.moderation.dashboadpage.syncWithGlobalFilter(j.SeriesLevel)),i.titlebar.showProgress(!0);var k=$.extend({},a);k.Members=$.grep(a.Members,function(a){return a.IsChecked}),i.parameters={ChartInPageId:i.ChartInPageId,Filter:[k]},app.chartCommons.levelTypeUtils.getParam(i),h.charts(i.type,"refreshWithData",i)}}}},app.moderation.dashboadpage.refreshRelatedDatasources=function(a,b,c,d){b=b||[],a=a||[],b=b.map(function(a){return+a});var e=0;c=(c||"").split(","),$(".bar-chart").each(function(f){$el=$(this);var g=$el.data("settings");if("undefined"!=typeof g){var h=app.customChart.getConfig(g.type);if(h.needServerData!==!1&&"undefined"!=typeof g&&"undefined"!=typeof g.input&&!g.input.disableFilter&&b.indexOf(+g.ChartInPageId)===-1){var i=_.difference(a,g.input.RefreshDatasource);if(i.length!==a.length){7!==+g.type&&e++;var j=(g.chartProp.info.groups||"").split(",");if(d||!j.length&&!c.length||_.intersection(j,c).length){var k=app.chartCommons.getFilterParameter(g.ChartInPageId,g.input.RefreshDatasource),l=_.flatten(_.map(k.otherFilters,function(a){return a.drillDown})),m=!1;_.each(l,function(a){if(a.isLast){var b=null;try{b=_.find(g.input.filterException.fields,{UniqueName:a.formula[0]})}catch(c){b=null}b&&(m=!0)}}),m||setTimeout(function(a){g.titlebar&&g.titlebar.showProgress&&g.titlebar.showProgress(!0),app.chartCommons.levelTypeUtils.getParam(g),a.charts(g.type,"refreshWithData",g,{refreshRelatedDatasources:!1})},7==+g.type?0:e*app.chartLoadDelay,$el)}}}}})},app.moderation.dashboadpage.selectValueOnChart=function(a,b){var c=a.chartInPageId;return+a.Id==-1?(app.chartCommons.userFilter.setFilter({id:a.Id,values:a.Values,variableType:a.VariableType,dimensionName:a.dimensionName,chartInPageId:a.chartInPageId,datasourceId:a.datasourceId}),app.moderation.dashboadpage.refreshRelatedDatasources(b,[+c]),void app.filterBox.refresh()):void $.ajax({type:"POST",url:app.urlPrefix+"api/GlobalVariable/SetValueForUser",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(a),success:function(a){a.result?(app.moderation.dashboadpage.refreshRelatedDatasources(a.relatedDatasource,[+c]),app.filterBox.refresh()):alert(a.Message)}})};var app=app||{};app.dashboardLayoutVersion=2;var dashboard={defuals:{maxCols:12},charts:[],pageInfo:{},pageId:-1,arrangePer:!1,minChartSize:{1:[500,250],2:[350,350],3:[300,200],4:[300,300],5:[500,300],6:[300,200],7:[350,50],8:[300,300],9:[300,300]},padding:10,maxCols:12,baseDimantion:{y:30},serialize:function(){dashboard.gs.serialize()},drillDownResize:function(a,b){},setMaxCols:function(){var a=dashboard.getPagePosition();dashboard.maxCols=a?a.maxCol||12:12,$("#dashboard-col").val(dashboard.maxCols)},setInfo:function(a,b,c,d,e){this.arrangePer=d||!1,this.charts=a||[],this.pageInfo=b||{chartsOrder:[],layout:[],pageLayout:"30_30_30"},this.pageId=c||-1,this.forms=e||[],this.charts=this.charts.concat(this.forms),this.setMaxCols()},disable:function(){dashboard.gs.disable(),dashboard.gs.disable_resize()},enable:function(){dashboard.gs.enable(),dashboard.gs.enable_resize()},saveSerialize:function(){dashboard.serializeData=dashboard.gs.serialize();var a=dashboard.serializeData.map(function(a){var b;return b="form"===a.type?a.id:a.data.ChartInPageId,{type:a.type,chartIdPageId:b,col:a.wgd.col,row:a.wgd.row,size_x:a.wgd.size_x,size_y:a.wgd.size_y}}),b={pageId:this.pageId,chartsPosition:a,media:dashboard.media,maxCol:dashboard.maxCols};try{"undefined"==typeof dashboard.pageInfo.layout&&(dashboard.pageInfo.layout=[]);var c=dashboard.pageInfo.layout.filter(function(a){return a.media===dashboard.media});c.length>0?c[0].chartsPosition=a:dashboard.pageInfo.layout.push({media:dashboard.media,chartsPosition:a,maxCol:dashboard.maxCols})}catch(d){}$.ajax({type:"POST",url:app.urlPrefix+"api/DashboardPage/SetChartsOrder",dataType:"json",contentType:"application/json;charset=utf-8",traditional:!0,data:JSON.stringify(b),success:function(a){}})},add:function(a,b,c,d,e){b=b>dashboard.maxCols?dashboard.maxCols:b,d=d>dashboard.maxCols?dashboard.maxCols:d,dashboard.gs.add_widget(a,b,c,d,e)},initGs:function(a){return dashboard.baseDimantion={x:$(".gridster").width()/dashboard.maxCols,y:50},dashboard.gs=$(".gridster>div").gridster({widget_margins:[0,0],widget_base_dimensions:[dashboard.baseDimantion.x,dashboard.baseDimantion.y],max_cols:dashboard.maxCols,min_cols:dashboard.maxCols,min_rows:1e3,resize:{enabled:!0,stop:function(a,b,c){dashboard.saveSerialize();var d=$(c).data("type");if("form"!==d){var e=$(c).find(".chart-data").data("settings");e.isDashboardResize=!0,$(c).find(".chart-data").charts(e.type,"refresh",e),e.widgetSize.size_y=+$(c).attr("data-sizey"),e.widgetSize.size_x=+$(c).attr("data-sizex")}}},serialize_params:function(a,b){var c=a.data("type"),d=a.data("id");return{type:c,id:d,data:a.find(".chart-data").data("settings"),wgd:b}},draggable:{handle:".content > .move, content > .move b, .content .title-content",cancel:".desc",start:function(a,b){},drag:function(a,b){},stop:function(a,b){$(b.$helper).removeClass("player-revert"),dashboard.saveSerialize()}}}).data("gridster"),a||(dashboard.gs.disable(),dashboard.gs.disable_resize()),dashboard.gs},deleteAll:function(){$("#ID0").data("settings");dashboard.gs.remove_widget($("#ID0"))},deleteChartFromGs:function(a,b){var c=$(a).parents(".chart-widget");dashboard.gs.remove_widget(c),b&&b()},getPagePosition:function(){var a=dashboard.pageInfo.layout.filter(function(a){return a.media<=dashboard.media}).sort(function(a,b){return+b.media-+a.media});if(0==a.length){var b=_.map(dashboard.pageInfo.layout,function(a){return a.media}),c=-1,d=1e3;_.each(dashboard.pageInfo.layout,function(a,b){var e=Math.abs(a.media-dashboard.media);e<d&&(d=e,c=b)}),c!=-1&&(a=[dashboard.pageInfo.layout[c]],a[0].media=b,a[0].maxCols=dashboard.maxCols)}return a[0]},getChartPosition:function(a,b,c){var d,e=null,f=1e3;"form"===a.type?(e="form",d=a.id):(d=a.pageId,f=+a.type);var g=dashboard.minChartSize[+f]||[300,300],h={col:1,row:1e3,size_x:Math.floor(g[0]/dashboard.baseDimantion.x)+1,size_y:Math.floor(g[1]/dashboard.baseDimantion.y)+1},i=[];try{var j=dashboard.getPagePosition();i=j.chartsPosition.filter(function(a){return a.chartIdPageId===d&&(!a.type||a.type===e)})}catch(k){}return i[0]||h},sortCharts:function(){try{this.charts.sort(function(a,b){try{var c=dashboard.getChartPosition(a),d=dashboard.getChartPosition(b),e=c.row==d.row?c.col>d.col?1:c.col<d.col?-1:0:c.row>d.row?1:c.row<d.row?-1:0;return e}catch(f){return-1e3}})}catch(a){Error(a)}},addTasks:[],drow:function(a){dashboard.initGs(this.arrangePer),dashboard.sortCharts();var b=0;this.charts.forEach(function(c,d){7!=+c.type&&b++;var e=b,f=setTimeout(function(){dashboard.addChart(c,null,!1,e*app.chartLoadDelay),d==dashboard.charts.length-1&&a&&a()},50*d);dashboard.addTasks.push(f)})},resize:function(){this.setMaxCols();var a=$(".chart-data").map(function(a,b){return $(b).data("settings")}).toArray();$(".gridster").remove(),$("#dashboard-chart-panel").html('<div class="gridster"><div></div></div>'),dashboard.initGs(this.arrangePer),a.forEach(function(a){dashboard.addChart(null,a,!0)}),dashboard.forms&&_.each(dashboard.forms,function(a){dashboard.addChart(a)})},addChart:function(a,b,c,d,e){var f;if(a&&"form"===a.type){var g=dashboard.getChartPosition(a),h=app.absoluteUrl+"sadaf/management/#/forms/"+a.id,i=!1,j="javascript:dashboard.deleteForm("+a.id+")",k=!1,l="";f=$('<div data-type="form" data-id="'+a.id+'" class="chart-widget"></div>');var m=dashboard.getFormTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.name,o,a.lastRefresh,l,k);f.append(m),f.find(".title-content").text(a.name),dashboard.add(f,g.size_x,g.size_y,g.col,g.row),$("body").trigger("form-widget-add",[a.id]),app.lang.setLang({selector:"div[data-type=form][data-id="+a.id+"]"})}else{"undefined"==typeof d&&(d=0),b&&(a={id:b.chartId,pageId:b.ChartInPageId,title:"undefined"!=typeof b.title?b.title:b.input.title,type:b.type.id,isCustom:b.type.isCustom,permissions:b.permissions,lastRefresh:b.lastRefresh,desc:b.desc});var n={chartId:a.id,ChartInPageId:a.pageId},o="ID"+a.pageId,p=b;b||(p=JSON.parse(a.detail));var q=p.chartProp.info||{},r=app.customChart.getConfig({isCustom:a.isCustom,id:+a.type},q),s=r.needServerData!==!1;q.dontShowTitle===!0&&(r.noTitle=!0),r.noTitle&&(q.dontShowTitle=!0),q.noPadding===!0&&(r.noPadding=!0);var k=!(!s||!a.isCustom&&7==+a.type),i=!(!s||!a.isCustom&&7==+a.type),h=app.absoluteUrl+"sadaf/management/#/charts/edit/0/"+n.chartId,j="javascript:dashboard.deleteChart("+n.ChartInPageId+", "+n.chartId+", "+a.permissions.DeletePermission+")",l=$("<p />");_.isEmpty(a.desc)||(l.html("<br/><b>"+app.lang.translate("desc")+":</b> "),l.append($("<span />").text(a.desc)));var t="combo-kpi"==p.dataType,m=dashboard.getChartTemplate(this.arrangePer,a.permissions.EditPermission,h,j,i,a.title,o,a.lastRefresh,l,k,t,r,q);if(f=$("<div class='chart-widget cid"+a.pageId+"'></div>"),e&&c&&e.find(".chart-data").data("isChart")?f=e.find(".chart-widget.cid"+a.pageId):f.append(m),f.find(".title-content").remove(),a.title&&!q.dontShowTitle&&(f.find(".title").append('<span class="title-content"></span>'),f.find(".title-content").text(a.title),f.find(".title-content").attr("title",a.title),f.find(".header.move").remove()),f.find(".desc-content").append(l),app.chartCommons.setBackground(f.find(".ui.card "),q),q.titleFont){var u=q.titleFont.align||"";app.lang.isRtl()||(u="right"===u?"left":"left"===u?"right":u),f.find(".ui.card .title-content").css({"font-size":q.titleFont.fontSize,color:q.titleFont.color,"font-family":q.titleFont.fontName,"font-weight":q.titleFont.bold?"bold":"normal","font-style":q.titleFont.italic?"italic":"normal","text-align":u}),f.find(".ui.card .title").css({"line-height":"1"})}f.find(".ui.card .title").css({"line-height":"1.2"}),r.noPadding&&f.find(".ui.card .title + .description").addClass("chart-fit-to-container"),a.permissions.Filter||f.find(".icon.filter").remove(),a.permissions.Description||f.find(".icon.info").remove(),a.permissions.Comment||f.find(".icon.comments").remove(),a.permissions.ExportExcel||f.find(".item.export-excel").remove(),a.isCustom&&f.find(".export-png").remove();var b=b||$.extend({permissions:a.permissions,parameters:n,chartId:n.chartId,editLink:h,removeLink:j,RemoveFromPage:this.arrangePer,ChartInPageId:a.pageId,input:{RefreshDatasource:a.RefreshDatasource},lastRefresh:a.lastRefresh,desc:a.desc,type:a.type,isCustom:a.isCustom},p);if(g=dashboard.getChartPosition(a),b.widgetSize=g,e)return void(c&&e.find(".chart-data").data("isChart")?e.find(".chart-data").charts(b.type,c,b):(e.append(f),f.find(".menu-bar ").remove(),f.find(".chart-data").charts(b.type,b)));if(dashboard.add(f,g.size_x,g.size_y,g.col,g.row),c&&e&&e.find(".chart-data").data("isChart"))f.find(".bar-chart").data("settings",b),f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refresh",b,!0);else{var v=setTimeout(function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},b)},a.isCustom||7!==+a.type?d:0);dashboard.addTasks.push(v)}app.lang.setLang({selector:".chart-widget.cid"+a.pageId})}f.find(".show-extra-info").on("click",function(){f.find(".ui.card .ui.dimmer.overflow-auto").dimmer("show")}),f.find(".dimmer-info").on("click",function(){f.find(".ui.card .ui.dimmer").dimmer("hide")}),f.find(".refresh-chart").on("click",function(){f.find(".chart-data").charts({id:a.type,isCustom:a.isCustom},"refreshWithData",b,!0),f.find(".bar-chart").data("settings").titlebar.showProgress(!0)}),f.find(".export-excel").on("click",function(){var a=f.find(".chart-data").data("settings");app.chartCommons.setFilterParameter(a);try{a.parameters.TableInfo.IsPageValid=!0}catch(c){}$.ajax({type:"POST",url:app.urlPrefix+"api/BarChart/ExportToExcel",data:JSON.stringify({ChartId:b.chartId,ChartInPageId:b.ChartInPageId,TableInfo:a.parameters.TableInfo,IsPivot:1===+p.chartProp.info.aggregation,drillDown:a.parameters.drillDown,userControlFilter:a.parameters.userControlFilter,userVariable:a.parameters.userVariable,otherFilters:a.parameters.otherFilters,filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId)}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){window.location=app.urlPrefix+"api/BarChart/Download?name="+a.id}})}),f.find(".export-png").on("click",function(){var b=f.get(0);html2canvas(b,{background:null,scale:5,useCORS:!0,onclone:function(b){$(b).find(".cid"+a.pageId+" .header").remove(),$(b).find(".cid"+a.pageId+" .menu-bar").remove(),$(b).find(".cid"+a.pageId+" .title-content").css("padding","10px 0"),$(b).find(".cid"+a.pageId+" #sort_checkbox").remove(),$(b).find(".cid"+a.pageId+" .comment").remove(),$(b).find(".cid"+a.pageId+" .ui.card").css("background","none"),$(b).find(".cid"+a.pageId+" rect.background").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart .line").css("fill","none"),$(b).find(".cid"+a.pageId+" .line-chart circle").css("fill","#fff"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("fill","none"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke-width","1px"),$(b).find(".cid"+a.pageId+" .pie-chart polyline").css("stroke","#000"),$(b).find(".cid"+a.pageId+" *").css("font-family","IRANSans,Droid,Tahoma,Arial"),$(b).find(".cid"+a.pageId+" .map-container  #state-borders").css("fill","none")}}).then(function(b){b.fillStyle=null,b.fillRect=null,b.toBlob(function(b){saveAs(b,a.title+".png")})})}),f.find(".export-print").on("click",function(){app.print.printSingle(".cid"+a.pageId,a.title)}),f.find(".clone-chart").on("click",function(){app.post(app.urlPrefix+"api/Charts/CloneChart",{Id:b.chartId,PageId:dashboard.pageId},function(a){if(a.result&&a.insertedId){var b=a.insertedId,c=app.urlPrefix+"api/dashboards/getSingleChartInfo?chartId="+b+"&chartInPageId="+a.chartInPageId;$.get(c,function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1),$("html, body").animate({scrollTop:$(document).height()-$(window).height()},1e3)})}})}),f.find(".chart-dimentions").on("click",function(){f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade")}),f.find(".show-chart-dimensions").on("click",function(){var a=f.find(".chart-dimentions-content");f.find(".chart-dimentions-content").transition("fade up"),f.find(".chart-dimentions").transition("fade"),""==a.html()&&(a.html('<div class="ui text active loader">در حال بارگذاری</div>'),$.ajax(app.urlPrefix+"api/chartdata/GetChart?Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId).done(function(c){function d(a,b){return null!=a?"<ul class='sortable list-unstyled pointer' index='"+b+"'>"+a.map(function(a,b){return a.ShowFilter?'<li value="'+filterXSS(a.Uniquename)+'">  '+filterXSS(a.Caption)+'<i class="icon filter filter-member-dialog" style="float:left; margin-right:5px;"></i></li>':'<li value="'+filterXSS(a.Uniquename)+'"> '+filterXSS(a.Caption)+"</li>"}).join("")+"</ul>":""}function e(){function d(b,c){var d=b[c],e=[];a.find("ul[index="+c+"] li").each(function(a,b){var c=$(this).attr("value"),f=$.grep(d,function(a){return a.Uniquename==c})[0];f.Members=$(this).data("members"),e.push(f)}),b[c]=e}d(c,"Hierarchies"),d(c,"Where"),d(c,"SeriesLevel");var e=function(a){b.parameters={filterHierarchy:app.chartCommons.getFilterHierarchy(b.ChartInPageId),chartId:b.chartId,ChartInPageId:b.ChartInPageId},$("#ID"+b.ChartInPageId).charts({id:b.type,isCustom:b.isCustom},"refreshWithData",b,{refreshRelatedDatasources:!1})};e(c)}a.data("data",c);var f=null,g=null,h=null;f=d(c.Hierarchies,"Hierarchies"),g=d(c.Where,"Where"),h=d(c.SeriesLevel,"SeriesLevel");var i='<table class="ui single line unstackable table chart-design" xstyle="display:none" xstyle="position:absolute;margin-bottom:0px; background-color:#fff;display:none; border-bottom:1px solid silver">                                           <thead><tr class="">                                             <th style="'+(""==h?"display:none":"")+'"><span data-trans-key="شاخص‌ها (ستون‌های عددی)" > </span> </th>                                             <th style="'+(""==f?"display:none":"")+'"><span data-trans-key="ابعاد (ستون‌های رشته‌ای)" > </span> </th>                                             <th style="'+(""==g?"display:none":"")+'"><span data-trans-key="شرط" > </span></th>                                         </tr></thead>                                         <tr>                                             <td  style="'+(""==h?"display:none":"")+'"id="div-x" class="myc">'+h+'</td>                                             <td  style="'+(""==f?"display:none":"")+'"id="div-y" class="myc">'+f+'</td>                                             <td  style="'+(""==g?"display:none":"")+'"id="div-where" class="myc">'+g+"</td>                                         </tr>                                     </table>";a.html(i),a.find(".filter-member-dialog").on("click",function(){function a(a,b){app.helper.filterMemberDialog(a,b,function(a){d.data("members",a),e()})}var d=$(this).parent(),f=$(this).parent().attr("value"),g=c[$(this).closest("ul").attr("index")],h=($.grep(g,function(a,b){return a.Uniquename==f})[0],$(this).parent().data("members")),i=app.urlPrefix+"api/chartdata/GetMemberOfFilterHierarchy?Uniquename="+f+"&Id="+b.chartId+"&ChartInPageId="+b.ChartInPageId;"undefined"==typeof h?$.ajax(i).done(function(b){$(this).parent().data("members",b),a(b,i)}):a(h,i)}),a.find(".sortable").sortable({start:function(a,b){b.placeholder.addClass("filter-placeholder"),b.placeholder.height(b.item.height()),b.placeholder.width(b.item.width()),b.placeholder.parent().width(b.item.width()),b.placeholder.parent().parent().width(b.item.width())},stop:function(a,b){e()}}),app.lang.setLang({selector:a.selector})}))}),f.find(".dropdown").lazyDropdown({onShow:function(a,b){f.find(".menu-bar").addClass("show-dropdown")},onHide:function(a,b){f.find(".menu-bar").removeClass("show-dropdown")}}),this.showEmptyMessageIfNeed()},showEmptyMessageIfNeed:function(){0==dashboard.charts.length?$("#chart-empty-message").hasClass("hidden")&&$("#chart-empty-message").transition("scale in"):$("#chart-empty-message").hasClass("hidden")||$("#chart-empty-message").transition("scale out")},deleteChart:function(a,b,c){if(a)c?$("#deleteChart .checkbox").show():$("#deleteChart .checkbox").hide(),$("#deleteChart").data("cId",a),$("#deleteChart").data("chartId",b),$("#deleteChart").modal("show");else{var a=$("#deleteChart").data("cId"),b=$("#deleteChart").data("chartId"),d=app.urlPrefix+"api/dashboardPage/removeChartFromPage";$("#deleteChart .action-btn").addClass("loading"),$.post(d,{ChartInPageId:a,pageId:dashboard.pageId},function(b){if(0==b)return void alert("شما مجوز پاک کردن این نمودار را ندارید");for(var c,d=0;d<dashboard.charts.length;d++)if(dashboard.charts[d].pageId==a){c=dashboard.charts[d].pageId,dashboard.charts.splice(d,1)}dashboard.deleteChartFromGs("#ID"+c,function(){$(this).remove(),dashboard.showEmptyMessageIfNeed()}),$("#deleteChart").modal("hide"),$("#deleteChart .action-btn").removeClass("loading")});var e=$("#delete-from-dash").prop("checked");e&&$.post(app.urlPrefix+"api/Charts/DeleteCharts",{Ids:["ChartId-"+b]},function(a){})}},deleteForm:function(a){$("body").trigger("delete-form",[a,dashboard.pageId])},setReturnUrl:function(a){app.mobileMode||(localStorage.setItem("returnUrl",window.location.href),localStorage.setItem("lastEditedChartId",a))},getChartTemplate:function(a,b,c,d,e,f,g,h,i,j,k,l){return'<div class="ui card">  <div class="content" style="">    <div class="header '+(a?"move":"")+'" style="position:absolute; width:50%;z-index:2;">&nbsp;</div>    <div class="title'+(l.noTitle===!0?" no-title ":a?" move":"")+'">            <div class="menu-bar" style="z-index:3;">                <i class="icon titlebar-icon" style="xbackground: #fff;width: 100%;position: absolute;display: block;top: 0;height: 100%;"></i>                '+(app.mobileMode?e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"":'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon titlebar-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit outline icon"></i></a>':"")+"                          "+(b?' <a class="item clone-chart"><span data-trans-key="تکرار" > </span> <i class="clone outline icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف نمودار از صفحه" > </span> <i class="trash alternate outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-excel"><span data-trans-key="خروجی اکسل" > </span> <i class="file excel outline icon"></i></a>':"")+"                          "+(j?'<a class="item export-png"><span data-trans-key="export png"> </span> <i class="camera icon"></i></a>':"")+"                          "+(e?'<a class="item refresh-chart">'+app.lang.translate("data refresh")+' <i class="refresh icon"></i></a>':"")+"                          "+(j?'<a class="item export-print"><span data-trans-key="print" > </span> <i class="print icon"></i></a>':"")+'                        </div>                </div>                <div class=" ">                    '+(e?'<i class="info icon chart-setting-icon show-extra-info pointer titlebar-icon"></i>':"")+"                    "+(!e||k?"":'<i class="filter icon chart-setting-icon show-chart-dimensions pointer titlebar-icon"></i>')+"                    "+(e&&app.commentOnChart?'<i class="comments icon chart-setting-icon show-chart-comments pointer titlebar-icon"></i>':"")+"                </div>")+'            </div>            </div>    <div class="description chart-data bar-chart" id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader mini"></div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: '+(app.mobileMode?"0":"4")+'px !important;"><div class="content"><div class="center"><div class="dimmer-info"><b>'+app.lang.translate("lastUpdate")+':</b> <span class="last-refresh"> </span><div class="desc-content"></div></div></div></div></div></div>'},getFormTemplate:function(a,b,c,d,e,f,g,h,i,j){return'<div class="ui card ">  <div class="content" style="background-color:#f4f6f9;">    <div class="header '+(a?"move":"")+'">            <div class="menu-bar ">                '+(a||b?'<div class="ui dropdown" >                        <i class="setting icon chart-setting-icon"></i>                        <div class=" menu transition hidden" tabindex="-1">                          '+(b?' <a class="item"  href="'+c+'" onclick="dashboard.setReturnUrl(\''+g+'\')"><span data-trans-key="ویرایش" > </span> <i class="edit icon"></i></a>':"")+"                          "+(a?'<a class="item" href="'+d+'"><span data-trans-key="حذف" > </span> <i class="trash alternate outline icon"></i></a>':"")+"                                                   </div>                </div>":"")+'                <div class="">                   <i xclass="info icon chart-setting-icon show-extra-info pointer"></i>                </div>            </div>        <span class="title-content"></span>    </div>    <div class="description form-content " id="'+g+'">      <div class="ui active inverted dimmer ">        <div class="ui text loader tiny">'+app.lang.translate("در حال بارگذاری")+'</div>      </div>    </div>  </div>  <div class="progress-overall"></div>  <div class="chart-dimentions"></div>  <div class="chart-dimentions-content"></div>  <div class="ui dimmer overflow-auto" style="padding:10px;border-radius: 4px !important;"><div class="content"><div class="center"><div class="dimmer-info desc-content"></div></div></div></div></div>'},setLastRefresh:function(a,b){var c=$(".cid"+a+" .last-refresh");c.html(app.chartCommons.lastRefreshDateFormat(b))}},ngApp=angular.module("sadaf");ngApp.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$last===!0&&a(function(){b.$emit(d.onFinishRender)})}}}]),ngApp.directive("sglclick",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.sglclick),f=200,g=0,h=null;c.on("click",function(a){g++,1===g?h=setTimeout(function(){b.$apply(function(){e(b,{$event:a})}),g=0},f):(clearTimeout(h),g=0)})}}}]),ngApp.controller("dashboardPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","drawer","$translate","$rootScope","$compile","formsService","dashboardContainerService","chartComments","iframeService","datasources",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){function a(){$(window).width()<768?(dashboard.media=1,dashboard.maxCols=1):$(window).width()<992?(dashboard.media=2,dashboard.maxCols=1):$(window).width()<1200?(dashboard.media=3,dashboard.maxCols=12):(dashboard.media=4,dashboard.maxCols=12),"print"==dashboard.mode&&(dashboard.media=6,dashboard.maxCols=12);try{var a=dashboard.getPagePosition();dashboard.maxCols=a&&a.length&&a[0].maxCol||12}catch(b){Error(b)}$("#dashboard-col").val(dashboard.maxCols),$("#device-selector .icon").removeClass("active"),$($("#device-selector .icon").get(4-dashboard.media)).addClass("active")}function b(a,b){if(dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.pageInfo.layout.filter(function(b){return+b.media==+a});c.length>0&&(c[0].maxCol=b)}}_renderBefor=!0,a(),app.lestenWindowResize(function(){0!=$("#dashboard-chart-panel").length&&(a(),fixLayout(!1))}),$("#dashboard-col").on("change",function(){var a=dashboard.getPagePosition();a.maxCol=+$(this).val()||dashboard.maxCols,dashboard.resize(dashboard.arrangePer),dashboard.saveSerialize(),b(dashboard.media,dashboard.maxCols)});$("#device-selector .item").on("click",function(a){var b=$(this);if($("#device-selector .icon").removeClass("active"),b.find(".icon").addClass("active"),dashboard.media=4-b.index(),dashboard.pageInfo&&dashboard.pageInfo.layout){var c=dashboard.getPagePosition();dashboard.maxCols=c.length>0&&c[0].maxCol?c[0].maxCol:4==dashboard.media||3==dashboard.media?12:1,$("#dashboard-col").val(dashboard.maxCols),dashboard.resize(dashboard.arrangePer)}});var c=null,d=$('<div class="copy-handler"></div>').css("position","fixed").css("display","none");$("body").append(d),$("#device-selector .icon").mousedown(function(a){var b=a.currentTarget;c=$(b).attr("id"),d.show(),setTimeout(function(){c=null},3e3)}),$("#device-selector .icon").mouseup(function(a){var b=a.currentTarget;if(target=$(b).attr("id"),null!=c&&c!=target){var d=function(a){return"laptop"==a?4:"tablet"==a?3:"smartphone-land"==a?2:1},e=dashboard.pageInfo.layout.indexOf(dashboard.pageInfo.layout.filter(function(a){return a.media==+d(target)})[0]),f=$.extend({},dashboard.pageInfo.layout.filter(function(a){return a.media==+d(c)})[0]);f.media=+d(target),dashboard.pageInfo.layout.splice(e,1,f);var g=dashboard.media;dashboard.media=f.media,dashboard.saveSerialize(),dashboard.media=g,c=null,alert("cope done!")}}),$(".freeze-menu").on("hide.bs.collapse",function(){$(".freeze-menu").addClass("hide-aff")}).on("show.bs.collapse",function(){$(".freeze-menu").removeClass("hide-aff")}),$(".freeze-menu").on("affixed.bs.affix",function(){$(".freeze-menu.affix").css("width",$("#content_segment").width()+"px")})}function q(){window.parent.postMessage("ready","*")}function r(b){a.menuCategories=b.data;var c=b.data.defaultId;a.reorderPermission=b.data.reorderPermission;var f=d.id||w||c,g=d.appid||$("#appId").val()||b.data.appId||1;d.id||e.path("app/"+g+"/dashboard/"+f),a.menuCategories&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.open=!0,a.active=!0,b.active=!0)})})}function s(){a.routeChangeSuccess&&a.getMenusData&&r(a.getMenusData)}function t(){$(".ui.modal#edit-menus").modal("show"),$(".ui.modal#edit-menus input[type=text]").off("keyup"),$(".ui.modal#edit-menus input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#edit-menus .ui.button.btn-primary").click()})}function u(){$(".ui.modal#edit-menus").modal("hide")}function v(){var b=$(window).width()<=723,c=$(".side-menu");b||a.isFullscreen?($(".toc-toggle").show(),c.removeClass("my-fix no-padd no-margin"),c.addClass("sidebar right  menu fixed vertical"),$(".main-container").addClass("mobile")):($(".toc-toggle").hide(),c.addClass("my-fix no-padd no-margin"),c.removeClass("sidebar right  menu fixed vertical"),$(".main-container").removeClass("mobile")),b?$(".full-screen-toggle").hide():$(".full-screen-toggle").show()}if(a.mainMenuType=2,a.iframeService=n,p(),h.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),g.init(),a.pageOrientation="1",a.pageOrientationChange=function(){dashboard.media="0"==a.pageOrientation?5:6,$("style[name=size]").remove();var b='<style name="size">@page {padding:0; margin: 1cm; size: A4 landscape;}</style>';"0"==a.pageOrientation&&(b='<style name="size">@page {padding:0; margin: 1cm; size: A4 portrait;}</style>'),$("head").append(b),f(function(){dashboard.resize(dashboard.arrangePer)},0)},q(),a.setPath=function(a){e.path(a)},a.$watch("visible",function(b){b||(a.formId=0,a.rowId=0)}),a.hideForm=function(){$.jqmodal.close()},a.formInfo={modalSettings:{closable:!1,observeChanges:!0,autofocus:!1,allowMultiple:!0}},a.dashboardOptions={toggleFav:function(){b.post(app.urlPrefix+"api/favoritemenus/favorite",{id:dashboard.pageId,fav:!a.dashboardOptions.isFav
}).then(function(b){a.dashboardOptions.isFav=b.data.isFav,$(".top-menu .icon.heart").transition("pulse")})["catch"](function(){})},isFav:!1},a.publishDashboard={show:function(){a.publishDashboard.showModal=!0},showModal:!1,publishProgress:!1,publish:!1,setPublishState:function(b){b?(a.publishDashboard.url=b,a.publishDashboard.publish=!0):a.publishDashboard.publish=!1},publishing:function(c){this.publishProgress=!0,b.post(app.urlPrefix+"api/dashboards/publish",{id:dashboard.pageId,enable:c}).then(function(b){a.publishDashboard.publishProgress=!1,a.publishDashboard.setPublishState(b.data)})["catch"](function(){a.publishDashboard.publishProgress=!1})}},i.$on("publish-url",function(b,c){a.publishDashboard.setPublishState(c.url)}),i.$on("fav",function(b,c){a.dashboardOptions.isFav=c.isFav,a.dashboardOptions.showTitle=c.showTitle,a.dashboardOptions.showTitleFullscreen=c.showTitleFullscreen}),a.formSettings={modal:!0,xc:!1,selector:"singletone-edit"},$("body").on("open-form",function(b,c,d,e,f,g){"delete-all"!==f&&$(".modal.form-editor.singletone-edit").jqmodal({escapeClose:!1,clickClose:!1,showClose:!1,fadeDuration:0,closeExisting:!1});var h=a.formSettings.notify;h(c,d,f,g)}),$("body").on("form-widget-add",function(b,c){f(function(){var b=$("div[data-type=form][data-id="+c+"] .form-content");b.html('<div class="" sadaf-form id="'+c+'" settings="{pop:true}"></div>'),j(b)(a)},0)}),$("body").on("delete-form",function(b,d,e){f(function(){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("آیا فرم از صفحه حذف شود؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف..."),k.deleteFormFromDashboard(e,[d]).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),u();var c=$("div[data-type=form][data-id="+d+"]");dashboard.gs.remove_widget(c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},0)}),$("body").on("show-chart-comments",function(b,c){f(function(){a.comment={value:null,ok:function(){var b=app.chartCommons.getFilterParameter(c.chartInPageId,c.input.RefreshDatasource);m.save(0,{chartId:c.chartId,dashboardId:c.dashboardId,datasourceId:c.datasourceId,dimention:c.dimention,input:JSON.stringify(c.input),drillDown:b.drillDown,otherFilters:b.otherFilters,userControlFilter:b.userControlFilter,userVariable:b.userVariable,where:c.where,comment:a.comment.value}).then(function(a){}),$(".ui.modal#input-comments").modal("hide")}},$(".ui.modal#input-comments").modal("show"),$(".ui.modal#input-comments input[type=text]").off("keyup"),$(".ui.modal#input-comments input[type=text]").on("keyup",function(a){13==a.keyCode&&$(".ui.modal#input-comments .ui.button.btn-primary").click()})},0)}),i.$on("permission-change",function(b,c){a.hasEditPermission=c,$(".dashboard-edit-panel").css("visibility","visible"),c?$(".dashboard-edit-panel").fadeIn():$(".dashboard-edit-panel").fadeOut()}),a.$on("ngRepeatFinished",function(){$(".side-menu .ui.dropdown").lazyDropdown({onShow:function(){$(this).parents(".side-menu-item").addClass("show-dropdown")},onHide:function(){$(this).parents(".side-menu-item").removeClass("show-dropdown")}})}),!app.mobileMode){var w=+localStorage.getItem("defaultDashboard");$("#dashboardPublishMenuId").val()&&(w=$("#dashboardPublishMenuId").val())}if(!app.mobileMode){a.$on("$routeChangeSuccess",function(){a.routeChangeSuccess=!0,s()});var x=a.$on("$routeChangeSuccess",function(){var c=d.appid||$("#appId").val()||1;return 1==+$("#isShared").val()?(a.getMenusData={result:!0,defaultId:$("#dashboardPublishMenuId").val(),appId:5,hasAminPermission:!1,data:[],hasAddPer:!1,reorderPermission:!1,licenceRemain:{}},void s()):void b.get(app.urlPrefix+"api/menus/MenuCategories/"+c).then(function(b){a.getMenusData=b,s(),x()},function(a){!app.mobileMode&&a&&a.data&&a.data.forceSignout?(console.log("مجوز برنامه مشکل دارد."),alert("مجوز برنامه مشکل دارد."),window.location.href=app.urlPrefix+"account/logoff"):window.location.href=app.urlPrefix+"sadaf/main"})})}var y=0;a.sortableOptions={disabled:!a.editMode,start:function(a,b){f(function(){y=$(b.item).parents(".menu-category").data("id")},0)},stop:function(c,d){f(function(){a.isDrag=!1;var c=$(d.item).parents(".menu-category").data("id"),e=$(d.item).data("id"),f=$(d.item).parents(".menu-category").find(".dashboard-menu").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"api/menus/ChangeMenuOrder",{FromCategoryId:y,list:f,menuId:e,parentCategoryId:c}).then(null,function(a){alert(a.data.title+" - "+a.data.desc)})},0)},connectWith:".connected-sortable"},a.sortableCatOptions={disabled:!a.editMode,stop:function(a,c){f(function(){var a=$(".menu-category").map(function(){return+$(this).data("id")}).toArray();b.post(app.urlPrefix+"api/menus/ChangeMenuCategoryOrder",a)},0)}},a.clearActive=function(){a.menuCategories&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1,_.each(a.menus,function(a){a.active=!1})})},a.closeAll=function(b){var c=b.open;a.menuCategories&&!a.editMode&&_.each(a.menuCategories.data,function(a){a.open=!1,a.active=!1}),b.open=!c,b.active=!c},a.editMode=!1,a.toggleEdit=function(){a.editMode=!a.editMode,$("div[ui-sortable=sortableOptions]").sortable("option","disabled",!a.editMode),$("div[ui-sortable=sortableCatOptions]").sortable("option","disabled",!a.editMode),a.editMode?$(".icon.sort").transition("set looping").transition("pulse"):$(".icon.sort").transition("remove looping")},a.isFullscreen=$("#isFullscreen").val(),a.fullscreenToggle=function(){a.isFullscreen=!a.isFullscreen,v(),dashboard.resize(),b.post(app.urlPrefix+"api/users/toogleFullscreen?isFullScreen="+a.isFullscreen),a.isFullscreen||(app.autoPlay("stop"),a.slidePlay=!1)},a.slidePlayToggle=function(){a.slidePlay=!a.slidePlay,a.slidePlay?app.autoPlay("start",dashboard.PageSwiching||10):app.autoPlay("stop")},a.print=function(){window.location=app.urlPrefix+"sadaf/print/"+window.location.hash},a["export"]=function(){window.location=app.urlPrefix+"api/charts/exportByDashboard/"+dashboard.pageId},a.backToDash=function(){window.location=app.urlPrefix+""+window.location.hash},a.addChart=function(){o.select(null,{type:["charts"]}).then(function(a){var b=_.map(a.selected,function(a){return a.id});b.forEach(function(a){var b=app.urlPrefix+"api/dashboards/addChartToPage";$.post(b,{chartId:a,pageId:dashboard.pageId},function(a){dashboard.charts.push(a),dashboard.addChart(a,null,!1)})})})},a.$on("$locationChangeStart",function(b,c,d){if(/\/app\/\d+\/dashboard\/\d+/.test(e.path())){var f=+e.path().replace(/\/app\/\d+\/dashboard\/(\d+)/gi,"$1");a.clearActive(),a.menuCategories&&a.menuCategories.data&&_.each(a.menuCategories.data,function(a){_.each(a.menus,function(b){b.menu.Id==f&&(a.active=!0,a.open=!0,b.active=!0)})})}}),a.modal={body:c.trustAsHtml(""),btnClass:"btn-primary",btnText:"ذخیره",inProgress:!1},a.addFormSettings={},a.onFormSelect=function(b){a.addFormSettings.loaging=!0,k.addFormToDashboard(dashboard.pageId,b.map(function(a){return a.id})).then(function(c){a.addFormSettings.loaging=!1,a.addFormSettings.visible=!1,_.each(b,function(a){var b=_.extend({},a);b.type="form",dashboard.charts.push(b),dashboard.addChart(b)})})},a.hideModal=function(){u()},a.addMenuToCategory=function(f){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var g=app.urlPrefix+"api/DashboardPage/addMenu";b.post(g,{menuName:a.modal.val,menuCategory:f.category.Id,mainMenu:d.appid,menulink:""}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),$("#dashboard-page-modal").modal("hide"),f.menus=f.menus||[],f.menus.push(b.data),e.path("/app/"+d.appid+"/dashboard/"+b.data.menu.Id),u()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.editCategory=function(e){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,label:app.lang.translate("نام جدید را وارد کنید"),val:e.category.Name,ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var f=app.urlPrefix+"api/DashboardPage/editMenu";b.post(f,{menuName:a.modal.val,menuCategory:e.category.Id,mainMenu:d.appid}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),e.category.Name=b.data.Name,u()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.deleteCategory=function(d,e){a.modal={btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، گروه <b>"+filterXSS(d.category.Name)+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال حذف...");var f=app.urlPrefix+"api/DashboardPage/deleteMenu";b.post(f,{menuCategory:d.category.Id,deletePermanent:a.modal.deletePermanent}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),a.menuCategories.data.splice(e,1),u()},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.editMenu=function(d,e){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("تغییر"),inProgress:!1,val:d.menu.Name,label:app.lang.translate("نام جدید را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال تغییر...");var e=app.urlPrefix+"api/DashboardPage/editMenu";b.post(e,{menuName:a.modal.val,menuId:d.menu.Id}).then(function(b){a.modal.btnText=app.lang.translate("تغییر"),$("#dashboard-page-modal").modal("hide"),d.menu.Name=b.data.Name,u()},function(b){a.modal.btnText=app.lang.translate("تغییر"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.deleteMenu=function(f,g,h){a.modal={showPermanent:!0,deletePermanent:!1,btnClass:"btn-danger red",btnText:app.lang.translate("حذف"),inProgress:!1,body:c.trustAsHtml("با انتخاب گزینه حذف، منوی <b>"+filterXSS(f.menu.Name)+"</b> حذف می‌شود. آیا اطمینان دارید؟"),ok:function(){a.modal.btnText=app.lang.translate("در حال حذف...");var i=app.urlPrefix+"api/DashboardPage/deleteMenu";b.post(i,{menuId:f.menu.Id,menuCategory:g.category.Id,deletePermanent:a.modal.deletePermanent}).then(function(b){a.modal.btnText=app.lang.translate("حذف"),$("#dashboard-page-modal").modal("hide"),g.menus.splice(h,1),u();var c=$(".side-menu-item-child").data("id");e.path("/app/"+d.appid+"/dashboard/"+c)},function(b){a.modal.btnText=app.lang.translate("حذف"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.duplicateMenu=function(a,c){b.post(app.urlPrefix+"api/menus/DuplicateMenu/"+a.menu.Id,c.category.Id).then(function(a){c.menus=c.menus||[],c.menus.push(a.data.item),u()},function(a){alert(a.data)})},a.addCat=function(){a.modal={btnClass:"btn-primary green",btnText:app.lang.translate("ساختن"),inProgress:!1,label:app.lang.translate("نام منو را وارد کنید"),ok:function(){a.modal.inProgress=!0,a.modal.btnText=app.lang.translate("در حال ساختن...");var e=app.urlPrefix+"api/DashboardPage/addMenu";b.post(e,{menuName:a.modal.val,mainMenu:d.appid}).then(function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,$("#dashboard-page-modal").modal("hide"),a.menuCategories=a.menuCategories||{},a.menuCategories.data=a.menuCategories.data||[];var c={category:{Id:b.data.menu.Id,MainMenuId:b.data.menu.MainMenuId,Name:b.data.menu.Name,Type:b.data.menu.Type},hasAddPer:!0,hasDeletePer:!0,hasEditPer:!0,open:!0,menus:[]};a.menuCategories.data.push(c),u()},function(b){a.modal.btnText=app.lang.translate("ساختن"),a.modal.inProgress=!1,a.modal.error=b.data,"undefined"==typeof a.modal.error.title&&(a.modal.error=c.trustAsHtml(filterXSS(b.data)))})}},t()},a.closeSidebar=function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("hide")},a.cancelRequests=function(){for($(".chart-data").each(function(){var a=$(this).data("ajaxRequest");a&&a.abort()});dashboard.addTasks.length;){var a=dashboard.addTasks.pop();clearTimeout(a)}},$(".toc-toggle").on("click",function(){$(".ui.sidebar").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("toggle")}),$(window).resize(function(){v()}),v()}]),ngApp.service("dashboardContainerService",function(){function a(a){console.log("### call renderBody"),a()}return{renderBody:a}}),ngApp.controller("dashboardPageBodyCtrl",["$scope","$http","$sce","$routeParams","navbar","$timeout","drawer","$q","$rootScope","dashboardContainerService",function(a,b,c,d,e,f,g,h,i,j){function k(){a.progress=!0,b({method:"GET",url:m,timeout:dashboard.canceler.promise}).then(function(b){a.progress=!1;var c=$(window).width()<=723,e=!c&&b.data.arrangePer;if(document.title=b.data.name,a.$parent&&(a.$parent.name=b.data.name),l(b.data,e),a.paramkey&&!app.mobileMode){var f=JSON.parse(localStorage.getItem("filter-params")||"[]");app.chartCommons.clearFilterParamsCache(f);var g=_.find(f,{dash:+d.id,key:d.paramkey});g&&(app.chartCommons.drillDown.filters=g.data.drillDown,app.chartCommons.userFilter.filters=g.data.userFilter)}i.$broadcast("app-filterbox-refresh"),i.$broadcast("publish-url",{url:b.data.publishUrl}),i.$broadcast("fav",{isFav:b.data.isFav,showTitleFullscreen:b.data.showTitleFullscreen,showTitle:b.data.showTitle}),i.$broadcast("permission-change",e),b.data.ForceChangePass&&$(".ui.modal#change-pass").modal("setting","closable",!1).modal("show")})["catch"](function(b){console.log("### Error",b),a.progress=!1,3===b.data.type?$("#update-message").transition("in scale"):$("#no-page-message").transition("in scale")})}function l(a,b){$("body").removeClass("full-height-container"),$(".main-container").addClass("full-height-container"),app.chartCommons.drillDown.clearAll(),app.chartCommons.userFilter.setUserControlFilters(a.userControlFilters),dashboard.setInfo(a.charts,a.pageInfo,a.pageId,b,a.forms),dashboard.PageSwiching=a.PageSwiching,app.dashboardLayoutVersion=2;app.urlPrefix+"api/dashboardpage/setchartsorder";app.moderation.dashboadpage.isRelated=!1,fixLayout(!0)}a.app=app,g.close(),a.model="param: "+d.id,a.paramkey=d.paramkey;var m=app.urlPrefix+"api/dashboards/get/"+d.id;dashboard.canceler&&dashboard.canceler.resolve("http call aborted"),dashboard.canceler=h.defer(),$(document).ready(function(){j.renderBody(k)})}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/app/:appid/dashboard/:id/:paramkey?",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardBody.html?v="+app.version,controller:"dashboardPageBodyCtrl"}).otherwise({redirectTo:"/nothings"})}]),jQuery.fn.createModal=function(a){$el=$(this),0==$el.length&&($el=$("#content_segmentModal")),$el.find("#"+a.id).remove();var b="undefined"!=typeof a.okId?' id="'+a.okId+'" ':"",c="undefined"!=typeof a.okFun?' onclick="'+a.okFun+'" ':"";"undefined"!=typeof a.okFunObj&&(c="");var d=' <div class="modal '+("undefined"==typeof a.Fade||a.Fade?"fade":"")+'" id="'+a.id+'" tabindex="-1" role="dialog" aria-labelledby="'+a.id+'Label" aria-hidden="true">          <div class="modal-dialog">                                                                                                       <div class="modal-content">                                                                                                      <div class="modal-header">                                                                                                       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                                 <h4 class="modal-title">'+a.title+'</h4>                                                                       </div>                                                                                                                       <div class="modal-body">                                                                                                         '+a.body+'                                                                                                     </div>                                                                                                                       <div class="modal-footer">                                                                                                      '+("undefined"!=typeof a.cancelText?' <button type="button" class="btn btn-default" data-dismiss="modal" >'+a.cancelText+"</button>":"")+"                        "+("undefined"!=typeof a.okText?'<button type="button" class="btn '+a.okClass+' okbtn" data-dismiss="modal" '+c+b+">"+a.okText+"</button>":"")+"</div>                                                                                                                   </div>                                                                                                                       <!-- /.modal-content -->                                                                                                 </div>                                                                                                                       <!-- /.modal-dialog -->                                                                                                  </div>                                                                                                                       <!-- /.modal -->                                                                                                                     ",e=$(d);e.appendTo($el),"undefined"!=typeof a.okFunObj&&e.find(".okbtn").on("click",function(){a.okFunObj()}),"undefined"==typeof a.id||"undefined"!=typeof a.onKey&&!a.onKey||($("#"+a.id).on("keypress",function(b){13===b.keyCode&&(b.preventDefault(),$("#"+a.id+" .okbtn").click())}),$("#"+a.id).on("shown.bs.modal",function(){$("#"+a.id+" input").first().focus()}))},$.fn.tableSortable=function(a){var b=$(this);b.find("th").addClass("pointer").on("click",function(c,d){var d=$(this).index()+1,e=b.find("tbody tr");a&&(e=e.not(a));var f=$(this).data("isdesc");"undefined"==typeof f&&(f=!0),$(this).data("isdesc",!f),e.sort(function(a,b){var c=depersian($(a).find("td:nth-child("+d+")").text()),e=depersian($(b).find("td:nth-child("+d+")").text());return f?/^[0-9.]+$/.test(c)?d3.descending(+c,+e):d3.descending(c,e):/^[0-9.]+$/.test(c)?d3.ascending(+c,+e):d3.ascending(c,e)}),e.remove(),b.append(e)})},$.fn.tableBindSearchbox=function(a,b){var c=$(this),a=a instanceof $?a:$(a);a.keyup(function(){var a=$(this).val(),d=c.find("tbody tr");b&&(d=d.not(b)),d.each(function(){$(this).text().toLocaleLowerCase().indexOf(a.toLocaleLowerCase())==-1?$(this).hide():$(this).show()})})},jQuery.fn.progressbar=function(a,b){function c(){var a=d3.interpolate(0,h);return function(b){return j.endAngle(a(d3.easeLinear(b)))()}}if("stop"==a)return void d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var d=+a||25,e=d/5,f=2*d,g=2*d,h=2*Math.PI,i=+b||1e4,j=d3.arc().startAngle(0).innerRadius(d-e).outerRadius(d);d3.select($(this).get(0)).select(".sadaf-circular-timeout").remove();var k=d3.select($(this).get(0)).append("svg").attr("width",f).attr("height",g).attr("class","sadaf-circular-timeout").append("g").attr("transform","translate("+f/2+","+g/2+")"),l=k.append("g").attr("class","progress-meter");l.append("path").attr("class","background").style("fill","#666").style("opacity","0.2").attr("d",j.endAngle(h));var m=l.append("path").style("fill","#212121").attr("class","foreground");m.attr("d",j.endAngle(0*h)),m.transition().duration(i).attrTween("d",c)},$.extend($.datepicker,{_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+(c?0:$(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:$(document).scrollTop());return b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0),b.top<50&&(b.top=55),b}});var app=app||{};app.escapeBraket=function(a){return a.replace("[","\\\\[").replace("]","\\\\]")};var ngApp=angular.module("sadafMain",["sadafForms","ngRoute","filterBox","navbarCat","ui.sortable","pascalprecht.translate","ngSanitize","uibCollapseCat","notificationCat","services"]);ngApp.controller("dashboardMainPageCtrl",["$scope","$http","$sce","$routeParams","$location","$timeout","$translate","mainmenus","mostRecentMenus","favoriteMenus","appsPermissions",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var b=d.id||0;a.appLoading=!0,h.get(b).then(function(b){a.data=_.merge({},b.data),a.apps=b.data.list,a.isAdmin=b.data.isAdmin,a.hasAminPermission=b.data.hasAminPermission,a.userInfo=b.data.userInfo,a.brand=b.data.brand,a.path=_.reverse(b.data.parents),a.appLoading=!1,$(".dropdown.userinfo").dropdown(),_.each(a.apps,function(a){var b=m();a.detail=JSON.parse(a.detail||"{}"),a.detail.startColor||(a.detail.startColor=b[0]),a.detail.endColor||(a.detail.endColor=b[1])})})["catch"](function(){a.appLoading=!1})}function m(){var a=[["#03A9F4","#0277BD"],["#e91e63","#ad1457"],["#f44336","#b71c1c"],["#009688","#00695c"],["#ff9800","#ef6c00"],["#ffeb3b","#f9a825"],["#dce775","#c0ca33"],["#aed581","#7cb342"],["#ba68c8","#8e24aa"]],b=a[Math.ceil(8*Math.random())];return b}function n(){var a=m(),b=d.id||0,c={id:0,edit:!0,detail:{startColor:a[0],endColor:a[1]},parent:b,permissions:{ViewPermission:!0,EditPermission:!0,DeletePermission:!0}};return c}function o(){i.get().then(function(b){a.mostRecentMenus=b.data.list})["catch"](function(){}),j.get().then(function(b){a.favoriteMenus=b.data.list})["catch"](function(){})}a.mainMenuType=2,a.gApp=app,a.moment=moment,g.use(0==+$("#lang").val()?"fa":"en"),a.persian=persian,a.isPersian=0==+$("#lang").val(),$(".ui.dimmer.modals .mainmenu-permission").remove(),a.cModel={name:"salam",invalidate:function(){a.$apply()}},a.appsPermissions=k,a.parent=d.id||0,a.roles=[],o(),a.add=function(){var b=n();a.apps.push(b)},a.save=function(a,b){a.progress=!0,h.save(a).then(function(c){a.progress=!1,a.id=c.data.id,a.name=c.data.name,a.detail=c.data.detail,a.editDesc=!1,a.edit=!1,b&&b(a)})["catch"](function(){a.progress=!1})},a.keyup=function(b,c){13===b.keyCode&&a.save(c),27===b.keyCode&&(c.edit=!1)},a.edit=function(a){a.edit=!0,f(function(){$(".app-"+a.id+" input").focus()},0)},a.editDesc=function(a){a.editDesc=!0,f(function(){$(".app-"+a.id+" textarea").focus()},0)},a.remove=function(b,c){var d=confirm("آیا برای حذف اطمینان دارید؟");if(d){if(!b.id)return void a.apps.splice(c,1);b.progressTrash=!0,h.remove(b.id).then(function(d){b.progressTrash=!1,a.apps.splice(c,1)})["catch"](function(){b.progressTrash=!1})}},a.settings=function(a,b){a.render||(a.render=!0,$(".app-"+a.id+" .popup-btn").popup({transition:"flip vertical",on:"click",popup:$(".app-"+a.id+" .setting-popup")}),$(".app-"+a.id+" .popup-btn").click())},a.previewFile=function(b,c){var d=b.files[0];if(d.size>35e3)return void alert("حجم فایل باید کمتر از ۳۵ کیلو بایت باشد");var e=new FileReader,g=$(b).attr("index");e.addEventListener("load",function(){f(function(){var b=a.apps[g];b.detail.pic=e.result,a.save(b)},0)},!1),d&&e.readAsDataURL(d)},a.search=function(b){console.log("### query ",b),b&&b.trim()||(a.searchResult=null),b.length<3||(a.searchProgress=!0,h.search(b).then(function(b){a.searchProgress=!1,a.searchResult=b.data})["catch"](function(){a.searchProgress=!1}))},a.addChild=function(b){var c=n();c.name="پروژه جدید",c.parent=b.id,a.save(c,function(a){e.path("/"+a.parent)})},a.$on("$routeChangeSuccess",function(){l()}),a.conf={id:0},a.showSettings=function(b){a.conf.id=b.id,$(".mainmenu-permission").modal("show"),$(".app-"+b.id+" .popup-btn").popup("hide")},a.savePermissions=function(){a.savePerProgress=!0;var b=_.filter(a.roles,{check:!0}).map(function(a){return{id:a.id,action:a.action}});h.savePermissions(a.conf.id,b).then(function(){a.savePerProgress=!1,$(".mainmenu-permission").modal("hide")})["catch"](function(){a.savePerProgress=!1})},a.mm={}}]),ngApp.service("appsPermissions",["$q","$rootScope","$compile","$timeout","mainmenus","$location",function(a,b,c,d,e,f){function g(f){var g=a.defer();$(".mainmenu-permission").remove();var h=$(".mainmenu-permission");if(!h.length){$pickerScope=b.$new(),$pickerScope.roles=[],$pickerScope.conf={id:f},$pickerScope.savePermissions=function(){$pickerScope.savePerProgress=!0;var a=_.filter($pickerScope.roles,{check:!0}).map(function(a){return{id:a.id,action:a.action}});e.savePermissions($pickerScope.conf.id,a).then(function(){$pickerScope.savePerProgress=!1,$(".mainmenu-permission").modal("hide")})["catch"](function(){$pickerScope.savePerProgress=!1})};var i=c('                <div class="ui modal mainmenu-permission">                    <div class="header">                        <h3 xstyle="margin-bottom:40px">مجوزها</h3>                    </div>                    <div class="content scrolling">                        <datasource-permission type="mainmenu" conf="conf" ng-model="roles"></datasource-permission>                        <div class="ui red message" role="alert" ng-show="error">                            <strong>خطا!</strong> <span ng-bind-html="error"></span>                        </div>                    </div>                    <div class="actions">                        <div class="ui button green" ng-class="{loading: savePerProgress}" ng-click="savePermissions()" ng-disabled="savePerProgress">                            {{ !savePerProgress ? (\'ذخیره\' | translate) : (\'در حال ذخیره‌سازی\' | translate)}}                        </div>                    </div>                </div>                ')($pickerScope);angular.element("[ng-app]").append(i)}return d(function(){h=$(".mainmenu-permission"),h.modal("show")},1),g.promise}function h(a){d(function(){f.path("/"+a)},0)}return{select:g,setPath:h}}]),ngApp.config(["$routeProvider","$locationProvider",function(a,b){a.when("/:id",{templateUrl:app.urlPrefix+"dist/partial/dashboardPage/su.dashboardMainPage.html?v="+app.version,controller:"dashboardMainPageCtrl"}).otherwise({redirectTo:"/0"})}]),ngApp.config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:app.urlPrefix+"dist/locales/locale-",suffix:".js"}),a.preferredLanguage("fa"),a.useSanitizeValueStrategy("sanitizeParameters")}]),ngApp.config(["$locationProvider",function(a){a.hashPrefix("")}]);var logout=_.debounce(function(){alert("مهلت اعتبار ارتباط شما با سایت پایان یافته، لطفا دوباره وارد شوید"),document.location="/account/login"},1e3);ngApp.factory("httpResponseInterceptor",["$q","$rootScope","$location",function(a,b,c){return{responseError:function(b){return 401===b.status&&logout(),a.reject(b)}}}]),ngApp.config(["$httpProvider",function(a){a.interceptors.push("httpResponseInterceptor");var b=$("input[name=__RequestVerificationToken]").val();a.defaults.headers.post.__RequestVerificationToken=b}]);